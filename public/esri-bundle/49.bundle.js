(function(){(this||window).webpackJsonp.registerAbsMids({"esri/views/3d/layers/SceneLayerGraphicsView3D":2154,"esri/views/layers/support/popupUtils":2188,"esri/views/3d/layers/graphics/QueryEngine":2217,"esri/views/3d/layers/graphics/Graphics3DFrustumVisibility":2218,"esri/views/3d/layers/support/DefinitionExpressionSceneLayerView":2222,"esri/views/3d/layers/support/fieldProperties":2223,"esri/views/3d/layers/graphics/Graphics3DVerticalScale":2260,"esri/renderers/support/renderingInfoUtils":2261,"esri/views/3d/layers/graphics/Graphics3DFeatureLikeLayerView":2262,"esri/views/3d/layers/graphics/Graphics3DFilterVisibility":2263,"esri/views/3d/layers/support/PopupSceneLayerView":2274,"esri/views/3d/support/GraphicsMap":2526})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{2154:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(1),i(0),i(9),i(11),i(135),i(116),i(62),i(58),i(47),i(13),i(14),i(7),i(29),i(2),i(6),i(55),i(44),i(186),i(91),i(2331),i(87),i(2261),i(163),i(2176),i(2262),i(2260),i(2217),i(2182),i(2222),i(2223),i(2180),i(2274),i(2526),i(2195),i(38),i(808)],void 0===(n=function(e,t,i,r,n,s,o,a,l,u,p,d,c,h,y,f,g,v,b,m,_,x,E,w,F,S,V,O,C,I,R,D,N,j,P,A,M,T){function q(e,t){for(var i=0;i<e.length;i++)for(var r=0,n=e[i].graphics;r<n.length;r++){var s=n[r];if(s.attributes||(s.attributes={}),t&&t.loadedAttributes)for(var o=0,a=t.loadedAttributes;o<a.length;o++){var l=a[o].name;t.attributeData[l]&&(s.attributes[l]=I.getCachedAttributeValue(t.attributeData[l],i))}}}var G=d.getLogger("esri.views.3d.layers.SceneLayerGraphicsView3D"),Q=D.defineFieldProperties(),L=function(e){function t(t){var i=e.call(this)||this;return i._nodesAddedToStage=new Map,i.overlayUpdating=!1,i.supportsDraping=!0,i._queryEngine=null,i._memCache=null,i.loadedGraphics=new P.GraphicsMap,i.progressiveLoadFactor=1,i.supportsHeightUnitConversion=!0,i._coordinatesOutsideExtentErrors=0,i._maxCoordinatesOutsideExtentErrors=20,i}return i(t,e),t.prototype.initialize=function(){var e=this;I.checkSpatialReferences(this.layer,this.view.spatialReference,this.view.viewingMode),this.handles.add([y.init(this,["layer.renderer","layer.labelingInfo","layer.labelsVisible","definitionExpressionFields","filter"],function(){return e._updateRequiredFields()}),y.init(this.layer,"rangeInfos",function(t){return e._rangeInfosChanged(t)}),this.layer.watch("renderer",function(t,i){return e._rendererChange(t,i)}),this.watch(["layer.objectIdFilter","parsedDefinitionExpression"],function(){return e._filterChange()})]),this._set("graphics3d",new V({owner:this,layer:this.layer,asyncGraphicsUpdates:!0,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentVisibilityEnabled:!1,frustumVisibilityEnabled:!1,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!1,suspendResumeExtentMode:"data",dataExtent:this.layer.fullExtent,updateClippingExtent:function(t){return e._updateClippingExtent(t)}})),this.graphics3d.elevationAlignment&&this.graphics3d.elevationAlignment.events.on("invalidate-elevation",function(t){return e._invalidateElevation(t.extent,t.spatialReference)}),this.supportsHeightUnitConversion&&(this._verticalScale=new O({sourceSpatialReference:this.layer.spatialReference,destSpatialReference:this.view.spatialReference})),this.addResolvingPromise(this.graphics3d.setup()),this.drawingOrder=this.view.getDrawingOrder(this.layer.uid),this._memCache=this.view.resourceController.memoryController.getMemCache(this.layer.uid),this._controller=new x({layerView:this,scaleVisibilityEnabled:!1}),this.when(function(){e._queryEngine=new C.default({layerView:e,priority:4}),e.handles.add([y.init(e,"maximumNumberOfFeatures",function(t){return e._controller.featureTarget=t}),y.whenTrue(e,"suspended",function(){return e._removeAllNodeData()})])})},t.prototype.destroy=function(){this.graphics3d&&(this.graphics3d.destroy(),this._set("graphics3d",null)),this._controller&&(this._controller.destroy(),this._controller=null),this._queryEngine&&(this._queryEngine.destroy(),this._queryEngine=null),this._memCache.destroy(),this._memCache=null,this._nodesAddedToStage=null},Object.defineProperty(t.prototype,"maximumNumberOfFeatures",{get:function(){var e=this.graphics3d&&this.graphics3d.graphicsCore&&this.graphics3d.graphicsCore.displayFeatureLimit;return e?e.maximumNumberOfFeatures:0},set:function(e){null!=e?(this._override("maximumNumberOfFeatures",e),this._controller.fixedFeatureTarget=!0):(this._clearOverride("maximumNumberOfFeatures"),this._controller.fixedFeatureTarget=!1)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maximumNumberOfFeaturesExceeded",{get:function(){return!this.suspended&&!!this._controller&&!this._controller.leafsReached},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasM",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasZ",{get:function(){return!0},enumerable:!0,configurable:!0}),t.prototype.whenGraphicAttributes=function(e,t){var i=this;return I.whenGraphicAttributes(this.layer,e,this._getObjectIdField(),t,function(e){for(var t=new Map,r=[],n=0,s=e;n<s.length;n++){var o=s[n],a=i._findGraphicNodeAndIndex(o),l=t.get(a.node);l||(l={node:a.node,indices:[],graphics:[]},r.push(l)),l.indices.push(a.index),l.graphics.push(o)}return r},{ignoreUnavailableFields:!0,populateObjectId:!0})},t.prototype.getGraphicFromGraphicUid=function(e){if(!this.loadedGraphics)return null;var t=_.hydrateGraphic(this.loadedGraphics.find(function(t){return t.uid===e}),this.layer),i=this._getObjectIdField();return t&&t.attributes&&t.attributes[i]?(t.layer=this.layer,t.sourceLayer=this.layer,t):null},t.prototype.whenGraphicBounds=function(e,t){return this.graphics3d.graphicsCore.whenGraphicBounds(e,t)},t.prototype.canResume=function(){return this.inherited(arguments)&&(!this._controller||this._controller.rootNodeVisible)},t.prototype.isUpdating=function(){return this.overlayUpdating||this._controller&&this._controller.updating||this.graphics3d&&this.graphics3d.updating},t.prototype.getRenderingInfo=function(e,t){var i=w.getRenderingInfo(e,{renderer:t});if(i&&i.color){var r=i.color;r[0]=r[0]/255,r[1]=r[1]/255,r[2]=r[2]/255}return i},Object.defineProperty(t.prototype,"symbolUpdateType",{get:function(){return this.graphics3d.graphicsCore.symbolUpdateType},enumerable:!0,configurable:!0}),t.prototype._findGraphicNodeAndIndex=function(e){for(var t=e.attributes[this.layer.objectIdField],i=0,r=u.keysOfMap(this._nodesAddedToStage);i<r.length;i++){var n=r[i],s=this._nodesAddedToStage.get(n),o=this._findGraphicIndex(s.bundle,t);if(o>=0)return{node:s.node,index:o}}return null},t.prototype._findGraphicIndex=function(e,t){for(var i=0;i<e.length;i++)for(var r=0,n=e[i].featureIds;r<n.length;r++){if(n[r]===t)return i}return-1},t.prototype.highlight=function(e,t){return void 0===t&&(t={}),this.graphics3d.highlight(e,t,this.layer.objectIdField)},t.prototype.addNodeData=function(e,t){if(!this._nodesAddedToStage.has(e.index)){for(var i=t.allGeometryData,r=t.attributeDataInfo,n=this._controller.crsIndex,s=this.view.spatialReference,o=[0,0,0],a=this._getObjectIdField(),u=[],p=this.layer.fullExtent&&function(e,t){return e.xmin-=t,e.ymin-=t,e.xmax+=t,e.ymax+=t,e.hasZ&&(e.zmin-=t,e.zmax+=t),e.hasM&&(e.mmin-=t,e.mmax+=t),e}(this.layer.fullExtent.clone(),.5),d=[],c=[],y=0;y<i.length;y++){var f=i[y],g=f.featureDataPosition,v=g.length,b=f.geometries||[U[v]],x=f.featureIds;p&&!m.extentContainsCoords3D(p,g)&&(this._coordinatesOutsideExtentErrors<this._maxCoordinatesOutsideExtentErrors&&G.error("Service Error: Coordinates outside of layer extent"),this._coordinatesOutsideExtentErrors+1===this._maxCoordinatesOutsideExtentErrors&&G.error("Maximum number of errors reached. Further errors are ignored."),this._coordinatesOutsideExtentErrors++);for(var E=0;E<b.length;E++){var w=b[E];if("points"===w.params.type){var F=[],S=x[E<x.length?E:0],V={};null!=S&&(V[a]=S);var O=null==S?l.generateUID():S,C=void 0;"Embedded"===w.type&&(C=w.params.vertexAttributes.position);for(var I=0;I<C.length;I+=v){for(var R=0;R<v;R++)o[R]=g[R]+C[I+R];M.bufferToBuffer(o,n,0,z,s,0,1);var D=_.makeDehydratedPoint(z[0],z[1],z[2],s);v<3&&(D.z=void 0),F.push({uid:O,geometry:D,attributes:V,visible:!0}),e.obb||c.push(D.x,D.y,D.z?D.z:0)}d.push.apply(d,F),u.push({featureIds:f.featureIds,graphics:F})}}}e.numFeatures=d.length,this._updateNodeMemory(e);var N={bundle:u,attributeInfo:r,node:e};if(q(N.bundle,N.attributeInfo),c.length>0){var j=this.view.renderSpatialReference,P=this._controller.crsVertex;M.bufferToBuffer(c,s,0,c,j,0,c.length/3);var T={data:c,size:3,offsetIdx:0,strideIdx:3};e.obb=A.compute(T),M.vectorToVector(e.obb.center,j,e.obb.center,P),this._controller.updateVisibility(e.index)}return this._controller.isGeometryVisible(e)?(this._verticalScale&&this._verticalScale.adjust(d),this._nodesAddedToStage.set(e.index,N),this.loadedGraphics.addMany(d),this._filterNode(N),h.resolve()):(this._cacheNodeData(N),h.resolve())}G.error("I3S node "+e.id+" already added")},t.prototype.isNodeLoaded=function(e){return this._nodesAddedToStage.has(e)},t.prototype._updateNodeMemory=function(e){e.memory=4096+e.numFeatures*this.graphics3d.graphicsCore.usedMemoryPerGraphic},t.prototype._cacheNodeData=function(e){var t=e.bundle.reduce(function(e,t){return t.graphics.reduce(function(e,t){return _.estimateSize(t)+e},512+8*t.featureIds.length+e)},1024);this._memCache.put(this._getMemCacheKey(e.node),e,t)},t.prototype._getMemCacheKey=function(e){return""+e.index},t.prototype._removeAllNodeData=function(){var e=this;this._nodesAddedToStage.forEach(function(t){if(t){var i=t.node;e._updateNodeMemory(i),e._cacheNodeData(t)}}),this._nodesAddedToStage.clear(),this.loadedGraphics.clear()},t.prototype.removeNodeData=function(e,t){for(;e.length>0&&!t.done;){var i=e.pop(),r=this._removeNodeStageData(i);r&&(this._updateNodeMemory(r.node),this._cacheNodeData(r)),t.madeProgress()}},t.prototype._removeNodeStageData=function(e){var t=this._nodesAddedToStage.get(e);if(!t)return null;for(var i=0,r=t.bundle;i<r.length;i++){var n=r[i];this.loadedGraphics.removeMany(n.graphics)}return this._nodesAddedToStage.delete(e),t},t.prototype.loadCachedNodeData=function(e){return h.resolve(this._memCache.pop(this._getMemCacheKey(e)))},t.prototype.addCachedNodeData=function(e,t,i){if(!this._nodesAddedToStage.has(e.index)){for(var r=0,n=t.bundle;r<n.length;r++){var s=n[r];this.loadedGraphics.addMany(s.graphics)}return this._nodesAddedToStage.set(e.index,t),this._updateNodeMemory(e),this.setAttributeData(e.index,i),this._filterNode(t),h.resolve()}G.error("I3S node "+e.id+" already added")},t.prototype.getLoadedNodeIds=function(){var e=[];return this._nodesAddedToStage.forEach(function(t){return e.push(t.node.id)}),e.sort()},t.prototype.getLoadedNodeIndices=function(e){this._nodesAddedToStage.forEach(function(t,i){return e.push(i)})},t.prototype.getLoadedAttributes=function(e){var t=this._nodesAddedToStage.get(e);if(t&&t.attributeInfo)return t.attributeInfo.loadedAttributes},t.prototype.getAttributeData=function(e){var t=this._nodesAddedToStage.get(e);if(t&&t.attributeInfo)return t.attributeInfo.attributeData},t.prototype.setAttributeData=function(e,t){var i=this._nodesAddedToStage.get(e);if(i&&(i.attributeInfo=t,q(i.bundle,t),this._filterNode(i),this.graphics3d.graphicsCore.labelsEnabled)){var r=i.bundle.map(function(e){return e.graphics.length&&e.graphics[0].uid});this.graphics3d.graphicsCore.updateLabelingInfo(r)}},t.prototype._updateClippingExtent=function(e){return this._controller&&this._controller.updateClippingArea(e),!1},t.prototype._getObjectIdField=function(){return this.layer.objectIdField||"OBJECTID"},t.prototype._rendererChange=function(e,t){return s(this,void 0,void 0,function(){var i,r,s,l;return n(this,function(n){switch(n.label){case 0:return i=this.layer.fields,r=new a.default,e?[4,e.collectRequiredFields(r,i)]:[3,2];case 1:return n.sent(),s=o.from(r).sort(),[3,3];case 2:s=[],n.label=3;case 3:return r.clear(),t?[4,t.collectRequiredFields(r,i)]:[3,5];case 4:return n.sent(),l=o.from(r).sort(),[3,6];case 5:l=[],n.label=6;case 6:return s.length===l.length&&s.every(function(e,t){return s[t]===l[t]})?[2]:(this._reloadAllNodes(),[2])}})})},t.prototype._rangeInfosChanged=function(e){null!=e&&e.length>0&&G.warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")},t.prototype._filterChange=function(){var e=this;this._nodesAddedToStage.forEach(function(t){return e._filterNode(t)})},t.prototype._reloadAllNodes=function(){this._removeAllNodeData(),this._controller&&this._controller.restartNodeLoading()},t.prototype._filterNode=function(e){var t=this._getObjectIdField(),i=null;if(this.layer.objectIdFilter){var r=this.layer.objectIdFilter.ids,n="include"===this.layer.objectIdFilter.method;i=function(e){return r.indexOf(e)>=0===n}}for(var s=this.parsedDefinitionExpression,o=0,a=e.bundle;o<a.length;o++)for(var l=0,u=a[o].graphics;l<u.length;l++){var p=u[l],d=p.visible;i&&!i(p.attributes[t])?p.visible=!1:p.visible=!s||this._evaluateClause(s,p),d!==p.visible&&(J.graphic=p,J.property="visible",J.oldValue=d,J.newValue=p.visible,this.graphics3d.graphicsCore.graphicUpdateHandler(J))}},t.prototype._updateRequiredFields=function(){return s(this,void 0,void 0,function(){var e,t,i,r,s,l,u,p,d;return n(this,function(n){switch(n.label){case 0:return t=(e=this).layer,i=e.layer,r=i.fields,s=i.renderer,l=i.labelsVisible,u=e.filter,p=e.definitionExpressionFields,d=new a.default,s?[4,s.collectRequiredFields(d,r)]:[3,2];case 1:n.sent(),n.label=2;case 2:return l?[4,E.collectLabelingFields(d,t)]:[3,4];case 3:n.sent(),n.label=4;case 4:return c.isSome(u)?[4,E.collectFilterFields(d,t,u)]:[3,6];case 5:n.sent(),n.label=6;case 6:return E.collectFields(d,r,p),this._set("requiredFields",o.from(d).sort()),[2]}})})},t.prototype._invalidateElevation=function(e,t){var i=this._controller.crsIndex;M.boundingRectToBoundingRect(e,t,B,i);var r=k;v.fromRect(r,B),r[2]=-1/0,r[5]=1/0,this._controller.updateElevationChanged(r,i)},t.prototype.createQuery=function(){var e={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};return c.isSome(this.filter)?this.filter.createQuery(e):new F(e)},t.prototype.queryFeatures=function(e,t){return p.safeCast(this._queryEngine.executeQuery(this._ensureQuery(e),t&&t.signal))},t.prototype.queryObjectIds=function(e,t){return p.safeCast(this._queryEngine.executeQueryForIds(this._ensureQuery(e),t&&t.signal))},t.prototype.queryFeatureCount=function(e,t){return p.safeCast(this._queryEngine.executeQueryForCount(this._ensureQuery(e),t&&t.signal))},t.prototype.queryExtent=function(e,t){return p.safeCast(this._queryEngine.executeQueryForExtent(this._ensureQuery(e),t&&t.signal))},t.prototype._ensureQuery=function(e){return this._addDefinitionExpressionToQuery(c.isNone(e)?this.createQuery():F.from(e))},t.prototype.getUsedMemory=function(){var e=this.graphics3d&&this.graphics3d.graphicsCore;return e?e.usedMemory:0},t.prototype.getUnloadedMemory=function(){var e=this.graphics3d&&this.graphics3d.graphicsCore;return.8*((this._controller?this._controller.unloadedMemoryEstimate:0)+(e?e.unprocessedMemoryEstimate:0))},t.prototype.ignoresMemoryFactor=function(){return this._controller&&this._controller.fixedFeatureTarget},t.prototype.getNumberOfNodes=function(){return this._nodesAddedToStage.size},t.prototype.getNumberOfFeatures=function(){return this.loadedGraphics.length},t.prototype.getStats=function(){var e=this.graphics3d.graphicsCore.getStats();return e.nodes=this.getNumberOfNodes(),e.features=this.loadedGraphics.length,this._controller&&this._controller.updateStats(e),e},r([f.property()],t.prototype,"graphics3d",void 0),r([f.property()],t.prototype,"drawingOrder",void 0),r([f.property({aliasOf:"graphics3d.graphicsCore.hasDraped"})],t.prototype,"hasDraped",void 0),r([f.property({type:Boolean})],t.prototype,"overlayUpdating",void 0),r([f.property({type:Boolean})],t.prototype,"supportsDraping",void 0),r([f.property({type:T})],t.prototype,"filter",void 0),r([f.property()],t.prototype,"loadedGraphics",void 0),r([f.property()],t.prototype,"layer",void 0),r([f.property()],t.prototype,"_controller",void 0),r([f.property({dependsOn:["_controller.updating","graphics3d.updating","overlayUpdating"]})],t.prototype,"updating",void 0),r([f.property({dependsOn:["_controller.rootNodeVisible"]})],t.prototype,"suspended",void 0),r([f.property(N.updatingPercentage)],t.prototype,"updatingPercentage",void 0),r([f.property({aliasOf:"_controller.updatingPercentage"})],t.prototype,"updatingPercentageValue",void 0),r([f.property(Q.requiredFields)],t.prototype,"requiredFields",void 0),r([f.property(Q.availableFields)],t.prototype,"availableFields",void 0),r([f.property({type:Number,dependsOn:["graphics3d.graphicsCore.displayFeatureLimit"]})],t.prototype,"maximumNumberOfFeatures",null),r([f.property({readOnly:!0,dependsOn:["suspended","_controller.leafsReached"]})],t.prototype,"maximumNumberOfFeaturesExceeded",null),r([f.property({readOnly:!0,aliasOf:"view.qualitySettings.sceneService.point.lodFactor"})],t.prototype,"lodFactor",void 0),r([f.property({readOnly:!0})],t.prototype,"hasM",null),r([f.property({readOnly:!0})],t.prototype,"hasZ",null),r([f.subclass("esri.views.3d.layers.SceneLayerGraphicsView3D")],t)}(f.declared(S,j.PopupSceneLayerView,R.DefinitionExpressionSceneLayerView)),U={2:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0]}}},3:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0,0]}}}},z=g.vec3f64.create(),J={graphic:null,property:null,oldValue:null,newValue:null},k=v.create(),B=b.create();return L}.apply(null,r))||(e.exports=n)},2188:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(9),i(11),i(135),i(14),i(87)],void 0===(n=function(e,t,i,r,n,s,o){Object.defineProperty(t,"__esModule",{value:!0}),t.getRequiredFields=function(e,t){return void 0===t&&(t=e.popupTemplate),r(this,void 0,void 0,function(){var r,a,l,u,p,d,c,h,y,f,g;return i(this,function(i){switch(i.label){case 0:return s.isSome(t)?[4,t.getRequiredFields(e.fields)]:[2,[]];case 1:return r=i.sent(),a=t.lastEditInfoEnabled,l=e.objectIdField,u=e.typeIdField,n.includes(r,"*")?[2,["*"]]:(d=o.fixFields,c=[e.fields],y=(h=r).concat,f=[[u]],(g=a)?[4,o.getFeatureEditFields(e)]:[3,3]);case 2:g=i.sent(),i.label=3;case 3:return(p=d.apply(void 0,c.concat([y.apply(h,f.concat([g||null]))])))&&l&&o.hasField(e.fields,l)&&-1===p.indexOf(l)&&p.push(l),[2,p]}})})},t.getFetchPopupTemplate=function(e,t){return e.popupTemplate?e.popupTemplate:s.isSome(t)&&t.defaultPopupTemplateEnabled&&s.isSome(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}}.apply(null,r))||(e.exports=n)},2217:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(0),i(1),i(9),i(11),i(35),i(8),i(14),i(2),i(30),i(811),i(93),i(163)],void 0===(n=function(e,t,i,r,n,s,o,a,l,u,p,d,c,h){Object.defineProperty(t,"__esModule",{value:!0});var y=d.default,f=function(e){function t(t){var i=e.call(this)||this;return i._dataQueryEngineInstance=null,i}return r(t,e),Object.defineProperty(t.prototype,"queryGeometryType",{get:function(){switch(this.layer.geometryType){case"multipoint":case"point":case"polygon":case"polyline":return this.layer.geometryType;case"mesh":return"polygon"}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"defaultQueryJSON",{get:function(){return new h({outSpatialReference:this.spatialReference}).toJSON()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataQueryEngine",{get:function(){return this.ensureDataQueryEngine()},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){this.clear()},t.prototype.clear=function(){return!!this._dataQueryEngineInstance&&(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null,!0)},t.prototype.executeQueryForIdSet=function(e,t){return s(this,void 0,void 0,function(){return n(this,function(i){return[2,this.dataQueryEngine.executeQueryForIdSet(this._ensureQueryJSON(e),t)]})})},t.prototype.executeQueryForCount=function(e,t){return s(this,void 0,void 0,function(){return n(this,function(i){return[2,this.dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(e),t)]})})},t.prototype.executeQueryForExtent=function(e,t){return s(this,void 0,void 0,function(){var i,r,s,o;return n(this,function(n){switch(n.label){case 0:return[4,this.dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(e),t)];case 1:return i=n.sent(),r=i.count,s=i.extent,o=p.fromJSON(s),[2,{count:r,extent:o}]}})})},t.prototype.executeQueryForIds=function(e,t){return s(this,void 0,void 0,function(){return n(this,function(i){return[2,this.dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(e),t)]})})},t.prototype.executeQuery=function(e,t){return s(this,void 0,void 0,function(){var i,r,s=this;return n(this,function(n){switch(n.label){case 0:return[4,this.dataQueryEngine.executeQuery(this._ensureQueryJSON(e),t)];case 1:return i=n.sent(),(r=c.fromJSON(i)).features.forEach(function(e){e.layer=s.layer,e.sourceLayer=s.layer}),[2,r]}})})},t.prototype._ensureQueryJSON=function(e){return l.isNone(e)?this.defaultQueryJSON:("outSpatialReference"in e&&!e.outSpatialReference&&(e.outSpatialReference=this.spatialReference),e.toJSON())},t.prototype.ensureDataQueryEngine=function(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;var e="timeInfo"in this.layer&&this.layer.timeInfo&&this.layer.timeInfo.toJSON()||null,t=this.layer.objectIdField,i=o.featureGeometryTypeKebabDictionary.toJSON(this.queryGeometryType),r=this.layer.fields.map(function(e){return e.toJSON()}),n=this.layerView.view.resourceController.scheduler,s=this.priority,a=this.spatialReference.toJSON(),l=this.layerView.graphics3d.graphicsCore.featureStore,u=this.layerView,p=u.hasZ,d=u.hasM;return this._dataQueryEngineInstance=new y({hasZ:p,hasM:d,geometryType:i,fields:r,timeInfo:e,spatialReference:a,objectIdField:t,featureStore:l,scheduler:n,priority:s}),this._dataQueryEngineInstance},i([u.property({constructOnly:!0})],t.prototype,"layerView",void 0),i([u.property({constructOnly:!0})],t.prototype,"priority",void 0),i([u.property({readOnly:!0,aliasOf:"layerView.view.spatialReference"})],t.prototype,"spatialReference",void 0),i([u.property({readOnly:!0,aliasOf:"layerView.layer"})],t.prototype,"layer",void 0),i([u.property({readOnly:!0,dependsOn:["layer.geometryType"]})],t.prototype,"queryGeometryType",null),i([u.property({readOnly:!0,dependsOn:["spatialReference"]})],t.prototype,"defaultQueryJSON",null),i([u.subclass("esri.views.3d.layers.graphics.QueryEngine")],t)}(u.declared(a));t.QueryEngine=f,t.default=f}.apply(null,r))||(e.exports=n)},2218:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(1),i(0),i(8),i(18),i(29),i(2),i(64),i(829)],void 0===(n=function(e,t,i,r,n,s,o,a,l,u){var p=-.3*l.earthRadius;return function(e){function t(){var t=e.call(this)||this;return t.suspended=!1,t._dirty=!0,t.extent=null,t.extentIntersectionDirty=!0,t._isVisibleBelowSurface=!1,t.handles=new s,t.layerView=null,t}return i(t,e),Object.defineProperty(t.prototype,"dirty",{get:function(){return this._dirty},set:function(e){e!==this._dirty&&(this._dirty=e,this.notifyChange("updating"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return this.dirty},enumerable:!0,configurable:!0}),t.prototype.setup=function(e){var t=this;this.layerView=e,this.extentIntersection=new u.FrustumExtentIntersection({renderCoordsHelper:e.view.renderCoordsHelper});var i=e.view,r=i.basemapTerrain,n=i.resourceController.scheduler;this.handles.add([i.on("resize",function(){return t.viewChange()}),i.state.watch("camera",function(){return t.viewChange()},!0),n.registerTask(6,function(){return t.update()},function(){return t.dirty}),r.on("elevation-bounds-change",function(){return t.elevationBoundsChange()})]),"local"===i.viewingMode?this.isVisibleBelowSurface=!0:this.handles.add(o.init(r,["opacity","wireframe"],function(){return t.isVisibleBelowSurface=!r.isOpaque()}))},t.prototype.destroy=function(){this.layerView=null,this.extent=null,this.extentIntersection=null,this.handles&&(this.handles.destroy(),this.handles=null)},t.prototype.setExtent=function(e){this.extent=e,this.extentIntersectionDirty=!0,this.dirty=!0},t.prototype.viewChange=function(){this.dirty=!0},t.prototype.elevationBoundsChange=function(){this.dirty=!0,this.extentIntersectionDirty=!0},Object.defineProperty(t.prototype,"isVisibleBelowSurface",{set:function(e){this._isVisibleBelowSurface=e,this.dirty=!0,this.extentIntersectionDirty=!0},enumerable:!0,configurable:!0}),t.prototype.update=function(){this.updateSuspendFrustumVisible(),this.dirty=!1},t.prototype.updateExtentIntersection=function(){if(this.extentIntersectionDirty){this.extentIntersectionDirty=!1;var e,t=this.layerView.view;if(this._isVisibleBelowSurface)e=p;else{var i=t.basemapTerrain.getElevationBounds(),r=i[0],n=i[1];e=r-Math.max(1,(n-r)*(1.2-1))}this.extentIntersection.update(this.extent,t.spatialReference,e)}},t.prototype.updateSuspendFrustumVisible=function(){if(this.extent){this.updateExtentIntersection();var e=this.layerView.view.frustum;this._set("suspended",!this.extentIntersection.isVisibleInFrustum(e))}else this._set("suspended",!1)},r([a.property({readOnly:!0})],t.prototype,"suspended",void 0),r([a.property({readOnly:!0})],t.prototype,"updating",null),r([a.subclass("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],t)}(a.declared(n))}.apply(null,r))||(e.exports=n)},2222:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(1),i(0),i(8),i(13),i(2),i(355),i(2182)],void 0===(n=function(e,t,i,r,n,s,o,a,l){Object.defineProperty(t,"__esModule",{value:!0});var u=s.getLogger("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView"),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._definitionExpressionErrors=0,t._maxDefinitionExpressionErrors=20,t.logError=function(e){t._definitionExpressionErrors<t._maxDefinitionExpressionErrors&&u.error("Error while evaluating definitionExpression: "+e),++t._definitionExpressionErrors===t._maxDefinitionExpressionErrors&&u.error("Further errors are ignored")},t}return i(t,e),Object.defineProperty(t.prototype,"parsedDefinitionExpression",{get:function(){if(this.layer.definitionExpression)try{var e=a.WhereClause.create(this.layer.definitionExpression,this.layer.fieldsIndex);if(!e.isStandardized)return u.error("definitionExpression is using non standard function"),null;var t=[],i=e.fieldNames;return l.findFieldsCaseInsensitive(i,this.layer.fields,{missingFields:t}),t.length>0?(u.error("definitionExpression references unknown fields: "+t.join(", ")),null):(this._definitionExpressionErrors=0,e)}catch(e){return u.error("Failed to parse definitionExpression: "+e),null}return null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"definitionExpressionFields",{get:function(){return this.parsedDefinitionExpression?this.parsedDefinitionExpression.fieldNames:null},enumerable:!0,configurable:!0}),t.prototype._evaluateClause=function(e,t){try{return e.testFeature(t)}catch(e){return this.logError(e),!1}},t.prototype._addDefinitionExpressionToQuery=function(e){if(!this.parsedDefinitionExpression)return e;var t=this.layer.definitionExpression,i=e.clone();return i.where?i.where="("+t+") AND ("+i.where+")":i.where=t,i},r([o.property()],t.prototype,"layer",void 0),r([o.property({readOnly:!0,dependsOn:["layer.definitionExpression","layer.fieldsIndex"]})],t.prototype,"parsedDefinitionExpression",null),r([o.property({readOnly:!0,dependsOn:["parsedDefinitionExpression"]})],t.prototype,"definitionExpressionFields",null),r([o.subclass("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView")],t)}(o.declared(n));t.DefinitionExpressionSceneLayerView=p,t.default=p}.apply(null,r))||(e.exports=n)},2223:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(87)],void 0===(n=function(e,t,i){Object.defineProperty(t,"__esModule",{value:!0}),t.defineFieldProperties=function(){return{requiredFields:{type:[String],readOnly:!0},availableFields:{type:[String],readOnly:!0,dependsOn:["layer.fields","layer.outFields","requiredFields"],get:function(){var e=this,t=e.layer,r=e.layer.fields,n=e.requiredFields;return t.outFields?i.fixFields(r,i.unpackFieldNames(r,t.outFields).concat(n)):i.fixFields(r,n)}}}}}.apply(null,r))||(e.exports=n)},2260:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(14),i(59)],void 0===(n=function(e,t,i,r){return function(){function e(e){this.sourceSpatialReference=e.sourceSpatialReference,this.destSpatialReference=e.destSpatialReference}return e.prototype.adjust=function(e){var t=this._getVerticalUnitScale();1!==t&&this._scaleVerticalUnits(e,t)},e.prototype._getVerticalUnitScale=function(){return this.sourceSpatialReference&&!this.sourceSpatialReference.equals(this.destSpatialReference)?r.getMetersPerVerticalUnitForSR(this.sourceSpatialReference)/r.getMetersPerVerticalUnitForSR(this.destSpatialReference):1},e.prototype._vertexListsScaleZ=function(e,t){for(var i=0;i<e.length;++i)for(var r=e[i],n=0;n<r.length;++n){r[n][2]*=t}},e.prototype._scaleVerticalUnits=function(e,t){for(var r=0;r<e.length;++r){var n=e[r].geometry;!i.isNone(n)&&n.hasZ&&(this._geometryIsPoint(n)?null!==n.z&&(n.z*=t):this._geometryIsPolyline(n)?this._vertexListsScaleZ(n.paths,t):this._geometryIsPolygon(n)&&this._vertexListsScaleZ(n.rings,t))}},e.prototype._geometryIsPoint=function(e){return"point"===e.type},e.prototype._geometryIsPolygon=function(e){return"polygon"===e.type},e.prototype._geometryIsPolyline=function(e){return"polyline"===e.type},e}()}.apply(null,r))||(e.exports=n)},2261:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(4),i(14),i(495),i(358)],void 0===(n=function(e,t,i,r,n,s){function o(e,t){if(!e||e.symbol)return null;var i=t.renderer;return e&&i&&i.getObservationRenderer?i.getObservationRenderer(e):i}function a(e,t){if(r.isSome(e.symbol))return e.symbol;var n=o(e,t);return n&&n.getSymbol(e,i({},t,{arcadeUtils:s}))}Object.defineProperty(t,"__esModule",{value:!0}),t.getRenderer=o,t.getSymbol=a,t.getRenderingInfo=function(e,t){var i=o(e,t),r=a(e,t);if(!r)return null;var s={renderer:i,symbol:r};if(!(i&&"visualVariables"in i&&i.visualVariables))return s;for(var l=["proportional","proportional","proportional"],u=0,p=n.getVisualVariableValues(i,e,t);u<p.length;u++){var d=p[u],c=d.variable,h=d.value;if("color"===c.type)s.color=h.toRgba();else if("size"===c.type)if("outline"===c.target)s.outlineSize=h;else{var y=c.axis,f=c.useSymbolValue?"symbolValue":h;"width"===y?l[0]=f:"depth"===y?l[1]=f:"height"===y?l[2]=f:l[0]=l[1]="width-and-depth"===y?f:l[2]=f}else"opacity"===c.type?s.opacity=h:"rotation"===c.type&&"tilt"===c.axis?s.tilt=h:"rotation"===c.type&&"roll"===c.axis?s.roll=h:"rotation"===c.type&&(s.heading=h)}return(isFinite(l[0])||isFinite(l[1])||isFinite(l[2]))&&(s.size=l),s}}.apply(null,r))||(e.exports=n)},2262:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(1),i(0),i(9),i(11),i(62),i(8),i(47),i(36),i(18),i(29),i(2),i(57),i(824),i(163),i(492),i(2234),i(2235),i(2263),i(2218),i(2236),i(2237),i(105),i(2238)],void 0===(n=function(e,t,i,r,n,s,o,a,l,u,p,d,c,h,y,f,g,v,b,m,_,x,E,w,F){var S=function(e){function t(t){var i=e.call(this)||this;return i._handles=new p,i.highlights=new x,i.suspendResumeExtentMode="computed",i.dataExtent=null,i.suspendResumeExtent=null,i}return i(t,e),Object.defineProperty(t.prototype,"suspended",{get:function(){return this.scaleVisibility&&this.scaleVisibility.suspended||this.frustumVisibility&&this.frustumVisibility.suspended},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!!(this.graphicsCore&&this.graphicsCore.updating||this.frustumVisibility&&this.frustumVisibility.updating)},enumerable:!0,configurable:!0}),t.prototype.normalizeCtorArgs=function(e){var t=e.frustumVisibilityEnabled?new _:null,i=e.scaleVisibilityEnabled?new E:null,r=(e.filterVisibilityEnabled||e.timeExtentVisibilityEnabled)&&"multipatch"!==e.layer.geometryType?new m.Graphics3DFilterVisibility:null,n=e.elevationAlignmentEnabled?new b:null;return{graphicsCore:new v({owner:e.owner,layer:e.layer,asyncUpdates:e.asyncGraphicsUpdates,elevationFeatureExpressionEnabled:e.elevationFeatureExpressionEnabled,graphicSymbolSupported:!1,hasZ:e.owner.hasZ,hasM:e.owner.hasM}),frustumVisibility:t,scaleVisibility:i,filterVisibility:r,elevationAlignment:n,updateClippingExtent:e.updateClippingExtent,suspendResumeExtentMode:e.suspendResumeExtentMode,dataExtent:e.dataExtent}},t.prototype.initialize=function(){var e=this;this.scaleVisibility&&this._handles.add(this.layer.watch(["minScale","maxScale"],function(){return e.scaleVisibility.layerMinMaxScaleChangeHandler()})),this.filterVisibility&&this._handles.add(this.owner.watch(["filter","timeExtent"],function(){return e.filterVisibility.filterChanged()})),this.elevationAlignment&&this._handles.add(this.layer.watch("elevationInfo",function(t,i){y.diff(t,i)&&e.graphicsCore.elevationInfoChange()})),this._handles.add(this.layer.watch("labelsVisible",function(){return e.graphicsCore.updateVisibilityInfo()})),this._handles.add(this.layer.watch("labelingInfo",function(t,i){y.diff(t,i)&&e.graphicsCore.updateLabelingInfo()}))},t.prototype.setup=function(){return s(this,void 0,void 0,function(){var e,t,i,r,s=this;return n(this,function(n){switch(n.label){case 0:return this.frustumVisibility&&this.frustumVisibility.setup(this.owner),e=this.owner,t=this.owner.view.basemapTerrain,i=function(e,t,i){return s.graphicsCore.spatialIndex.queryGraphicUIDsInExtent(e,t,i)},this.scaleVisibility&&this.scaleVisibility.setup(e,this.layer,i,this.graphicsCore,t),this.filterVisibility&&("filter"in e||"timeExtent"in e)&&this.filterVisibility.setup(e,this.graphicsCore),this.elevationAlignment&&(r=e.view.elevationProvider,this.elevationAlignment.setup(e,i,this.graphicsCore,r)),this.highlights&&this.highlights.setup(this.graphicsCore),this._set("labeling",this.owner.view.labeler.addGraphicsOwner(this.graphicsCore,this.scaleVisibility)),this._set("deconfliction",e.view.deconflictor.addGraphicsOwner(this.graphicsCore)),[4,l.result(this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,scaleVisibility:this.scaleVisibility,filterVisibility:this.filterVisibility,deconflictor:this.deconfliction,labeler:this.labeling,highlights:this.highlights}))];case 1:return n.sent(),this._handles.add([this.layer.watch("renderer",function(e){return s.graphicsCore.rendererChange(e)}),e.watch("fullOpacity",function(){return s.graphicsCore.opacityChange()})]),this.setupSuspendResumeExtent(),this.updateClippingExtent&&(this._handles.add(e.view.watch("clippingArea",function(){return s._updateClippingExtent()})),this._updateClippingExtent()),this.graphicsCore.startCreateGraphics(),this.graphicsCore.labelsEnabled?[4,l.result(this.graphicsCore.updateLabelingInfo())]:[3,3];case 2:n.sent(),n.label=3;case 3:return[2]}})})},t.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null);for(var e=0,t=["frustumVisibility","scaleVisibility","filterVisibility","elevationAlignment","highlights","graphicsCore"];e<t.length;e++){var i=t[e],r=this[i];r&&(r.destroy(),this._set(i,null))}this._set("layer",null),this._set("owner",null)},t.prototype.highlight=function(e,t,i){var r=this;if(e instanceof f){var n=this.highlights.acquireSet(t,i),s=n.set,a=n.handle;return this.owner.queryObjectIds(e).then(function(e){return r.highlights.setObjectIds(s,e)}),a}if("number"==typeof e)return this.highlight([e],t,i);if(e instanceof o)return this.highlight([e],t,i);if("toArray"in e&&(e=e.toArray()),Array.isArray(e)&&e.length>0){if(e[0]instanceof o){var l=e;if(!i||!l[0].attributes||null===F.attributeLookup(l[0].attributes,i)){var u=l.map(function(e){return e.uid}),p=this.highlights.acquireSet(t,null),d=p.set;a=p.handle;return this.highlights.setUids(d,u),a}e=l.map(function(e){return F.attributeLookup(e.attributes,i)})}if("number"==typeof e[0]){var c=e,h=this.highlights.acquireSet(t,i);d=h.set,a=h.handle;return this.highlights.setObjectIds(d,c),a}}return O},t.prototype._updateClippingExtent=function(){var e=this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(e,this.owner.view.spatialReference)&&(this.updateClippingExtent(e)||this.graphicsCore.recreateAllGraphics())},t.prototype.setupSuspendResumeExtent=function(){var e=this;(this.frustumVisibility||this.scaleVisibility)&&this._handles.add(d.init(this,"suspendResumeExtentMode",function(){switch(e._handles.remove(V),e.suspendResumeExtentMode){case"computed":e._handles.add(d.init(e.graphicsCore,"computedExtent",function(t){return e.updateSuspendResumeExtent(t)}),V);break;case"data":e._handles.add(d.init(e,"dataExtent",function(t){return e.updateSuspendResumeExtent(t)}),V);break;default:u.neverReached(e.suspendResumeExtentMode)}}))},t.prototype.updateSuspendResumeExtent=function(e){e?this.suspendResumeExtentChanged(this.extentToSuspendResumeRect(e,this.suspendResumeExtent)):this.suspendResumeExtentChanged(null)},t.prototype.extentToSuspendResumeRect=function(e,t){var i=this.owner.view.spatialReference;if(!e.spatialReference.equals(i)){if(!h.canProject(e,i))return;e=h.project(e,i)}return w.enlargeExtent(e,t,g.SUSPEND_RESUME_EXTENT_OPTIMISM)},t.prototype.suspendResumeExtentChanged=function(e){this.frustumVisibility&&this.frustumVisibility.setExtent(e),this.scaleVisibility&&this.scaleVisibility.setExtent(e)},r([c.property({aliasOf:"graphicsCore.layer"})],t.prototype,"layer",void 0),r([c.property({aliasOf:"graphicsCore.owner"})],t.prototype,"owner",void 0),r([c.property({constructOnly:!0})],t.prototype,"updateClippingExtent",void 0),r([c.property({constructOnly:!0})],t.prototype,"graphicsCore",void 0),r([c.property({constructOnly:!0})],t.prototype,"scaleVisibility",void 0),r([c.property({constructOnly:!0})],t.prototype,"filterVisibility",void 0),r([c.property({constructOnly:!0})],t.prototype,"elevationAlignment",void 0),r([c.property({constructOnly:!0})],t.prototype,"frustumVisibility",void 0),r([c.property({readOnly:!0})],t.prototype,"deconfliction",void 0),r([c.property({readOnly:!0})],t.prototype,"labeling",void 0),r([c.property({readOnly:!0})],t.prototype,"highlights",void 0),r([c.property()],t.prototype,"suspendResumeExtentMode",void 0),r([c.property()],t.prototype,"dataExtent",void 0),r([c.property({readOnly:!0,dependsOn:["scaleVisibility.suspended","frustumVisibility.suspended"]})],t.prototype,"suspended",null),r([c.property({readOnly:!0,dependsOn:["graphicsCore.updating","frustumVisibility.updating"]})],t.prototype,"updating",null),r([c.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureLikeLayerView")],t)}(c.declared(a)),V="suspendResumeExtentMode",O={remove:function(){},pause:function(){},resume:function(){}};return S}.apply(null,r))||(e.exports=n)},2263:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(1),i(0),i(8),i(18),i(13),i(14),i(29),i(2),i(2217),i(808)],void 0===(n=function(e,t,i,r,n,s,o,a,l,u,p,d){Object.defineProperty(t,"__esModule",{value:!0});var c=o.getLogger("esri.views.3d.layers.graphics.Graphics3DFilterVisibility"),h=function(e){function t(){var t=e.call(this)||this;return t.filter=null,t._dirty=!1,t._querying=!1,t._handles=new s,t}return i(t,e),Object.defineProperty(t.prototype,"updating",{get:function(){return this._dirty||this._querying||null!=this._queryResult},enumerable:!0,configurable:!0}),t.prototype.setup=function(e,t){var i=this;this._layerView=e,this._core=t,this._objectIdField=e.layer.objectIdField,this._queryEngine=new p.default({layerView:this._layerView,priority:4});var r=this._layerView.view.resourceController.scheduler;this._handles.add(r.registerTask(4,function(e){return i._update(e)},function(){return i._needsUpdate()})),this._handles.add(l.on(t.owner,"loadedGraphics","change",function(e){return i._graphicsChanged(e)},function(){return i.dirty=!0}))},t.prototype.destroy=function(){this._handles.destroy(),this._handles=null,this.clear(),this._layerView=null,this._core=null},t.prototype.clear=function(){this._queryEngine.clear()&&(this._core.modifyGraphics3DGraphicVisibilities(function(e){return e.clearVisibilityFlag(2)}),this._queryResult=null,this._querying=!1),this.dirty=!1,this.notifyChange("updating")},t.prototype._graphicsChanged=function(e){(!this._queryEngine||e.added&&e.added.length>0)&&(this.dirty=!0)},t.prototype.updateVisibility=function(e){this.active&&(e.hasVisibilityFlag(2,0)||e.setVisibilityFlag(2,!1,0),this.dirty=!0)},t.prototype.filterChanged=function(){this.filter=this.recomputeFilter(),this.dirty=!0},Object.defineProperty(t.prototype,"active",{get:function(){return this.filter&&this._core.graphics3DGraphics.size>0},enumerable:!0,configurable:!0}),t.prototype.recomputeFilter=function(){var e="filter"in this._layerView?this._layerView.filter:null,t="timeExtent"in this._layerView?this._layerView.timeExtent:null;if(!t)return e;var i=a.isSome(e)?e.clone():new d;return i.timeExtent=i.timeExtent?i.timeExtent.intersection(t):t,i},t.prototype._needsUpdate=function(){return this._dirty&&!this._querying||null!=this._queryResult},t.prototype._update=function(e){var t=this;this.active?(!this._dirty||this._querying||e.done||(this._querying=!0,this.dirty=!1,this._queryEngine.executeQueryForIdSet(this.filter).then(function(e){t._queryResult=e,t._querying=!1}).catch(function(e){c.warn("FeatureFilter query failed: "+e),t._queryResult=new Set,t._core.graphics3DGraphics.forEach(function(e){return t._queryResult.add(t._getFeatureId(e.graphic))}),t._querying=!1}),e.madeProgress()),this._queryResult&&!e.done&&(this._core.modifyGraphics3DGraphicVisibilities(function(i){if(e.done)return!1;var r=t._queryResult.has(t._getFeatureId(i.graphic));return!!i.setVisibilityFlag(2,r,0)&&(e.madeProgress(),!0)}),e.done||(this._queryResult=null)),this.notifyChange("updating")):this.clear()},t.prototype._getFeatureId=function(e){return null==e.objectId?e.attributes[this._objectIdField]:e.objectId},Object.defineProperty(t.prototype,"dirty",{set:function(e){this._dirty!==e&&(this._dirty=e,this.notifyChange("updating"))},enumerable:!0,configurable:!0}),r([u.property({readOnly:!0})],t.prototype,"updating",null),r([u.subclass("esri.views.3d.layers.graphics.Graphics3DFilterVisibility")],t)}(u.declared(n));t.Graphics3DFilterVisibility=h}.apply(null,r))||(e.exports=n)},2274:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(1),i(0),i(9),i(11),i(15),i(14),i(7),i(2),i(87),i(2176),i(2188)],void 0===(n=function(e,t,i,r,n,s,o,a,l,u,p,d,c){Object.defineProperty(t,"__esModule",{value:!0});var h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype._validateFetchPopupFeatures=function(e){var t=this.layer;return t.popupEnabled?c.getFetchPopupTemplate(t,e)?void 0:new o("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:t}):new o("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:t})},t.prototype.fetchPopupFeatures=function(e,t){return s(this,void 0,void 0,function(){var e,i,r,s,o,u,d,h,y,f;return n(this,function(n){switch(n.label){case 0:return(e=this._validateFetchPopupFeatures(t))?[2,l.reject(e)]:(i=a.isSome(t)?t.clientGraphics:null)&&0!==i.length?(r=[],s=[],u=p.unpackFieldNames,d=[this.layer.fields],[4,c.getRequiredFields(this.layer,c.getFetchPopupTemplate(this.layer,t))]):[2,l.resolve([])];case 1:for(o=u.apply(void 0,d.concat([n.sent()])),h=0,y=i;h<y.length;h++)f=y[h],p.featureHasFields(o,f)?r.push(f):s.push(f);return 0===s.length?[2,l.resolve(r)]:[2,this.whenGraphicAttributes(s,o).catch(function(){return s}).then(function(e){return r.concat(e)})]}})})},r([u.subclass("esri.views.3d.layers.support.PopupSceneLayerView")],t)}(u.declared(d));t.PopupSceneLayerView=h,t.default=h}.apply(null,r))||(e.exports=n)},2526:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(12),i(231),i(50)],void 0===(n=function(e,t,i,r,n){Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._map=new r.default,t}return i(t,e),t.prototype.clear=function(){if(this._map.size>0){var e=this.toArray();this._map.clear(),this.emit("change",{added:[],removed:e})}},Object.defineProperty(t.prototype,"length",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),t.prototype.addMany=function(e){if(0!==e.length){for(var t=new Set,i=0,r=e;i<r.length;i++){var n=r[i],s=n.uid;this._map.has(s)?(t.add(s),++this._map.get(s).refCount):(n.refCount=1,this._map.set(s,n))}var o=t.size>0?e.filter(function(e){return!t.has(e.uid)}):e;this.emit("change",{added:o,removed:[]})}},t.prototype.removeMany=function(e){for(var t=[],i=0,r=e;i<r.length;i++){var n=r[i],s=n.uid,o=this._map.get(s);null!=o&&--o.refCount<=0&&this._map.delete(s)&&t.push(n)}t.length>0&&this.emit("change",{added:[],removed:t})},t.prototype.toArray=function(){var e=new Array(this._map.size),t=0;return this._map.forEach(function(i){return e[t++]=i}),e},t.prototype.find=function(e){for(var t=this._map.entries(),i=t.next();!i.done;i=t.next())if(e(i.value[1]))return i.value[1]},t.prototype.forEach=function(e){this._map.forEach(function(t){return e(t)})},t}(n);t.GraphicsMap=s}.apply(null,r))||(e.exports=n)}}]);