(function(){(this||window).webpackJsonp.registerAbsMids({"esri/arcade/functions/geomasync":2125,"esri/arcade/arcadeAsyncRuntime":2164})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[81,59],{2125:function(e,n,t){var r,o;r=[t.dj.c(e.i),n,t(97),t(819),t(118),t(506),t(30),t(75),t(812),t(107),t(34),t(63),t(108),t(49)],void 0===(o=function(e,n,t,r,o,a,i,u,c,l,s,f,d,h){function g(e){return 0===t.version.indexOf("4.")?f.fromExtent(e):new f({spatialReference:e.spatialReference,rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]})}function p(e){if(o.pcCheck(e,2,2),e[0]instanceof u&&e[1]instanceof u);else if(e[0]instanceof u&&null===e[1]);else if(e[1]instanceof u&&null===e[0]);else if(null!==e[0]||null!==e[1])throw new Error("Illegal Argument")}Object.defineProperty(n,"__esModule",{value:!0}),n.registerFunctions=function(e){"async"===e.mode&&(e.functions.disjoint=function(n,t){return e.standardFunctionAsync(n,t,function(e,n,t){return p(t=o.autoCastFeatureToGeometry(t)),null===t[0]||null===t[1]||c.disjoint(t[0],t[1])})},e.functions.intersects=function(n,t){return e.standardFunctionAsync(n,t,function(e,n,t){return p(t=o.autoCastFeatureToGeometry(t)),null!==t[0]&&null!==t[1]&&c.intersects(t[0],t[1])})},e.functions.touches=function(n,t){return e.standardFunctionAsync(n,t,function(e,n,t){return p(t=o.autoCastFeatureToGeometry(t)),null!==t[0]&&null!==t[1]&&c.touches(t[0],t[1])})},e.functions.crosses=function(n,t){return e.standardFunctionAsync(n,t,function(e,n,t){return p(t=o.autoCastFeatureToGeometry(t)),null!==t[0]&&null!==t[1]&&c.crosses(t[0],t[1])})},e.functions.within=function(n,t){return e.standardFunctionAsync(n,t,function(e,n,t){return p(t=o.autoCastFeatureToGeometry(t)),null!==t[0]&&null!==t[1]&&c.within(t[0],t[1])})},e.functions.contains=function(n,t){return e.standardFunctionAsync(n,t,function(e,n,t){return p(t=o.autoCastFeatureToGeometry(t)),null!==t[0]&&null!==t[1]&&c.contains(t[0],t[1])})},e.functions.overlaps=function(n,t){return e.standardFunctionAsync(n,t,function(e,n,t){return p(t=o.autoCastFeatureToGeometry(t)),null!==t[0]&&null!==t[1]&&c.overlaps(t[0],t[1])})},e.functions.equals=function(n,t){return e.standardFunctionAsync(n,t,function(e,n,t){return o.pcCheck(t,2,2),t[0]===t[1]||(t[0]instanceof u&&t[1]instanceof u?c.equals(t[0],t[1]):!(!o.isDate(t[0])||!o.isDate(t[1]))&&t[0].getTime()===t[1].getTime())})},e.functions.relate=function(n,t){return e.standardFunctionAsync(n,t,function(e,n,t){if(t=o.autoCastFeatureToGeometry(t),o.pcCheck(t,3,3),t[0]instanceof u&&t[1]instanceof u)return c.relate(t[0],t[1],o.toString(t[2]));if(t[0]instanceof u&&null===t[1])return!1;if(t[1]instanceof u&&null===t[0])return!1;if(null===t[0]&&null===t[1])return!1;throw new Error("Illegal Argument")})},e.functions.intersection=function(n,t){return e.standardFunctionAsync(n,t,function(e,n,t){return p(t=o.autoCastFeatureToGeometry(t)),null===t[0]||null===t[1]?null:c.intersect(t[0],t[1])})},e.functions.union=function(n,t){return e.standardFunctionAsync(n,t,function(e,t,a){var i=[];if(0===(a=o.autoCastFeatureToGeometry(a)).length)throw new Error("Function called with wrong number of Parameters");if(1===a.length)if(o.isArray(a[0])){for(var l=o.autoCastFeatureToGeometry(a[0]),s=0;s<l.length;s++)if(null!==l[s]){if(!(l[s]instanceof u))throw new Error("Illegal Argument");i.push(l[s])}}else{if(!o.isImmutableArray(a[0])){if(a[0]instanceof u)return o.fixSpatialReference(r.cloneGeometry(a[0]),n.spatialReference);if(null===a[0])return null;throw new Error("Illegal Argument")}var f=o.autoCastFeatureToGeometry(a[0].toArray());for(s=0;s<f.length;s++)if(null!==f[s]){if(!(f[s]instanceof u))throw new Error("Illegal Argument");i.push(f[s])}}else for(s=0;s<a.length;s++)if(null!==a[s]){if(!(a[s]instanceof u))throw new Error("Illegal Argument");i.push(a[s])}return 0===i.length?null:c.union(i)})},e.functions.difference=function(n,t){return e.standardFunctionAsync(n,t,function(e,n,t){return p(t=o.autoCastFeatureToGeometry(t)),null!==t[0]&&null===t[1]?r.cloneGeometry(t[0]):null===t[0]?null:c.difference(t[0],t[1])})},e.functions.symmetricdifference=function(n,t){return e.standardFunctionAsync(n,t,function(e,n,t){return p(t=o.autoCastFeatureToGeometry(t)),null===t[0]&&null===t[1]?null:null===t[0]?r.cloneGeometry(t[1]):null===t[1]?r.cloneGeometry(t[0]):c.symmetricDifference(t[0],t[1])})},e.functions.clip=function(n,t){return e.standardFunctionAsync(n,t,function(e,n,t){if(t=o.autoCastFeatureToGeometry(t),o.pcCheck(t,2,2),!(t[1]instanceof i)&&null!==t[1])throw new Error("Illegal Argument");if(null===t[0])return null;if(!(t[0]instanceof u))throw new Error("Illegal Argument");return null===t[1]?null:c.clip(t[0],t[1])})},e.functions.cut=function(n,t){return e.standardFunctionAsync(n,t,function(e,n,t){if(t=o.autoCastFeatureToGeometry(t),o.pcCheck(t,2,2),!(t[1]instanceof d)&&null!==t[1])throw new Error("Illegal Argument");if(null===t[0])return[];if(!(t[0]instanceof u))throw new Error("Illegal Argument");return null===t[1]?[r.cloneGeometry(t[0])]:c.cut(t[0],t[1])})},e.functions.area=function(n,t){return e.standardFunctionAsync(n,t,function(e,t,a){if(o.pcCheck(a,1,2),null===(a=o.autoCastFeatureToGeometry(a))[0])return 0;if(o.isFeatureSet(a[0]))return a[0].sumArea(r.convertSquareUnitsToCode(o.defaultUndefined(a[1],-1)),!1,n.abortSignal).then(function(e){if(n.abortSignal.aborted)throw new Error("Operation has been cancelled.");return e});if(o.isArray(a[0])||o.isImmutableArray(a[0])){var i=o.autoCastArrayOfPointsToPolygon(a[0],n.spatialReference);return null===i?0:c.planarArea(i,r.convertSquareUnitsToCode(o.defaultUndefined(a[1],-1)))}if(!(a[0]instanceof u))throw new Error("Illegal Argument");return c.planarArea(a[0],r.convertSquareUnitsToCode(o.defaultUndefined(a[1],-1)))})},e.functions.areageodetic=function(n,t){return e.standardFunctionAsync(n,t,function(e,t,a){if(o.pcCheck(a,1,2),null===(a=o.autoCastFeatureToGeometry(a))[0])return 0;if(o.isFeatureSet(a[0]))return a[0].sumArea(r.convertSquareUnitsToCode(o.defaultUndefined(a[1],-1)),!0,n.abortSignal).then(function(e){if(n.abortSignal.aborted)throw new Error("Operation has been cancelled.");return e});if(o.isArray(a[0])||o.isImmutableArray(a[0])){var i=o.autoCastArrayOfPointsToPolygon(a[0],n.spatialReference);return null===i?0:c.geodesicArea(i,r.convertSquareUnitsToCode(o.defaultUndefined(a[1],-1)))}if(!(a[0]instanceof u))throw new Error("Illegal Argument");return c.geodesicArea(a[0],r.convertSquareUnitsToCode(o.defaultUndefined(a[1],-1)))})},e.functions.length=function(n,t){return e.standardFunctionAsync(n,t,function(e,t,a){if(o.pcCheck(a,1,2),null===(a=o.autoCastFeatureToGeometry(a))[0])return 0;if(o.isFeatureSet(a[0]))return a[0].sumLength(r.convertLinearUnitsToCode(o.defaultUndefined(a[1],-1)),!1,n.abortSignal).then(function(e){if(n.abortSignal.aborted)throw new Error("Operation has been cancelled.");return e});if(o.isArray(a[0])||o.isImmutableArray(a[0])){var i=o.autoCastArrayOfPointsToPolyline(a[0],n.spatialReference);return null===i?0:c.planarLength(i,r.convertLinearUnitsToCode(o.defaultUndefined(a[1],-1)))}if(!(a[0]instanceof u))throw new Error("Illegal Argument");return c.planarLength(a[0],r.convertLinearUnitsToCode(o.defaultUndefined(a[1],-1)))})},e.functions.lengthgeodetic=function(n,t){return e.standardFunctionAsync(n,t,function(e,t,a){if(o.pcCheck(a,1,2),null===(a=o.autoCastFeatureToGeometry(a))[0])return 0;if(o.isFeatureSet(a[0]))return a[0].sumLength(r.convertLinearUnitsToCode(o.defaultUndefined(a[1],-1)),!0,n.abortSignal).then(function(e){if(n.abortSignal.aborted)throw new Error("Operation has been cancelled.");return e});if(o.isArray(a[0])||o.isImmutableArray(a[0])){var i=o.autoCastArrayOfPointsToPolyline(a[0],n.spatialReference);return null===i?0:c.geodesicLength(i,r.convertLinearUnitsToCode(o.defaultUndefined(a[1],-1)))}if(!(a[0]instanceof u))throw new Error("Illegal Argument");return c.geodesicLength(a[0],r.convertLinearUnitsToCode(o.defaultUndefined(a[1],-1)))})},e.functions.distance=function(n,t){return e.standardFunctionAsync(n,t,function(e,t,a){a=o.autoCastFeatureToGeometry(a),o.pcCheck(a,2,3);var i=a[0];(o.isArray(a[0])||o.isImmutableArray(a[0]))&&(i=o.autoCastArrayOfPointsToMultiPoint(a[0],n.spatialReference));var l=a[1];if((o.isArray(a[1])||o.isImmutableArray(a[1]))&&(l=o.autoCastArrayOfPointsToMultiPoint(a[1],n.spatialReference)),!(i instanceof u))throw new Error("Illegal Argument");if(!(l instanceof u))throw new Error("Illegal Argument");return c.distance(i,l,r.convertLinearUnitsToCode(o.defaultUndefined(a[2],-1)))})},e.functions.densify=function(n,t){return e.standardFunctionAsync(n,t,function(e,n,t){if(t=o.autoCastFeatureToGeometry(t),o.pcCheck(t,2,3),null===t[0])return null;if(!(t[0]instanceof u))throw new Error("Illegal Argument");var a=o.toNumber(t[1]);if(isNaN(a))throw new Error("Illegal Argument");if(a<=0)throw new Error("Illegal Argument");return t[0]instanceof f||t[0]instanceof d?c.densify(t[0],a,r.convertLinearUnitsToCode(o.defaultUndefined(t[2],-1))):t[0]instanceof i?c.densify(g(t[0]),a,r.convertLinearUnitsToCode(o.defaultUndefined(t[2],-1))):t[0]})},e.functions.densifygeodetic=function(n,t){return e.standardFunctionAsync(n,t,function(e,n,t){if(t=o.autoCastFeatureToGeometry(t),o.pcCheck(t,2,3),null===t[0])return null;if(!(t[0]instanceof u))throw new Error("Illegal Argument");var a=o.toNumber(t[1]);if(isNaN(a))throw new Error("Illegal Argument");if(a<=0)throw new Error("Illegal Argument");return t[0]instanceof f||t[0]instanceof d?c.geodesicDensify(t[0],a,r.convertLinearUnitsToCode(o.defaultUndefined(t[2],-1))):t[0]instanceof i?c.geodesicDensify(g(t[0]),a,r.convertLinearUnitsToCode(o.defaultUndefined(t[2],-1))):t[0]})},e.functions.generalize=function(n,t){return e.standardFunctionAsync(n,t,function(e,n,t){if(t=o.autoCastFeatureToGeometry(t),o.pcCheck(t,2,4),null===t[0])return null;if(!(t[0]instanceof u))throw new Error("Illegal Argument");var a=o.toNumber(t[1]);if(isNaN(a))throw new Error("Illegal Argument");return c.generalize(t[0],a,o.toBoolean(o.defaultUndefined(t[2],!0)),r.convertLinearUnitsToCode(o.defaultUndefined(t[3],-1)))})},e.functions.buffer=function(n,t){return e.standardFunctionAsync(n,t,function(e,n,t){if(t=o.autoCastFeatureToGeometry(t),o.pcCheck(t,2,3),null===t[0])return null;if(!(t[0]instanceof u))throw new Error("Illegal Argument");var a=o.toNumber(t[1]);if(isNaN(a))throw new Error("Illegal Argument");return 0===a?r.cloneGeometry(t[0]):c.buffer(t[0],a,r.convertLinearUnitsToCode(o.defaultUndefined(t[2],-1)))})},e.functions.buffergeodetic=function(n,t){return e.standardFunctionAsync(n,t,function(e,n,t){if(t=o.autoCastFeatureToGeometry(t),o.pcCheck(t,2,3),null===t[0])return null;if(!(t[0]instanceof u))throw new Error("Illegal Argument");var a=o.toNumber(t[1]);if(isNaN(a))throw new Error("Illegal Argument");return 0===a?r.cloneGeometry(t[0]):c.geodesicBuffer(t[0],a,r.convertLinearUnitsToCode(o.defaultUndefined(t[2],-1)))})},e.functions.offset=function(n,t){return e.standardFunctionAsync(n,t,function(e,n,t){if(t=o.autoCastFeatureToGeometry(t),o.pcCheck(t,2,6),null===t[0])return null;if(!(t[0]instanceof f||t[0]instanceof d))throw new Error("Illegal Argument");var a=o.toNumber(t[1]);if(isNaN(a))throw new Error("Illegal Argument");var i=o.toNumber(o.defaultUndefined(t[4],10));if(isNaN(i))throw new Error("Illegal Argument");var u=o.toNumber(o.defaultUndefined(t[5],0));if(isNaN(u))throw new Error("Illegal Argument");return c.offset(t[0],a,r.convertLinearUnitsToCode(o.defaultUndefined(t[2],-1)),o.toString(o.defaultUndefined(t[3],"round")).toLowerCase(),i,u)})},e.functions.rotate=function(n,t){return e.standardFunctionAsync(n,t,function(e,n,t){t=o.autoCastFeatureToGeometry(t),o.pcCheck(t,2,3);var r=t[0];if(null===r)return null;if(!(r instanceof u))throw new Error("Illegal Argument");r instanceof i&&(r=f.fromExtent(r));var a=o.toNumber(t[1]);if(isNaN(a))throw new Error("Illegal Argument");var l=o.defaultUndefined(t[2],null);if(null===l)return c.rotate(r,a);if(l instanceof s)return c.rotate(r,a,l);throw new Error("Illegal Argument")})},e.functions.centroid=function(n,t){return e.standardFunctionAsync(n,t,function(e,t,c){if(c=o.autoCastFeatureToGeometry(c),o.pcCheck(c,1,1),null===c[0])return null;var h=c[0];if((o.isArray(c[0])||o.isImmutableArray(c[0]))&&(h=o.autoCastArrayOfPointsToMultiPoint(c[0],n.spatialReference)),null===h)return null;if(!(h instanceof u))throw new Error("Illegal Argument");return h instanceof s?o.fixSpatialReference(r.cloneGeometry(c[0]),n.spatialReference):h instanceof f?h.centroid:h instanceof d?a.centroidPolyline(h):h instanceof l?a.centroidMultiPoint(h):h instanceof i?h.center:null})},e.functions.multiparttosinglepart=function(n,t){return e.standardFunctionAsync(n,t,function(e,t,a){a=o.autoCastFeatureToGeometry(a),o.pcCheck(a,1,1);var g=[];if(null===a[0])return null;if(!(a[0]instanceof u))throw new Error("Illegal Argument");return a[0]instanceof s?[o.fixSpatialReference(r.cloneGeometry(a[0]),n.spatialReference)]:a[0]instanceof i?[o.fixSpatialReference(r.cloneGeometry(a[0]),n.spatialReference)]:c.simplify(a[0]).then(function(e){if(e instanceof f){for(var t=[],i=[],u=0;u<e.rings.length;u++)if(e.isClockwise(e.rings[u])){var c=h.fromJSON({rings:[e.rings[u]],hasZ:!0===e.hasZ,hazM:!0===e.hasM,spatialReference:e.spatialReference.toJSON()});t.push(c)}else i.push({ring:e.rings[u],pt:e.getPoint(u,0)});for(var s=0;s<i.length;s++)for(var p=0;p<t.length;p++)if(t[p].contains(i[s].pt)){t[p].addRing(i[s].ring);break}return t}if(e instanceof d){var v=[];for(u=0;u<e.paths.length;u++){var m=h.fromJSON({paths:[e.paths[u]],hasZ:!0===e.hasZ,hazM:!0===e.hasM,spatialReference:e.spatialReference.toJSON()});v.push(m)}return v}if(a[0]instanceof l){var y=o.fixSpatialReference(r.cloneGeometry(a[0]),n.spatialReference);for(u=0;u<y.points.length;u++)g.push(y.getPoint(u));return g}return null})})},e.functions.issimple=function(n,t){return e.standardFunctionAsync(n,t,function(e,n,t){if(t=o.autoCastFeatureToGeometry(t),o.pcCheck(t,1,1),null===t[0])return!0;if(!(t[0]instanceof u))throw new Error("Illegal Argument");return c.isSimple(t[0])})},e.functions.simplify=function(n,t){return e.standardFunctionAsync(n,t,function(e,n,t){if(t=o.autoCastFeatureToGeometry(t),o.pcCheck(t,1,1),null===t[0])return null;if(!(t[0]instanceof u))throw new Error("Illegal Argument");return c.simplify(t[0])})})}}.apply(null,r))||(e.exports=o)},2164:function(e,n,t){var r,o;r=[t.dj.c(e.i),n,t(505),t(185),t(238),t(524),t(380),t(251),t(118),t(297),t(525),t(2125),t(526),t(521),t(527),t(528),t(7),t(30),t(75),t(107),t(34),t(63),t(108),t(32)],void 0===(o=function(e,n,t,r,o,a,i,u,c,l,s,f,d,h,g,p,v,m,y,E,w,N,I,b){function A(e){return e instanceof Error?v.reject(e):v.reject(new Error(e))}function T(e){return v.resolve(e)}function C(e,n){for(var t=[],r=0;r<n.arguments.length;r++)t.push(R(e,n.arguments[r]));return v.all(t)}function F(e,n,t){return v.create(function(r,o){C(e,n).then(function(a){try{r(t(e,n,a))}catch(e){o(e)}},o)})}function S(e,n,t){try{return C(e,n).then(function(r){try{var o=t(e,n,r);return function(e){return e&&"function"==typeof e.then}(o)?o:v.resolve(o)}catch(e){return A(e)}})}catch(e){return A(e)}}function R(e,n){try{switch(n.type){case"VariableDeclarator":return function(e,n){try{var t=null;return t=null===n.init?v.resolve(null):R(e,n.init),null!==e.localScope?t.then(function(t){return v.create(function(r,o){if(t===c.voidOperation&&(t=null),"Identifier"!==n.id.type)throw new Error("Can only assign a regular variable");var a=n.id.name.toLowerCase();e.localScope[a]={value:t,valueset:!0,node:n.init},r(c.voidOperation)})}):t.then(function(t){return v.create(function(r,o){if("Identifier"!==n.id.type)throw new Error("Can only assign a regular variable");var a=n.id.name.toLowerCase();t===c.voidOperation&&(t=null),e.globalScope[a]={value:t,valueset:!0,node:n.init},r(c.voidOperation)})})}catch(e){return A(e)}}(e,n);case"VariableDeclaration":return function e(n,t,r){return v.create(function(o,a){r>=t.declarations.length?o(c.voidOperation):R(n,t.declarations[r]).then(function(i){r===t.declarations.length-1?o(c.voidOperation):e(n,t,r+1).then(function(e){o(c.voidOperation)},a)},a)})}(e,n,0);case"BlockStatement":return function(e,n){try{return function e(n,t,r){try{return r>=t.body.length?v.resolve(c.voidOperation):v.create(function(o,a){R(n,t.body[r]).then(function(i){try{i instanceof c.ReturnResult||i===c.breakResult||i===c.continueResult?o(i):r===t.body.length-1?o(i):e(n,t,r+1).then(o,a)}catch(e){a(e)}},a)})}catch(n){return A(n)}}(e,n,0)}catch(e){return A(e)}}(e,n);case"FunctionDeclaration":return function(e,n){try{var t=n.id.name.toLowerCase();return e.globalScope[t]={valueset:!0,node:null,value:new a(n,e)},v.resolve(c.voidOperation)}catch(e){return A(e)}}(e,n);case"ReturnStatement":return function(e,n){return v.create(function(t,r){null===n.argument?t(new c.ReturnResult(c.voidOperation)):R(e,n.argument).then(function(e){try{t(new c.ReturnResult(e))}catch(e){r(e)}},r)})}(e,n);case"IfStatement":return function(e,n){return v.create(function(t,r){"AssignmentExpression"!==n.test.type&&"UpdateExpression"!==n.test.type?R(e,n.test).then(function(o){try{!0===o?R(e,n.consequent).then(t,r):!1===o?null!==n.alternate?R(e,n.alternate).then(t,r):t(c.voidOperation):r(new Error(l.nodeErrorMessage(n.test,"RUNTIME","CANNOT_USE_NONBOOLEAN_IN_CONDITION")))}catch(e){r(e)}},r):r(new Error(l.nodeErrorMessage(n.test,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION")))})}(e,n);case"ExpressionStatement":return function(e,n){try{return"AssignmentExpression"===n.expression.type?R(e,n.expression):(n.expression.type,R(e,n.expression).then(function(e){return v.create(function(n,t){n(e===c.voidOperation?c.voidOperation:new c.ImplicitResult(e))})}))}catch(e){return v.reject(e)}}(e,n);case"UpdateExpression":return function(e,n){try{var t=n.argument;if("MemberExpression"===t.type){var a={t:null};return R(e,t.object).then(function(n){var r=null;return a.t=n,!0===t.computed?r=R(e,t.property):"Identifier"===t.property.type&&(r=v.resolve(t.property.name)),r}).then(function(e){return v.create(function(t,i){var u,l=a.t;if(c.isArray(l)){if(!c.isNumber(e))throw new Error("Invalid Parameter");if(e<0&&(e=l.length+e),e<0||e>=l.length)throw new Error("Assignment outside of array bounds");u=c.toNumber(l[e]),l[e]="++"===n.operator?u+1:u-1}else if(l instanceof r){if(!1===c.isString(e))throw new Error("Dictionary accessor must be a string");if(!0!==l.hasField(e))throw new Error("Invalid Parameter");u=c.toNumber(l.field(e)),l.setField(e,"++"===n.operator?u+1:u-1)}else{if(!(l instanceof o))throw c.isImmutableArray(l)?new Error("Array is Immutable"):new Error("Invalid Parameter");if(!1===c.isString(e))throw new Error("Feature accessor must be a string");if(!0!==l.hasField(e))throw new Error("Invalid Parameter");u=c.toNumber(l.field(e)),l.setField(e,"++"===n.operator?u+1:u-1)}t(!1===n.prefix?u:"++"===n.operator?u+1:u-1)})})}return v.create(function(t,r){var o,a="Identifier"===n.argument.type?n.argument.name.toLowerCase():"";if(!a)throw new Error("Invalid identifier");return null!==e.localScope&&void 0!==e.localScope[a]?(o=c.toNumber(e.localScope[a].value),e.localScope[a]={value:"++"===n.operator?o+1:o-1,valueset:!0,node:n},void t(!1===n.prefix?o:"++"===n.operator?o+1:o-1)):void 0!==e.globalScope[a]?(o=c.toNumber(e.globalScope[a].value),e.globalScope[a]={value:"++"===n.operator?o+1:o-1,valueset:!0,node:n},void t(!1===n.prefix?o:"++"===n.operator?o+1:o-1)):void r(new Error("Variable not recognised"))})}catch(e){return v.reject(e)}}(e,n);case"AssignmentExpression":return function(e,n){return v.create(function(t,a){var i=n.left;if("MemberExpression"===i.type)R(e,n.right).then(function(u){try{R(e,i.object).then(function(l){try{var s=null;if(!0===i.computed)s=R(e,i.property);else{if("Identifier"!==i.property.type)throw new Error("Expected computed or identifier for assignemnt target");s=v.resolve(i.property.name)}s.then(function(e){try{if(c.isArray(l)){if(!c.isNumber(e))throw new Error("Invalid Parameter");if(e<0&&(e=l.length+e),e<0||e>l.length)throw new Error("Assignment outside of array bounds");if(e===l.length){if("="!==n.operator)throw new Error("Invalid Parameter");l[e]=x(u,n.operator,l[e],n)}else l[e]=x(u,n.operator,l[e],n)}else if(l instanceof r){if(!1===c.isString(e))throw new Error("Dictionary accessor must be a string");if(!0===l.hasField(e))l.setField(e,x(u,n.operator,l.field(e),n));else{if("="!==n.operator)throw new Error("Invalid Parameter");l.setField(e,x(u,n.operator,null,n))}}else{if(!(l instanceof o))throw c.isImmutableArray(l)?new Error("Array is Immutable"):new Error("Invalid Parameter");if(!1===c.isString(e))throw new Error("Feature accessor must be a string");if(!0===l.hasField(e))l.setField(e,x(u,n.operator,l.field(e),n));else{if("="!==n.operator)throw new Error("Invalid Parameter");l.setField(e,x(u,n.operator,null,n))}}t(c.voidOperation)}catch(e){a(e)}},a)}catch(e){a(e)}},a)}catch(e){a(e)}},a);else{var u=i.name.toLowerCase();null!==e.localScope&&void 0!==e.localScope[u]&&R(e,n.right).then(function(r){try{e.localScope[u]={value:x(r,n.operator,e.localScope[u].value,n),valueset:!0,node:n.right},t(c.voidOperation)}catch(e){a(e)}},a),void 0!==e.globalScope[u]?R(e,n.right).then(function(r){try{e.globalScope[u]={value:x(r,n.operator,e.globalScope[u].value,n),valueset:!0,node:n.right},t(c.voidOperation)}catch(e){a(e)}},a):a(new Error("Cannot assign undeclared variable"))}})}(e,n);case"ForStatement":return function(e,n){try{return null!==n.init?R(e,n.init).then(function(){return v.create(function(t,r){var o={testResult:!0,lastAction:c.voidOperation};U(e,n,o,function(e){t(e)},function(e){r(e)},0)})}):v.create(function(t,r){var o={testResult:!0,lastAction:c.voidOperation};U(e,n,o,function(e){t(e)},function(e){r(e)},0)})}catch(e){return v.reject(e)}}(e,n);case"ForInStatement":return function(e,n){return v.create(function(t,a){R(e,n.right).then(function(i){try{("VariableDeclaration"===n.left.type?R(e,n.left):v.resolve()).then(function(){try{var u="";if("VariableDeclaration"===n.left.type){var s=n.left.declarations[0].id;"Identifier"===s.type&&(u=s.name)}else"Identifier"===n.left.type&&(u=n.left.name);if(!u)throw new Error(l.nodeErrorMessage(n,"RUNTIME","INVALIDVARIABLE"));u=u.toLowerCase();var f=null;if(null!==e.localScope&&void 0!==e.localScope[u]&&(f=e.localScope[u]),null===f&&void 0!==e.globalScope[u]&&(f=e.globalScope[u]),null===f)return void a(new Error(l.nodeErrorMessage(n,"RUNTIME","VARIABLENOTDECLARED")));c.isArray(i)||c.isString(i)?M(e,n,i,{reject:a,resolve:t},f):c.isImmutableArray(i)?function(e,n,t,r,o,a){try{if(void 0===a&&(a="i"),0===t.length)return void r.resolve(c.voidOperation);!function e(n,t,r,o,a,i,u,l,s){try{if(r.length()<=a)return void u(c.voidOperation);o.value="k"===i?r.get(a):a,R(n,t.body).then(function(f){f instanceof c.ReturnResult?u(f):f===c.breakResult?u(c.voidOperation):++s>q?(s=0,setTimeout(function(){e(n,t,r,o,a+1,i,function(e){u(e)},function(e){l(e)},s)})):e(n,t,r,o,a+1,i,function(e){u(e)},function(e){l(e)},s)},function(e){l(e)})}catch(n){l(n)}}(e,n,t,o,0,a,function(e){r.resolve(e)},function(e){r.reject(e)},0)}catch(e){r.reject(e)}}(e,n,i,{reject:a,resolve:t},f):i instanceof r||i instanceof o?function(e,n,t,r,o){try{M(e,n,t.keys(),r,o,"k")}catch(e){r.reject(e)}}(e,n,i,{reject:a,resolve:t},f):c.isFeatureSet(i)?function e(n,t,r,a,i,u,l,s){try{n.next().then(function(f){try{if(null===f)u(c.voidOperation);else{var d=o.createFromGraphicLikeObject(f.geometry,f.attributes,a);d._underlyingGraphic=f,i.value=d,R(t,r.body).then(function(o){try{o===c.breakResult?u(c.voidOperation):o instanceof c.ReturnResult?u(o):++s>q?(s=0,setTimeout(function(){e(n,t,r,a,i,function(e){u(e)},function(e){l(e)},s)})):e(n,t,r,a,i,function(e){u(e)},function(e){l(e)},s)}catch(e){l(e)}},function(e){l(e)})}}catch(e){l(e)}},function(e){l(e)})}catch(n){l(n)}}(i.iterator(e.abortSignal),e,n,i,f,function(e){t(e)},function(e){a(e)},0):M(e,n,[],{reject:a,resolve:t},f)}catch(e){a(e)}},a)}catch(e){a(e)}},a)})}(e,n);case"BreakStatement":return v.resolve(c.breakResult);case"EmptyStatement":return v.resolve(c.voidOperation);case"ContinueStatement":return v.resolve(c.continueResult);case"Identifier":return P(e,n);case"MemberExpression":return function(e,n){try{return R(e,n.object).then(function(t){try{return null===t?v.reject(new Error(l.nodeErrorMessage(n,"RUNTIME","NOTFOUND"))):!1===n.computed?"Identifier"===n.property.type?t instanceof r||t instanceof o?v.resolve(t.field(n.property.name)):t instanceof y?v.resolve(k(t,n.property.name,e,n)):v.reject(new Error(l.nodeErrorMessage(n,"RUNTIME","INVALIDTYPE"))):v.reject(new Error(l.nodeErrorMessage(n,"RUNTIME","INVALIDTYPE"))):R(e,n.property).then(function(a){return v.create(function(i,u){if(t instanceof r||t instanceof o)c.isString(a)?i(t.field(a)):u(new Error(l.nodeErrorMessage(n,"RUNTIME","INVALIDTYPE")));else if(t instanceof y)c.isString(a)?i(k(t,a,e,n)):u(new Error(l.nodeErrorMessage(n,"RUNTIME","INVALIDTYPE")));else if(c.isArray(t))if(c.isNumber(a)&&isFinite(a)&&Math.floor(a)===a){if(a<0&&(a=t.length+a),a>=t.length||a<0)throw new Error(l.nodeErrorMessage(n,"RUNTIME","OUTOFBOUNDS"));i(t[a])}else u(new Error(l.nodeErrorMessage(n,"RUNTIME","INVALIDTYPE")));else if(c.isImmutableArray(t))if(c.isNumber(a)&&isFinite(a)&&Math.floor(a)===a){if(a<0&&(a=t.length()+a),a>=t.length()||a<0)throw new Error(l.nodeErrorMessage(n,"RUNTIME","OUTOFBOUNDS"));i(t.get(a))}else u(new Error(l.nodeErrorMessage(n,"RUNTIME","INVALIDTYPE")));else if(c.isString(t))if(c.isNumber(a)&&isFinite(a)&&Math.floor(a)===a){if(a<0&&(a=t.length+a),a>=t.length||a<0)throw new Error(l.nodeErrorMessage(n,"RUNTIME","OUTOFBOUNDS"));i(t[a])}else u(new Error(l.nodeErrorMessage(n,"RUNTIME","INVALIDTYPE")));else u(new Error(l.nodeErrorMessage(n,"RUNTIME","INVALIDTYPE")))})})}catch(e){return A(e)}})}catch(e){return A(e)}}(e,n);case"Literal":return T(n.value);case"CallExpression":return function(e,n){try{if("Identifier"!==n.callee.type)return A(l.nodeErrorMessage(n,"RUNTIME","ONLYNODESSUPPORTED"));if(null!==e.localScope&&void 0!==e.localScope[n.callee.name.toLowerCase()]){var t=e.localScope[n.callee.name.toLowerCase()];return t.value instanceof c.NativeFunction?t.value.fn(e,n):t.value instanceof a?_(e,n,t.value.definition):A(l.nodeErrorMessage(n,"RUNTIME","NOTAFUNCTION"))}if(void 0!==e.globalScope[n.callee.name.toLowerCase()]){var t=e.globalScope[n.callee.name.toLowerCase()];return t.value instanceof c.NativeFunction?t.value.fn(e,n):t.value instanceof a?_(e,n,t.value.definition):A(l.nodeErrorMessage(n,"RUNTIME","NOTAFUNCTION"))}return A(l.nodeErrorMessage(n,"RUNTIME","NOTFOUND"))}catch(e){return A(e)}}(e,n);case"UnaryExpression":return function(e,n){try{return R(e,n.argument).then(function(e){return v.create(function(t,r){c.isBoolean(e)&&"!"===n.operator?t(!e):"-"===n.operator?t(-1*c.toNumber(e)):"+"===n.operator?t(1*c.toNumber(e)):r(new Error(l.nodeErrorMessage(n,"RUNTIME","NOTSUPPORTEDUNARYOPERATOR")))})})}catch(e){return A(e)}}(e,n);case"BinaryExpression":return function(e,n){try{return v.all([R(e,n.left),R(e,n.right)]).then(function(e){return v.create(function(t,r){var o=e[0],a=e[1];switch(n.operator){case"==":t(c.equalityTest(o,a));break;case"!=":t(!c.equalityTest(o,a));break;case"<":case">":case"<=":case">=":t(c.greaterThanLessThan(o,a,n.operator));break;case"+":t(c.isString(o)||c.isString(a)?c.toString(o)+c.toString(a):c.toNumber(o)+c.toNumber(a));break;case"-":t(c.toNumber(o)-c.toNumber(a));break;case"*":t(c.toNumber(o)*c.toNumber(a));break;case"/":t(c.toNumber(o)/c.toNumber(a));break;case"%":t(c.toNumber(o)%c.toNumber(a));break;default:r(new Error(l.nodeErrorMessage(n,"RUNTIME","OPERATORNOTRECOGNISED")))}})})}catch(e){return A(e)}}(e,n);case"LogicalExpression":return function(e,n){return v.create(function(t,r){return"AssignmentExpression"===n.left.type||"UpdateExpression"===n.left.type?void r(new Error(l.nodeErrorMessage(n.left,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"))):"AssignmentExpression"===n.right.type||"UpdateExpression"===n.right.type?void r(new Error(l.nodeErrorMessage(n.right,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"))):void R(e,n.left).then(function(o){try{if(!c.isBoolean(o))throw new Error(l.nodeErrorMessage(n,"RUNTIME","ONLYBOOLEAN"));switch(n.operator){case"||":!0===o?t(o):R(e,n.right).then(function(e){try{if(!c.isBoolean(e))throw new Error(l.nodeErrorMessage(n,"RUNTIME","ONLYORORAND"));t(e)}catch(e){r(e)}},r);break;case"&&":!1===o?t(o):R(e,n.right).then(function(e){try{if(!c.isBoolean(e))throw new Error(l.nodeErrorMessage(n,"RUNTIME","ONLYORORAND"));t(e)}catch(e){r(e)}},r);break;default:throw new Error(l.nodeErrorMessage(n,"RUNTIME","ONLYORORAND"))}}catch(e){r(e)}},r)})}(e,n);case"ConditionalExpression":return A(l.nodeErrorMessage(n,"RUNTIME","NOTSUPPORTED"));case"ArrayExpression":return function(e,n){try{for(var t=[],r=0;r<n.elements.length;r++)t.push(R(e,n.elements[r]));return v.all(t).then(function(e){return v.create(function(t,r){for(var o=0;o<e.length;o++){if(c.isFunctionParameter(e[o]))return void r(new Error(l.nodeErrorMessage(n,"RUNTIME","FUNCTIONCONTEXTILLEGAL")));e[o]===c.voidOperation&&(e[o]=null)}t(e)})})}catch(e){return A(e)}}(e,n);case"ObjectExpression":return function(e,n){try{for(var t=[],o=0;o<n.properties.length;o++)t.push(R(e,n.properties[o]));return v.all(t).then(function(e){return v.create(function(n,t){for(var o={},a=0;a<e.length;a++){var i=e[a];if(c.isFunctionParameter(i.value))throw new Error("Illegal Argument");if(!1===c.isString(i.key))throw new Error("Illegal Argument");i.value===c.voidOperation?o[i.key.toString()]=null:o[i.key.toString()]=i.value}var u=new r(o);u.immutable=!1,n(u)})})}catch(e){return A(e)}}(e,n);case"Property":return function(e,n){try{return R(e,n.value).then(function(t){return v.create(function(r,o){"Identifier"===n.key.type?r({key:n.key.name,value:t}):R(e,n.key).then(function(e){r({key:e,value:t})})})})}catch(e){return v.reject(e)}}(e,n);default:return A(l.nodeErrorMessage(n,"RUNTIME","UNREOGNISED"))}}catch(e){return A(e)}}function O(e,n,t){try{return R(e,n.body).then(function(r){try{return t.lastAction=r,t.lastAction===c.breakResult?(t.testResult=!1,v.resolve(t)):t.lastAction instanceof c.ReturnResult?(t.testResult=!1,v.resolve(t)):null!==n.update?R(e,n.update).then(function(e){return v.resolve(t)}):v.resolve(t)}catch(e){return v.reject(e)}})}catch(e){return v.reject(e)}}function U(e,n,t,r,o,a){try{(function(e,n,t){try{return null!==n.test?R(e,n.test).then(function(r){try{return!0===e.abortSignal.aborted?v.reject(new Error("Cancelled")):(t.testResult=r,!1===t.testResult?v.resolve(t):!0!==t.testResult?v.reject(new Error(l.nodeErrorMessage(n,"RUNTIME","CANNOT_USE_NONBOOLEAN_IN_CONDITION"))):O(e,n,t))}catch(e){return v.reject(e)}}):O(e,n,t)}catch(e){return v.reject(e)}})(e,n,t).then(function(){try{!0===t.testResult?++a>q?(a=0,setTimeout(function(){U(e,n,t,function(e){r(e)},function(e){o(e)},a)})):U(e,n,t,function(e){r(e)},function(e){o(e)},a):r(t.lastAction instanceof c.ReturnResult?t.lastAction:c.voidOperation)}catch(e){o(e)}},function(e){o(e)})}catch(e){o(e)}}function M(e,n,t,r,o,a){try{if(void 0===a&&(a="i"),0===t.length)return void r.resolve(c.voidOperation);!function e(n,t,r,o,a,i,u,l,s,f){try{if(o<=i)return void l(c.voidOperation);a.value="k"===u?r[i]:i,R(n,t.body).then(function(d){try{d instanceof c.ReturnResult?l(d):d===c.breakResult?l(c.voidOperation):++f>q?(f=0,setTimeout(function(){e(n,t,r,o,a,i+1,u,function(e){l(e)},function(e){s(e)},f)})):e(n,t,r,o,a,i+1,u,function(e){l(e)},function(e){s(e)},f)}catch(e){s(e)}},function(e){s(e)})}catch(n){s(n)}}(e,n,t,t.length,o,0,a,function(e){r.resolve(e)},function(e){r.reject(e)},0)}catch(e){r.reject(e)}}function x(e,n,t,r){switch(n){case"=":return e===c.voidOperation?null:e;case"/=":return c.toNumber(t)/c.toNumber(e);case"*=":return c.toNumber(t)*c.toNumber(e);case"-=":return c.toNumber(t)-c.toNumber(e);case"+=":return c.isString(t)||c.isString(e)?c.toString(t)+c.toString(e):c.toNumber(t)+c.toNumber(e);case"%=":return c.toNumber(t)%c.toNumber(e);default:throw new Error(l.nodeErrorMessage(r,"RUNTIME","OPERATORNOTRECOGNISED"))}}function k(e,n,t,o){var a;switch(n=n.toLowerCase()){case"hasz":var c=e.hasZ;return void 0!==c&&c;case"hasm":var s=e.hasM;return void 0!==s&&s;case"spatialreference":var f=e.spatialReference._arcadeCacheId;if(void 0===f){var d=!0;Object.freeze&&Object.isFrozen(e.spatialReference)&&(d=!1),d&&(z++,e.spatialReference._arcadeCacheId=z,f=z)}var h=new r({wkt:e.spatialReference.wkt,wkid:e.spatialReference.wkid});return void 0!==f&&(h._arcadeCacheId="SPREF"+f.toString()),h}switch(e.type){case"extent":switch(n){case"xmin":case"xmax":case"ymin":case"ymax":case"zmin":case"zmax":case"mmin":case"mmax":var g=e[n];return void 0!==g?g:null;case"type":return"Extent"}break;case"polygon":switch(n){case"rings":return void 0===(a=e.cache._arcadeCacheId)&&(a=++z,e.cache._arcadeCacheId=a),new i(e.rings,e.spatialReference,!0===e.hasZ,!0===e.hasM,a);case"type":return"Polygon"}break;case"point":switch(n){case"x":case"y":case"z":case"m":return void 0!==e[n]?e[n]:null;case"type":return"Point"}break;case"polyline":switch(n){case"paths":return void 0===(a=e.cache._arcadeCacheId)&&(a=++z,e.cache._arcadeCacheId=a),new i(e.paths,e.spatialReference,!0===e.hasZ,!0===e.hasM,a);case"type":return"Polyline"}break;case"multipoint":switch(n){case"points":return void 0===(a=e.cache._arcadeCacheId)&&(a=++z,e.cache._arcadeCacheId=a),new u(e.points,e.spatialReference,!0===e.hasZ,!0===e.hasM,a,1);case"type":return"Multipoint"}}throw new Error(l.nodeErrorMessage(o,"RUNTIME","PROPERTYNOTFOUND"))}function P(e,n){return v.create(function(t,r){var o=n.name.toLowerCase();if(null===e.localScope||void 0===e.localScope[o])if(void 0===e.globalScope[o])r(new Error(l.nodeErrorMessage(n,"RUNTIME","VARIABLENOTFOUND")));else{var a=e.globalScope[o];!0===a.valueset?t(a.value):null!==a.d?a.d.then(t,r):(a.d=R(e,a.node),a.d.then(function(e){try{a.value=e,a.valueset=!0,t(e)}catch(e){r(e)}},r))}else{var i=e.localScope[o];!0===i.valueset?t(i.value):null!==i.d?i.d.then(t,r):(i.d=R(e,i.node),i.d.then(function(e){try{i.value=e,i.valueset=!0,t(e)}catch(e){r(e)}},r))}})}function L(e){return null===e?"":c.isArray(e)?"Array":c.isImmutableArray(e)?"Array":c.isDate(e)?"Date":c.isString(e)?"String":c.isBoolean(e)?"Boolean":c.isNumber(e)?"Number":e instanceof t?"Attachment":e instanceof r?"Dictionary":e instanceof o?"Feature":e instanceof w?"Point":e instanceof N?"Polygon":e instanceof I?"Polyline":e instanceof E?"Multipoint":e instanceof m?"Extent":c.isFunctionParameter(e)?"Function":c.isFeatureSet(e)?"FeatureSet":c.isFeatureSetCollection(e)?"FeatureSetCollection":e===c.voidOperation?"":"number"==typeof e&&isNaN(e)?"Number":"Unrecognised Type"}function D(e,n){try{var t=e.length,r=Math.floor(t/2);return 0===t?v.resolve([]):1===t?v.resolve([e[0]]):v.create(function(o,a){var i=[D(e.slice(0,r),n),D(e.slice(r,t),n)];v.all(i).then(function(e){try{(function e(n,t,r,o){return v.create(function(a,i){var u=o;n.length>0||t.length>0?n.length>0&&t.length>0?r(n[0],t[0]).then(function(c){try{isNaN(c)&&(c=1),c<=0?(u.push(n[0]),n=n.slice(1)):(u.push(t[0]),t=t.slice(1)),e(n,t,r,o).then(a,i)}catch(e){i(e)}},i):n.length>0?(u.push(n[0]),n=n.slice(1),e(n,t,r,o).then(a,i)):t.length>0&&(u.push(t[0]),t=t.slice(1),e(n,t,r,o).then(a,i)):a(o)})})(e[0],e[1],n,[]).then(o,a)}catch(e){a(e)}},a)})}catch(e){return A(e)}}function G(e,n){var t=e.length,r=Math.floor(t/2);return n||(n=function(e,n){return e<n?-1:e===n?0:1}),0===t?[]:1===t?[e[0]]:function(e,n,t){for(var r=[];e.length>0||n.length>0;)if(e.length>0&&n.length>0){var o=t(e[0],n[0]);isNaN(o)&&(o=1),o<=0?(r.push(e[0]),e=e.slice(1)):(r.push(n[0]),n=n.slice(1))}else e.length>0?(r.push(e[0]),e=e.slice(1)):n.length>0&&(r.push(n[0]),n=n.slice(1));return r}(G(e.slice(0,r),n),G(e.slice(r,t),n),n)}function j(e,n,t){try{var r=e.body;if(t.length!==e.params.length)return A(new Error("Invalid Parameter calls to function."));for(var o=0;o<t.length;o++){var a=e.params[o];"Identifier"===a.type&&(n.localScope[a.name.toLowerCase()]={d:null,value:t[o],valueset:!0,node:null})}return R(n,r).then(function(e){return v.create(function(n,t){return e instanceof c.ReturnResult?void n(e.value):e===c.breakResult?void t(new Error("Cannot Break from a Function")):e===c.continueResult?void t(new Error("Cannot Continue from a Function")):e instanceof c.ImplicitResult?void n(e.value):void n(e)})})}catch(e){return v.reject(e)}}function _(e,n,t){return S(e,n,function(n,r,o){var a={spatialReference:e.spatialReference,services:e.services,console:e.console,lrucache:e.lrucache,localScope:{},abortSignal:e.abortSignal,globalScope:e.globalScope,depthCounter:e.depthCounter+1};if(a.depthCounter>64)throw new Error("Exceeded maximum function depth");return j(t,a,o)})}function B(e){return function(){var n={abortSignal:e.context.abortSignal,spatialReference:e.context.spatialReference,console:e.context.console,lrucache:e.context.lrucache,services:e.context.services,localScope:{},globalScope:e.context.globalScope,depthCounter:e.context.depthCounter+1};if(n.depthCounter>64)throw new Error("Exceeded maximum function depth");return j(e.definition,n,arguments)}}function V(e,n){var t=new W;void 0!==e&&null!==e||(e={}),void 0!==n&&null!==n||(n={});var a=new r({newline:"\n",tab:"\t",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});for(var i in a.immutable=!1,t.textformatting={value:a,valueset:!0,node:null},n)t[i]={value:new c.NativeFunction(n[i]),native:!0,valueset:!0,node:null};for(var i in e)e[i]&&"esri.Graphic"===e[i].declaredClass?t[i]={value:o.createFromGraphic(e[i]),valueset:!0,node:null}:t[i]={value:e[i],valueset:!0,node:null};return t}function Y(e){console.log(e)}Object.defineProperty(n,"__esModule",{value:!0});var q=100,z=0,Z={};s.registerFunctions(Z,F),p.registerFunctions(Z,F),h.registerFunctions(Z,F),d.registerFunctions(Z,F),g.registerFunctions(Z,F),f.registerFunctions({functions:Z,compiled:!1,signatures:null,failDefferred:null,evaluateIdentifier:null,arcadeCustomFunctionHandler:null,mode:"async",standardFunction:F,standardFunctionAsync:S}),Z.typeof=function(e,n){return F(e,n,function(e,n,t){c.pcCheck(t,1,1);var r=L(t[0]);if("Unrecognised Type"===r)throw new Error("Unrecognised Type");return r})},Z.iif=function(e,n){return v.create(function(t,r){c.pcCheck(null===n.arguments?[]:n.arguments,3,3),R(e,n.arguments[0]).then(function(o){try{if(!1===c.isBoolean(o))return void r(new Error("IF Function must have a boolean test condition"));v.all([R(e,n.arguments[1]),R(e,n.arguments[2])]).then(function(e){t(o?e[0]:e[1])},r)}catch(e){r(e)}},r)})},Z.decode=function(e,n){return v.create(function(t,r){return n.arguments.length<2?void r(new Error("Missing Parameters")):2===n.arguments.length?void R(e,n.arguments[1]).then(t,r):(n.arguments.length-1)%2==0?void r(new Error("Must have a default value result.")):void R(e,n.arguments[0]).then(function(o){try{(function e(n,t,r,o){return v.create(function(a,i){R(n,t.arguments[r]).then(function(u){try{if(c.equalityTest(u,o))return void R(n,t.arguments[r+1]).then(a,i);var l=t.arguments.length-r;return 1===l?void R(n,t.arguments[r]).then(a,i):(2===l&&a(null),3===l?void R(n,t.arguments[r+2]).then(a,i):void e(n,t,r+2,o).then(a,i))}catch(e){i(e)}},i)})})(e,n,1,o).then(t,r)}catch(e){r(e)}},r)})},Z.when=function(e,n){try{return n.arguments.length<3?A("Missing Parameters"):n.arguments.length%2==0?A("Must have a default value result."):R(e,n.arguments[0]).then(function(t){return v.create(function(r,o){!1!==c.isBoolean(t)?function e(n,t,r,o){return v.create(function(a,i){!0===o?R(n,t.arguments[r+1]).then(a,i):3==t.arguments.length-r?R(n,t.arguments[r+2]).then(a,i):R(n,t.arguments[r+2]).then(function(o){try{if(!1===c.isBoolean(o))return void i(new Error("WHEN needs boolean test conditions"));e(n,t,r+2,o).then(a,i)}catch(e){i(e)}})})}(e,n,0,t).then(r,o):o(new Error("WHEN needs boolean test conditions"))})})}catch(e){return A(e)}},Z.sort=function(e,n){return S(e,n,function(e,n,t){c.pcCheck(t,1,2);var r,o=t[0];if(c.isImmutableArray(o)&&(o=o.toArray()),!1===c.isArray(o))return A(Error("Illegal Argument"));if(t.length>1)return!1===c.isFunctionParameter(t[1])?A(Error("Illegal Argument")):D(r=o,B(t[1]));if(0===(r=o).length)return v.resolve([]);for(var a={},i=0;i<r.length;i++){var u=L(r[i]);""!==u&&(a[u]=!0)}if(!0===a.Array||!0===a.Dictionary||!0===a.Feature||!0===a.Point||!0===a.Polygon||!0===a.Polyline||!0===a.Multipoint||!0===a.Extent||!0===a.Function)return v.resolve(r.slice(0));var l=0,s="";for(var f in a)l++,s=f;return l>1||"String"===s?r=G(r,function(e,n){if(null===e||void 0===e||e===c.voidOperation)return null===n||void 0===n||n===c.voidOperation?0:1;if(null===n||void 0===n||n===c.voidOperation)return-1;var t=c.toString(e),r=c.toString(n);return t<r?-1:t===r?0:1}):"Number"===s?r=G(r,function(e,n){return e-n}):"Boolean"===s?r=G(r,function(e,n){return e===n?0:n?-1:1}):"Date"===s&&(r=G(r,function(e,n){return n-e})),v.resolve(r)})};var J={failDefferred:A,resolveDeffered:T,fixSpatialReference:c.fixSpatialReference,parseArguments:C,standardFunction:F,standardFunctionAsync:S,evaluateIdentifier:P,arcadeCustomFunction:B};for(var H in Z)Z[H]={value:new c.NativeFunction(Z[H]),valueset:!0,node:null};var W=function(){};W.prototype=Z,W.prototype.infinity={value:Number.POSITIVE_INFINITY,valueset:!0,node:null},W.prototype.pi={value:Math.PI,valueset:!0,node:null},n.functionHelper=J,n.extend=function(e){for(var n={mode:"async",compiled:!1,functions:{},signatures:[],standardFunction:F,standardFunctionAsync:S,failDefferred:A,evaluateIdentifier:P,arcadeCustomFunctionHandler:B},t=0;t<e.length;t++)e[t].registerFunctions(n);for(var r in n.functions)Z[r]={value:new c.NativeFunction(n.functions[r]),valueset:!0,node:null},W.prototype[r]=Z[r];for(t=0;t<n.signatures.length;t++)l.addFunctionDeclaration(n.signatures[t],"async")},n.executeScript=function(e,n){var t=n.spatialReference;null!==t&&void 0!==t||(t=new b({wkid:102100}));var r=V(n.vars,n.customfunctions);return R({spatialReference:t,services:n.services,abortSignal:void 0===n.abortSignal||null===n.abortSignal?{aborted:!1}:n.abortSignal,globalScope:r,console:n.console?n.console:Y,lrucache:n.lrucache,localScope:null,depthCounter:1},e.body[0].body).then(function(e){return v.create(function(n,t){return e instanceof c.ReturnResult&&(e=e.value),e instanceof c.ImplicitResult&&(e=e.value),e===c.voidOperation&&(e=null),e===c.breakResult?void t(new Error("Cannot return BREAK")):e===c.continueResult?void t(new Error("Cannot return CONTINUE")):e instanceof c.NativeFunction?void t(new Error("Cannot return FUNCTION")):e instanceof a?void t(new Error("Cannot return FUNCTION")):void n(e)})})},n.extractFieldLiterals=function(e,n){return void 0===n&&(n=!1),l.findFieldLiterals(e,n)},n.validateScript=function(e,n){return l.validateScript(e,n,"full")},n.referencesMember=function(e,n){return l.referencesMember(e,n)},n.referencesFunction=function(e,n){return l.referencesFunction(e,n)},n.findFunctionCalls=function(e){return l.findFunctionCalls(e,!1)}}.apply(null,r))||(e.exports=o)}}]);