(function(){(this||window).webpackJsonp.registerAbsMids({"esri/arcade/featureSetUtils":2127,"esri/arcade/functions/featuresetbase":2165,"esri/arcade/functions/featuresetgeom":2166,"esri/arcade/functions/featuresetstats":2167,"esri/arcade/functions/featuresetstring":2168,"esri/arcade/featureset/support/shared":2183,"esri/arcade/featureset/support/FeatureSet":2189,"esri/arcade/featureset/support/IdSet":2190,"esri/arcade/featureset/support/sqlUtils":2192,"esri/arcade/featureset/polyfill/FeatureLayerAndTable":2276,"esri/arcade/featureset/support/stats":2277,"esri/arcade/featureset/actions/OrderBy":2278,"esri/arcade/featureset/support/OrderbyClause":2279,"esri/arcade/featureset/actions/AttributeFilter":2280,"esri/arcade/featureset/support/cache":2338,"esri/arcade/featureSetCollection":2339,"esri/arcade/featureset/support/sha":2340,"esri/arcade/featureset/sources/FeatureLayerMemory":2341,"esri/arcade/featureset/actions/Top":2342,"esri/arcade/featureset/actions/SpatialFilter":2343,"esri/arcade/featureset/sources/Empty":2344,"esri/arcade/featureset/sources/FeatureLayerDynamic":2547,"esri/arcade/featureset/support/FeatureSetIterator":2548,"esri/arcade/featureset/sources/FeatureLayerRelated":2549,"esri/arcade/featureset/actions/GroupBy":2550,"esri/arcade/featureset/actions/Adapted":2551,"esri/arcade/featureset/support/StatsField":2552})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[74],{2127:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(12),r(4),r(23),r(2339),r(2276),r(2547),r(2341),r(2549),r(2338),r(2189),r(7),r(181),r(148),r(2278),r(2342),r(2343),r(2280),r(2550)],void 0===(a=function(e,t,r,n,a,i,s,o,l,u,c,d,f,h,p){function y(e,t){if(c.applicationCache){var r=c.applicationCache.getLayerInfo(e);if(r)return r.then(function(r){return f.resolve(new s({url:e,outFields:t,resourceInfo:r}))});var n=new s({url:e,outFields:t}),a=f.create(function(e,t){n.load().then(function(){e(n.resourceInfo)},function(e){t(e)})});return c.applicationCache&&(c.applicationCache.setLayerInfo(e,a),a=a.catch(function(t){throw c.applicationCache.clearLayerInfo(e),t})),a.then(function(e){return f.resolve(n)})}return f.resolve(new s({url:e,outFields:t}))}function _(e,t,r,n,a){return y(e,["*"]).then(function(e){return f.resolve(g(e,t,r,n,a))})}function g(e,t,r,n,a){return void 0===t&&(t=null),void 0===r&&(r=null),void 0===n&&(n=!0),void 0===a&&(a=null),!0===e._hasMemorySource()?new l({layer:e,spatialReference:t,outFields:r,includeGeometry:n,lrucache:a}):new o({layer:e,spatialReference:t,outFields:r,includeGeometry:n,lrucache:a})}function v(e){if(null!==c.applicationCache){var t=c.applicationCache.getLayerInfo(e);if(null!==t)return t}var r=a(e,{responseType:"json",query:{f:"json"}}).then(function(e){if(e.data){var t=e.data;return f.resolve(t)}return f.resolve(null)});return null!==c.applicationCache&&(c.applicationCache.setLayerInfo(e,r),r=r.catch(function(t){throw c.applicationCache.clearLayerInfo(e),t})),r}function m(e,t){var r="QUERYDATAELEMTS:"+t.toString()+":"+e;if(null!==c.applicationCache){var n=c.applicationCache.getLayerInfo(r);if(null!==n)return n}var i=a(e+"/queryDataElements",{method:"post",responseType:"json",query:{layers:JSON.stringify([t.toString()]),f:"json"}}).then(function(e){if(e.data){var t=e.data;if(t.layerDataElements&&t.layerDataElements[0])return t.layerDataElements[0]}throw new Error("Not Found")});return null!==c.applicationCache&&(c.applicationCache.setLayerInfo(r,i),i=i.catch(function(e){throw c.applicationCache.clearLayerInfo(r),e})),i}function S(e){if(null!==c.applicationCache){var t=c.applicationCache.getLayerInfo(e);if(null!==t)return t}var r=a(e,{responseType:"json",query:{f:"json"}}).then(function(e){if(e.data){var t=e.data;return t.layers||(t.layers=[]),t.tables||(t.tables=[]),f.resolve(t)}return f.resolve({layers:[],tables:[]})});return null!==c.applicationCache&&(c.applicationCache.setLayerInfo(e,r),r=r.catch(function(t){throw c.applicationCache.clearLayerInfo(e),t})),r}Object.defineProperty(t,"__esModule",{value:!0}),t.initialiseMetaDataCache=function(){null===c.applicationCache&&(c.applicationCache=new c)},t.constructFeatureSetFromUrl=_,t.constructFeatureSet=g,t.constructAssociationMetaDataFeatureSetFromUrl=function(e,t){var r={metadata:null,networkId:-1,queryelem:null,layerNameLkp:{},lkp:null};return S(e).then(function(n){if(r.metadata=n,n.controllerDatasetLayers&&void 0!==n.controllerDatasetLayers.utilityNetworkLayerId&&null!==n.controllerDatasetLayers.utilityNetworkLayerId){if(n.layers)for(var a=0,i=n.layers;a<i.length;a++){var s=i[a];r.layerNameLkp[s.id]=s.name}if(n.tables)for(var o=0,l=n.tables;o<l.length;o++)s=l[o],r.layerNameLkp[s.id]=s.name;var u=n.controllerDatasetLayers.utilityNetworkLayerId;return r.networkId=u,m(e,u).then(function(n){if(n){r.queryelem=n,r.lkp={},r.queryelem.dataElement.domainNetworks||(r.queryelem.dataElement.domainNetworks=[]);for(var a=0,i=r.queryelem.dataElement.domainNetworks;a<i.length;a++){for(var s=i[a],o=0,l=s.edgeSources?s.edgeSources:[];o<l.length;o++)(h={layerId:(f=l[o]).layerId,sourceId:f.sourceId,className:r.layerNameLkp[f.layerId]?r.layerNameLkp[f.layerId]:null}).className&&(r.lkp[h.className]=h);for(var c=0,d=s.junctionSources?s.junctionSources:[];c<d.length;c++){var f,h;(h={layerId:(f=d[c]).layerId,sourceId:f.sourceId,className:r.layerNameLkp[f.layerId]?r.layerNameLkp[f.layerId]:null}).className&&(r.lkp[h.className]=h)}}return v(e+"/"+u).then(function(n){return n.systemLayers&&void 0!==n.systemLayers.associationsTableId&&null!==n.systemLayers.associationsTableId?_(e+"/"+n.systemLayers.associationsTableId.toString(),t,["OBJECTID","FROMNETWORKSOURCEID","TONETWORKSOURCEID","FROMGLOBALID","TOGLOBALID","TOTERMINALID","FROMTERMINALID","ASSOCIATIONTYPE","ISCONTENTVISIBLE","GLOBALID"],!1,null).then(function(e){return e.load()}).then(function(e){return{lkp:r.lkp,associations:e}}):{associations:null,lkp:null}})}return{associations:null,lkp:null}})}return{associations:null,lkp:null}})},t.constructFeatureSetFromRelationship=function(e,t,r,n,a,i,s){void 0===n&&(n=null),void 0===a&&(a=null),void 0===i&&(i=!0),void 0===s&&(s=null);var o=e.serviceUrl();return o?_(o="/"===o.charAt(o.length-1)?o+t.relatedTableId.toString():o+"/"+t.relatedTableId.toString(),n,a,i,s).then(function(o){return new u({layer:e,relatedLayer:o,relationship:t,objectId:r,spatialReference:n,outFields:a,includeGeometry:i,lrucache:s})}):null},d._polyfill.table=s;var w=function(e){function t(t,r,n){void 0===r&&(r=null),void 0===n&&(n=null);var a=e.call(this)||this;return a._map=t,a._overridespref=r,a.lrucache=n,a._instantLayers=[],a}return r(t,e),t.prototype.makeAndAddFeatureSet=function(e,t,r){void 0===t&&(t=!0),void 0===r&&(r=null);var n=g(e,this._overridespref,null===r?["*"]:r,t,this.lrucache);return this._instantLayers.push({featureset:n,opitem:e,includeGeometry:t,outFields:JSON.stringify(r)}),n},t.prototype.featureSetByName=function(e,t,r){var a=this;if(void 0===t&&(t=!0),void 0===r&&(r=null),void 0!==this._map.loaded&&void 0!==this._map.load&&!1===this._map.loaded)return this._map.load().then(function(){try{return a.featureSetByName(e,t,r)}catch(e){return f.reject(e)}});null===r&&(r=["*"]),r=(r=r.slice(0)).sort();for(var i=JSON.stringify(r),o=0;o<this._instantLayers.length;o++){var l=this._instantLayers[o];if(l.opitem.title===e&&l.includeGeometry===t&&l.outFields===i)return this.resolvePromise(this._instantLayers[o].featureset)}var u=this._map.layers.find(function(t){return t instanceof h&&t.title===e});if(u)return this.resolvePromise(this.makeAndAddFeatureSet(u,t,r));if(this._map.tables){var c=this._map.tables.find(function(t){return!!(t.title&&t.title===e||t.title&&t.title===e)});if(c){if(c._materializedTable);else{var d=c.outFields?c:n({},c,{outFields:["*"]});c._materializedTable=new s(d)}return c._materializedTable.load().then(function(){return a.resolvePromise(a.makeAndAddFeatureSet(c._materializedTable,t,r))})}}return this.resolvePromise(null)},t.prototype.featureSetById=function(e,t,r){var a=this;if(void 0===t&&(t=!0),void 0===r&&(r=["*"]),void 0!==this._map.loaded&&void 0!==this._map.load&&!1===this._map.loaded)return this._map.load().then(function(){try{return a.featureSetById(e,t,r)}catch(e){return f.reject(e)}});null===r&&(r=["*"]),r=(r=r.slice(0)).sort();for(var i=JSON.stringify(r),o=0;o<this._instantLayers.length;o++){var l=this._instantLayers[o];if(l.opitem.id===e&&l.includeGeometry===t&&l.outFields===i)return this.resolvePromise(this._instantLayers[o].featureset)}var u=this._map.layers.find(function(t){return t instanceof h&&t.id===e});if(u)return this.resolvePromise(this.makeAndAddFeatureSet(u,t,r));if(this._map.tables){var c=this._map.tables.find(function(t){return t.id===e});if(c){if(c._materializedTable);else{var d=n({},c,{outFields:["*"]});c._materializedTable=new s(d)}return c._materializedTable.load().then(function(){return a.resolvePromise(a.makeAndAddFeatureSet(c._materializedTable,t,r))})}}return this.resolvePromise(null)},t}(i),F=function(e){function t(t,r,n){void 0===r&&(r=null),void 0===n&&(n=null);var a=e.call(this)||this;return a._url=t,a._overridespref=r,a.lrucache=n,a.metadata=null,a._instantLayers=[],a}return r(t,e),Object.defineProperty(t.prototype,"url",{get:function(){return this._url},enumerable:!0,configurable:!0}),t.prototype.makeAndAddFeatureSet=function(e,t,r){void 0===t&&(t=!0),void 0===r&&(r=null);var n=g(e,this._overridespref,null===r?["*"]:r,t,this.lrucache);return this._instantLayers.push({featureset:n,opitem:e,includeGeometry:t,outFields:JSON.stringify(r)}),n},t.prototype._loadMetaData=function(){var e=this;return S(this._url).then(function(t){return e.metadata=t,t})},t.prototype.load=function(){return this._loadMetaData()},t.prototype.clone=function(){return new t(this._url,this._overridespref,this.lrucache)},t.prototype.featureSetByName=function(e,t,r){var n=this;void 0===t&&(t=!0),void 0===r&&(r=null),null===r&&(r=["*"]),r=(r=r.slice(0)).sort();for(var a=JSON.stringify(r),i=0;i<this._instantLayers.length;i++){var s=this._instantLayers[i];if(s.opitem.title===e&&s.includeGeometry===t&&s.outFields===a)return this.resolvePromise(this._instantLayers[i].featureset)}return this._loadMetaData().then(function(a){for(var i=null,s=0,o=a.layers?a.layers:[];s<o.length;s++){(c=o[s]).name===e&&(i=c)}if(!i)for(var l=0,u=a.tables?a.tables:[];l<u.length;l++){var c;(c=u[l]).name===e&&(i=c)}return i?y(n._url+"/"+i.id,["*"]).then(function(e){return n.makeAndAddFeatureSet(e,t,r)}):n.resolvePromise(null)})},t.prototype.featureSetById=function(e,t,r){var n=this;void 0===t&&(t=!0),void 0===r&&(r=["*"]),null===r&&(r=["*"]),r=(r=r.slice(0)).sort();var a=JSON.stringify(r);e=null!==e&&void 0!==e?e.toString():"";for(var i=0;i<this._instantLayers.length;i++){var s=this._instantLayers[i];if(s.opitem.id===e&&s.includeGeometry===t&&s.outFields===a)return this.resolvePromise(this._instantLayers[i].featureset)}return this._loadMetaData().then(function(a){for(var i=null,s=0,o=a.layers?a.layers:[];s<o.length;s++){null!==(c=o[s]).id&&void 0!==c.id&&c.id.toString()===e&&(i=c)}if(!i)for(var l=0,u=a.tables?a.tables:[];l<u.length;l++){var c;null!==(c=u[l]).id&&void 0!==c.id&&c.id.toString()===e&&(i=c)}return i?y(n._url+"/"+i.id,["*"]).then(function(e){return n.makeAndAddFeatureSet(e,t,r)}):n.resolvePromise(null)})},t}(i);t.createFeatureSetCollectionFromMap=function(e,t,r){return void 0===r&&(r=null),new w(e,t,r)},t.createFeatureSetCollectionFromService=function(e,t,r){return void 0===r&&(r=null),new F(e,t,r)},t.constructFeatureSetFromPortalItem=function(e,t,r,n,a,i,o){if(c.applicationCache){var l=c.applicationCache.getLayerInfo(e+":"+i.url);if(l)return l.then(function(e){try{var i=new s({url:e.url+"/"+t,outFields:["*"]});return f.resolve(g(i,r,n,a,o))}catch(e){return f.reject(e)}},function(e){return f.reject(e)})}return f.create(function(l,u){var d=new p({id:e,portal:i}).load();c.applicationCache&&c.applicationCache.setLayerInfo(e+":"+i.url,d),d.then(function(e){try{var i=new s({url:e.url+"/"+t,outFields:["*"]});l(g(i,r,n,a,o))}catch(e){u(e)}},function(t){c.applicationCache&&c.applicationCache.clearLayerInfo(e+":"+i.url),u(t)})})}}.apply(null,n))||(e.exports=a)},2165:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(185),r(185),r(238),r(2339),r(2127),r(118),r(2280),r(2278),r(2342),r(2341),r(2279),r(7),r(355),r(181)],void 0===(a=function(e,t,r,n,a,i,s,o,l,u,c,d,f,h,p,y){function _(e,t,r){var n=e.getVariables();if(n.length>0){for(var a=[],i=0;i<n.length;i++){var s={name:n[i]};a.push(t.evaluateIdentifier(r,s))}return h.all(a).then(function(t){for(var r={},a=0;a<n.length;a++)r[n[a]]=t[a];return e.parameters=r,e})}return h.resolve(e)}function g(e,t,r){for(var n in void 0===r&&(r=null),e)if(n.toLowerCase()===t.toLowerCase())return e[n];return r}function v(e){if(null===e)return null;var t={type:g(e,"type",""),name:g(e,"name","")};if("range"===t.type)t.range=g(e,"range",[]);else{t.codedValues=[];for(var r=0,n=g(e,"codedValues",[]);r<n.length;r++){var a=n[r];t.codedValues.push({name:g(a,"name",""),code:g(a,"code",null)})}}return t}function m(e){if(null===e)return null;var t={},r=g(e,"wkt",null);null!==r&&(t.wkt=r);var n=g(e,"wkid",null);return null!==n&&(t.wkid=n),t}function S(e){if(null===e)return null;var t={hasZ:g(e,"hasz",!1),hasM:g(e,"hasm",!1)},r=g(e,"spatialreference",null);r&&(t.spatialReference=m(r));var n=g(e,"x",null);if(null!==n)return t.x=n,t.y=g(e,"y",null),t;var a=g(e,"rings",null);if(null!==a)return t.rings=a,t;var i=g(e,"paths",null);if(null!==i)return t.paths=i,t;var s=g(e,"points",null);if(null!==s)return t.points=s,t;for(var o=0,l=["xmin","xmax","ymin","ymax","zmin","zmax","mmin","mmax"];o<l.length;o++){var u=l[o],c=g(e,u,null);null!==c&&(t[u]=c)}return t}Object.defineProperty(t,"__esModule",{value:!0}),t.registerFunctions=function(e){"async"===e.mode&&(e.functions.featuresetbyid=function(t,r){return e.standardFunctionAsync(t,r,function(e,t,r){if(o.pcCheck(r,2,4),r[0]instanceof i){var n=o.toString(r[1]),a=o.defaultUndefined(r[2],null),s=o.toBoolean(o.defaultUndefined(r[3],!0));if(null===a&&(a=["*"]),!1===o.isArray(a))throw new Error("Invalid Parameter");return r[0].featureSetById(n,s,a)}throw new Error("Invalid Parameter")})},e.signatures.push({name:"featuresetbyid",min:"2",max:"4"}),e.functions.featuresetbyportalitem=function(t,r){return e.standardFunctionAsync(t,r,function(e,r,n){o.pcCheck(n,2,4);var a=o.toString(n[0]),i=o.toString(n[1]),l=o.defaultUndefined(n[2],null),u=o.toBoolean(o.defaultUndefined(n[3],!0));if(null===l&&(l=["*"]),!1===o.isArray(l))throw new Error("Invalid Parameter");if(t.services&&t.services.portal)return s.constructFeatureSetFromPortalItem(a,i,t.spatialReference,l,u,t.services.portal,t.lrucache);throw new Error("Portal is required")})},e.signatures.push({name:"featuresetbyportalitem",min:"2",max:"4"}),e.functions.featuresetbyname=function(t,r){return e.standardFunctionAsync(t,r,function(e,t,r){if(o.pcCheck(r,2,4),r[0]instanceof i){var n=o.toString(r[1]),a=o.defaultUndefined(r[2],null),s=o.toBoolean(o.defaultUndefined(r[3],!0));if(null===a&&(a=["*"]),!1===o.isArray(a))throw new Error("Invalid Parameter");return r[0].featureSetByName(n,s,a)}throw new Error("Invalid Parameter")})},e.signatures.push({name:"featuresetbyname",min:"2",max:"4"}),e.functions.featureset=function(t,n){return e.standardFunction(t,n,function(e,n,a){o.pcCheck(a,1,1);var i=a[0],s={layerDefinition:{geometryType:"",objectIdField:"",typeIdField:"",fields:[]},featureSet:{geometryType:"",features:[]}};if(o.isString(i))void 0!==(i=JSON.parse(i)).layerDefinition?(s.layerDefinition=i.layerDefinition,s.featureSet=i.featureSet,i.layerDefinition.spatialReference&&(s.layerDefinition.spatialReference=i.layerDefinition.spatialReference)):(s.featureSet.features=i.features,s.featureSet.geometryType=i.geometryType,s.layerDefinition.geometryType=s.featureSet.geometryType,s.layerDefinition.objectIdField=i.objectIdFieldName,s.layerDefinition.typeIdField=i.typeIdFieldName,s.layerDefinition.fields=i.fields,i.spatialReference&&(s.layerDefinition.spatialReference=i.spatialReference));else{if(!(a[0]instanceof r))throw new Error("Invalid Parameter");var l=g(i=JSON.parse(a[0].castToText()),"layerdefinition");if(null!==l){s.layerDefinition.geometryType=g(l,"geometrytype",""),s.featureSet.geometryType=s.layerDefinition.geometryType,s.layerDefinition.objectIdField=g(l,"objectidfield",""),s.layerDefinition.typeIdField=g(l,"typeidfield",""),(C=g(l,"spatialreference",null))&&(s.layerDefinition.spatialReference=m(C));for(var u=0,c=g(l,"fields",[]);u<c.length;u++){var f={name:g(x=c[u],"name",""),alias:g(x,"alias",""),type:g(x,"type",""),nullable:g(x,"nullable",!0),editable:g(x,"editable",!0),length:g(x,"length",null),domain:v(g(x,"domain"))};s.layerDefinition.fields.push(f)}var h=g(i,"featureset",null);if(h){for(var p={},y=0,_=s.layerDefinition.fields;y<_.length;y++)p[(T=_[y]).name.toLowerCase()]=T.name;for(var w=0,F=g(h,"features",[]);w<F.length;w++){var b={},I=g(N=F[w],"attributes",{});for(var T in I)b[p[T.toLowerCase()]]=I[T];s.featureSet.features.push({attributes:b,geometry:S(g(N,"geometry",null))})}}}else{var C;s.layerDefinition.geometryType=g(i,"geometrytype",""),s.featureSet.geometryType=s.layerDefinition.geometryType,s.layerDefinition.objectIdField=g(i,"objectidfieldname",""),s.layerDefinition.typeIdField=g(i,"typeidfieldname",""),(C=g(i,"spatialreference",null))&&(s.layerDefinition.spatialReference=m(C));for(var D=0,E=g(i,"fields",[]);D<E.length;D++){var x;f={name:g(x=E[D],"name",""),alias:g(x,"alias",""),type:g(x,"type",""),nullable:g(x,"nullable",!0),editable:g(x,"editable",!0),length:g(x,"length",null),domain:v(g(x,"domain"))},s.layerDefinition.fields.push(f)}p={};for(var R=0,A=s.layerDefinition.fields;R<A.length;R++)p[(T=A[R]).name.toLowerCase()]=T.name;for(var O=0,k=g(i,"features",[]);O<k.length;O++){var N;for(var T in b={},I=g(N=k[O],"attributes",{}))b[p[T.toLowerCase()]]=I[T];s.featureSet.features.push({attributes:b,geometry:S(g(N,"geometry",null))})}}}if(!1===function(e){return!!e.layerDefinition&&!!e.featureSet&&!1!==function(e,t){for(var r=0,n=t;r<n.length;r++)if(n[r]===e)return!0;return!1}(e.layerDefinition.geometryType,["","esriGeometryPoint","esriGeometryPolyline","esriGeometryPolygon","esriGeometryMultipoint","esriGeometryEnvelope"])&&null!==e.layerDefinition.objectIdField&&""!==e.layerDefinition.objectIdField&&!1!==o.isArray(e.layerDefinition.fields)&&!1!==o.isArray(e.featureSet.features)&&void 0}(s))throw new Error("Invalid Parameter");return d.create(s,t.spatialReference)})},e.signatures.push({name:"featureset",min:"1",max:"1"}),e.functions.filter=function(t,r){return e.standardFunctionAsync(t,r,function(r,n,a){return o.pcCheck(a,2,2),o.isFeatureSet(a[0])?a[0].load().then(function(r){var n=p.WhereClause.create(a[1],r.getFieldsIndex()),i=n.getVariables();if(i.length>0){for(var s=[],o=0;o<i.length;o++){var u={name:i[o]};s.push(e.evaluateIdentifier(t,u))}return h.all(s).then(function(e){for(var t={},r=0;r<i.length;r++)t[i[r]]=e[r];return n.parameters=t,new l({parentfeatureset:a[0],whereclause:n})})}return h.resolve(new l({parentfeatureset:a[0],whereclause:n}))}):e.failDefferred("Filter cannot accept this parameter type")})},e.signatures.push({name:"filter",min:"2",max:"2"}),e.functions.orderby=function(t,r){return e.standardFunctionAsync(t,r,function(t,r,n){if(o.pcCheck(n,2,2),o.isFeatureSet(n[0])){var a=new f(n[1]);return h.resolve(new u({parentfeatureset:n[0],orderbyclause:a}))}return e.failDefferred("Order cannot accept this parameter type")})},e.signatures.push({name:"orderby",min:"2",max:"2"}),e.functions.top=function(t,r){return e.standardFunctionAsync(t,r,function(t,r,n){return o.pcCheck(n,2,2),o.isFeatureSet(n[0])?h.resolve(new c({parentfeatureset:n[0],topnum:n[1]})):o.isArray(n[0])?o.toNumber(n[1])>=n[0].length?n[0].slice(0):n[0].slice(0,o.toNumber(n[1])):o.isImmutableArray(n[0])?o.toNumber(n[1])>=n[0].length()?n[0].slice(0):n[0].slice(0,o.toNumber(n[1])):e.failDefferred("Top cannot accept this parameter type")})},e.signatures.push({name:"top",min:"2",max:"2"}),e.functions.first=function(t,r){return e.standardFunctionAsync(t,r,function(e,t,r){return o.pcCheck(r,1,1),o.isFeatureSet(r[0])?r[0].first(e.abortSignal).then(function(e){if(null!==e){var t=a.createFromGraphicLikeObject(e.geometry,e.attributes,r[0]);t._underlyingGraphic=e,e=t}return e}):o.isArray(r[0])?0===r[0].length?h.resolve(null):h.resolve(r[0][0]):o.isImmutableArray(r[0])?0===r[0].length()?h.resolve(null):h.resolve(r[0].get(0)):null})},e.signatures.push({name:"first",min:"1",max:"1"}),e.functions.attachments=function(t,n){return e.standardFunctionAsync(t,n,function(e,n,i){o.pcCheck(i,1,2);var l={minsize:-1,maxsize:-1,types:null};if(i.length>1)if(i[1]instanceof r){if(i[1].hasField("minsize")&&(l.minsize=o.toNumber(i[1].field("minsize"))),i[1].hasField("maxsize")&&(l.maxsize=o.toNumber(i[1].field("maxsize"))),i[1].hasField("types")){var u=o.toStringArray(i[1].field("types"),!1);u.length>0&&(l.types=u)}}else if(null!==i[1])throw new Error("Invalid Parameter");if(i[0]instanceof a){var c=i[0]._layer;return c instanceof y&&(c=s.constructFeatureSet(c,t.spatialReference,["*"],!0,t.lrucache)),null===c?[]:!1===o.isFeatureSet(c)?[]:c.load().then(function(){return c.queryAttachments(i[0].field(c.objectIdField),l.minsize,l.maxsize,l.types)})}if(null===i[0])return[];throw new Error("Invalid Parameter")})},e.signatures.push({name:"attachments",min:"1",max:"2"}),e.functions.featuresetbyrelationship=function(t,r){return e.standardFunctionAsync(t,r,function(e,r,n){o.pcCheck(n,2,4);var i=n[0],l=o.toString(n[1]),u=o.defaultUndefined(n[2],null),c=o.toBoolean(o.defaultUndefined(n[3],!0));if(null===u&&(u=["*"]),!1===o.isArray(u))throw new Error("Invalid Parameter");if(null===n[0])return null;if(!(n[0]instanceof a))throw new Error("Invalid Parameter");var d=i._layer;return d instanceof y&&(d=s.constructFeatureSet(d,t.spatialReference,["*"],!0,t.lrucache)),null===d?null:!1===o.isFeatureSet(d)?null:d.load().then(function(e){var r=e.relationshipMetaData().filter(function(e){return e.name===l});if(0===r.length)return null;if(void 0!==r[0].relationshipTableId&&null!==r[0].relationshipTableId&&r[0].relationshipTableId>-1)return s.constructFeatureSetFromRelationship(e,r[0],i.field(e.objectIdField),e.spatialReference,u,c,t.lrucache);var n=e.serviceUrl();return n?(n="/"===n.charAt(n.length-1)?n+r[0].relatedTableId.toString():n+"/"+r[0].relatedTableId.toString(),s.constructFeatureSetFromUrl(n,e.spatialReference,u,c,t.lrucache).then(function(e){return e.load().then(function(){return e.relationshipMetaData()}).then(function(t){if(t=t.filter(function(e){return e.id===r[0].id}),null===i.field(r[0].keyField)){var n=p.WhereClause.create(t[0].keyField+" is null",e.getFieldsIndex());return e.filter(n)}var a=p.WhereClause.create(t[0].keyField+"= @id",e.getFieldsIndex());return a.parameters={id:i.field(r[0].keyField)},e.filter(a)})})):null})})},e.signatures.push({name:"featuresetbyrelationship",min:"2",max:"4"}),e.functions.groupby=function(t,r){return e.standardFunctionAsync(t,r,function(r,a,i){return o.pcCheck(i,3,3),o.isFeatureSet(i[0])?i[0].load().then(function(r){var a=[],s=[],l=[];if(o.isString(i[1]))l.push(i[1]);else if(i[1]instanceof n)l.push(i[1]);else if(o.isArray(i[1]))l=i[1];else{if(!o.isImmutableArray(i[1]))return e.failDefferred("Illegal Value: GroupBy");l=i[1].toArray()}for(var u=0,c=l;u<c.length;u++){var d=c[u];if(o.isString(d))a.push({name:o.toString(d),expression:p.WhereClause.create(o.toString(d),r.getFieldsIndex())});else{if(!(d instanceof n))return e.failDefferred("Illegal Value: GroupBy");var f=d.hasField("name")?d.field("name"):"",y=d.hasField("expression")?d.field("expression"):"";if(!f)return e.failDefferred("Illegal Value: GroupBy");a.push({name:f,expression:p.WhereClause.create(y?f:y,r.getFieldsIndex())})}}if(l=[],o.isString(i[2]))l.push(i[2]);else if(o.isArray(i[2]))l=i[2];else if(o.isImmutableArray(i[2]))l=i[2].toArray();else{if(!(i[2]instanceof n))return e.failDefferred("Illegal Value: GroupBy");l.push(i[2])}for(var g=0,v=l;g<v.length;g++){if(!((d=v[g])instanceof n))return e.failDefferred("Illegal Value: GroupBy");var m=d.hasField("name")?d.field("name"):"",S=d.hasField("statistic")?d.field("statistic"):"";if(y=d.hasField("expression")?d.field("expression"):"",!m||!S||!y)return e.failDefferred("Illegal Value: GroupBy");s.push({name:m,statistic:S.toLowerCase(),expression:p.WhereClause.create(y,r.getFieldsIndex())})}for(var w=[],F=0,b=a;F<b.length;F++){var I=b[F];w.push(_(I.expression,e,t))}for(var T=0,C=s;T<C.length;T++)I=C[T],w.push(_(I.expression,e,t));return w.length>0?h.all(w).then(function(){return h.resolve(i[0].groupby(a,s))}):h.resolve(i[0].groupby(a,s))}):e.failDefferred("Illegal Value: GroupBy")})},e.signatures.push({name:"groupby",min:"3",max:"3"}))}}.apply(null,n))||(e.exports=a)},2166:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(819),r(118),r(2343),r(2344),r(7),r(75),r(812)],void 0===(a=function(e,t,r,n,a,i,s,o,l){function u(e,t,u,c,d){return d(e,t,function(e,t,d){if(d.length<2)return c(new Error("Missing Parameters"));if(null===(d=n.autoCastFeatureToGeometry(d))[0]&&null===d[1])return s.resolve(!1);if(n.isFeatureSet(d[0]))return d[1]instanceof o?s.resolve(new a({parentfeatureset:d[0],relation:u,relationGeom:d[1]})):null===d[1]?s.resolve(new i({parentfeatureset:d[0]})):c("Spatial Relation cannot accept this parameter type");if(d[0]instanceof o){if(d[1]instanceof o){var f=null;switch(u){case"esriSpatialRelEnvelopeIntersects":f=l.intersects(r.shapeExtent(d[0]),r.shapeExtent(d[1]));break;case"esriSpatialRelIntersects":f=l.intersects(d[0],d[1]);break;case"esriSpatialRelContains":f=l.contains(d[0],d[1]);break;case"esriSpatialRelOverlaps":f=l.overlaps(d[0],d[1]);break;case"esriSpatialRelWithin":f=l.within(d[0],d[1]);break;case"esriSpatialRelTouches":f=l.touches(d[0],d[1]);break;case"esriSpatialRelCrosses":f=l.crosses(d[0],d[1])}return null!==f?f:s.reject(new Error("Unrecognised Relationship"))}return n.isFeatureSet(d[1])?s.resolve(new a({parentfeatureset:d[1],relation:u,relationGeom:d[0]})):null===d[1]?s.resolve(!1):c("Spatial Relation cannot accept this parameter type")}return null!==d[0]?c("Spatial Relation cannot accept this parameter type"):n.isFeatureSet(d[1])?s.resolve(new i({parentfeatureset:d[1]})):d[1]instanceof o||null===d[1]?s.resolve(!1):void 0})}Object.defineProperty(t,"__esModule",{value:!0}),t.registerFunctions=function(e){"async"===e.mode&&(e.functions.intersects=function(t,r){return u(t,r,"esriSpatialRelIntersects",e.failDefferred,e.standardFunctionAsync)},e.functions.envelopeintersects=function(t,r){return u(t,r,"esriSpatialRelEnvelopeIntersects",e.failDefferred,e.standardFunctionAsync)},e.signatures.push({name:"envelopeintersects",min:"2",max:"2"}),e.functions.contains=function(t,r){return u(t,r,"esriSpatialRelContains",e.failDefferred,e.standardFunctionAsync)},e.functions.overlaps=function(t,r){return u(t,r,"esriSpatialRelOverlaps",e.failDefferred,e.standardFunctionAsync)},e.functions.within=function(t,r){return u(t,r,"esriSpatialRelWithin",e.failDefferred,e.standardFunctionAsync)},e.functions.touches=function(t,r){return u(t,r,"esriSpatialRelTouches",e.failDefferred,e.standardFunctionAsync)},e.functions.crosses=function(t,r){return u(t,r,"esriSpatialRelCrosses",e.failDefferred,e.standardFunctionAsync)},e.functions.relate=function(t,r){return e.standardFunctionAsync(t,r,function(e,t,r){if(r=n.autoCastFeatureToGeometry(r),n.pcCheck(r,3,3),r[0]instanceof o&&r[1]instanceof o)return l.relate(r[0],r[1],n.toString(r[2]));if(r[0]instanceof o&&null===r[1])return!1;if(r[1]instanceof o&&null===r[0])return!1;if(n.isFeatureSet(r[0])&&null===r[1])return new i({parentfeatureset:r[0]});if(n.isFeatureSet(r[1])&&null===r[0])return new i({parentfeatureset:r[1]});if(n.isFeatureSet(r[0])&&r[1]instanceof o)return r[0].relate(r[1],n.toString(r[2]));if(n.isFeatureSet(r[1])&&r[0]instanceof o)return r[1].relate(r[0],n.toString(r[2]));if(null===r[0]&&null===r[1])return!1;throw new Error("Illegal Argument")})})}}.apply(null,n))||(e.exports=a)},2167:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(118),r(850),r(7),r(355)],void 0===(a=function(e,t,r,n,a,i){function s(e,t,s,l,u,c){if(1===l.length){if(r.isArray(l[0]))return a.resolve(n.calculateStat(e,l[0],r.defaultUndefined(l[1],-1)));if(r.isImmutableArray(l[0]))return a.resolve(n.calculateStat(e,l[0].toArray(),r.defaultUndefined(l[1],-1)))}else if(2===l.length){if(r.isArray(l[0]))return a.resolve(n.calculateStat(e,l[0],r.defaultUndefined(l[1],-1)));if(r.isImmutableArray(l[0]))return a.resolve(n.calculateStat(e,l[0].toArray(),r.defaultUndefined(l[1],-1)));if(r.isFeatureSet(l[0]))return l[0].load().then(function(n){return o(i.WhereClause.create(l[1],n.getFieldsIndex()),c,u).then(function(n){return l[0].calculateStatistic(e,n,r.defaultUndefined(l[2],1e3),t.abortSignal)})})}else if(3===l.length&&r.isFeatureSet(l[0]))return l[0].load().then(function(n){return o(i.WhereClause.create(l[1],n.getFieldsIndex()),c,u).then(function(n){return l[0].calculateStatistic(e,n,r.defaultUndefined(l[2],1e3),t.abortSignal)})});return a.resolve(n.calculateStat(e,l,-1))}function o(e,t,r){try{var n=e.getVariables();if(n.length>0){for(var i=[],s=0;s<n.length;s++){var o={name:n[s]};i.push(t.evaluateIdentifier(r,o))}return a.all(i).then(function(t){for(var r={},a=0;a<n.length;a++)r[n[a]]=t[a];return e.parameters=r,e})}return a.resolve(e)}catch(e){return a.reject(e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.registerFunctions=function(e){"async"===e.mode&&(e.functions.stdev=function(t,r){return e.standardFunctionAsync(t,r,function(r,n,a){return s("stdev",r,0,a,t,e)})},e.functions.variance=function(t,r){return e.standardFunctionAsync(t,r,function(r,n,a){return s("variance",r,0,a,t,e)})},e.functions.average=function(t,r){return e.standardFunctionAsync(t,r,function(r,n,a){return s("mean",r,0,a,t,e)})},e.functions.mean=function(t,r){return e.standardFunctionAsync(t,r,function(r,n,a){return s("mean",r,0,a,t,e)})},e.functions.sum=function(t,r){return e.standardFunctionAsync(t,r,function(r,n,a){return s("sum",r,0,a,t,e)})},e.functions.min=function(t,r){return e.standardFunctionAsync(t,r,function(r,n,a){return s("min",r,0,a,t,e)})},e.functions.max=function(t,r){return e.standardFunctionAsync(t,r,function(r,n,a){return s("max",r,0,a,t,e)})},e.functions.count=function(t,n){return e.standardFunctionAsync(t,n,function(e,t,n){if(r.pcCheck(n,1,1),r.isFeatureSet(n[0]))return n[0].count(e.abortSignal);if(r.isArray(n[0])||r.isString(n[0]))return n[0].length;if(r.isImmutableArray(n[0]))return n[0].length();throw new Error("Invalid Parameters for Count")})})}}.apply(null,n))||(e.exports=a)},2168:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(238),r(118)],void 0===(a=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0}),t.registerFunctions=function(e){"async"===e.mode&&(e.functions.domainname=function(t,a){return e.standardFunctionAsync(t,a,function(e,t,a){if(n.pcCheck(a,2,4),a[0]instanceof r)return a[0].domainValueLookup(n.toString(a[1]),a[2],void 0===a[3]?void 0:n.toNumber(a[3]));if(n.isFeatureSet(a[0]))return a[0]._ensureLoaded().then(function(){var e=n.getDomain(n.toString(a[1]),a[0],null,void 0===a[3]?void 0:n.toNumber(a[3]));return n.getDomainValue(e,a[2])});throw new Error("Invalid Parameter")})},e.signatures.push({name:"domainname",min:"2",max:"4"}),e.functions.domaincode=function(t,a){return e.standardFunctionAsync(t,a,function(e,t,a){if(n.pcCheck(a,2,4),a[0]instanceof r)return a[0].domainCodeLookup(n.toString(a[1]),a[2],void 0===a[3]?void 0:n.toNumber(a[3]));if(n.isFeatureSet(a[0]))return a[0]._ensureLoaded().then(function(){var e=n.getDomain(n.toString(a[1]),a[0],null,void 0===a[3]?void 0:n.toNumber(a[3]));return n.getDomainCode(e,a[2])});throw new Error("Invalid Parameter")})},e.signatures.push({name:"domaincode",min:"2",max:"4"})),e.functions.text=function(t,r){return e.standardFunctionAsync(t,r,function(e,t,r){if(n.pcCheck(r,1,2),!n.isFeatureSet(r[0]))return n.toStringExplicit(r[0],r[1]);var a=n.defaultUndefined(r[2],"");return""===a?r[0].castToText():"schema"===a.toLowerCase()?r[0].convertToText("schema",e.abortSignal):"featureset"===a.toLowerCase()?r[0].convertToText("featureset",e.abortSignal):void 0})}}}.apply(null,n))||(e.exports=a)},2183:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(7),r(30),r(151)],void 0===(a=function(e,t,r,n,a){function i(e){return e instanceof Date}Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Standardised=0]="Standardised",e[e.StandardisedNoInterval=1]="StandardisedNoInterval",e[e.SqlServer=2]="SqlServer",e[e.Oracle=3]="Oracle",e[e.Postgres=4]="Postgres",e[e.PGDB=5]="PGDB",e[e.FILEGDB=6]="FILEGDB",e[e.NotEvaluated=7]="NotEvaluated"}(t.FeatureServiceDatabaseType||(t.FeatureServiceDatabaseType={})),t.cloneField=function(e){return a.fromJSON(e.toJSON())},t.esriFieldToJson=function(e){return e.toJSON()},function(e){e[e.InFeatureSet=0]="InFeatureSet",e[e.NotInFeatureSet=1]="NotInFeatureSet",e[e.Unknown=2]="Unknown"}(t.IdState||(t.IdState={})),t.isString=function(e){return"string"==typeof e||e instanceof String},t.isBoolean=function(e){return"boolean"==typeof e},t.isNumber=function(e){return"number"==typeof e},t.isArray=function(e){return e instanceof Array},t.isDate=i,t.equalityTest=function(e,t){return e===t||!(!i(e)||!i(t))&&e.getTime()===t.getTime()},t.cloneAttributes=function(e){var t={};for(var r in e)t[r]=e[r];return t},t.convertSquareUnitsToCode=function(e){if(void 0===e)return null;if("number"==typeof e)return e;switch(e.toLowerCase()){case"meters":case"meter":return 109404;case"miles":case"mile":return 109413;case"kilometers":case"kilometer":case"km":return 109414}return null},t.shapeExtent=function(e){if(null===e)return null;switch(e.type){case"polygon":case"multipoint":case"polyline":return e.extent;case"point":return new n({xmin:e.x,ymin:e.y,xmax:e.x,ymax:e.y,spatialReference:e.spatialReference});case"extent":return e}return null},t.convertLinearUnitsToCode=function(e){if(void 0===e)return null;if("number"==typeof e)return e;if("number"==typeof e)return e;switch(e.toLowerCase()){case"meters":case"meter":return 9001;case"miles":case"mile":return 9035;case"kilometers":case"kilometer":case"km":return 9036}return null},t.sameGeomType=function(e,t){return e===t||"point"===e&&"esriGeometryPoint"===t||"polyline"===e&&"esriGeometryPolyline"===t||"polygon"===e&&"esriGeometryPolygon"===t||"extent"===e&&"esriGeometryEnvelope"===t||"multipoint"===e&&"esriGeometryMultipoint"===t||"point"===t&&"esriGeometryPoint"===e||"polyline"===t&&"esriGeometryPolyline"===e||"polygon"===t&&"esriGeometryPolygon"===e||"extent"===t&&"esriGeometryEnvelope"===e||"multipoint"===t&&"esriGeometryMultipoint"===e},t.defaultMaxRecords=1e3,t.errback=function(e){return function(t){e.reject(t)}},t.callback=function(e,t){return function(r){try{e.apply(null,arguments)}catch(e){t.reject(e)}}},t.layerGeometryEsriConstants={point:"point",polygon:"polygon",polyline:"polyline",multipoint:"multipoint",extent:"extent",esriGeometryPoint:"point",esriGeometryPolygon:"polygon",esriGeometryPolyline:"polyline",esriGeometryMultipoint:"multipoint",esriGeometryEnvelope:"extent",envelope:"extent"},t.toEsriGeometryType=function(e){switch(e){case"point":return"esriGeometryPoint";case"polygon":return"esriGeometryPolygon";case"multipoint":return"esriGeometryMultipoint";case"polyline":return"esriGeometryPolyline";default:return"esriGeometryPoint"}},t.reduceArrayWithPromises=function(e,t,n){return r.create(function(n,a){var i=r.resolve(!0);e.reduce(function(e,n,a,i){return e.then(function(e){try{return t(e,n,a,i)}catch(e){return r.reject(e)}},function(e){return r.reject(e)})},i).then(n,a)})},t.extractServiceUrl=function(e){return void 0===e?"":e=(e=(e=e.replace(/\/featureserver\/[0-9]*/i,"/FeatureServer")).replace(/\/mapserver\/[0-9]*/i,"/MapServer")).split("?")[0]},t.stableStringify=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var r="boolean"==typeof t.cycles&&t.cycles,n=t.cmp&&function(e){return function(t){return function(r,n){var a={key:r,value:t[r]},i={key:n,value:t[n]};return e(a,i)}}}(t.cmp),a=[];return function e(t){if(t&&t.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0!==t){if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!=typeof t)return JSON.stringify(t);var i,s;if(Array.isArray(t)){for(s="[",i=0;i<t.length;i++)i&&(s+=","),s+=e(t[i])||"null";return s+"]"}if(null===t)return"null";if(-1!==a.indexOf(t)){if(r)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var o=a.push(t)-1,l=Object.keys(t).sort(n&&n(t));for(s="",i=0;i<l.length;i++){var u=l[i],c=e(t[u]);c&&(s&&(s+=","),s+=JSON.stringify(u)+":"+c)}return a.splice(o,1),"{"+s+"}"}}(e)}}.apply(null,n))||(e.exports=a)},2189:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(2548),r(2190),r(2183),r(2338),r(2277),r(7),r(355),r(812),r(32),r(232)],void 0===(a=function(e,t,r,n,a,i,s,o,l,u,c,d){return function(){function e(e){this.recentlyUsedQueries=null,this._idstates=[],this._parent=null,this._wset=null,this._mainSetInUse=null,this._maxProcessing=200,this._maxQuery=500,this._totalCount=-1,this._databaseType=a.FeatureServiceDatabaseType.NotEvaluated,this._databaseTypeProbed=null,this.declaredRootClass="esri.arcade.featureset.support.FeatureSet",this._featureCache=[],this.types=null,this.fields=null,this.geometryType="",this.objectIdField="",this.spatialReference=null,this.hasM=!1,this.hasZ=!1,this._transparent=!1,this.loaded=!1,this._loadPromise=null,this._fieldsIndex=null,e&&e.lrucache&&(this.recentlyUsedQueries=e.lrucache)}return e.prototype.optimisePagingFeatureQueries=function(e){this._parent&&this._parent.optimisePagingFeatureQueries(e)},e.prototype._hasMemorySource=function(){return!0},e.prototype.prop=function(e,t){return void 0===t?this[e]:(void 0!==this[e]&&(this[e]=t),this)},e.prototype.end=function(){return null!==this._parent&&!0===this._parent._transparent?this._parent.end():this._parent},e.prototype._ensureLoaded=function(){return this.load()},e.prototype.load=function(){var e=this;return null===this._loadPromise&&(this._loadPromise=o.create(function(t,r){if(!0===e._parent.loaded)return e._initialiseFeatureSet(),void t(e);e._parent.load().then(function(){try{e._initialiseFeatureSet(),t(e)}catch(e){r(e)}},r)})),this._loadPromise},e.prototype._initialiseFeatureSet=function(){null!==this._parent?(this.fields=this._parent.fields.slice(0),this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.fields=[],this.typeIdField="",this.objectIdField="",this.spatialReference=new c({wkid:4326}),this.geometryType=a.layerGeometryEsriConstants.point)},e.prototype.getField=function(e,t){var r;return(t=t||this.fields)&&(e=e.toLowerCase(),t.some(function(t){return t&&t.name.toLowerCase()===e&&(r=t),!!r})),r},e.prototype.getFieldsIndex=function(){return null===this._fieldsIndex&&(this._fieldsIndex=new d(this.fields)),this._fieldsIndex},e.prototype._maxProcessingRate=function(){return null!==this._parent?Math.min(this._maxProcessing,this._parent._maxProcessingRate()):Math.min(this._maxProcessing,this._maxQueryRate())},e.prototype._maxQueryRate=function(){return null!==this._parent?Math.max(this._maxQuery,this._parent._maxQueryRate()):this._maxQuery},e.prototype._checkCancelled=function(e){if(null!==e&&e.aborted)throw new Error("Operation has been cancelled.")},e.prototype.nativeSource=function(){return this._parent.nativeSource()},e.prototype._canDoAggregates=function(e,t,r,n,a){return null===this._parent?o.resolve(!1):this._parent._canDoAggregates(e,t,r,n,a)},e.prototype._getAggregatePagesDataSourceDefinition=function(e,t,r,n,a,i,s){return null===this._parent?o.reject(new Error("Should never be called")):this._parent._getAggregatePagesDataSourceDefinition(e,t,r,n,a,i,s)},e.prototype._getAgregagtePhysicalPage=function(e,t,r){return null===this._parent?o.reject(new Error("Should never be called")):this._parent._getAgregagtePhysicalPage(e,t,r)},e.prototype.databaseType=function(){var e=this;if(this._databaseType===a.FeatureServiceDatabaseType.NotEvaluated){if(null!==i.applicationCache){var t=i.applicationCache.getDatabaseType(this._cacheableFeatureSetSourceKey());if(null!==t)return t}if(null!==this._databaseTypeProbed)return this._databaseTypeProbed;var r=[{thetype:a.FeatureServiceDatabaseType.SqlServer,testwhere:"(CAST( '2015-01-01' as DATETIME) = CAST( '2015-01-01' as DATETIME)) AND OBJECTID<0"},{thetype:a.FeatureServiceDatabaseType.Oracle,testwhere:"(TO_DATE('2003-11-18','YYYY-MM-DD') = TO_DATE('2003-11-18','YYYY-MM-DD')) AND OBJECTID<0"},{thetype:a.FeatureServiceDatabaseType.StandardisedNoInterval,testwhere:"(date '2015-01-01 10:10:10' = date '2015-01-01 10:10:10') AND OBJECTID<0"}],n=o.create(function(t,n){e._getDatabaseTypeImpl(r,0).then(function(r){e._databaseType=r,t(e._databaseType)},function(e){n(e)})});return null!==i.applicationCache&&(i.applicationCache.setDatabaseType(this._cacheableFeatureSetSourceKey(),n),n=n.catch(function(t){throw i.applicationCache.clearDatabaseType(e._cacheableFeatureSetSourceKey()),t})),this._databaseTypeProbed=n,this._databaseTypeProbed}return o.resolve(this._databaseType)},e.prototype._cacheableFeatureSetSourceKey=function(){return"MUSTBESET"},e.prototype._getDatabaseTypeImpl=function(e,t){var r=this;return t>=e.length?o.resolve(a.FeatureServiceDatabaseType.StandardisedNoInterval):this._runDatabaseProbe(e[t].testwhere).then(function(n){return!0===n?e[t].thetype:r._getDatabaseTypeImpl(e,t+1)})},e.prototype._runDatabaseProbe=function(e){return o.reject(new Error("Not Implemented"))},e.prototype.isTable=function(){return this._parent.isTable()},e.prototype._featureFromCache=function(e){if(void 0!==this._featureCache[e])return this._featureCache[e]},e.prototype._isInFeatureSet=function(e){return a.IdState.Unknown},e.prototype._getSet=function(e){throw new Error("Not implemented in abstract class")},e.prototype._getFeature=function(e,t,r){var n=this;try{return this._checkCancelled(r),void 0!==this._featureFromCache(t)?o.resolve(this._featureFromCache(t)):this._getFeatures(e,t,this._maxProcessingRate(),r).then(function(){return n._checkCancelled(r),void 0!==n._featureFromCache(t)?n._featureFromCache(t):o.reject(new Error("Feature Not Found"))})}catch(e){return o.reject(e)}},e.prototype._getFeatureBatch=function(e,t){var r=this;try{this._checkCancelled(t);var a=new n([],e,!1,null),i=[];return this._getFeatures(a,-1,e.length,t).then(function(){r._checkCancelled(t);for(var n=0,a=e;n<a.length;n++){var s=a[n];void 0!==r._featureFromCache(s)&&i.push(r._featureFromCache(s))}return i})}catch(e){return o.reject(e)}},e.prototype._getFeatures=function(e,t,r,n){return o.resolve("success")},e.prototype._getFilteredSet=function(e,t,r,n,a){throw new Error("Not implemented in abstract class")},e.prototype._refineSetBlock=function(e,t,r){var n=this;try{if(!0===this._checkIfNeedToExpandCandidatePage(e,this._maxQueryRate(),r))return this._expandPagedSet(e,this._maxQueryRate(),0,0,r).then(function(){return n._refineSetBlock(e,t,r)});this._checkCancelled(r);var a=e._candidates.length;this._refineKnowns(e,t);var i=a-e._candidates.length;return 0===e._candidates.length?o.resolve(e):i>=t?o.resolve(e):this._refineIfParentKnown(e,t-i,r).then(function(){if(n._checkCancelled(r),n._refineKnowns(e,t-i),(i=a-e._candidates.length)<t&&e._candidates.length>0){var s=t-i,o=n._prepareFetchAndRefineSet(e._candidates,n._maxQueryRate());return n._fetchAndRefineFeatures(o,o.length>s?s:e._candidates.length,r).then(function(){return n._checkCancelled(r),n._refineKnowns(e,t-i),e})}return e})}catch(e){return o.reject(e)}},e.prototype._fetchAndRefineFeatures=function(e,t,r){return null},e.prototype._prepareFetchAndRefineSet=function(e,t){for(var r=[],n=0;n<e.length;n++)this._isPhysicalFeature(e[n])&&r.push(e[n]);return r},e.prototype._isPhysicalFeature=function(e){return null===this._parent||this._parent._isPhysicalFeature(e)},e.prototype._refineKnowns=function(e,t){var r=0,n=null,i=[];t=this._maxQueryRate();for(var s=0;s<e._candidates.length&&"GETPAGES"!==e._candidates[s];s++){var o=!1,l=this._candidateIdTransform(e._candidates[s]);l!==e._candidates[s]&&(o=!0);var u=this._isInFeatureSet(l);if(u===a.IdState.InFeatureSet)!0===o?e._known.indexOf(l)<0&&(e._known.push(l),r+=1):(e._known.push(e._candidates[s]),r+=1),null===n?n={start:s,end:s}:n.end===s-1?n.end=s:(i.push(n),n={start:s,end:s});else if(u===a.IdState.NotInFeatureSet)null===n?n={start:s,end:s}:n.end===s-1?n.end=s:(i.push(n),n={start:s,end:s}),r+=1;else if(u===a.IdState.Unknown&&(r+=1,!0===e._ordered))break;if(r>=t)break}null!==n&&i.push(n);for(var c=i.length-1;c>=0;c--)e._candidates.splice(i[c].start,i[c].end-i[c].start+1)},e.prototype._refineIfParentKnown=function(e,t,r){var a=this,i=new n([],[],e._ordered,null);return i._candidates=e._candidates.slice(0),this._parent._refineSetBlock(i,t,r).then(function(t){return a._parent._transformSetWithIdChanges(e),t})},e.prototype._candidateIdTransform=function(e){return this._parent._candidateIdTransform(e)},e.prototype._transformSetWithIdChanges=function(e){this._parent._transformSetWithIdChanges(e)},e.prototype._checkIfNeedToExpandKnownPage=function(e,t,r){if(null===e.pagesDefinition)return!1;for(var n=0,a=e._lastFetchedIndex;a<e._known.length;a++){if("GETPAGES"===e._known[a])return!0;if(void 0===this._featureCache[e._known[a]]&&(n+=1)>=t)break}return!1},e.prototype._checkIfNeedToExpandCandidatePage=function(e,t,r){if(null===e.pagesDefinition)return!1;for(var n=0,a=0;a<e._candidates.length;a++){if("GETPAGES"===e._candidates[a])return!0;if((n+=1)>=t)break}return!1},e.prototype._expandPagedSet=function(e,t,r,n,a){return null===this._parent?o.reject(new Error("Parent Paging not implemented")):this._parent._expandPagedSet(e,t,r,n,a)},e.prototype._expandPagedSetFeatureSet=function(e,t,r,n,a){var i=this;return e._known.length>0&&"GETPAGES"===e._known[e._known.length-1]&&(n=1),0===n&&e._candidates.length>0&&"GETPAGES"===e._candidates[e._candidates.length-1]&&(n=2),0===n?o.resolve("finished"):this._getPage(e,n,a).then(function(n){return r+n<t?i._expandPagedSet(e,t,r+n,0,a):"success"})},e.prototype._getPage=function(e,t,r){var n=this,a=1===t?e._known:e._candidates;if(e.pagesDefinition.internal.set.length>e.pagesDefinition.resultOffset||!0===e.pagesDefinition.internal.fullyResolved){a.length=a.length-1;for(var i=0,s=0;s<e.pagesDefinition.resultRecordCount&&!(e.pagesDefinition.resultOffset+s>=e.pagesDefinition.internal.set.length);s++)a[a.length]=e.pagesDefinition.internal.set[e.pagesDefinition.resultOffset+s],i++;e.pagesDefinition.resultOffset+=i;var l=!1;return!0===e.pagesDefinition.internal.fullyResolved&&e.pagesDefinition.internal.set.length<=e.pagesDefinition.resultOffset&&(l=!0),!1===l&&a.push("GETPAGES"),o.resolve(i)}return this._getPhysicalPage(e,t,r).then(function(){return n._getPage(e,t,r)})},e.prototype._getPhysicalPage=function(e,t,r){return null},e.prototype._clonePageDefinition=function(e){return null===this._parent?null:this._parent._clonePageDefinition(e)},e.prototype._first=function(e){return this.iterator(e).next()},e.prototype.first=function(e){return this._first(e)},e.prototype.calculateStatistic=function(e,t,r,n){var a=this;return this._ensureLoaded().then(function(){return a._stat(e,t,"",null,null,r,n).then(function(i){return!1===i.calculated?a._manualStat(e,t,r,n).then(function(e){return e.result}):i.result})})},e.prototype._manualStat=function(e,t,r,n){switch(e.toLowerCase()){case"count":return s.count(this,n).then(function(e){return{calculated:!0,result:e}});case"distinct":return s.distinct(this,t,r).then(function(e){return{calculated:!0,result:e}});case"avg":case"mean":return s.mean(this,t,n).then(function(e){return{calculated:!0,result:e}});case"stdev":return s.stdev(this,t,n).then(function(e){return{calculated:!0,result:e}});case"variance":return s.variance(this,t,n).then(function(e){return{calculated:!0,result:e}});case"sum":return s.sum(this,t,n).then(function(e){return{calculated:!0,result:e}});case"min":return s.min(this,t,n).then(function(e){return{calculated:!0,result:e}});case"max":return s.max(this,t,n).then(function(e){return{calculated:!0,result:e}});default:return o.resolve({calculated:!0,result:0})}},e.prototype._stat=function(e,t,r,n,a,i,s){var o=this;return this._parent._stat(e,t,r,n,a,i,s).then(function(l){return!1===l.calculated?null===a&&""===r&&null===n?o._manualStat(e,t,i,s):{calculated:!1}:l})},e.prototype._unionAllGeomSelf=function(e){var t=this,r=this.iterator(this._defaultTracker(e)),n=[];return o.create(function(e,a){t._unionShapeInBatches(n,r,e,a)})},e.prototype._unionAllGeom=function(e){var t=this;return o.create(function(r,n){var a=t.iterator(t._defaultTracker(e));t._unionShapeInBatches([],a,r,n)})},e.prototype._unionShapeInBatches=function(e,t,r,n){var a=this;t.next().then(function(i){try{null!==i&&null!==i.geometry&&e.push(i.geometry),e.length>30||null===i&&e.length>1?u.union(e).then(function(s){try{null===i?r(s):(e=[s],a._unionShapeInBatches(e,t,r,n))}catch(e){n(e)}},n):null===i?r(1===e.length?e[0]:null):a._unionShapeInBatches(e,t,r,n)}catch(e){n(e)}},n)},e.prototype.iterator=function(e){return new r(this,e)},e.prototype.intersection=function(t,r){return void 0===r&&(r=!1),e._featuresetFunctions.intersection.bind(this)(t,r)},e.prototype.difference=function(t,r,n){return void 0===r&&(r=!1),void 0===n&&(n=!0),e._featuresetFunctions.difference.bind(this)(t,r,n)},e.prototype.symmetricDifference=function(t,r,n){return void 0===r&&(r=!1),void 0===n&&(n=!0),e._featuresetFunctions.symmetricDifference.bind(this)(t,r,n)},e.prototype.morphShape=function(t,r,n,a){return void 0===n&&(n="unknown"),void 0===a&&(a=null),e._featuresetFunctions.morphShape.bind(this)(t,r,n,a)},e.prototype.morphShapeAndAttributes=function(t,r,n){return void 0===n&&(n="unknown"),e._featuresetFunctions.morphShapeAndAttributes.bind(this)(t,r,n)},e.prototype.union=function(t,r){return void 0===r&&(r=!1),e._featuresetFunctions.union.bind(this)(t,r)},e.prototype.intersects=function(t){return e._featuresetFunctions.intersects.bind(this)(t)},e.prototype.envelopeIntersects=function(t){return e._featuresetFunctions.envelopeIntersects.bind(this)(t)},e.prototype.contains=function(t){return e._featuresetFunctions.contains.bind(this)(t)},e.prototype.overlaps=function(t){return e._featuresetFunctions.overlaps.bind(this)(t)},e.prototype.relate=function(t,r){return e._featuresetFunctions.relate.bind(this)(t,r)},e.prototype.within=function(t){return e._featuresetFunctions.within.bind(this)(t)},e.prototype.touches=function(t){return e._featuresetFunctions.touches.bind(this)(t)},e.prototype.top=function(t){return e._featuresetFunctions.top.bind(this)(t)},e.prototype.crosses=function(t){return e._featuresetFunctions.crosses.bind(this)(t)},e.prototype.buffer=function(t,r,n,a){return void 0===a&&(a=!0),e._featuresetFunctions.buffer.bind(this)(t,r,n,a)},e.prototype.filter=function(t,r){return void 0===r&&(r=null),e._featuresetFunctions.filter.bind(this)(t,r)},e.prototype.orderBy=function(t){return e._featuresetFunctions.orderBy.bind(this)(t)},e.prototype.dissolve=function(t,r){return e._featuresetFunctions.dissolve.bind(this)(t,r)},e.prototype.groupby=function(t,r){return e._featuresetFunctions.groupby.bind(this)(t,r)},e.prototype.reduce=function(e,t,r){var n=this;return void 0===t&&(t=null),o.create(function(a,i){n._reduceImpl(n.iterator(n._defaultTracker(r)),e,t,0,a,i,0)})},e.prototype._reduceImpl=function(e,t,r,n,a,i,s){var l=this;try{if(++s>1e3)return void setTimeout(function(){s=0,l._reduceImpl(e,t,r,n,a,i,s)});e.next().then(function(u){try{if(null===u)a(r);else{var c=t(r,u,n,l);o.isThenable(c)?c.then(function(r){l._reduceImpl(e,t,r,n+1,a,i,s)},i):l._reduceImpl(e,t,c,n+1,a,i,s)}}catch(e){i(e)}},i)}catch(e){i(e)}},e.prototype.removeField=function(t){return e._featuresetFunctions.removeField.bind(this)(t)},e.prototype.addField=function(t,r,n){return void 0===n&&(n=null),e._featuresetFunctions.addField.bind(this)(t,r,n)},e.prototype.sumArea=function(e,t,r){void 0===t&&(t=!1);var n=a.convertSquareUnitsToCode(e);return this.reduce(function(e,r){return null===r.geometry?0:t?u.geodesicArea(r.geometry,n).then(function(t){return e+t}):u.planarArea(r.geometry,n).then(function(t){return e+t})},0,r)},e.prototype.sumLength=function(e,t,r){void 0===t&&(t=!1);var n=a.convertLinearUnitsToCode(e);return this.reduce(function(e,r){return null===r.geometry?0:t?u.geodesicLength(r.geometry,n).then(function(t){return e+t}):u.planarLength(r.geometry,n).then(function(t){return e+t})},0,r)},e.prototype._substituteVars=function(e,t){if(null!==t){var r={};for(var n in t)r[n.toLowerCase()]=t[n];e.parameters=r}},e.prototype.distinct=function(e,t,r,n){var a=this;return void 0===t&&(t=1e3),void 0===r&&(r=null),this.load().then(function(){var i=l.WhereClause.create(e,a.getFieldsIndex());return a._substituteVars(i,r),a.calculateStatistic("distinct",i,t,a._defaultTracker(n))})},e.prototype.min=function(e,t,r){var n=this;return void 0===t&&(t=null),this.load().then(function(){var a=l.WhereClause.create(e,n.getFieldsIndex());return n._substituteVars(a,t),n.calculateStatistic("min",a,-1,n._defaultTracker(r))})},e.prototype.max=function(e,t,r){var n=this;return void 0===t&&(t=null),this.load().then(function(){var a=l.WhereClause.create(e,n.getFieldsIndex());return n._substituteVars(a,t),n.calculateStatistic("max",a,-1,n._defaultTracker(r))})},e.prototype.avg=function(e,t,r){var n=this;return void 0===t&&(t=null),this.load().then(function(){var a=l.WhereClause.create(e,n.getFieldsIndex());return n._substituteVars(a,t),n.calculateStatistic("avg",a,-1,n._defaultTracker(r))})},e.prototype.sum=function(e,t,r){var n=this;return void 0===t&&(t=null),this.load().then(function(){var a=l.WhereClause.create(e,n.getFieldsIndex());return n._substituteVars(a,t),n.calculateStatistic("sum",a,-1,n._defaultTracker(r))})},e.prototype.stdev=function(e,t,r){var n=this;return void 0===t&&(t=null),this.load().then(function(){var a=l.WhereClause.create(e,n.getFieldsIndex());return n._substituteVars(a,t),n.calculateStatistic("stdev",a,-1,n._defaultTracker(r))})},e.prototype.variance=function(e,t,r){var n=this;return void 0===t&&(t=null),this.load().then(function(){var a=l.WhereClause.create(e,n.getFieldsIndex());return n._substituteVars(a,t),n.calculateStatistic("variance",a,-1,n._defaultTracker(r))})},e.prototype.count=function(e){var t=this;return this.load().then(function(){return t.calculateStatistic("count",l.WhereClause.create("1",t.getFieldsIndex()),-1,t._defaultTracker(e))})},e.prototype._defaultTracker=function(e){return e||{aborted:!1}},e.prototype.forEach=function(e,t){var r=this;return o.create(function(n,a){r._forEachImpl(r.iterator(r._defaultTracker(t)),e,r,n,a,0)})},e.prototype._forEachImpl=function(e,t,r,n,a,i){var s=this;try{if(++i>1e3)return void setTimeout(function(){i=0,s._forEachImpl(e,t,r,n,a,i)},0);e.next().then(function(l){try{if(null===l)n(r);else{var u=t(l);void 0===u||null===u?s._forEachImpl(e,t,r,n,a,i):o.isThenable(u)?u.then(function(){try{s._forEachImpl(e,t,r,n,a,i)}catch(e){a(e)}},a):s._forEachImpl(e,t,r,n,a,i)}}catch(e){a(e)}},a)}catch(e){a(e)}},e.prototype.convertToJSON=function(e){for(var t={layerDefinition:{geometryType:this.geometryType,fields:[]},featureSet:{features:[],geometryType:this.geometryType}},r=0;r<this.fields.length;r++)t.layerDefinition.fields.push(a.esriFieldToJson(this.fields[r]));return this.reduce(function(e){var r={geometry:e.geometry&&e.geometry.toJSON(),attributes:{}};for(var n in e.attributes)r.attributes[n]=e.attributes[n];return t.featureSet.features.push(r),1},0,e)},e.prototype.castToText=function(){return"object, FeatureSet"},e.prototype.queryAttachments=function(e,t,r,n){return this._parent.queryAttachments(e,t,r,n)},e.prototype.serviceUrl=function(){return this._parent.serviceUrl()},e.prototype.relationshipMetaData=function(){return this._parent.relationshipMetaData()},e.prototype.schema=function(){for(var e=[],t=0,r=this.fields;t<r.length;t++){var n=r[t];e.push(a.esriFieldToJson(n))}return{objectIdField:this.objectIdField,typeIdField:this.typeIdField,geometryType:void 0===a.layerGeometryEsriConstants[this.geometryType]?"":a.layerGeometryEsriConstants[this.geometryType],hasZ:this.hasZ,hasM:this.hasM,fields:e}},e.prototype.convertToText=function(e,t){var r=this;return"schema"===e?this._ensureLoaded().then(function(){return JSON.stringify(r.schema)}):"featureset"===e?this._ensureLoaded().then(function(){var e=[];return r.reduce(function(t){var r=t.toJson();return null!==r.geometry&&r.geometry.spatialReference&&delete r.geometry.spatialReference,e.push(r),1},0,t).then(function(){var t=r.schema();return t.features=e,t.spatialReference=r.spatialReference.toJSON(),JSON.stringify(r.schema)})}):o.resolve(this.castToText())},e._featuresetFunctions={},e._polyfill={table:null},e}()}.apply(null,n))||(e.exports=a)},2190:function(e,t,r){var n,a;n=[r.dj.c(e.i),t],void 0===(a=function(e,t){return function(){return function(e,t,r,n){this._candidates=null,this._known=null,this._lastFetchedIndex=0,this._ordered=!1,this.pagesDefinition=null,this._candidates=e,this._known=t,this._ordered=r,this.pagesDefinition=n}}()}.apply(null,n))||(e.exports=a)},2192:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(523),r(2183),r(355)],void 0===(a=function(e,t,r,n,a){function i(e,t){return s(e.parseTree,t,e.parameters)}function s(e,t,r,n,a){var i,c,d,h;switch(void 0===n&&(n=null),void 0===a&&(a=null),e.type){case"interval":return f(s(e.value,t,r,n,a),e.qualifier,e.op,t);case"case_expression":var p=" CASE ";"simple"===e.format&&(p+=s(e.operand,t,r,n,a));for(var y=0;y<e.clauses.length;y++)p+=" WHEN "+s(e.clauses[y].operand,t,r,n,a)+" THEN "+s(e.clauses[y].value,t,r,n,a);return null!==e.else&&(p+=" ELSE "+s(e.else,t,r,n,a)),p+" END ";case"param":var _=r[e.value.toLowerCase()];if("string"==typeof _)return"'"+r[e.value.toLowerCase()].toString().replace(/'/g,"''")+"'";if(_ instanceof Date)return l(_,t);if(_ instanceof Array){var g=[];for(y=0;y<_.length;y++)"string"==typeof _[y]?g.push("'"+_[y].toString().replace(/'/g,"''")+"'"):_[y]instanceof Date?g.push(l(_[y],t)):g.push(_[y].toString());return g}return _.toString();case"expr_list":c=[];for(var v=0,m=e.value;v<m.length;v++){var S=m[v];c.push(s(S,t,r,n,a))}return c;case"unary_expr":return" ( NOT "+s(e.expr,t,r,n,a)+" ) ";case"binary_expr":switch(e.operator){case"AND":return" ("+s(e.left,t,r,n,a)+" AND "+s(e.right,t,r,n,a)+") ";case"OR":return" ("+s(e.left,t,r,n,a)+" OR "+s(e.right,t,r,n,a)+") ";case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return" ("+s(e.left,t,r,n,a)+" IS NULL )";case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return" ("+s(e.left,t,r,n,a)+" IS NOT NULL )";case"IN":return i=[],"expr_list"===e.right.type?(i=s(e.right,t,r,n,a)," ("+s(e.left,t,r,n,a)+" IN ("+i.join(",")+")) "):(h=s(e.right,t,r,n,a))instanceof Array?" ("+s(e.left,t,r,n,a)+" IN ("+h.join(",")+")) ":" ("+s(e.left,t,r,n,a)+" IN ("+h+")) ";case"NOT IN":return i=[],"expr_list"===e.right.type?(i=s(e.right,t,r,n,a)," ("+s(e.left,t,r,n,a)+" NOT IN ("+i.join(",")+")) "):(h=s(e.right,t,r,n,a))instanceof Array?" ("+s(e.left,t,r,n,a)+" NOT IN ("+h.join(",")+")) ":" ("+s(e.left,t,r,n,a)+" NOT IN ("+h+")) ";case"BETWEEN":return d=s(e.right,t,r,n,a)," ("+s(e.left,t,r,n,a)+" BETWEEN "+d[0]+" AND "+d[1]+" ) ";case"NOTBETWEEN":return d=s(e.right,t,r,n,a)," ("+s(e.left,t,r,n,a)+" NOT BETWEEN "+d[0]+" AND "+d[1]+" ) ";case"LIKE":return""!==e.escape?" ("+s(e.left,t,r,n,a)+" LIKE "+s(e.right,t,r,n,a)+" ESCAPE '"+e.escape+"') ":" ("+s(e.left,t,r,n,a)+" LIKE "+s(e.right,t,r,n,a)+") ";case"NOT LIKE":return""!==e.escape?" ("+s(e.left,t,r,n,a)+" NOT LIKE "+s(e.right,t,r,n,a)+" ESCAPE '"+e.escape+"') ":" ("+s(e.left,t,r,n,a)+" NOT LIKE "+s(e.right,t,r,n,a)+") ";case"<>":case"<":case">":case">=":case"<=":case"=":case"*":case"-":case"+":case"/":return" ("+s(e.left,t,r,n,a)+" "+e.operator+" "+s(e.right,t,r,n,a)+") "}throw new Error("Not Supported Operator "+e.operator);case"null":return"null";case"bool":return!0===e.value?"1":"0";case"string":return"'"+e.value.toString().replace(/'/g,"''")+"'";case"timestamp":case"date":return l(e.value,t);case"number":return e.value.toString();case"column_ref":return"CURRENT_DATE"===e.column.toUpperCase()?u(!0,t):"CURRENT_TIMESTAMP"===e.column.toUpperCase()?u(!1,t):n&&n.toLowerCase()===e.column.toLowerCase()?"("+a+")":e.column;case"function":var w=s(e.args,t,r,n,a);return o(e.name,w,t)}throw new Error("Unsupported sql syntax "+e.type)}function o(e,t,r){switch(e.toLowerCase().trim()){case"abs":if(1!==t.length)throw new Error("Invalid Parameter for call to ABS");return"abs("+t[0]+")";case"ceiling":case"ceil":if(1!==t.length)throw new Error("Invalid Parameter for call to CEILING");switch(r){case n.FeatureServiceDatabaseType.Standardised:case n.FeatureServiceDatabaseType.StandardisedNoInterval:default:return"CEILING("+t[0]+")"}case"floor":if(1!==t.length)throw new Error("Invalid Parameter for call to Floor");return"FLOOR("+t[0]+")";case"log":if(1!==t.length)throw new Error("Invalid Parameter for call to LOG");return"LOG("+t[0]+")";case"log10":if(1!==t.length)throw new Error("Invalid Parameter for call to LOG10");return"LOG10("+t[0]+")";case"power":if(2!==t.length)throw new Error("Invalid Parameter for call to POWER");return"POWER("+t[0]+","+t[1]+")";case"round":if(2===t.length)return"ROUND("+t[0]+","+t[1]+")";if(1===t.length)return"ROUND("+t[0]+")";throw new Error("Invalid Parameter for call to ROUND");case"truncate":if(t.length<1||t.length>2)throw new Error("Invalid Parameter for TRUNCATE function");switch(r){case n.FeatureServiceDatabaseType.SqlServer:return"ROUND("+t[0]+(1===t.length?"0":","+t[1])+",1)";default:return"TRUNCATE("+t[0]+(1===t.length?")":","+t[1]+")")}case"char_length":case"len":if(1!==t.length)throw new Error("Invalid Parameter for CHAR_LENGTH function");switch(r){case n.FeatureServiceDatabaseType.SqlServer:return"LEN("+t[0]+")";case n.FeatureServiceDatabaseType.Oracle:return"LENGTH("+t[0]+")";default:return"CHAR_LENGTH("+t[0]+")"}case"concat":if(t.length<1)throw new Error("Invalid Parameter for CONCAT function");for(var a="CONCAT(",i=0;i<t.length;i++)0!==i&&(a+=","),a+=t[i];return a+")";case"lower":case"lcase":if(1!==t.length)throw new Error("Invalid Parameter for Lower function");return"LOWER("+t[0]+")";case"upper":case"ucase":if(1!==t.length)throw new Error("Invalid Parameter for Upper function");return"UPPER("+t[0]+")";case"substring":var s="";switch(r){case n.FeatureServiceDatabaseType.Oracle:return s="SUBSTR("+t[0]+","+t[1],3===t.length&&(s+=","+t[2]),s+")";case n.FeatureServiceDatabaseType.SqlServer:return 3===t.length?"SUBSTRING("+t[0]+","+t[1]+","+t[2]+")":"SUBSTRING("+t[0]+",  "+t[1]+", LEN("+t[0]+") - "+t[1]+")";default:return s="SUBSTRING("+t[0]+" FROM "+t[1],3===t.length&&(s+=" FOR "+t[2]),s+")"}case"extract":return"EXTRACT("+t[0].replace(/\'/g,"")+" FROM "+t[1]+")"}throw new Error("Function Not Recognised")}function l(e,t){var a=r(e),i=0===a.minute()&&0===a.hour()&&0===a.second()&&0===a.millisecond();switch(t){case n.FeatureServiceDatabaseType.FILEGDB:case n.FeatureServiceDatabaseType.Standardised:case n.FeatureServiceDatabaseType.StandardisedNoInterval:return i?"date '"+a.format("YYYY-MM-DD")+"'":"date '"+a.format("YYYY-MM-DD HH:mm:ss")+"'";case n.FeatureServiceDatabaseType.Oracle:return i?"TO_DATE('"+a.format("YYYY-MM-DD")+"','YYYY-MM-DD')":"TO_DATE('"+a.format("YYYY-MM-DD HH:mm:ss")+"','YYYY-MM-DD HH24:MI:SS')";case n.FeatureServiceDatabaseType.SqlServer:return"'"+a.format(i?"YYYY-MM-DD":"YYYY-MM-DD HH:mm:ss")+"'";case n.FeatureServiceDatabaseType.PGDB:return"#"+a.format(i?"MM-DD-YYYY":"MM-DD-YYYY HH:mm:ss")+"#";case n.FeatureServiceDatabaseType.Postgres:return"TIMESTAMP '"+a.format(i?"YYYY-MM-DD":"YYYY-MM-DD HH:mm:ss")+"'";default:return"date '"+a.format("YYYY-MM-DD HH:mm:ss")+"'"}}function u(e,t){switch(t){case n.FeatureServiceDatabaseType.FILEGDB:case n.FeatureServiceDatabaseType.Standardised:case n.FeatureServiceDatabaseType.StandardisedNoInterval:case n.FeatureServiceDatabaseType.Oracle:return e?"CURRENT_DATE":"CURRENT_TIMESTAMP";case n.FeatureServiceDatabaseType.SqlServer:return e?"CAST(GETDATE() AS DATE)":"GETDATE()";case n.FeatureServiceDatabaseType.PGDB:case n.FeatureServiceDatabaseType.Postgres:default:return e?"CURRENT_DATE":"CURRENT_TIMESTAMP"}}function c(e){if(e){for(var t="",r=0,n=e;r<n.length;r++){var a=n[r];""!==a&&(t=""===t?a:h[t]<h[a]?a:t)}return t}return""}function d(e,t){return""+e.period.toUpperCase()}function f(e,t,r,n){return"INTERVAL "+r+" "+e+" "+("interval-period"===t.type?d(t):d(t.start)+" TO "+d(t.end))}Object.defineProperty(t,"__esModule",{value:!0}),t.toWhereClause=i,t.toWhereClauseFromTree=function(e,t,r){return s(e,t,r)},t.reformulateWithoutField=function(e,t,r,i){return a.WhereClause.create(s(e.parseTree,n.FeatureServiceDatabaseType.Standardised,t,r),i)},t.combine=function(e,t,r){return void 0===r&&(r="AND"),a.WhereClause.create("(("+i(e,n.FeatureServiceDatabaseType.Standardised)+")"+r+"("+i(t,n.FeatureServiceDatabaseType.Standardised)+"))",e.fieldsIndex)},t.translateFunctionToDatabaseSpecific=o,t.makeDateString=l,t.makeToday=u,t.predictType=function(e,t,r){void 0===r&&(r={});for(var n={},a={},i={esriFieldTypeSmallInteger:"integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"double",esriFieldTypeDouble:"double",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"integer",oid:"integer",long:"integer","small-integer":"integer",integer:"integer",single:"double",double:"double",date:"date",string:"string"},s=0,o=t;s<o.length;s++){var l=i[(u=o[s]).type];n[u.name.toLowerCase()]=void 0===l?"":l}for(var u in r)l=i[r[u]],a[u.toLowerCase()]=void 0===l?"":l;switch(function e(t,r,n,a){var i;switch(r.type){case"interval":return"integer";case"case_expression":var s=[];if("simple"===r.format){for(var o=0;o<r.clauses.length;o++)s.push(e(t,r.clauses[o].value,n,a));null!==r.else&&s.push(e(t,r.else,n,a))}else{for(var o=0;o<r.clauses.length;o++)s.push(e(t,r.else,n,a));null!==r.else&&s.push(e(t,r.else,n,a))}return c(s);case"param":var l=a[r.value.toLowerCase()];if(void 0===l&&n){var u=n[r.value.toLowerCase()];if(void 0===u)return"";if(null===u)return"";if("string"==typeof u||u instanceof String)return"string";if("boolean"==typeof u)return"boolean";if(u instanceof Date)return"date";if("number"==typeof u)return u%1==0?"integer":"double"}return void 0===l?"":l;case"expr_list":for(var d=[],f=0,h=r.value;f<h.length;f++){var p=h[f];d.push(e(t,p,n,a))}return d;case"unary_expr":return"boolean";case"binary_expr":switch(r.operator){case"AND":case"OR":return"boolean";case"IS":case"ISNOT":if("null"!==r.right.type)throw new Error("Unsupported RHS for IS");return"boolean";case"IN":case"NOT IN":case"BETWEEN":case"NOTBETWEEN":case"LIKE":case"NOT LIKE":return"boolean";case"<>":case"<":case">":case">=":case"<=":case"=":return"boolean";case"*":case"-":case"+":case"/":return c([e(t,r.left,n,a),e(t,r.right,n,a)])}throw new Error("Not Supported Operator "+r.operator);case"null":return"";case"bool":return"boolean";case"string":return"string";case"number":return null===r.value?"":r.value%1==0?"integer":"double";case"date":case"timestamp":return"date";case"column_ref":if("CURRENT_DATE"===r.column.toUpperCase())return"date";if("CURRENT_TIMESTAMP"===r.column.toUpperCase())return"date";var y=t[r.column.toLowerCase()];return void 0===y?"":y;case"function":switch(r.name.toLowerCase()){case"position":case"extract":case"char_length":return"integer";case"round":return(i=e(t,r.args,n,a))instanceof Array?i.length>0?i[0]:"":i;case"sign":return(i=e(t,r.args,n,a))instanceof Array&&(i=c(i)),"integer"===i||"double"===i?i:"double";case"ceiling":case"floor":case"abs":var _=e(t,r.args,n,a);return _ instanceof Array?c(_):_;case"area":case"length":case"log":case"log10":case"sin":case"cos":case"tan":case"asin":case"acos":case"atan":case"power":return"double";case"substring":case"trim":case"concat":case"lower":case"upper":return"string";case"truncate":return"double";case"round":return(i=e(t,r.args,n,a))instanceof Array?i.length>0?i[0]:"":i}return""}throw new Error("Unsupported sql syntax "+r.type)}(n,e.parseTree,e.parameters,a)){case"double":return"double";case"integer":return"integer";case"double":return"double";case"date":return"date";case"string":return"string"}return""};var h={boolean:1,string:2,integer:3,double:4,date:5};t.scanForField=function(e,t){return function e(t,r){if(null===t||void 0===t)return!1;switch(t.type){case"when_clause":return e(t.operand,r)||e(t.value,r);case"case_expression":for(var n=0,a=t.clauses;n<a.length;n++){var i=a[n];if(e(i,r))return!0}return!("simple"!==t.format||!e(t.operand,r))||!(null===t.else||!e(t.else,r));case"param":return!1;case"expr_list":for(var s=0,o=t.value;s<o.length;s++){var i=o[s];if(e(i,r))return!0}return!1;case"unary_expr":return e(t.expr,r);case"binary_expr":return e(t.left,r)||e(t.right,r);case"null":case"bool":case"date":case"timestamp":case"string":case"number":return!1;case"column_ref":return r.toLowerCase()===t.column.toLowerCase();case"function":return e(t.args,r)}return!1}(e.parseTree,t)},t.isSingleField=function(e){return"column_ref"===e.parseTree.type},t.convertIntervalToSql=f}.apply(null,n))||(e.exports=a)},2276:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(1),r(0),r(15),r(2),r(181)],void 0===(a=function(e,t,r,n,a,i,s){return function(e){function t(t){var r=e.call(this,t)||this;return r.handleAsTable=!1,r}return r(t,e),t.prototype._verifySource=function(){if(this._hasMemorySource()){if(this.url)throw new a("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else if(!this.url)throw new a("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")},n([i.subclass("esri.arcade.featureset.polyfill.FeatureLayerAndTable")],t)}(i.declared(s))}.apply(null,n))||(e.exports=a)},2277:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(2183),r(2192),r(7)],void 0===(a=function(e,t,r,n,a){function i(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t/e.length}function s(e){for(var t=i(e),r=0,n=0;n<e.length;n++)r+=Math.pow(t-e[n],2);return r/e.length}function o(e){for(var t=i(e),r=0,n=0;n<e.length;n++)r+=Math.pow(t-e[n],2);return r/(e.length-1)}function l(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t}function u(e,t){for(var n=[],a={},i=[],s=0;s<e.length;s++){if(void 0!==e[s]&&null!==e[s]){var o=e[s];if(r.isNumber(o)||r.isString(o))void 0===a[o]&&(n.push(o),a[o]=1);else{for(var l=!1,u=0;u<i.length;u++)!0===r.equalityTest(i[u],o)&&(l=!0);!1===l&&(i.push(o),n.push(o))}}if(n.length>=t&&-1!==t)return n}return n}function c(e,t,r,n){void 0===n&&(n=!1);try{return function e(t,r,n,a){return t.next().then(function(i){if(null!==i){var s=n.calculateValue(i);return null===s?!1===a&&(r[r.length]=s):r[r.length]=s,e(t,r,n,a)}return r})}(e.iterator(r),[],t,n)}catch(e){return a.reject(e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.decodeStatType=function(e){switch(e.toLowerCase()){case"distinct":return"distinct";case"avg":case"mean":return"avg";case"min":return"min";case"sum":return"sum";case"max":return"max";case"stdev":case"stddev":return"stddev";case"var":case"variance":return"var";case"count":return"count"}return""},t.calculateStat=function(e,t,r){switch(void 0===r&&(r=1e3),e.toLowerCase()){case"distinct":return u(t,r);case"avg":case"mean":return i(t);case"min":return Math.min.apply(Math,t);case"sum":return l(t);case"max":return Math.max.apply(Math,t);case"stdev":case"stddev":return Math.sqrt(s(t));case"var":case"variance":return s(t);case"count":return t.length}return 0},t.min=function(e,t,r){return c(e,t,r,!0).then(function(e){return 0===e.length?null:Math.min.apply(Math,e)})},t.max=function(e,t,r){return c(e,t,r,!0).then(function(e){return 0===e.length?null:Math.max.apply(Math,e)})},t.mean=function(e,t,r){var a="";return!1===n.isSingleField(t)&&(a=n.predictType(t,e.fields,null)),c(e,t,r,!0).then(function(e){if(0===e.length)return null;var t=i(e);return null===t?t:"integer"===a?function(e){return e=+e,isFinite(e)?e-e%1||(e<0?-0:0===e?e:0):e}(t):t})},t.variance=function(e,t,r){return c(e,t,r,!0).then(function(e){return 0===e.length?null:o(e)})},t.stdev=function(e,t,r){return c(e,t,r,!0).then(function(e){return 0===e.length?null:Math.sqrt(o(e))})},t.sum=function(e,t,r){return c(e,t,r,!0).then(function(e){return 0===e.length?null:l(e)})},t.count=function(e,t){try{return e.iterator(t).count()}catch(e){return a.reject(e)}},t.distinct=function(e,t,r,n){return void 0===r&&(r=1e3),void 0===n&&(n=null),function(e,t,r,n){try{return function e(t,r,n,a,i){return t.next().then(function(s){if(null!==s){var o=a.calculateValue(s);return void 0!==o&&null!==o&&void 0===r[o]&&(n.push(o),r[o]=1),n.length>=i&&-1!==i?n:e(t,r,n,a,i)}return n})}(e.iterator(n),{},[],t,r)}catch(e){return a.reject(e)}}(e,t,r,n)}}.apply(null,n))||(e.exports=a)},2278:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(12),r(2189),r(2190),r(2279),r(7)],void 0===(a=function(e,t,r,n,a,i,s){var o=function(e){function t(t){var r=e.call(this,t)||this;return r._orderbyclause=null,r.declaredClass="esri.arcade.featureset.actions.OrderBy",r._maxProcessing=100,r._orderbyclause=t.orderbyclause,r._parent=t.parentfeatureset,r}return r(t,e),t.prototype._getSet=function(e){var t=this;return null===this._wset?this._ensureLoaded().then(function(){return t._getFilteredSet("",null,null,t._orderbyclause,e)}).then(function(r){return t._checkCancelled(e),t._wset=r,t._wset}):s.resolve(this._wset)},t.prototype.manualOrderSet=function(e,t){var r=this;return this.getIdColumnDictionary(e,[],-1,t).then(function(e){r._orderbyclause.order(e);for(var t=new a([],[],!0,null),n=0;n<e.length;n++)t._known.push(e[n].id);return t})},t.prototype.getIdColumnDictionary=function(e,t,r,n){var a=this;if(r<e._known.length-1){var i=this._maxQueryRate();return"GETPAGES"===e._known[r+1]?this._parent._expandPagedSet(e,i,0,0,n).then(function(i){return a.getIdColumnDictionary(e,t,r,n)}):this._parent._getFeature(e,e._known[r+1],n).then(function(i){return r+=1,a._checkCancelled(n),t.push({id:e._known[r],feature:i}),a.getIdColumnDictionary(e,t,r,n)})}return e._candidates.length>0?this._refineSetBlock(e,this._maxProcessingRate(),n).then(function(){return a._checkCancelled(n),a.getIdColumnDictionary(e,t,r,n)}):s.resolve(t)},t.prototype._isInFeatureSet=function(e){return this._parent._isInFeatureSet(e)},t.prototype._getFeatures=function(e,t,r,n){return this._parent._getFeatures(e,t,r,n)},t.prototype._featureFromCache=function(e){if(void 0===this._featureCache[e]){var t=this._parent._featureFromCache(e);if(void 0===t)return;return null===t?null:(this._featureCache[e]=t,t)}return this._featureCache[e]},t.prototype._fetchAndRefineFeatures=function(e,t,r){return s.reject(new Error("Fetch and Refine should not be called in this featureset"))},t.prototype._getFilteredSet=function(e,t,r,n,i){var s=this;return this._ensureLoaded().then(function(){return s._parent._getFilteredSet(e,t,r,null===n?s._orderbyclause:n,i)}).then(function(e){var n;s._checkCancelled(i),n=new a(e._candidates.slice(0),e._known.slice(0),e._ordered,s._clonePageDefinition(e.pagesDefinition));var o=!0;return e._candidates.length>0&&(o=!1),!1===n._ordered?s.manualOrderSet(n,i).then(function(e){return!1===o&&(null===t&&null===r||(e=new a(e._candidates.slice(0).concat(e._known.slice(0)),[],e._ordered,s._clonePageDefinition(e.pagesDefinition)))),e}):n})},t}(n);return n._featuresetFunctions.orderBy=function(e){return""===e?this:new o({parentfeatureset:this,orderbyclause:new i(e)})},o}.apply(null,n))||(e.exports=a)},2279:function(e,t,r){var n,a;n=[r.dj.c(e.i),t],void 0===(a=function(e,t){function r(e,t){return e===t?0:e<t?-1:1}return function(){function e(e){var t=e.split(",");this._fields=[],this._directions=[];for(var r=0;r<t.length;r++){var n=t[r].match(/\S+/g);this._fields.push(n[0]),2===n.length?"asc"===n[1].toLowerCase()?this._directions.push(1):this._directions.push(0):this._directions.push(1)}}return e.prototype.constructClause=function(){for(var e="",t=0;t<this._fields.length;t++)0!==t&&(e+=","),e+=this._fields[t],1===this._directions[t]?e+=" ASC":e+=" DESC";return e},e.prototype.order=function(e){var t=this;e.sort(function(e,n){for(var a=0;a<t._fields.length;a++){var i,s=t.featureValue(e.feature,t._fields[a],a),o=t.featureValue(n.feature,t._fields[a],a);if(0!==(i=1===t._directions[a]?r(s,o):-1*r(s,o)))return i}return 0})},e.prototype.scanForField=function(e){for(var t=0;t<this._fields.length;t++)if(this._fields[t].toLowerCase().trim()===e.toLowerCase().trim())return!0;return!1},e.prototype.featureValue=function(e,t,r){var n=e.attributes[t];if(void 0!==n)return n;for(var a in e.attributes)if(t.toLowerCase()===a.toLowerCase())return this._fields[r]=a,e.attributes[a];return null},e}()}.apply(null,n))||(e.exports=a)},2280:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(12),r(2189),r(2190),r(2183),r(2192),r(7),r(355),r(32)],void 0===(a=function(e,t,r,n,a,i,s,o,l,u){var c=function(e){function t(t){var r=e.call(this,t)||this;return r.declaredClass="esri.arcade.featureset.actions.AttributeFilter",r._maxProcessing=1e3,r._parent=t.parentfeatureset,t.whereclause instanceof l.WhereClause?(r._whereclause=t.whereclause,r._whereClauseFunction=null):(r._whereClauseFunction=t.whereclause,r._whereclause=null),r}return r(t,e),t.prototype._initialiseFeatureSet=function(){null!==this._parent?(this.fields=this._parent.fields.slice(0),this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.fields=[],this.typeIdField="",this.objectIdField="",this.spatialReference=new u({wkid:4326}),this.geometryType=i.layerGeometryEsriConstants.point)},t.prototype._getSet=function(e){var t=this;return null===this._wset?this._ensureLoaded().then(function(){return t._parent._getFilteredSet("",null,t._whereclause,null,e)}).then(function(r){return t._checkCancelled(e),null!==t._whereClauseFunction?t._wset=new a(r._candidates.slice(0).concat(r._known.slice(0)),[],r._ordered,t._clonePageDefinition(r.pagesDefinition)):t._wset=new a(r._candidates.slice(0),r._known.slice(0),r._ordered,t._clonePageDefinition(r.pagesDefinition)),t._wset}):o.resolve(this._wset)},t.prototype._isInFeatureSet=function(e){var t=this._parent._isInFeatureSet(e);return t===i.IdState.NotInFeatureSet?t:void 0===(t=this._idstates[e])?i.IdState.Unknown:t},t.prototype._getFeature=function(e,t,r){return this._parent._getFeature(e,t,r)},t.prototype._getFeatures=function(e,t,r,n){return this._parent._getFeatures(e,t,r,n)},t.prototype._featureFromCache=function(e){return this._parent._featureFromCache(e)},t.prototype.executeWhereClause=function(e){return this._whereclause.testFeature(e)},t.prototype.executeWhereClauseDeferred=function(e){if(null!==this._whereClauseFunction)try{var t=this._whereClauseFunction(e);return o.isThenable(t)?t:o.resolve(t)}catch(e){return o.reject(e)}return o.resolve(this.executeWhereClause(e))},t.prototype._fetchAndRefineFeatures=function(e,t,r){var n=this,s=new a([],e,!1,null),l=Math.min(t,e.length);return this._parent._getFeatures(s,-1,l,r).then(function(){if(n._checkCancelled(r),null==n._whereClauseFunction){for(var a=0;a<l;a++){var s=n._parent._featureFromCache(e[a]);!0===n.executeWhereClause(s)?n._idstates[e[a]]=i.IdState.InFeatureSet:n._idstates[e[a]]=i.IdState.NotInFeatureSet}return"success"}var u=[];for(a=0;a<l;a++){s=n._parent._featureFromCache(e[a]);u.push(n.executeWhereClauseDeferred(s))}return o.all(u).then(function(r){for(var a=0;a<t;a++)!0===r[a]?n._idstates[e[a]]=i.IdState.InFeatureSet:n._idstates[e[a]]=i.IdState.NotInFeatureSet;return"success"})})},t.prototype._getFilteredSet=function(e,t,r,n,i){var o=this;return null!==this._whereClauseFunction||(null!==r?null!==this._whereclause&&(r=s.combine(this._whereclause,r)):r=this._whereclause),this._ensureLoaded().then(function(){return o._parent._getFilteredSet(e,t,r,n,i)}).then(function(e){return o._checkCancelled(i),null!==o._whereClauseFunction?new a(e._candidates.slice(0).concat(e._known.slice(0)),[],e._ordered,o._clonePageDefinition(e.pagesDefinition)):new a(e._candidates.slice(0),e._known.slice(0),e._ordered,o._clonePageDefinition(e.pagesDefinition))})},t.prototype._stat=function(e,t,r,n,a,i,l){var u=this;if(null!==this._whereClauseFunction)return null===a&&""===r&&null===n?this._manualStat(e,t,i,l):o.resolve({calculated:!1});var c=this._whereclause;return null!==a&&null!==this._whereclause&&(c=s.combine(this._whereclause,a)),this._parent._stat(e,t,r,n,c,i,l).then(function(s){return!1===s.calculated?null===a&&""===r&&null===n?u._manualStat(e,t,i,l):{calculated:!1}:s})},t.prototype._canDoAggregates=function(e,t,r,n,a){return null!==this._whereClauseFunction?o.resolve(!1):(null!==a?null!==this._whereclause&&(a=s.combine(this._whereclause,a)):a=this._whereclause,null===this._parent?o.resolve(!1):this._parent._canDoAggregates(e,t,r,n,a))},t.prototype._getAggregatePagesDataSourceDefinition=function(e,t,r,n,a,i,l){return null===this._parent?o.reject(new Error("Should never be called")):(null!==a?null!==this._whereclause&&(a=s.combine(this._whereclause,a)):a=this._whereclause,this._parent._getAggregatePagesDataSourceDefinition(e,t,r,n,a,i,l))},t}(n);return n._featuresetFunctions.filter=function(e){if("function"==typeof e)return new c({parentfeatureset:this,whereclause:e});var t=null;return e instanceof l.WhereClause&&(t=e),new c({parentfeatureset:this,whereclause:t})},c}.apply(null,n))||(e.exports=a)},2338:function(e,t,r){var n,a;n=[r.dj.c(e.i),t],void 0===(a=function(e,t){return function(){function e(){this._databaseTypeMetaData={},this._layerInfo={}}return e.prototype.clearDatabaseType=function(e){void 0===this._databaseTypeMetaData[e]&&delete this._databaseTypeMetaData[e]},e.prototype.getDatabaseType=function(e){return"MUSTBESET"===e?null:void 0===this._databaseTypeMetaData[e]?null:this._databaseTypeMetaData[e]},e.prototype.setDatabaseType=function(e,t){this._databaseTypeMetaData[e]=t},e.prototype.getLayerInfo=function(e){return void 0===this._layerInfo[e]?null:this._layerInfo[e]},e.prototype.setLayerInfo=function(e,t){this._layerInfo[e]=t},e.prototype.clearLayerInfo=function(e){void 0!==this._layerInfo[e]&&delete this._layerInfo[e]},e.applicationCache=null,e}()}.apply(null,n))||(e.exports=a)},2339:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(7)],void 0===(a=function(e,t,r){return function(){function e(){this.declaredRootClass="esri.arcade.featureSetCollection",this._layerById={},this._layerByName={}}return e.prototype.add=function(e,t,r){this._layerById[t]=r,this._layerByName[e]=r},e.prototype.featureSetByName=function(e,t,r){return void 0===t&&(t=!0),void 0===r&&(r=["*"]),void 0===this._layerByName[e]?this.resolvePromise(null):this.resolvePromise(this._layerByName[e])},e.prototype.featureSetById=function(e,t,r){return void 0===t&&(t=!0),void 0===r&&(r=["*"]),void 0===this._layerById[e]?this.resolvePromise(null):this.resolvePromise(this._layerById[e])},e.prototype.castToText=function(){return"object, FeatureSetCollection"},e.prototype.resolvePromise=function(e){return r.resolve(e)},e}()}.apply(null,n))||(e.exports=a)},2340:function(e,t,r){var n,a;
/**
 * @preserve A JavaScript implementation of the SHA family of hashes, as
 * defined in FIPS PUB 180-2 as well as the corresponding HMAC implementation
 * as defined in FIPS PUB 198a
 *
 * Copyright Brian Turek 2008-2015
 * Distributed under the BSD License
 * See http://caligatio.github.com/jsSHA/ for more information
 *
 * Several functions taken from Paul Johnston
 */n=[r.dj.c(e.i),t],void 0===(a=function(e,t){function r(e,t){var r,n,a,i,s=[],o=[],l=0;if("UTF8"===t)for(n=0;n<e.length;n+=1)for(o=[],128>(r=e.charCodeAt(n))?o.push(r):2048>r?(o.push(192|r>>>6),o.push(128|63&r)):55296>r||57344<=r?o.push(224|r>>>12,128|r>>>6&63,128|63&r):(n+=1,r=65536+((1023&r)<<10|1023&e.charCodeAt(n)),o.push(240|r>>>18,128|r>>>12&63,128|r>>>6&63,128|63&r)),a=0;a<o.length;a+=1){for(i=l>>>2;s.length<=i;)s.push(0);s[i]|=o[a]<<24-l%4*8,l+=1}else if("UTF16BE"===t||"UTF16LE"===t)for(n=0;n<e.length;n+=1){for(r=e.charCodeAt(n),"UTF16LE"===t&&(r=(a=255&r)<<8|r>>8),i=l>>>2;s.length<=i;)s.push(0);s[i]|=r<<16-l%4*8,l+=2}return{value:s,binLen:8*l}}function n(e){var t,r,n,a=[],i=e.length;if(0!=i%2)throw"String of HEX type must be in byte increments";for(t=0;t<i;t+=2){if(r=parseInt(e.substr(t,2),16),isNaN(r))throw"String of HEX type contains invalid characters";for(n=t>>>3;a.length<=n;)a.push(0);a[t>>>3]|=r<<24-t%8*4}return{value:a,binLen:4*i}}function a(e){var t,r,n,a=[];for(r=0;r<e.length;r+=1)t=e.charCodeAt(r),n=r>>>2,a.length<=n&&a.push(0),a[n]|=t<<24-r%4*8;return{value:a,binLen:8*e.length}}function i(e){var t,r,n,a,i,s,o=[],l=0;if(-1===e.search(/^[a-zA-Z0-9=+\/]+$/))throw"Invalid character in base-64 string";if(i=e.indexOf("="),e=e.replace(/\=/g,""),-1!==i&&i<e.length)throw"Invalid '=' found in base-64 string";for(t=0;t<e.length;t+=4){for(a=e.substr(t,4),n=0,r=0;r<a.length;r+=1)n|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a[r])<<18-6*r;for(r=0;r<a.length-1;r+=1){for(s=l>>>2;o.length<=s;)o.push(0);o[s]|=(n>>>16-8*r&255)<<24-l%4*8,l+=1}}return{value:o,binLen:8*l}}function s(e,t){var r,n,a="0123456789abcdef",i="",s=4*e.length;for(r=0;r<s;r+=1)n=e[r>>>2]>>>8*(3-r%4),i+=a.charAt(n>>>4&15)+a.charAt(15&n);return t.outputUpper?i.toUpperCase():i}function o(e,t){var r,n,a,i,s,o,l="",u=4*e.length;for(r=0;r<u;r+=3)for(i=r+1>>>2,s=e.length<=i?0:e[i],i=r+2>>>2,o=e.length<=i?0:e[i],a=(e[r>>>2]>>>8*(3-r%4)&255)<<16|(s>>>8*(3-(r+1)%4)&255)<<8|o>>>8*(3-(r+2)%4)&255,n=0;n<4;n+=1)8*r+6*n<=32*e.length?l+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a>>>6*(3-n)&63):l+=t.b64Pad;return l}function l(e,t){var r,n,a="",i=4*e.length;for(r=0;r<i;r+=1)n=e[r>>>2]>>>8*(3-r%4)&255,a+=String.fromCharCode(n);return a}function u(e){var t={outputUpper:!1,b64Pad:"="};try{e.hasOwnProperty("outputUpper")&&(t.outputUpper=e.outputUpper),e.hasOwnProperty("b64Pad")&&(t.b64Pad=e.b64Pad)}catch(e){}if("boolean"!=typeof t.outputUpper)throw"Invalid outputUpper formatting option";if("string"!=typeof t.b64Pad)throw"Invalid b64Pad formatting option";return t}function c(e,t){return e<<t|e>>>32-t}function d(e,t){return e>>>t|e<<32-t}function f(e,t){var r=new G(e.highOrder,e.lowOrder);return 32>=t?new G(r.highOrder>>>t|r.lowOrder<<32-t&4294967295,r.lowOrder>>>t|r.highOrder<<32-t&4294967295):new G(r.lowOrder>>>t-32|r.highOrder<<64-t&4294967295,r.highOrder>>>t-32|r.lowOrder<<64-t&4294967295)}function h(e,t){return e>>>t}function p(e,t){return 32>=t?new G(e.highOrder>>>t,e.lowOrder>>>t|e.highOrder<<32-t&4294967295):new G(0,e.highOrder>>>t-32)}function y(e,t,r){return e^t^r}function _(e,t,r){return e&t^~e&r}function g(e,t,r){return new G(e.highOrder&t.highOrder^~e.highOrder&r.highOrder,e.lowOrder&t.lowOrder^~e.lowOrder&r.lowOrder)}function v(e,t,r){return e&t^e&r^t&r}function m(e,t,r){return new G(e.highOrder&t.highOrder^e.highOrder&r.highOrder^t.highOrder&r.highOrder,e.lowOrder&t.lowOrder^e.lowOrder&r.lowOrder^t.lowOrder&r.lowOrder)}function S(e){return d(e,2)^d(e,13)^d(e,22)}function w(e){var t=f(e,28),r=f(e,34),n=f(e,39);return new G(t.highOrder^r.highOrder^n.highOrder,t.lowOrder^r.lowOrder^n.lowOrder)}function F(e){return d(e,6)^d(e,11)^d(e,25)}function b(e){var t=f(e,14),r=f(e,18),n=f(e,41);return new G(t.highOrder^r.highOrder^n.highOrder,t.lowOrder^r.lowOrder^n.lowOrder)}function I(e){return d(e,7)^d(e,18)^h(e,3)}function T(e){var t=f(e,1),r=f(e,8),n=p(e,7);return new G(t.highOrder^r.highOrder^n.highOrder,t.lowOrder^r.lowOrder^n.lowOrder)}function C(e){return d(e,17)^d(e,19)^h(e,10)}function D(e){var t=f(e,19),r=f(e,61),n=p(e,6);return new G(t.highOrder^r.highOrder^n.highOrder,t.lowOrder^r.lowOrder^n.lowOrder)}function E(e,t){var r=(65535&e)+(65535&t);return(65535&(e>>>16)+(t>>>16)+(r>>>16))<<16|65535&r}function x(e,t,r,n){var a=(65535&e)+(65535&t)+(65535&r)+(65535&n);return(65535&(e>>>16)+(t>>>16)+(r>>>16)+(n>>>16)+(a>>>16))<<16|65535&a}function R(e,t,r,n,a){var i=(65535&e)+(65535&t)+(65535&r)+(65535&n)+(65535&a);return(65535&(e>>>16)+(t>>>16)+(r>>>16)+(n>>>16)+(a>>>16)+(i>>>16))<<16|65535&i}function A(e,t){var r,n,a;return r=(65535&e.lowOrder)+(65535&t.lowOrder),a=(65535&(n=(e.lowOrder>>>16)+(t.lowOrder>>>16)+(r>>>16)))<<16|65535&r,r=(65535&e.highOrder)+(65535&t.highOrder)+(n>>>16),n=(e.highOrder>>>16)+(t.highOrder>>>16)+(r>>>16),new G((65535&n)<<16|65535&r,a)}function O(e,t,r,n){var a,i,s;return a=(65535&e.lowOrder)+(65535&t.lowOrder)+(65535&r.lowOrder)+(65535&n.lowOrder),s=(65535&(i=(e.lowOrder>>>16)+(t.lowOrder>>>16)+(r.lowOrder>>>16)+(n.lowOrder>>>16)+(a>>>16)))<<16|65535&a,a=(65535&e.highOrder)+(65535&t.highOrder)+(65535&r.highOrder)+(65535&n.highOrder)+(i>>>16),i=(e.highOrder>>>16)+(t.highOrder>>>16)+(r.highOrder>>>16)+(n.highOrder>>>16)+(a>>>16),new G((65535&i)<<16|65535&a,s)}function k(e,t,r,n,a){var i,s,o;return i=(65535&e.lowOrder)+(65535&t.lowOrder)+(65535&r.lowOrder)+(65535&n.lowOrder)+(65535&a.lowOrder),o=(65535&(s=(e.lowOrder>>>16)+(t.lowOrder>>>16)+(r.lowOrder>>>16)+(n.lowOrder>>>16)+(a.lowOrder>>>16)+(i>>>16)))<<16|65535&i,i=(65535&e.highOrder)+(65535&t.highOrder)+(65535&r.highOrder)+(65535&n.highOrder)+(65535&a.highOrder)+(s>>>16),s=(e.highOrder>>>16)+(t.highOrder>>>16)+(r.highOrder>>>16)+(n.highOrder>>>16)+(a.highOrder>>>16)+(i>>>16),new G((65535&s)<<16|65535&i,o)}function N(e,t){var r,n,a,i,s,o,l,u,d,f,h=[],p=_,g=y,m=v,S=c,w=E,F=R,b=[1732584193,4023233417,2562383102,271733878,3285377520];for(f=15+(t+65>>>9<<4);e.length<=f;)e.push(0);for(e[t>>>5]|=128<<24-t%32,e[f]=t,d=e.length,l=0;l<d;l+=16){for(r=b[0],n=b[1],a=b[2],i=b[3],s=b[4],u=0;u<80;u+=1)h[u]=u<16?e[u+l]:S(h[u-3]^h[u-8]^h[u-14]^h[u-16],1),o=u<20?F(S(r,5),p(n,a,i),s,1518500249,h[u]):u<40?F(S(r,5),g(n,a,i),s,1859775393,h[u]):u<60?F(S(r,5),m(n,a,i),s,2400959708,h[u]):F(S(r,5),g(n,a,i),s,3395469782,h[u]),s=i,i=a,a=S(n,30),n=r,r=o;b[0]=w(r,b[0]),b[1]=w(n,b[1]),b[2]=w(a,b[2]),b[3]=w(i,b[3]),b[4]=w(s,b[4])}return b}function P(e,t,r){var n,a,i,s,o,l,u,c,d,f,h,p,y,N,P,j,B,U,M,W,q,H,Y,V,Q,J,K,z,X,Z,$,ee,te=[],re=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],ne=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428],ae=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];if(("SHA-224"===r||"SHA-256"===r)&&2&L)p=64,y=15+(t+65>>>9<<4),j=16,B=1,K=Number,U=E,M=x,W=R,q=I,H=C,Y=S,V=F,J=v,Q=_,h="SHA-224"===r?ne:ae;else{if("SHA-384"!==r&&"SHA-512"!==r||!(4&L))throw"Unexpected error in SHA-2 implementation";p=80,y=31+(t+128>>>10<<5),j=32,B=2,U=A,M=O,W=k,q=T,H=D,Y=w,V=b,J=m,Q=g,re=[new(K=G)(re[0],3609767458),new K(re[1],602891725),new K(re[2],3964484399),new K(re[3],2173295548),new K(re[4],4081628472),new K(re[5],3053834265),new K(re[6],2937671579),new K(re[7],3664609560),new K(re[8],2734883394),new K(re[9],1164996542),new K(re[10],1323610764),new K(re[11],3590304994),new K(re[12],4068182383),new K(re[13],991336113),new K(re[14],633803317),new K(re[15],3479774868),new K(re[16],2666613458),new K(re[17],944711139),new K(re[18],2341262773),new K(re[19],2007800933),new K(re[20],1495990901),new K(re[21],1856431235),new K(re[22],3175218132),new K(re[23],2198950837),new K(re[24],3999719339),new K(re[25],766784016),new K(re[26],2566594879),new K(re[27],3203337956),new K(re[28],1034457026),new K(re[29],2466948901),new K(re[30],3758326383),new K(re[31],168717936),new K(re[32],1188179964),new K(re[33],1546045734),new K(re[34],1522805485),new K(re[35],2643833823),new K(re[36],2343527390),new K(re[37],1014477480),new K(re[38],1206759142),new K(re[39],344077627),new K(re[40],1290863460),new K(re[41],3158454273),new K(re[42],3505952657),new K(re[43],106217008),new K(re[44],3606008344),new K(re[45],1432725776),new K(re[46],1467031594),new K(re[47],851169720),new K(re[48],3100823752),new K(re[49],1363258195),new K(re[50],3750685593),new K(re[51],3785050280),new K(re[52],3318307427),new K(re[53],3812723403),new K(re[54],2003034995),new K(re[55],3602036899),new K(re[56],1575990012),new K(re[57],1125592928),new K(re[58],2716904306),new K(re[59],442776044),new K(re[60],593698344),new K(re[61],3733110249),new K(re[62],2999351573),new K(re[63],3815920427),new K(3391569614,3928383900),new K(3515267271,566280711),new K(3940187606,3454069534),new K(4118630271,4000239992),new K(116418474,1914138554),new K(174292421,2731055270),new K(289380356,3203993006),new K(460393269,320620315),new K(685471733,587496836),new K(852142971,1086792851),new K(1017036298,365543100),new K(1126000580,2618297676),new K(1288033470,3409855158),new K(1501505948,4234509866),new K(1607167915,987167468),new K(1816402316,1246189591)],h="SHA-384"===r?[new K(3418070365,ne[0]),new K(1654270250,ne[1]),new K(2438529370,ne[2]),new K(355462360,ne[3]),new K(1731405415,ne[4]),new K(41048885895,ne[5]),new K(3675008525,ne[6]),new K(1203062813,ne[7])]:[new K(ae[0],4089235720),new K(ae[1],2227873595),new K(ae[2],4271175723),new K(ae[3],1595750129),new K(ae[4],2917565137),new K(ae[5],725511199),new K(ae[6],4215389547),new K(ae[7],327033209)]}for(;e.length<=y;)e.push(0);for(e[t>>>5]|=128<<24-t%32,e[y]=t,$=e.length,N=0;N<$;N+=j){for(n=h[0],a=h[1],i=h[2],s=h[3],o=h[4],l=h[5],u=h[6],c=h[7],P=0;P<p;P+=1)P<16?(Z=P*B+N,z=e.length<=Z?0:e[Z],X=e.length<=Z+1?0:e[Z+1],te[P]=new K(z,X)):te[P]=M(H(te[P-2]),te[P-7],q(te[P-15]),te[P-16]),d=W(c,V(o),Q(o,l,u),re[P],te[P]),f=U(Y(n),J(n,a,i)),c=u,u=l,l=o,o=U(s,d),s=i,i=a,a=n,n=U(d,f);h[0]=U(n,h[0]),h[1]=U(a,h[1]),h[2]=U(i,h[2]),h[3]=U(s,h[3]),h[4]=U(o,h[4]),h[5]=U(l,h[5]),h[6]=U(u,h[6]),h[7]=U(c,h[7])}if("SHA-224"===r&&2&L)ee=[h[0],h[1],h[2],h[3],h[4],h[5],h[6]];else if("SHA-256"===r&&2&L)ee=h;else if("SHA-384"===r&&4&L)ee=[h[0].highOrder,h[0].lowOrder,h[1].highOrder,h[1].lowOrder,h[2].highOrder,h[2].lowOrder,h[3].highOrder,h[3].lowOrder,h[4].highOrder,h[4].lowOrder,h[5].highOrder,h[5].lowOrder];else{if(!("SHA-512"===r&&4&L))throw"Unexpected error in SHA-2 implementation";ee=[h[0].highOrder,h[0].lowOrder,h[1].highOrder,h[1].lowOrder,h[2].highOrder,h[2].lowOrder,h[3].highOrder,h[3].lowOrder,h[4].highOrder,h[4].lowOrder,h[5].highOrder,h[5].lowOrder,h[6].highOrder,h[6].lowOrder,h[7].highOrder,h[7].lowOrder]}return ee}var L=7,G=function(){return function(e,t){this.highOrder=e,this.lowOrder=t}}();return function(){function e(e,t,s){this.strBinLen=0,this.strToHash=null,this.utfType="";var o=null;if(this.strToHash=[0],this.strBinLen=0,this.utfType=s||"UTF8","UTF8"!==this.utfType&&"UTF16BE"!==this.utfType&&"UTF16LE"!==this.utfType)throw"encoding must be UTF8, UTF16BE, or UTF16LE";if("HEX"===t){if(0!=e.length%2)throw"srcString of HEX type must be in byte increments";o=n(e),this.strBinLen=o.binLen,this.strToHash=o.value}else if("TEXT"===t)o=r(e,this.utfType),this.strBinLen=o.binLen,this.strToHash=o.value;else if("B64"===t)o=i(e),this.strBinLen=o.binLen,this.strToHash=o.value;else{if("BYTES"!==t)throw"inputFormat must be HEX, TEXT, B64, or BYTES";o=a(e),this.strBinLen=o.binLen,this.strToHash=o.value}}return e.prototype.getHash=function(e,t,r,n){var a,i=null,c=this.strToHash.slice(),d=this.strBinLen;if(3===arguments.length?"number"!=typeof r&&(n=r,r=1):2===arguments.length&&(r=1),r!==parseInt(r,10)||1>r)throw"numRounds must a integer >= 1";switch(t){case"HEX":i=s;break;case"B64":i=o;break;case"BYTES":i=l;break;default:throw"format must be HEX, B64, or BYTES"}if("SHA-1"===e&&1&L)for(a=0;a<r;a+=1)c=N(c,d),d=160;else if("SHA-224"===e&&2&L)for(a=0;a<r;a+=1)c=P(c,d,e),d=224;else if("SHA-256"===e&&2&L)for(a=0;a<r;a+=1)c=P(c,d,e),d=256;else if("SHA-384"===e&&4&L)for(a=0;a<r;a+=1)c=P(c,d,e),d=384;else{if(!("SHA-512"===e&&4&L))throw"Chosen SHA variant is not supported";for(a=0;a<r;a+=1)c=P(c,d,e),d=512}return i(c,u(n))},e.prototype.getHMAC=function(e,t,c,d,f){var h,p,y,_,g,v,m,S,w,F=[],b=[],I=null;switch(d){case"HEX":h=s;break;case"B64":h=o;break;case"BYTES":h=l;break;default:throw"outputFormat must be HEX, B64, or BYTES"}if("SHA-1"===c&&1&L)y=64,w=160;else if("SHA-224"===c&&2&L)y=64,w=224;else if("SHA-256"===c&&2&L)y=64,w=256;else if("SHA-384"===c&&4&L)y=128,w=384;else{if(!("SHA-512"===c&&4&L))throw"Chosen SHA variant is not supported";y=128,w=512}if("HEX"===t)S=(I=n(e)).binLen,p=I.value;else if("TEXT"===t)S=(I=r(e,this.utfType)).binLen,p=I.value;else if("B64"===t)S=(I=i(e)).binLen,p=I.value;else{if("BYTES"!==t)throw"inputFormat must be HEX, TEXT, B64, or BYTES";S=(I=a(e)).binLen,p=I.value}if(_=8*y,m=y/4-1,y<S/8){if("SHA-1"===c&&1&L)p=N(p,S);else{if(!(6&L))throw"Unexpected error in HMAC implementation";p=P(p,S,c)}for(;p.length<=m;)p.push(0);p[m]&=4294967040}else if(y>S/8){for(;p.length<=m;)p.push(0);p[m]&=4294967040}for(g=0;g<=m;g+=1)F[g]=909522486^p[g],b[g]=1549556828^p[g];if("SHA-1"===c&&1&L)v=N(b.concat(N(F.concat(this.strToHash),_+this.strBinLen)),_+w);else{if(!(6&L))throw"Unexpected error in HMAC implementation";v=P(b.concat(P(F.concat(this.strToHash),_+this.strBinLen,c)),_+w,c)}return h(v,u(f))},e}()}.apply(null,n))||(e.exports=a)},2341:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(12),r(62),r(2276),r(2189),r(2190),r(2183),r(2192),r(7),r(75),r(151),r(163)],void 0===(a=function(e,t,r,n,a,i,s,o,l,u,c,d,f){return function(e){function t(t){var r=e.call(this,t)||this;return r.declaredClass="esri.arcade.featureset.sources.FeatureLayerMemory",r._removeGeometry=!1,r._overrideFields=null,t.spatialReference&&(r.spatialReference=t.spatialReference),r._transparent=!0,r._maxProcessing=1e3,r._layer=t.layer,r._wset=null,void 0!==t.outFields&&(r._overrideFields=t.outFields),void 0!==t.includeGeometry&&(r._removeGeometry=!1===t.includeGeometry),r}return r(t,e),t.prototype._maxQueryRate=function(){return o.defaultMaxRecords},t.prototype.end=function(){return this._layer},t.prototype.optimisePagingFeatureQueries=function(e){},t.prototype.load=function(){var e=this;return null===this._loadPromise&&(this._loadPromise=u.create(function(t,r){if(!0===e._layer.loaded)return e._initialiseFeatureSet(),void t(e);e._layer.when().then(function(){try{e._initialiseFeatureSet(),t(e)}catch(e){r(e)}},r),e._layer.load()})),this._loadPromise},t.prototype._initialiseFeatureSet=function(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType,!0===this._layer.handleAsTable&&(this.geometryType=""),this.fields=this._layer.fields.slice(0),this._layer.outFields)if(1===this._layer.outFields.length&&"*"===this._layer.outFields[0]);else{for(var e=[],t=0,r=this.fields;t<r.length;t++){if("oid"===(u=r[t]).type)e.push(u);else for(var n=0,a=this._layer.outFields;n<a.length;n++){if(a[n].toLowerCase()===u.name.toLowerCase()){e.push(u);break}}}this.fields=e}if(null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{e=[];for(var i=[],s=0,l=this.fields;s<l.length;s++){var u;if("oid"===(u=l[s]).type)e.push(u),i.push(u.name);else for(var c=0,d=this._overrideFields;c<d.length;c++){if(d[c].toLowerCase()===u.name.toLowerCase()){e.push(u),i.push(u.name);break}}}this.fields=e,this._overrideFields=i}this.objectIdField=this._layer.objectIdField,this.hasM=this._layer.supportsM,this.hasZ=this._layer.supportsZ,this._databaseType=o.FeatureServiceDatabaseType.Standardised,this.typeIdField=this._layer.typeIdField,this.types=this._layer.types},t.prototype.isTable=function(){return"table"===this._layer.type||!0===this._layer.handleAsTable||!this._layer.geometryType},t.prototype._isInFeatureSet=function(e){return o.IdState.InFeatureSet},t.prototype._transformSetWithIdChanges=function(e){},t.prototype._candidateIdTransform=function(e){return e},t.prototype._getSet=function(e){var t=this;return null===this._wset?this._ensureLoaded().then(function(){return t._getFilteredSet("",null,null,null,e)}).then(function(e){return t._wset=e,e}):u.resolve(this._wset)},t.prototype._changeFeature=function(e){for(var t={},r=0,a=this.fields;r<a.length;r++){var i=a[r];t[i.name]=e.attributes[i.name]}return new n({geometry:!0===this._removeGeometry?null:e.geometry,attributes:t})},t.prototype._getFilteredSet=function(e,t,r,n,a){var i=this,c="",d=!1;if(null!==n&&(c=n.constructClause(),d=!0),this.isTable()&&t&&null!==e&&""!==e){var h=new s([],[],!0,null);return u.resolve(h)}var p=new f;return p.where=null===r?null===t?"1=1":"":l.toWhereClause(r,o.FeatureServiceDatabaseType.Standardised),p.spatialRelationship=this._makeRelationshipEnum(e),p.outSpatialReference=this.spatialReference,p.orderByFields=""!==c?c.split(","):null,p.geometry=null===t?null:t,p.returnGeometry=!0,p.relationParameter=this._makeRelationshipParam(e),this._layer.queryFeatures(p).then(function(e){if(null===e)return new s([],[],d,null);i._checkCancelled(a);var t=[];return e.features.forEach(function(e){var r=e.attributes[i._layer.objectIdField];t.push(r),i._featureCache[r]=i._changeFeature(e)}),new s([],t,d,null)})},t.prototype._makeRelationshipEnum=function(e){if(e.indexOf("esriSpatialRelRelation")>=0)return"relation";switch(e){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return e},t.prototype._makeRelationshipParam=function(e){return e.indexOf("esriSpatialRelRelation")>=0?e.split(":")[1]:""},t.prototype._queryAllFeatures=function(){var e=this;if(this._wset)return u.resolve(this._wset);var t=new f;return t.where="1=1",this._ensureLoaded().then(function(){if(e._layer.source&&e._layer.source.items){var r=[];return e._layer.source.items.forEach(function(t){var n=t.attributes[e._layer.objectIdField];r.push(n),e._featureCache[n]=e._changeFeature(t)}),e._wset=new s([],r,!1,null),e._wset}return e._layer.queryFeatures(t).then(function(t){var r=[];return t.features.forEach(function(t){var n=t.attributes[e._layer.objectIdField];r.push(n),e._featureCache[n]=e._changeFeature(t)}),e._wset=new s([],r,!1,null),e._wset})})},t.prototype._getFeatures=function(e,t,r,n){var a=[];-1!==t&&void 0===this._featureCache[t]&&a.push(t);for(var i=e._lastFetchedIndex;i<e._known.length&&(e._lastFetchedIndex+=1,!(void 0===this._featureCache[e._known[i]]&&(e._known[i]!==t&&a.push(e._known[i]),a.length>r)));i++);return 0===a.length?u.resolve("success"):u.reject(new Error("Unaccounted for Features. Not in Feature Collection"))},t.prototype._refineSetBlock=function(e,t,r){return u.resolve(e)},t.prototype._stat=function(e,t,r,n,a,i,s){return u.resolve({calculated:!1})},t.prototype._canDoAggregates=function(e,t,r,n,a){return u.resolve(!1)},t._cloneAttr=function(e){var t={};for(var r in e)t[r]=e[r];return t},t.prototype.nativeSource=function(){return this._layer},t.create=function(e,r){var n=e.layerDefinition.objectIdField,i=e.layerDefinition.geometryType;void 0===i&&(i=e.featureSet.geometryType||"");var s=e.featureSet.features,o=r.toJSON();if(""===n||void 0===n){for(var l=!1,u=0,f=e.layerDefinition.fields;u<f.length;u++){if("oid"===(D=f[u]).type||"esriFieldTypeOID"===D.type){n=D.name,l=!0;break}}if(!1===l){for(var h="FID",p=!0,y=0;p;){for(var _=!0,g=0,v=e.layerDefinition.fields;g<v.length;g++){if((D=v[g]).name===h){_=!1;break}}!0===_?p=!1:h="FID"+(++y).toString()}e.layerDefinition.fields.push({type:"esriFieldTypeOID",name:h,alias:h});for(var m=[],S=0;S<s.length;S++)m.push({geometry:e.featureSet.features[S].geometry,attributes:e.featureSet.features[S].attributes?this._cloneAttr(e.featureSet.features[S].attributes):{}}),m[S].attributes[h]=S;s=m,n=h}}for(var w=[],F=0,b=e.layerDefinition.fields;F<b.length;F++){(D=b[F])instanceof d?w.push(D):w.push(d.fromJSON(D))}var I=i;switch(I){case"esriGeometryPoint":I="point";break;case"esriGeometryPolyline":I="polyline";break;case"esriGeometryPolygon":I="polygon";break;case"esriGeometryExtent":I="extent";break;case"esriGeometryMultipoint":I="multipoint"}for(var T=0,C=s;T<C.length;T++){var D;(D=C[T]).geometry&&D.geometry instanceof c==0&&(D.geometry.type=I,void 0===D.geometry.spatialReference&&(D.geometry.spatialReference=o))}var E={outFields:["*"],source:s,fields:w,objectIdField:n,spatialReference:r};E.geometryType=I||"point";var x=new a(E);return""===I&&(x.handleAsTable=!0),new t({layer:x,spatialReference:r})},t.prototype.queryAttachments=function(e,t,r,n){return u.resolve([])},t}(i)}.apply(null,n))||(e.exports=a)},2342:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(12),r(2189),r(2190),r(2183),r(7)],void 0===(a=function(e,t,r,n,a,i,s){var o=function(e){function t(t){var r=e.call(this,t)||this;return r._topnum=0,r.declaredClass="esri.arcade.featureset.actions.Top",r._countedin=0,r._maxProcessing=100,r._topnum=t.topnum,r._parent=t.parentfeatureset,r}return r(t,e),t.prototype._getSet=function(e){var t=this;return null===this._wset?this._ensureLoaded().then(function(){return t._parent._getSet(e)}).then(function(e){return t._wset=new a(e._candidates.slice(0),e._known.slice(0),!1,t._clonePageDefinition(e.pagesDefinition)),t._setKnownLength(t._wset)>t._topnum&&(t._wset._known=t._wset._known.slice(0,t._topnum)),t._setKnownLength(t._wset)>=t._topnum&&(t._wset._candidates=[]),t._wset}):s.resolve(this._wset)},t.prototype._setKnownLength=function(e){return e._known.length>0&&"GETPAGES"===e._known[e._known.length-1]?e._known.length-1:e._known.length},t.prototype._isInFeatureSet=function(e){var t=this._parent._isInFeatureSet(e);if(t===i.IdState.NotInFeatureSet)return t;var r=this._idstates[e];return r===i.IdState.InFeatureSet||r===i.IdState.NotInFeatureSet?r:t===i.IdState.InFeatureSet&&void 0===r?this._countedin<this._topnum?(this._idstates[e]=i.IdState.InFeatureSet,this._countedin++,i.IdState.InFeatureSet):(this._idstates[e]=i.IdState.NotInFeatureSet,i.IdState.NotInFeatureSet):i.IdState.Unknown},t.prototype._expandPagedSet=function(e,t,r,n,a){var i=this;if(null===this._parent)return s.reject(new Error("Parent Paging not implemented"));if(t>this._topnum&&(t=this._topnum),this._countedin>=this._topnum&&e.pagesDefinition.internal.set.length<=e.pagesDefinition.resultOffset){var o=e._known.length;return o>0&&"GETPAGES"===e._known[o-1]&&(e._known.length=o-1),(o=e._candidates.length)>0&&"GETPAGES"===e._candidates[o-1]&&(e._candidates.length=o-1),s.resolve("success")}return this._parent._expandPagedSet(e,t,r,n,a).then(function(t){return i._setKnownLength(e)>i._topnum&&(e._known.length=i._topnum),i._setKnownLength(e)>=i._topnum&&(e._candidates.length=0),t})},t.prototype._getFeatures=function(e,t,r,n){var i=this,o=[],l=this._maxQueryRate();if(!0===this._checkIfNeedToExpandKnownPage(e,l,n))return this._expandPagedSet(e,l,0,0,n).then(function(a){return i._getFeatures(e,t,r,n)});-1!==t&&void 0===this._featureCache[t]&&o.push(t);for(var u=0,c=e._lastFetchedIndex;c<e._known.length&&(++u<=r&&(e._lastFetchedIndex+=1),!(void 0===this._featureCache[e._known[c]]&&(e._known[c]!==t&&o.push(e._known[c]),o.length>l-1)));c++);if(0===o.length)return s.resolve("success");var d=new a([],o,!1,null),f=Math.min(o.length,r);return this._parent._getFeatures(d,-1,f,n).then(function(e){for(var t=0;t<f;t++){var r=i._parent._featureFromCache(o[t]);void 0!==r&&(i._featureCache[o[t]]=r)}return"success"})},t.prototype._getFilteredSet=function(e,t,r,n,i){var s=this;return this._ensureLoaded().then(function(){return s._getSet(i)}).then(function(e){return new a(e._candidates.slice(0).concat(e._known.slice(0)),[],!1,s._clonePageDefinition(e.pagesDefinition))})},t.prototype._refineKnowns=function(e,t){for(var r=0,n=null,a=[],s=0;s<e._candidates.length;s++){var o=this._isInFeatureSet(e._candidates[s]);if(o===i.IdState.InFeatureSet){if(e._known.push(e._candidates[s]),r+=1,null===n?n={start:s,end:s}:n.end===s-1?n.end=s:(a.push(n),n={start:s,end:s}),e._known.length>=this._topnum)break}else if(o===i.IdState.NotInFeatureSet)null===n?n={start:s,end:s}:n.end===s-1?n.end=s:(a.push(n),n={start:s,end:s}),r+=1;else if(o===i.IdState.Unknown)break;if(r>=t)break}null!==n&&a.push(n);for(var l=a.length-1;l>=0;l--)e._candidates.splice(a[l].start,a[l].end-a[l].start+1);this._setKnownLength(e)>this._topnum&&(e._known=e._known.slice(0,this._topnum)),this._setKnownLength(e)>=this._topnum&&(e._candidates=[])},t.prototype._stat=function(e,t,r,n,a,i,o){return s.resolve({calculated:!1})},t.prototype._canDoAggregates=function(e,t,r,n,a){return s.resolve(!1)},t}(n);return n._featuresetFunctions.top=function(e){return new o({parentfeatureset:this,topnum:e})},o}.apply(null,n))||(e.exports=a)},2343:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(12),r(2344),r(2189),r(2190),r(2183),r(7),r(812)],void 0===(a=function(e,t,r,n,a,i,s,o,l){var u=function(e){function t(t){var r=e.call(this,t)||this;return r._relation="",r._relationGeom=null,r._relationString="",r.declaredClass="esri.arcade.featureset.actions.SpatialFilter",r._relationString=t.relationString,r._parent=t.parentfeatureset,r._maxProcessing=40,r._relation=t.relation,r._relationGeom=t.relationGeom,r}return r(t,e),t.prototype._getSet=function(e){var t=this;return null===this._wset?this._ensureLoaded().then(function(){return t._parent._getFilteredSet("esriSpatialRelRelation"!==t._relation?t._relation:t._relation+":"+t._relationString,t._relationGeom,null,null,e)}).then(function(r){return t._checkCancelled(e),t._wset=new i(r._candidates.slice(0),r._known.slice(0),r._ordered,t._clonePageDefinition(r.pagesDefinition)),t._wset}):o.resolve(this._wset)},t.prototype._isInFeatureSet=function(e){var t=this._parent._isInFeatureSet(e);return t===s.IdState.NotInFeatureSet?t:void 0===(t=this._idstates[e])?s.IdState.Unknown:t},t.prototype._getFeature=function(e,t,r){return this._parent._getFeature(e,t,r)},t.prototype._getFeatures=function(e,t,r,n){return this._parent._getFeatures(e,t,r,n)},t.prototype._featureFromCache=function(e){return this._parent._featureFromCache(e)},t.prototype.executeSpatialRelationTest=function(e){if(null===e.geometry)return o.resolve(!1);switch(this._relation){case"esriSpatialRelEnvelopeIntersects":var t=s.shapeExtent(this._relationGeom),r=s.shapeExtent(e.geometry);return l.intersects(t,r);case"esriSpatialRelIntersects":return l.intersects(this._relationGeom,e.geometry);case"esriSpatialRelContains":return l.contains(this._relationGeom,e.geometry);case"esriSpatialRelOverlaps":return l.overlaps(this._relationGeom,e.geometry);case"esriSpatialRelWithin":return l.within(this._relationGeom,e.geometry);case"esriSpatialRelTouches":return l.touches(this._relationGeom,e.geometry);case"esriSpatialRelCrosses":return l.crosses(this._relationGeom,e.geometry);case"esriSpatialRelRelation":return l.relate(this._relationGeom,e.geometry,this._relationString)}},t.prototype._fetchAndRefineFeatures=function(e,t,r){var n=this,a=new i([],e,!1,null),l=Math.min(t,e.length);return this._parent._getFeatures(a,-1,l,r).then(function(){n._checkCancelled(r);for(var t=[],a=0;a<l;a++){var i=n._parent._featureFromCache(e[a]);t.push(n.executeSpatialRelationTest(i))}return o.all(t)}).then(function(r){for(var a=0;a<t;a++)!0===r[a]?n._idstates[e[a]]=s.IdState.InFeatureSet:n._idstates[e[a]]=s.IdState.NotInFeatureSet;return"success"})},t.prototype._getFilteredSet=function(e,t,r,n,a){var s=this;return this._ensureLoaded().then(function(){return s._parent._getFilteredSet("esriSpatialRelRelation"!==s._relation?s._relation:s._relation+":"+s._relationString,s._relationGeom,r,n,a)}).then(function(e){return s._checkCancelled(a),null!==t?new i(e._candidates.slice(0).concat(e._known.slice(0)),[],e._ordered,s._clonePageDefinition(e.pagesDefinition)):new i(e._candidates.slice(0),e._known.slice(0),e._ordered,s._clonePageDefinition(e.pagesDefinition))})},t.prototype._stat=function(e,t,r,n,a,i,s){var l=this;return""!==r?o.resolve({calculated:!1}):this._parent._stat(e,t,"esriSpatialRelRelation"!==this._relation?this._relation:this._relation+":"+this._relationString,this._relationGeom,a,i,s).then(function(o){return!1===o.calculated?null===a&&""===r&&null===n?l._manualStat(e,t,i,s):{calculated:!1}:o})},t.prototype._canDoAggregates=function(e,t,r,n,a){return""!==r||null!==n?o.resolve(!1):null===this._parent?o.resolve(!1):this._parent._canDoAggregates(e,t,"esriSpatialRelRelation"!==this._relation?this._relation:this._relation+":"+this._relationString,this._relationGeom,a)},t.prototype._getAggregatePagesDataSourceDefinition=function(e,t,r,n,a,i,s){return null===this._parent?o.reject(new Error("Should never be called")):this._parent._getAggregatePagesDataSourceDefinition(e,t,"esriSpatialRelRelation"!==this._relation?this._relation:this._relation+":"+this._relationString,this._relationGeom,a,i,s)},t}(a);return a._featuresetFunctions.intersects=function(e){return null===e||void 0===e?new n({parentfeatureset:this}):new u({parentfeatureset:this,relation:"esriSpatialRelIntersects",relationGeom:e})},a._featuresetFunctions.envelopeIntersects=function(e){return null===e||void 0===e?new n({parentfeatureset:this}):new u({parentfeatureset:this,relation:"esriSpatialRelEnvelopeIntersects",relationGeom:e})},a._featuresetFunctions.contains=function(e){return null===e||void 0===e?new n({parentfeatureset:this}):new u({parentfeatureset:this,relation:"esriSpatialRelContains",relationGeom:e})},a._featuresetFunctions.overlaps=function(e){return null===e||void 0===e?new n({parentfeatureset:this}):new u({parentfeatureset:this,relation:"esriSpatialRelOverlaps",relationGeom:e})},a._featuresetFunctions.within=function(e){return null===e||void 0===e?new n({parentfeatureset:this}):new u({parentfeatureset:this,relation:"esriSpatialRelWithin",relationGeom:e})},a._featuresetFunctions.touches=function(e){return null===e||void 0===e?new n({parentfeatureset:this}):new u({parentfeatureset:this,relation:"esriSpatialRelTouches",relationGeom:e})},a._featuresetFunctions.crosses=function(e){return null===e||void 0===e?new n({parentfeatureset:this}):new u({parentfeatureset:this,relation:"esriSpatialRelCrosses",relationGeom:e})},a._featuresetFunctions.relate=function(e,t){return null===e||void 0===e?new n({parentfeatureset:this}):new u({parentfeatureset:this,relation:"esriSpatialRelRelation",relationGeom:e,relationString:t})},u}.apply(null,n))||(e.exports=a)},2344:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(12),r(2189),r(2190),r(2183),r(7)],void 0===(a=function(e,t,r,n,a,i,s){return function(e){function t(t){var r=e.call(this,t)||this;return r.declaredClass="esri.layers.featureset.sources.Empty",r._maxProcessing=1e3,r._wset=new a([],[],!1,null),r._parent=t.parentfeatureset,r._databaseType=i.FeatureServiceDatabaseType.Standardised,r}return r(t,e),t.prototype._getSet=function(e){return s.resolve(this._wset)},t.prototype.optimisePagingFeatureQueries=function(e){},t.prototype._isInFeatureSet=function(e){return i.IdState.NotInFeatureSet},t.prototype._getFeature=function(e,t){return s.reject(new Error("No Feature Found in EmptySet"))},t.prototype.queryAttachments=function(e,t,r,n){return s.resolve([])},t.prototype._getFeatures=function(e,t,r,n){return s.resolve("success")},t.prototype._featureFromCache=function(e){return null},t.prototype._fetchAndRefineFeatures=function(e,t,r){return s.reject(new Error("Fetch and Refine should not be called in this featureset"))},t.prototype._getFilteredSet=function(e,t,r,n,i){return s.resolve(new a([],[],!1,null))},t.prototype._stat=function(e,t,r,n,a,i,s){return this._manualStat(e,t,i,s)},t.prototype._canDoAggregates=function(e,t,r,n,a){return s.resolve(!1)},t}(n)}.apply(null,n))||(e.exports=a)},2547:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(12),r(62),r(505),r(2276),r(2189),r(2190),r(2340),r(2183),r(2192),r(2192),r(2277),r(7),r(183),r(478),r(484),r(93),r(163),r(494)],void 0===(a=function(e,t,r,n,a,i,s,o,l,u,c,d,f,h,p,y,_,g,v,m){return function(e){function t(t){var r=e.call(this,t)||this;return r.declaredClass="esri.arcade.featureset.sources.FeatureLayerDynamic",r._removeGeometry=!1,r._overrideFields=null,r.formulaCredential=null,r._pageJustIds=!1,r._requestStandardised=!1,t.spatialReference&&(r.spatialReference=t.spatialReference),r._transparent=!0,r._maxProcessing=1e3,r._layer=t.layer,r._wset=null,void 0!==t.outFields&&(r._overrideFields=t.outFields),void 0!==t.includeGeometry&&(r._removeGeometry=!1===t.includeGeometry),r}return r(t,e),t.prototype._maxQueryRate=function(){return u.defaultMaxRecords},t.prototype.end=function(){return this._layer},t.prototype.optimisePagingFeatureQueries=function(e){this._pageJustIds=e},t.prototype.convertQueryToLruCacheKey=function(e){var t=u.stableStringify(e.toJSON());return new l(t,"TEXT").getHash("SHA-1","B64")},t.prototype.load=function(){var e=this;return null===this._loadPromise&&(this._loadPromise=h.create(function(t,r){try{if(!0===e._layer.loaded)return e._initialiseFeatureSet(),void t(e);e._layer.when().then(function(){try{e._initialiseFeatureSet(),t(e)}catch(e){r(e)}},r),e._layer.load()}catch(e){r(e)}})),this._loadPromise},t.prototype._initialiseFeatureSet=function(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType,this.fields=this._layer.fields.slice(0),this._layer.outFields)if(1===this._layer.outFields.length&&"*"===this._layer.outFields[0]);else{for(var e=[],t=0,r=this.fields;t<r.length;t++){if("oid"===(l=r[t]).type)e.push(l);else for(var n=0,a=this._layer.outFields;n<a.length;n++){if(a[n].toLowerCase()===l.name.toLowerCase()){e.push(l);break}}}this.fields=e}if(null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{e=[];for(var i=[],s=0,o=this.fields;s<o.length;s++){var l;if("oid"===(l=o[s]).type)e.push(l),i.push(l.name);else for(var c=0,d=this._overrideFields;c<d.length;c++){if(d[c].toLowerCase()===l.name.toLowerCase()){e.push(l),i.push(l.name);break}}}this.fields=e,this._overrideFields=i}if(this._layer.source&&this._layer.source.layerDefinition){var f=this._layer.source.layerDefinition.currentVersion;!0===this._layer.source.layerDefinition.useStandardizedQueries?(this._databaseType=u.FeatureServiceDatabaseType.StandardisedNoInterval,void 0!==f&&null!==f&&f>=10.61&&(this._databaseType=u.FeatureServiceDatabaseType.Standardised)):void 0!==f&&null!==f&&(f>=10.5&&(this._databaseType=u.FeatureServiceDatabaseType.StandardisedNoInterval,this._requestStandardised=!0),f>=10.61&&(this._databaseType=u.FeatureServiceDatabaseType.Standardised))}this.objectIdField=this._layer.objectIdField,this.hasM=this._layer.supportsM,this.hasZ=this._layer.supportsZ,this.typeIdField=this._layer.typeIdField,this.types=this._layer.types},t.prototype._isInFeatureSet=function(){return u.IdState.InFeatureSet},t.prototype._refineSetBlock=function(e){return h.resolve(e)},t.prototype._candidateIdTransform=function(e){return e},t.prototype._transformSetWithIdChanges=function(){},t.prototype._getSet=function(e){var t=this;return null===this._wset?this._ensureLoaded().then(function(){return t._getFilteredSet("",null,null,null,e)}).then(function(e){return t._wset=e,e}):h.resolve(this._wset)},t.prototype._runDatabaseProbe=function(e){var t=this;return h.create(function(r,n){try{t._ensureLoaded().then(function(){try{var a=new v;a.where=e.replace("OBJECTID",t._layer.objectIdField),t._layer.queryObjectIds(a).then(function(){r(!0)},function(e){try{r(!1)}catch(e){n(e)}})}catch(e){n(e)}})}catch(e){n(e)}})},t.prototype._canUsePagination=function(){return!(!this._layer.capabilities||!this._layer.capabilities.query||!0!==this._layer.capabilities.query.supportsPagination)},t.prototype._cacheableFeatureSetSourceKey=function(){return this._layer.url},t.prototype.pbfSupportedForQuery=function(e){return!e.outStatistics&&this._layer&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsFormatPBF},t.prototype.queryPBF=function(e,t){return e.quantizationParameters={mode:"edit"},_.executeQueryPBF(this._layer.parsedUrl,e,{type:"optimized"}).then(function(e){return g.fromJSON(p.convertToFeatureSet(e.data)).unquantize()})},t.prototype.nativeSource=function(){return this._layer},t.prototype.executeQuery=function(e,t){var r=this,n=new y({url:this._layer.parsedUrl.path}),a="execute"===t&&this.pbfSupportedForQuery(e),i=null;if(this.recentlyUsedQueries){var s=this.convertQueryToLruCacheKey(e);null===(i=this.recentlyUsedQueries.getFromCache(s))&&(i=!0!==a?n[t](e):this.queryPBF(e,n),this.recentlyUsedQueries.addToCache(s,i),i=i.catch(function(e){throw r.recentlyUsedQueries.removeFromCache(s),e}))}return null===i&&(i=!0!==a?n[t](e):this.queryPBF(e,n)),i},t.prototype._getFilteredSet=function(e,t,r,n,a){var i=this;return this.databaseType().then(function(s){if(i.isTable()&&t&&null!==e&&""!==e)return new o([],[],!0,null);if(i._canUsePagination())return i._getFilteredSetUsingPaging(e,t,r,n,a);var l="",u=!1;null!==n&&i._layer.capabilities&&i._layer.capabilities.query&&!0===i._layer.capabilities.query.supportsOrderBy&&(l=n.constructClause(),u=!0);var d=new v;return d.where=null===r?null===t?"1=1":"":c.toWhereClause(r,s),i._requestStandardised&&(d.sqlFormat="standard"),d.spatialRelationship=i._makeRelationshipEnum(e),d.outSpatialReference=i.spatialReference,d.orderByFields=""!==l?l.split(","):null,d.geometry=null===t?null:t,d.relationParameter=i._makeRelationshipParam(e),i.executeQuery(d,"executeForIds").then(function(e){return null===e&&(e=[]),i._checkCancelled(a),new o([],e,u,null)})})},t.prototype._expandPagedSet=function(e,t,r,n,a){return this._expandPagedSetFeatureSet(e,t,r,n,a)},t.prototype._getFilteredSetUsingPaging=function(e,t,r,n,a){var i=this;try{var s="",l=!1;return null!==n&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsOrderBy&&(s=n.constructClause(),l=!0),this.databaseType().then(function(n){var u=null===r?null===t?"1=1":"":c.toWhereClause(r,n);i._layer.definitionExpression&&(u=""!==u?"(("+i._layer.definitionExpression+") AND ("+u+"))":i._layer.definitionExpression);var d=i._maxQueryRate();void 0!==i._layer.maxRecordCount&&i._layer.maxRecordCount<d&&(d=i._layer.maxRecordCount);var f=null;if(!0===i._pageJustIds)f=new o([],["GETPAGES"],l,{spatialRel:i._makeRelationshipEnum(e),relationParam:i._makeRelationshipParam(e),outFields:i._layer.objectIdField,resultRecordCount:d,resultOffset:0,geometry:null===t?null:t,where:u,orderByFields:s,returnGeometry:!1,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,fullyResolved:!1}});else{var h=!0;!0===i._removeGeometry&&(h=!1);var p=null!==i._overrideFields?i._overrideFields:i._fieldsIncludingObjectId(i._layer.outFields?i._layer.outFields:["*"]);f=new o([],["GETPAGES"],l,{spatialRel:i._makeRelationshipEnum(e),relationParam:i._makeRelationshipParam(e),outFields:p.join(","),resultRecordCount:d,resultOffset:0,geometry:null===t?null:t,where:u,orderByFields:s,returnGeometry:h,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,fullyResolved:!1}})}return i._expandPagedSet(f,d,0,1,a).then(function(){return f})})}catch(e){return h.reject(e)}},t.prototype._clonePageDefinition=function(e){return null===e?null:!0!==e.groupbypage?{groupbypage:!1,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}:{groupbypage:!0,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,useOIDpagination:e.useOIDpagination,generatedOid:e.generatedOid,groupByFieldsForStatistics:e.groupByFieldsForStatistics,resultOffset:e.resultOffset,outStatistics:e.outStatistics,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}},t.prototype._getPhysicalPage=function(e,t,r){var n=this;try{var a=e.pagesDefinition.internal.lastRetrieved,i=a,s=new v;return this._requestStandardised&&(s.sqlFormat="standard"),s.spatialRelationship=e.pagesDefinition.spatialRel,s.relationParameter=e.pagesDefinition.relationParam,s.outFields=e.pagesDefinition.outFields.split(","),s.num=e.pagesDefinition.resultRecordCount,s.start=e.pagesDefinition.internal.lastRetrieved,s.geometry=e.pagesDefinition.geometry,s.where=e.pagesDefinition.where,s.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,s.returnGeometry=e.pagesDefinition.returnGeometry,s.outSpatialReference=this.spatialReference,this.executeQuery(s,"execute").then(function(t){if(n._checkCancelled(r),e.pagesDefinition.internal.lastRetrieved!==a)return"done";for(var s=0;s<t.features.length;s++)e.pagesDefinition.internal.set[i+s]=t.features[s].attributes[n._layer.objectIdField];if(!1===n._pageJustIds)for(s=0;s<t.features.length;s++)n._featureCache[t.features[s].attributes[n._layer.objectIdField]]=t.features[s];return t.features.length!==e.pagesDefinition.resultRecordCount&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=a+e.pagesDefinition.resultRecordCount,"done"})}catch(e){return h.reject(e)}},t.prototype._fieldsIncludingObjectId=function(e){if(null===e)return[this.objectIdField];var t=e.slice(0);if(t.indexOf("*")>-1)return t;for(var r=!1,n=0,a=t;n<a.length;n++)if(a[n].toUpperCase()===this.objectIdField.toUpperCase()){r=!0;break}return!1===r&&t.push(this.objectIdField),t},t.prototype._getFeatures=function(e,t,r,n){var a=this,i=[];try{if(-1!==t&&void 0===this._featureCache[t]&&i.push(t),!0===this._checkIfNeedToExpandKnownPage(e,this._maxProcessingRate(),n))return this._expandPagedSet(e,this._maxProcessingRate(),0,0,n).then(function(){return a._getFeatures(e,t,r,n)});for(var s=0,o=e._lastFetchedIndex;o<e._known.length;o++){if(e._lastFetchedIndex+=1,s++,void 0===this._featureCache[e._known[o]]){var l=!1;if(null!==this._layer._mode&&void 0!==this._layer._mode){var u=this._layer._mode;if(void 0!==u._featureMap[e._known[o]]){var c=u._featureMap[e._known[o]];null!==c&&(l=!0,this._featureCache[e._known[o]]=c)}}if(!1===l&&(e._known[o]!==t&&i.push(e._known[o]),i.length>=this._maxProcessingRate()-1))break}if(s>=r&&0===i.length)break}if(0===i.length)return h.resolve("success");try{var d=new v;return this._requestStandardised&&(d.sqlFormat="standard"),d.objectIds=i,d.outFields=null!==this._overrideFields?this._overrideFields:this._fieldsIncludingObjectId(this._layer.outFields?this._layer.outFields:["*"]),d.returnGeometry=!0,!0===this._removeGeometry&&(d.returnGeometry=!1),d.outSpatialReference=this.spatialReference,this.executeQuery(d,"execute").then(function(e){if(a._checkCancelled(n),void 0!==e.error)return h.reject(new Error(e.error));for(var t=0;t<e.features.length;t++)a._featureCache[e.features[t].attributes[a._layer.objectIdField]]=e.features[t];return"success"})}catch(e){return h.reject(e)}}catch(e){return h.reject(e)}},t.prototype._getDistinctPages=function(e,t,r,n,a,i,s,o,l){var u=this;return this._ensureLoaded().then(function(){return u.databaseType()}).then(function(d){for(var f=r.parseTree.column,p=0;p<u._layer.fields.length;p++)if(u._layer.fields[p].name.toLowerCase()===f.toLowerCase()){f=u._layer.fields[p].name;break}var y=new v;u._requestStandardised&&(y.sqlFormat="standard");var _=null===i?null===a?"1=1":"":c.toWhereClause(i,d);return u._layer.definitionExpression&&(_=""!==_?"(("+u._layer.definitionExpression+") AND ("+_+"))":u._layer.definitionExpression),y.where=_,y.spatialRelationship=u._makeRelationshipEnum(n),y.relationParameter=u._makeRelationshipParam(n),y.geometry=null===a?null:a,y.returnDistinctValues=!0,y.returnGeometry=!1,y.outFields=[f],u.executeQuery(y,"execute").then(function(c){if(u._checkCancelled(l),!c.hasOwnProperty("features"))return h.reject(new Error("Unnexected Result querying statistics from layer"));for(var d=!1,p=0;p<u._layer.fields.length;p++)if(u._layer.fields[p].name===f){"date"===u._layer.fields[p].type&&(d=!0);break}for(p=0;p<c.features.length;p++){if(d){var y=c.features[p].attributes[f];null!==y?o.push(new Date(y)):o.push(y)}else o.push(c.features[p].attributes[f]);if(o.length>=s)break}return 0===c.features.length?o:c.features.length===u._layer.maxRecordCount&&o.length<s?u._getDistinctPages(e+c.features.length,t,r,n,a,i,s,o,l).then(function(e){return{calculated:!0,result:e}}):o})})},t.prototype._distinctStat=function(e,t,r,n,a,i,s){return this._getDistinctPages(0,e,t,r,n,a,i,[],s).then(function(e){return{calculated:!0,result:e}})},t.prototype.isTable=function(){return null===this._layer.geometryType||"table"===this._layer.type||""===this._layer.geometryType},t.prototype._countstat=function(e,t,r,n,a){var i=this;return this.databaseType().then(function(e){var a=new v;if(i._requestStandardised&&(a.sqlFormat="standard"),i.isTable()&&r&&null!==t&&""!==t)return{calculated:!0,result:0};var s=null===n?null===r?"1=1":"":c.toWhereClause(n,e);return i._layer.definitionExpression&&(s=""!==s?"(("+i._layer.definitionExpression+") AND ("+s+"))":i._layer.definitionExpression),a.where=s,a.where=s,a.spatialRelationship=i._makeRelationshipEnum(t),a.relationParameter=i._makeRelationshipParam(t),a.geometry=null===r?null:r,a.returnGeometry=!1,i.executeQuery(a,"executeForCount").then(function(e){return{calculated:!0,result:e}})})},t.prototype._stats=function(e,t,r,n,a,i,s){var o=this;return this._ensureLoaded().then(function(){var l=o._layer.capabilities&&o._layer.capabilities.query&&!0===o._layer.capabilities.query.supportsSqlExpression,u=o._layer.capabilities&&o._layer.capabilities.query&&!0===o._layer.capabilities.query.supportsStatistics,p=o._layer.capabilities&&o._layer.capabilities.query&&!0===o._layer.capabilities.query.supportsDistinct;return"count"===e?p?o._countstat(e,r,n,a,s):{calculated:!1}:!1===u||!1===d.isSingleField(t)&&!1===l||!1===t.isStandardized?""!==r||null!==a?{calculated:!1}:o._manualStat(e,t,i,s):"distinct"===e?!1===p?""!==r||null!==a?{calculated:!1}:o._manualStat(e,t,i,s):o._distinctStat(e,t,r,n,a,i,s):o.databaseType().then(function(i){if(o.isTable()&&n&&null!==r&&""!==r)return{calculated:!0,result:null};var s=new v;o._requestStandardised&&(s.sqlFormat="standard");var l=null===a?null===n?"1=1":"":c.toWhereClause(a,i);o._layer.definitionExpression&&(l=""!==l?"(("+o._layer.definitionExpression+") AND ("+l+"))":o._layer.definitionExpression),s.where=l,s.spatialRelationship=o._makeRelationshipEnum(r),s.relationParameter=o._makeRelationshipParam(r),s.geometry=null===n?null:n;var u=new m;u.statisticType=f.decodeStatType(e),u.onStatisticField=c.toWhereClause(t,i),u.outStatisticFieldName="ARCADE_STAT_RESULT",s.returnGeometry=!1;var d="ARCADE_STAT_RESULT";return s.outStatistics=[u],o.executeQuery(s,"execute").then(function(e){if(!e.hasOwnProperty("features")||0===e.features.length)return h.reject(new Error("Unnexected Result querying statistics from layer"));for(var t=!1,r=0;r<e.fields.length;r++)if("ARCADE_STAT_RESULT"===e.fields[r].name.toUpperCase()){d=e.fields[r].name,"date"===e.fields[r].type&&(t=!0);break}if(t){var n=e.features[0].attributes[d];return null!==n&&(n=new Date(e.features[0].attributes[d])),{calculated:!0,result:n}}return{calculated:!0,result:e.features[0].attributes[d]}})})})},t.prototype._stat=function(e,t,r,n,a,i,s){return this._stats(e,t,r,n,a,i,s)},t.prototype._canDoAggregates=function(e,t,r,n,a){var i=this;return this._ensureLoaded().then(function(){var e=!1,r=i._layer.capabilities&&i._layer.capabilities.query&&!0===i._layer.capabilities.query.supportsSqlExpression;if(void 0!==i._layer.capabilities&&null!==i._layer.capabilities.query&&!0===i._layer.capabilities.query.supportsStatistics&&!0===i._layer.capabilities.query.supportsOrderBy&&(e=!0),e)for(var n=0;n<t.length-1;n++)null!==t[n].workingexpr&&(!1===t[n].workingexpr.isStandardized?e=!1:!1===d.isSingleField(t[n].workingexpr)&&!1===r&&(e=!1));return!1!==e})},t.prototype._makeRelationshipEnum=function(e){if(e.indexOf("esriSpatialRelRelation")>=0)return"relation";switch(e){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return e},t.prototype._makeRelationshipParam=function(e){return e.indexOf("esriSpatialRelRelation")>=0?e.split(":")[1]:""},t.prototype._getAggregatePagesDataSourceDefinition=function(e,t,r,n,a,i,s){var l=this;return this._ensureLoaded().then(function(){return l.databaseType()}).then(function(u){var d="",f=!1,h=!1;null!==i&&l._layer.capabilities&&l._layer.capabilities.query&&!0===l._layer.capabilities.query.supportsOrderBy&&(d=i.constructClause(),h=!0),l._layer.capabilities&&l._layer.capabilities.query&&!1===l._layer.capabilities.query.supportsPagination&&(h=!1,f=!0,d=l._layer.objectIdField);for(var p=[],y=0;y<t.length;y++){var _=new m;_.onStatisticField=null!==t[y].workingexpr?c.toWhereClause(t[y].workingexpr,u):"",_.outStatisticFieldName=t[y].field,_.statisticType=t[y].toStatisticsName(),p.push(_)}""===d&&(d=e.join(","));var g=l._maxQueryRate();void 0!==l._layer.maxRecordCount&&l._layer.maxRecordCount<g&&(g=l._layer.maxRecordCount);var v=null===a?null===n?"1=1":"":c.toWhereClause(a,u);return l._layer.definitionExpression&&(v=""!==v?"(("+l._layer.definitionExpression+") AND ("+v+"))":l._layer.definitionExpression),new o([],["GETPAGES"],h,{groupbypage:!0,spatialRel:l._makeRelationshipEnum(r),relationParam:l._makeRelationshipParam(r),outFields:["*"],useOIDpagination:f,generatedOid:s,resultRecordCount:g,resultOffset:0,groupByFieldsForStatistics:e,outStatistics:p,geometry:null===n?null:n,where:v,orderByFields:d,returnGeometry:!1,returnIdsOnly:!1,internal:{lastMaxId:-1,set:[],lastRetrieved:0,fullyResolved:!1}})})},t.prototype._getAgregagtePhysicalPage=function(e,t,r){var a=this;try{var i=e.pagesDefinition.where;!0===e.pagesDefinition.useOIDpagination&&(i=""!==i?"("+i+") AND ("+e.pagesDefinition.generatedOid+">"+e.pagesDefinition.internal.lastMaxId.toString()+")":e.pagesDefinition.generatedOid+">"+e.pagesDefinition.internal.lastMaxId.toString());var s=e.pagesDefinition.internal.lastRetrieved,o=s,l=new v;return this._requestStandardised&&(l.sqlFormat="standard"),l.where=i,l.spatialRelationship=e.pagesDefinition.spatialRel,l.relationParameter=e.pagesDefinition.relationParam,l.outFields=e.pagesDefinition.outFields,l.outStatistics=e.pagesDefinition.outStatistics,l.geometry=e.pagesDefinition.geometry,l.groupByFieldsForStatistics=e.pagesDefinition.groupByFieldsForStatistics,l.num=e.pagesDefinition.resultRecordCount,l.start=e.pagesDefinition.internal.lastRetrieved,l.returnGeometry=e.pagesDefinition.returnGeometry,l.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,this.isTable()&&l.geometry&&l.spatialRelationship?h.resolve([]):this.executeQuery(l,"execute").then(function(t){if(a._checkCancelled(r),!t.hasOwnProperty("features"))return h.reject(new Error("Unnexected Result querying aggregates from layer"));var i=[];if(e.pagesDefinition.internal.lastRetrieved!==s)return[];for(var l=0;l<t.features.length;l++)e.pagesDefinition.internal.set[o+l]=t.features[l].attributes[e.pagesDefinition.generatedOid];for(l=0;l<t.features.length;l++)i.push(new n({attributes:t.features[l].attributes,geometry:null}));return!0===e.pagesDefinition.useOIDpagination?0===t.features.length?e.pagesDefinition.internal.fullyResolved=!0:e.pagesDefinition.internal.lastMaxId=t.features[t.features.length-1].attributes[e.pagesDefinition.generatedOid]:t.features.length!==e.pagesDefinition.resultRecordCount&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=s+e.pagesDefinition.resultRecordCount,i})}catch(e){return h.reject(e)}},t.create=function(e,r,n,a){return new t({layer:new i({url:e,outFields:null===r?["*"]:r}),spatialReference:n,lrucache:a})},t.prototype.relationshipMetaData=function(){return this._layer&&this._layer.source&&this._layer.source.layerDefinition&&this._layer.source.layerDefinition.relationships?this._layer.source.layerDefinition.relationships:[]},t.prototype.serviceUrl=function(){return u.extractServiceUrl(this._layer.parsedUrl.path)},t.prototype.queryAttachments=function(e,t,r,n){var i=this;if(this._layer.capabilities.data.supportsAttachment&&this._layer.capabilities.operations.supportsQueryAttachments){var s={objectIds:[e]};return(t&&t>0||r&&r>0)&&(s.size=[t&&t>0?t:0,r&&r>0?r:t+1]),n&&n.length>0&&(s.attachmentTypes=n),this._layer.queryAttachments(s).then(function(t){var r=[];return t&&t[e]&&t[e].forEach(function(t){var n=i._layer.parsedUrl.path+"/"+e.toString()+"/attachments/"+t.id.toString();r.push(new a(t.id,t.name,t.contentType,t.size,n))}),r})}return h.resolve([])},t}(s)}.apply(null,n))||(e.exports=a)},2548:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(7)],void 0===(a=function(e,t,r){return function(){function e(e,t){this._lastId=-1,this._progress=t,this._parent=e}return e.prototype.reset=function(){this._lastId=-1},e.prototype.nextBatch=function(e){var t=this;if(null!==this._parent._mainSetInUse)return this._parent._mainSetInUse.then(function(r){return t.nextBatch(e)},function(r){return t.nextBatch(e)});var n={returnpromise:null,hasset:!1},a=[];return n.returnpromise=r.create(function(r,i){t._parent._getSet(t._progress).then(function(s){var o=s._known.length-1;if("GETPAGES"===s._known[s._known.length-1]&&(o-=1),t._lastId+e<o&&s._known.length>0&&"GETPAGES"===s._known[s._known.length-1])t._parent._expandPagedSet(s,t._parent._maxQueryRate(),0,0,t._progress).then(function(r){return n.hasset=!0,t._parent._mainSetInUse=null,t.nextBatch(e)},function(e){n.hasset=!0,t._parent._mainSetInUse=null,i(e)});else{if(o>=t._lastId+e||0===s._candidates.length){for(var l=0;l<e;l++){var u=l+t._lastId+1;if(u>=s._known.length)break;a[l]=s._known[u]}return t._lastId+=a.length,0===a.length&&(n.hasset=!0,t._parent._mainSetInUse=null,r([])),void t._parent._getFeatureBatch(a,t._progress).then(function(e){n.hasset=!0,t._parent._mainSetInUse=null,r(e)},function(e){n.hasset=!0,t._parent._mainSetInUse=null,i(e)})}t._parent._refineSetBlock(s,t._parent._maxProcessingRate(),t._progress).then(function(){n.hasset=!0,t._parent._mainSetInUse=null,t.nextBatch(e).then(r,i)},function(e){n.hasset=!0,t._parent._mainSetInUse=null,i(e)})}},function(e){n.hasset=!0,t._parent._mainSetInUse=null,i(e)})}),!1===n.hasset&&(this._parent._mainSetInUse=n.returnpromise,n.hasset=!0),n.returnpromise},e.prototype.next=function(){var e=this;if(null!==this._parent._mainSetInUse)return this._parent._mainSetInUse.then(function(t){return e.next()},function(t){return e.next()});var t={returnpromise:null,hasset:!1};return t.returnpromise=r.create(function(r,n){e._parent._getSet(e._progress).then(function(a){e._lastId<a._known.length-1?"GETPAGES"===a._known[e._lastId+1]?e._parent._expandPagedSet(a,e._parent._maxQueryRate(),0,0,e._progress).then(function(r){return t.hasset=!0,e._parent._mainSetInUse=null,e.next()}).then(r,n):(e._lastId+=1,e._parent._getFeature(a,a._known[e._lastId],e._progress).then(function(n){t.hasset=!0,e._parent._mainSetInUse=null,r(n)},function(r){t.hasset=!0,e._parent._mainSetInUse=null,n(r)})):a._candidates.length>0?e._parent._refineSetBlock(a,e._parent._maxProcessingRate(),e._progress).then(function(){t.hasset=!0,e._parent._mainSetInUse=null,e.next().then(r,n)},function(r){t.hasset=!0,e._parent._mainSetInUse=null,n(r)}):(t.hasset=!0,e._parent._mainSetInUse=null,r(null))},function(r){t.hasset=!0,e._parent._mainSetInUse=null,n(r)})}),!1===t.hasset&&(this._parent._mainSetInUse=t.returnpromise,t.hasset=!0),t.returnpromise},e.prototype.count=function(){var e=this;return-1!==this._parent._totalCount?r.resolve(this._parent._totalCount):this._parent._getSet(this._progress).then(function(t){return e._refineAllSets(t)}).then(function(t){return e._parent._totalCount=t._known.length,r.resolve(e._parent._totalCount)})},e.prototype._refineAllSets=function(e){var t=this;return e._known.length>0&&"GETPAGES"===e._known[e._known.length-1]?this._parent._expandPagedSet(e,this._parent._maxQueryRate(),0,1,this._progress).then(function(r){return t._refineAllSets(e)}).then(function(e){return r.resolve(e)}):e._candidates.length>0?"GETPAGES"===e._known[e._candidates.length-1]?this._parent._expandPagedSet(e,this._parent._maxQueryRate(),0,2,this._progress).then(function(r){return t._refineAllSets(e)}).then(function(e){return r.resolve(e)}):this._parent._refineSetBlock(e,this._parent._maxProcessingRate(),this._progress).then(function(e){return e._candidates.length>0?t._refineAllSets(e):r.resolve(e)}):r.resolve(e)},e}()}.apply(null,n))||(e.exports=a)},2549:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(12),r(62),r(2189),r(2190),r(2183),r(2192),r(7),r(378)],void 0===(a=function(e,t,r,n,a,i,s,o,l,u){return function(e){function t(t){var r=e.call(this,t)||this;return r.declaredClass="esri.arcade.featureset.sources.FeatureLayerRelated",r._findObjectId=-1,r._requestStandardised=!1,r._removeGeometry=!1,r._overrideFields=null,r.featureObjectId=null,r.relatedLayer=null,r.relationship=null,t.spatialReference&&(r.spatialReference=t.spatialReference),r._transparent=!0,r._maxProcessing=1e3,r._layer=t.layer,r._wset=null,r._findObjectId=t.objectId,r.featureObjectId=t.objectId,r.relationship=t.relationship,r.relatedLayer=t.relatedLayer,void 0!==t.outFields&&(r._overrideFields=t.outFields),void 0!==t.includeGeometry&&(r._removeGeometry=!1===t.includeGeometry),r}return r(t,e),t.prototype._maxQueryRate=function(){return s.defaultMaxRecords},t.prototype.end=function(){return this._layer},t.prototype.optimisePagingFeatureQueries=function(e){},t.prototype.load=function(){var e=this;return null===this._loadPromise&&(this._loadPromise=l.create(function(t,r){l.all([e._layer.load(),e.relatedLayer.load()]).then(function(){e._initialiseFeatureSet(),t(e)},r)})),this._loadPromise},t.prototype._initialiseFeatureSet=function(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this.relatedLayer.geometryType,this.fields=this.relatedLayer.fields.slice(0),null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{for(var e=[],t=[],r=0,n=this.fields;r<n.length;r++){var a=n[r];if("oid"===a.type)e.push(a),t.push(a.name);else for(var i=0,o=this._overrideFields;i<o.length;i++){if(o[i].toLowerCase()===a.name.toLowerCase()){e.push(a),t.push(a.name);break}}}this.fields=e,this._overrideFields=t}var l=this._layer.nativeSource();if(l.source&&l.source.layerDefinition)if(!0===l.source.layerDefinition.useStandardizedQueries)this._databaseType=s.FeatureServiceDatabaseType.Standardised;else{var u=l.source.layerDefinition.currentVersion;void 0!==u&&null!==u&&u>=10.5&&(this._databaseType=s.FeatureServiceDatabaseType.Standardised,this._requestStandardised=!0)}this.objectIdField=this.relatedLayer.objectIdField,this.hasM=this.relatedLayer.supportsM,this.hasZ=this.relatedLayer.supportsZ,this.typeIdField=this.relatedLayer.typeIdField,this.types=this.relatedLayer.types},t.prototype.databaseType=function(){var e=this;return this.relatedLayer.databaseType().then(function(){return e._databaseType=e.relatedLayer._databaseType,e._databaseType})},t.prototype.isTable=function(){return this.relatedLayer.isTable()},t.prototype._isInFeatureSet=function(e){return s.IdState.InFeatureSet},t.prototype._transformSetWithIdChanges=function(e){},t.prototype._candidateIdTransform=function(e){return e},t.prototype._getSet=function(e){var t=this;return null===this._wset?this._ensureLoaded().then(function(){return t._getFilteredSet("",null,null,null,e)}).then(function(e){return t._wset=e,e}):l.resolve(this._wset)},t.prototype._changeFeature=function(e){for(var t={},r=0,a=this.fields;r<a.length;r++){var i=a[r];t[i.name]=e.attributes[i.name]}return new n({geometry:!0===this._removeGeometry?null:e.geometry,attributes:t})},t.prototype._getFilteredSet=function(e,t,r,n,a){var s=this;return this._layer.databaseType().then(function(l){if(s.isTable()&&t&&null!==e&&""!==e)return new i([],[],!0,null);var c=s._layer.nativeSource();if(c.capabilities.queryRelated&&c.capabilities.queryRelated.supportsPagination)return s._getFilteredSetUsingPaging(e,t,r,n,a);var d="",f=!1;null!==n&&c.capabilities&&c.capabilities.queryRelated&&!0===c.capabilities.queryRelated.supportsOrderBy&&(d=n.constructClause(),f=!0);var h=new u;return h.objectIds=[s._findObjectId],h.where=null===r?"1=1":o.toWhereClause(r,l),s._requestStandardised&&(h.sqlFormat="standard"),h.outSpatialReference=s.spatialReference,h.orderByFields=""!==d?d.split(","):null,c.queryRelatedFeatures(h).then(function(r){s._checkCancelled(a);for(var n=r[s._findObjectId]?r[s._findObjectId].features:[],o=[],l=0;l<n.length;l++)s._featureCache[n[l].attributes[s._layer.objectIdField]]=n[l],o.push(n[l].attributes[s._layer.objectIdField]);var u=t&&null!==e&&""!==e;return new i(u?o:[],u?[]:o,f,null)})})},t.prototype.nativeCapabilities=function(){return this._layer.nativeSource()},t.prototype._fieldsIncludingObjectId=function(e){if(null===e)return[this.objectIdField];var t=e.slice(0);if(t.indexOf("*")>-1)return t;for(var r=!1,n=0,a=t;n<a.length;n++)if(a[n].toUpperCase()===this.objectIdField.toUpperCase()){r=!0;break}return!1===r&&t.push(this.objectIdField),t},t.prototype._getFilteredSetUsingPaging=function(e,t,r,n,a){var s=this;try{var u="",c=!1,d=this._layer.nativeSource();return null!==n&&d&&d.capabilities.queryRelated&&!0===d.capabilities.queryRelated.supportsOrderBy&&(u=n.constructClause(),c=!0),this._layer.databaseType().then(function(n){var l=null===r?"1=1":o.toWhereClause(r,n),f=s._maxQueryRate();void 0!==d.maxRecordCount&&d.maxRecordCount<f&&(f=d.maxRecordCount);var h,p=t&&null!==e&&""!==e,y=!0;!0===s._removeGeometry&&(y=!1);var _=null!==s._overrideFields?s._overrideFields:s._fieldsIncludingObjectId(s.relatedLayer.fields?s.relatedLayer.fields.map(function(e){return e.name}):["*"]);return h=new i(p?["GETPAGES"]:[],p?[]:["GETPAGES"],c,{outFields:_.join(","),resultRecordCount:f,resultOffset:0,objectIds:[s._findObjectId],where:l,orderByFields:u,returnGeometry:y,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,fullyResolved:!1}}),s._expandPagedSet(h,f,0,1,a).then(function(){return h})})}catch(e){return l.reject(e)}},t.prototype._expandPagedSet=function(e,t,r,n,a){return this._expandPagedSetFeatureSet(e,t,r,n,a)},t.prototype._clonePageDefinition=function(e){return null===e?null:!0!==e.groupbypage?{groupbypage:!1,outFields:e.outFields,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,where:e.where,objectIds:e.objectIds,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}:{groupbypage:!0,outFields:e.outFields,resultRecordCount:e.resultRecordCount,useOIDpagination:e.useOIDpagination,generatedOid:e.generatedOid,groupByFieldsForStatistics:e.groupByFieldsForStatistics,resultOffset:e.resultOffset,outStatistics:e.outStatistics,geometry:e.geometry,where:e.where,objectIds:e.objectIds,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}},t.prototype._getPhysicalPage=function(e,t,r){var n=this;try{var a=e.pagesDefinition.internal.lastRetrieved,i=a,s=this._layer.nativeSource(),o=new u;return!0===this._requestStandardised&&(o.sqlFormat="standard"),o.relationshipId=this.relationship.id,o.objectIds=e.pagesDefinition.objectIds,o.resultOffset=e.pagesDefinition.internal.lastRetrieved,o.resultRecordCount=e.pagesDefinition.resultRecordCount,o.outFields=e.pagesDefinition.outFields.split(","),o.where=e.pagesDefinition.where,o.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,o.returnGeometry=e.pagesDefinition.returnGeometry,o.outSpatialReference=this.spatialReference,s.queryRelatedFeatures(o).then(function(t){if(n._checkCancelled(r),e.pagesDefinition.internal.lastRetrieved!==a)return"done";for(var s=t[n._findObjectId]?t[n._findObjectId].features:[],o=0;o<s.length;o++)e.pagesDefinition.internal.set[i+o]=s[o].attributes[n._layer.objectIdField];for(o=0;o<s.length;o++)n._featureCache[s[o].attributes[n._layer.objectIdField]]=s[o];return s.length!==e.pagesDefinition.resultRecordCount&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=a+e.pagesDefinition.resultRecordCount,"done"})}catch(e){return l.reject(e)}},t.prototype._makeRelationshipEnum=function(e){if(e.indexOf("esriSpatialRelRelation")>=0)return"relation";switch(e){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return e},t.prototype._makeRelationshipParam=function(e){return e.indexOf("esriSpatialRelRelation")>=0?e.split(":")[1]:""},t.prototype._getFeatures=function(e,t,r,n){var a=[];-1!==t&&void 0===this._featureCache[t]&&a.push(t);for(var i=e._lastFetchedIndex;i<e._known.length&&(e._lastFetchedIndex+=1,!(void 0===this._featureCache[e._known[i]]&&(e._known[i]!==t&&a.push(e._known[i]),a.length>r)));i++);return 0===a.length?l.resolve("success"):l.reject(new Error("Unaccounted for Features. Not in Feature Collection"))},t.prototype._refineSetBlock=function(e,t,r){return l.resolve(e)},t.prototype._stat=function(e,t,r,n,a,i,s){return l.resolve({calculated:!1})},t.prototype._canDoAggregates=function(e,t,r,n,a){return l.resolve(!1)},t.prototype.relationshipMetaData=function(){return this.relatedLayer.relationshipMetaData()},t.prototype.serviceUrl=function(){return this.relatedLayer.serviceUrl()},t.prototype.queryAttachments=function(e,t,r,n){return this.relatedLayer.queryAttachments(e,t,r,n)},t}(a)}.apply(null,n))||(e.exports=a)},2550:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(12),r(62),r(2551),r(2280),r(2278),r(2189),r(2190),r(2279),r(2340),r(2183),r(2192),r(2192),r(2277),r(2552),r(7),r(355),r(32),r(151),r(232)],void 0===(a=function(e,t,r,n,a,i,s,o,l,u,c,d,f,h,p,y,_,g,v,m,S){var w=function(e){function t(t){var r=e.call(this,t)||this;return r._decodedStatsfield=[],r._decodedGroupbyfield=[],r._candosimplegroupby=!0,r.phsyicalgroupbyfields=[],r.objectIdField="GENID",r._internalObjectIdField="GENID",r._adaptedFields=[],r.declaredClass="esri.arcade.featureset.actions.Aggregate",r._uniqueIds=1,r._maxQuery=10,r._maxProcessing=10,r._parent=t.parentfeatureset,r._config=t,r}return r(t,e),t.prototype.isTable=function(){return!0},t.prototype._getSet=function(e){var t=this;return null===this._wset?this._getFilteredSet("",null,null,null,e).then(function(e){return t._wset=e,t._wset}):_.resolve(this._wset)},t.prototype._isInFeatureSet=function(e){return d.IdState.InFeatureSet},t.prototype.nextUniqueName=function(e){for(;1===e["T"+this._uniqueIds.toString()];)this._uniqueIds++;var t="T"+this._uniqueIds.toString();return e[t]=1,t},t.prototype.convertToEsriFieldType=function(e){return e},t.prototype._initialiseFeatureSet=function(){var e={},t=!1,r=1,n=this._parent?this._parent.getFieldsIndex():new S([]);for(this.objectIdField="GENID";!1===t;){for(var i=!1,s=0;s<this._config.groupbyfields.length;s++)if(this._config.groupbyfields[s].name.toLowerCase()===this.objectIdField.toLowerCase()){i=!0;break}if(!1===i)for(s=0;s<this._config.statsfields.length;s++)if(this._config.statsfields[s].name.toLowerCase()===this.objectIdField.toLowerCase()){i=!0;break}!1===i?t=!0:(this.objectIdField="GENID"+r.toString(),r++)}for(var o=0,l=this._config.statsfields;o<l.length;o++){var u=l[o],c=new y;c.field=u.name,c.tofieldname=u.name,c.workingexpr=u.expression instanceof g.WhereClause?u.expression:g.WhereClause.create(u.expression,n),c.typeofstat=u.statistic.toUpperCase(),this._decodedStatsfield.push(c)}this._decodedGroupbyfield=[];for(var p=0,_=this._config.groupbyfields;p<_.length;p++){var w={name:(u=_[p]).name,singlefield:null,tofieldname:u.name,expression:u.expression instanceof g.WhereClause?u.expression:g.WhereClause.create(u.expression,n)};this._decodedGroupbyfield.push(w)}if(null!==this._parent){this.geometryType=this._parent.geometryType,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField="";for(var F=0,b=this._parent.fields;F<b.length;F++){e[(u=b[F]).name.toUpperCase()]=1}this.types=null}else this.geometryType=d.layerGeometryEsriConstants.point,this.typeIdField="",this.types=null,this.spatialReference=new v({wkid:4326});this.fields=[];var I=new y;I.field=this.nextUniqueName(e),I.tofieldname=this.objectIdField,I.workingexpr=g.WhereClause.create(this._parent.objectIdField,this._parent.getFieldsIndex()),I.typeofstat="MIN",this._decodedStatsfield.push(I);for(var T=0,C=this._decodedGroupbyfield;T<C.length;T++){var D=C[T],E=new m;if(D.name=this.nextUniqueName(e),E.name=D.tofieldname,E.alias=E.name,f.isSingleField(D.expression)){if(!(A=this._parent.getField(h.toWhereClause(D.expression,d.FeatureServiceDatabaseType.Standardised))))throw new Error("Field is not present for Aggregation");D.name=A.name,D.singlefield=A.name,this.phsyicalgroupbyfields.push(A.name),E.type=A.type}else E.type=this.convertToEsriFieldType(h.predictType(D.expression,this._parent.fields)),this.phsyicalgroupbyfields.push(D.name),this._adaptedFields.push(new a.SqlExpressionAdapted(E,D.expression)),this._candosimplegroupby=!1;this.fields.push(E)}if(this._adaptedFields.length>0)for(var x=0,R=this._parent.fields;x<R.length;x++){u=R[x];this._adaptedFields.push(new a.OriginalField(u))}for(s=0;s<this._decodedStatsfield.length;s++){E=new m;var A=null;(D=this._decodedStatsfield[s]).field=this.nextUniqueName(e),D.tofieldname===this.objectIdField&&(this._internalObjectIdField=D.field),E.name=D.tofieldname,E.alias=E.name;var O=null!==D.workingexpr&&f.isSingleField(D.workingexpr)?h.toWhereClause(D.workingexpr,d.FeatureServiceDatabaseType.Standardised):"";switch(this._decodedStatsfield[s].typeofstat){case"SUM":if(""!==O){if(!(A=this._parent.getField(O)))throw new Error("Field is not present for Aggregation");E.type=A.type}else E.type="double";break;case"MIN":case"MAX":if(""!==O){if(!(A=this._parent.getField(O)))throw new Error("Field is not present for Aggregation");E.type=A.type}else E.type="double";break;case"COUNT":E.type="integer";break;case"STDEV":case"VARIANCE":case"MEAN":case"AVERAGE":if(""!==O&&!(A=this._parent.getField(O)))throw new Error("Field is not present for Aggregation");E.type="double"}this.fields.push(E)}},t.prototype._canDoAggregates=function(e,t,r,n,a){return _.resolve(!1)},t.prototype._getFeatures=function(e,t,r,n){var a=this;-1!==t&&void 0===this._featureCache[t]&&[].push(t);var i=this._maxQuery;return!0===this._checkIfNeedToExpandKnownPage(e,i,n)?this._expandPagedSet(e,i,0,0,n).then(function(i){return a._getFeatures(e,t,r,n)}):_.resolve("success")},t.prototype._getFilteredSet=function(e,t,r,n,o){var c=this;if(""!==e)return _.resolve(new l([],[],!0,null));var d=null,h={ordered:!1,nowhereclause:!1};return this._ensureLoaded().then(function(){if(null!==r)for(var e=0;e<c._decodedStatsfield.length;e++)if(!0===f.scanForField(r,c._decodedStatsfield[e].tofieldname)){h.nowhereclause=!0,r=null;break}if(null!==n){h.ordered=!0;for(e=0;e<c._decodedStatsfield.length;e++)if(!0===n.scanForField(c._decodedStatsfield[e].tofieldname)){n=null,h.ordered=!1;break}for(var t=0,a=c._decodedGroupbyfield;t<a.length;t++){var i=a[t];if(null===i.singlefield&&!0===n.scanForField(i.tofieldname)){n=null,h.ordered=!1;break}}}return!1===c._candosimplegroupby?_.resolve(!1):c._parent._canDoAggregates(c.phsyicalgroupbyfields,c._decodedStatsfield,"",null,null)}).then(function(e){if(e){var t=null;return r&&(t=c._reformulateWhereClauseWithoutGroupByFields(r)),c._parent._getAggregatePagesDataSourceDefinition(c.phsyicalgroupbyfields,c._decodedStatsfield,"",null,t,n,c._internalObjectIdField).then(function(e){return c._checkCancelled(o),d=!0===h.nowhereclause?new l(e._candidates.slice(0).concat(e._known.slice(0)),[],!0===h.ordered&&e._ordered,c._clonePageDefinition(e.pagesDefinition)):new l(e._candidates.slice(0),e._known.slice(0),!0===h.ordered&&e._ordered,c._clonePageDefinition(e.pagesDefinition))})}var f=c._parent;if(c._adaptedFields.length>0&&(f=new a.AdaptedFeatureSet({parentfeatureset:c._parent,adaptedFields:c._adaptedFields,extraFilter:null})),!0===h.nowhereclause)d=new l(["GETPAGES"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:c._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:"manual",iterator:null,set:[],subfeatureset:new s({parentfeatureset:f,orderbyclause:new u(c.phsyicalgroupbyfields.join(",")+","+c._parent.objectIdField+" ASC")})}});else{var p=f;null!==r&&(p=new i({parentfeatureset:p,whereclause:r})),d=new l(["GETPAGES"],[],!1,{aggregatefeaturesetpagedefinition:!0,resultOffset:0,resultRecordCount:c._maxQuery,internal:{fullyResolved:!1,workingItem:null,type:"manual",iterator:null,set:[],subfeatureset:new s({parentfeatureset:p,orderbyclause:new u(c.phsyicalgroupbyfields.join(",")+","+c._parent.objectIdField+" ASC")})}})}return d})},t.prototype._reformulateWhereClauseWithoutStatsFields=function(e){for(var t=0,r=this._decodedStatsfield;t<r.length;t++){var n=r[t];e=h.reformulateWithoutField(e,n.tofieldname,h.toWhereClause(n.workingexpr,d.FeatureServiceDatabaseType.Standardised),this._parent.getFieldsIndex())}return e},t.prototype._reformulateWhereClauseWithoutGroupByFields=function(e){for(var t=0,r=this._decodedGroupbyfield;t<r.length;t++){var n=r[t];n.tofieldname!==n.name&&(e=h.reformulateWithoutField(e,n.tofieldname,h.toWhereClause(n.expression,d.FeatureServiceDatabaseType.Standardised),this._parent.getFieldsIndex()))}return e},t.prototype._clonePageDefinition=function(e){return null===e?null:!0===e.aggregatefeaturesetpagedefinition?{aggregatefeaturesetpagedefinition:!0,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,internal:e.internal}:this._parent._clonePageDefinition(e)},t.prototype._refineSetBlock=function(e,t,r){var n=this;try{if(!0===this._checkIfNeedToExpandCandidatePage(e,this._maxQuery,r))return this._expandPagedSet(e,this._maxQuery,0,0,r).then(function(a){return n._refineSetBlock(e,t,r)});this._checkCancelled(r);e._candidates.length;return this._refineKnowns(e,t),e._candidates.length,e._candidates.length,_.resolve(e)}catch(e){return _.reject(e)}},t.prototype._expandPagedSet=function(e,t,r,n,a){return this._expandPagedSetFeatureSet(e,t,r,n,a)},t.prototype._getPhysicalPage=function(e,t,r){var a=this;return!0===e.pagesDefinition.aggregatefeaturesetpagedefinition?this._sequentialGetPhysicalItem(e,e.pagesDefinition.resultRecordCount,r):this._getAgregagtePhysicalPage(e,t,r).then(function(e){for(var t=0,r=e;t<r.length;t++){for(var i=r[t],s={geometry:i.geometry,attributes:{}},o=0,l=a._decodedGroupbyfield;o<l.length;o++){var u=l[o];s.attributes[u.tofieldname]=i.attributes[u.name]}for(var c=0,d=a._decodedStatsfield;c<d.length;c++){u=d[c];s.attributes[u.tofieldname]=i.attributes[u.field]}a._featureCache[s.attributes[a.objectIdField]]=new n(s)}return e.length})},t.prototype._sequentialGetPhysicalItem=function(e,t,r){var n=this;return null===e.pagesDefinition.internal.iterator&&(e.pagesDefinition.internal.iterator=e.pagesDefinition.internal.subfeatureset.iterator(r)),!0===e.pagesDefinition.internal.fullyResolved?_.resolve("success"):0===t?_.resolve("success"):e.pagesDefinition.internal.iterator.next().then(function(a){if(null===a)return null!==e.pagesDefinition.internal.workingItem?n._calculateAndAppendAggregateItemDeferred(e.pagesDefinition.internal.workingItem).then(function(t){return e.pagesDefinition.internal.workingItem=null,e.pagesDefinition.internal.set.push(t),e.pagesDefinition.internal.fullyResolved=!0,"success"}):(e.pagesDefinition.internal.fullyResolved=!0,"success");var i=n._generateAggregateHash(a);if(null===e.pagesDefinition.internal.workingItem)e.pagesDefinition.internal.workingItem={features:[a],id:i};else{if(i!==e.pagesDefinition.internal.workingItem.id)return n._calculateAndAppendAggregateItemDeferred(e.pagesDefinition.internal.workingItem).then(function(s){return e.pagesDefinition.internal.workingItem=null,e.pagesDefinition.internal.set.push(s),t-=1,e.pagesDefinition.internal.workingItem={features:[a],id:i},n._sequentialGetPhysicalItem(e,t,r)});e.pagesDefinition.internal.workingItem.features.push(a)}return n._sequentialGetPhysicalItem(e,t,r)})},t.prototype._calculateFieldStat=function(e,t,r){for(var n=[],a=0;a<e.features.length;a++)if(null!==t.workingexpr){var i=t.workingexpr.calculateValue(e.features[a]);null!==i?n.push(i):"COUNT"!==t.typeofstat&&n.push(i)}else n.push(null);switch(t.typeofstat){case"MIN":r.attributes[t.tofieldname]=p.calculateStat("min",n,-1);break;case"MAX":r.attributes[t.tofieldname]=p.calculateStat("max",n,-1);break;case"SUM":r.attributes[t.tofieldname]=p.calculateStat("sum",n,-1);break;case"COUNT":r.attributes[t.tofieldname]=n.length;break;case"VARIANCE":r.attributes[t.tofieldname]=p.calculateStat("variance",n,-1);break;case"STDEV":r.attributes[t.tofieldname]=p.calculateStat("stdev",n,-1);break;case"MEAN":case"AVERAGE":r.attributes[t.tofieldname]=p.calculateStat("mean",n,-1)}return!0},t.prototype._calculateAndAppendAggregateItemDeferred=function(e){try{for(var t={attributes:{},geometry:null},r=0,a=this._decodedGroupbyfield;r<a.length;r++){var i=a[r],s=i.singlefield?e.features[0].attributes[i.singlefield]:i.expression.calculateValue(e.features[0]);t.attributes[i.tofieldname]=s}for(var o=0,l=this._decodedStatsfield;o<l.length;o++){var u=l[o];this._calculateFieldStat(e,u,t)}for(var c=[],d=0;d<this._decodedStatsfield.length;d++)c.push(this._calculateFieldStat(e,this._decodedStatsfield[d],t));return this._featureCache[t.attributes[this.objectIdField]]=new n({attributes:t.attributes,geometry:t.geometry}),_.resolve(t.attributes[this.objectIdField])}catch(e){return _.reject(e)}},t.prototype._generateAggregateHash=function(e){for(var t="",r=0,n=this._decodedGroupbyfield;r<n.length;r++){var a=n[r],i=a.singlefield?e.attributes[a.singlefield]:a.expression.calculateValue(e);t+=null===i||void 0===i?":":":"+i.toString()}return new c(t,"TEXT").getHash("SHA-1","B64")},t.prototype._stat=function(e,t,r,n,a,i,s){return _.resolve({calculated:!1})},t}(o);return o._featuresetFunctions.groupby=function(e,t){return new w({parentfeatureset:this,groupbyfields:e,statsfields:t})},w}.apply(null,n))||(e.exports=a)},2551:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(12),r(62),r(819),r(2189),r(2190),r(2183),r(2192),r(7),r(355),r(32)],void 0===(a=function(e,t,r,n,a,i,s,o,l,u,c,d){Object.defineProperty(t,"__esModule",{value:!0});var f=function(){function e(){this.sqlRewritable=!1}return e.prototype.extractValue=function(e){return null},e.prototype.postInitialization=function(e,t){},e.prototype.rewriteSql=function(e,t){return{rewritten:this.sqlRewritable,where:e}},e}();t.AdaptedField=f;var h=function(e){function t(t){var r=e.call(this)||this;return r.field=t,r.sqlRewritable=!0,r}return r(t,e),t.prototype.extractValue=function(e){return e.attributes[this.field.name]},t.prototype.rewriteSql=function(e,t){return{rewritten:this.sqlRewritable,where:e}},t}(f);t.OriginalField=h;var p=function(e){function t(t,r,n){var a=e.call(this)||this;return a.originalField=t,a.sqlRewritable=!0,a.field=o.cloneField(t),a.field.name=r,a.field.alias=n,a}return r(t,e),t.prototype.rewriteSql=function(e,t){return{rewritten:this.sqlRewritable,where:l.reformulateWithoutField(e,this.field.name,this.originalField.name,t.getFieldsIndex())}},t.prototype.extractValue=function(e){return e.attributes[this.originalField.name]},t}(f);t.FieldRename=p;var y=function(e){function t(t,r,n){var a=e.call(this)||this;for(var i in a.field=t,a.codefield=r,a.lkp=n,a.reverseLkp={},n)a.reverseLkp[n[i]]=i;return a.sqlRewritable=!0,a}return r(t,e),t.prototype.rewriteSql=function(e,r){var n=this.evaluateNodeToWhereClause(e.parseTree,o.FeatureServiceDatabaseType.Standardised,this.field.name,this.codefield instanceof c.WhereClause?l.toWhereClause(this.codefield,o.FeatureServiceDatabaseType.Standardised):this.codefield,e.parameters);return n.indexOf(t.BADNESS)>=0?{rewritten:!1,where:e}:{rewritten:this.sqlRewritable,where:c.WhereClause.create(n,r._parent.getFieldsIndex())}},t.prototype.evaluateNodeToWhereClause=function(e,r,n,a,i){var s,u,c,d;switch(void 0===n&&(n=null),void 0===a&&(a=null),e.type){case"interval":return l.convertIntervalToSql(this.evaluateNodeToWhereClause(e.value,r,n,a,i),e.qualifier,e.op,o.FeatureServiceDatabaseType.Standardised);case"case_expression":var f=" CASE ";"simple"===e.format&&(f+=this.evaluateNodeToWhereClause(e.operand,r,n,t.BADNESS,i));for(var h=0;h<e.clauses.length;h++)f+=" WHEN "+this.evaluateNodeToWhereClause(e.clauses[h].operand,r,n,t.BADNESS,i)+" THEN "+this.evaluateNodeToWhereClause(e.clauses[h].value,r,n,t.BADNESS,i);return null!==e.else&&(f+=" ELSE "+this.evaluateNodeToWhereClause(e.else,r,n,t.BADNESS,i)),f+" END ";case"param":var p=i[e.value.toLowerCase()];if("string"==typeof p)return"'"+i[e.value.toLowerCase()].toString().replace(/'/g,"''")+"'";if(p instanceof Date)return l.makeDateString(p,r);if(p instanceof Array){var y=[];for(h=0;h<p.length;h++)"string"==typeof p[h]?y.push("'"+p[h].toString().replace(/'/g,"''")+"'"):p[h]instanceof Date?y.push(l.makeDateString(p[h],r)):y.push(p[h].toString());return y}return p.toString();case"expr_list":u=[];for(var _=0,g=e.value;_<g.length;_++){var v=g[_];u.push(this.evaluateNodeToWhereClause(v,r,n,a,i))}return u;case"unary_expr":return" ( NOT "+this.evaluateNodeToWhereClause(e.expr,r,n,t.BADNESS,i)+" ) ";case"binary_expr":switch(e.operator){case"AND":return" ("+this.evaluateNodeToWhereClause(e.left,r,n,a,i)+" AND "+this.evaluateNodeToWhereClause(e.right,r,n,a,i)+") ";case"OR":return" ("+this.evaluateNodeToWhereClause(e.left,r,n,a,i)+" OR "+this.evaluateNodeToWhereClause(e.right,r,n,a,i)+") ";case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return" ("+this.evaluateNodeToWhereClause(e.left,r,n,a,i)+" IS NULL )";case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return" ("+this.evaluateNodeToWhereClause(e.left,r,n,a,i)+" IS NOT NULL )";case"IN":if(s=[],"expr_list"===e.right.type){if("column_ref"===e.left.type&&e.left.column.toUpperCase()===this.field.name.toUpperCase()){for(var m=[],S=!0,w=0,F=e.right.value;w<F.length;w++){if("string"!==(T=F[w]).type){S=!1;break}if(void 0===this.lkp[T.value]){S=!1;break}m.push(this.lkp[T.value].toString())}if(S)return" ("+this.evaluateNodeToWhereClause(e.left,r,n,a,i)+" IN ("+m.join(",")+")) "}return s=this.evaluateNodeToWhereClause(e.right,r,n,a,i)," ("+this.evaluateNodeToWhereClause(e.left,r,n,a,i)+" IN ("+s.join(",")+")) "}return(d=this.evaluateNodeToWhereClause(e.right,r,n,a,i))instanceof Array?" ("+this.evaluateNodeToWhereClause(e.left,r,n,a,i)+" IN ("+d.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(e.left,r,n,a,i)+" IN ("+d+")) ";case"NOT IN":if(s=[],"expr_list"===e.right.type){if("column_ref"===e.left.type&&e.left.column.toUpperCase()===this.field.name.toUpperCase()){m=[],S=!0;for(var b=0,I=e.right.value;b<I.length;b++){var T;if("string"!==(T=I[b]).type){S=!1;break}if(void 0===this.lkp[T.value]){S=!1;break}m.push(this.lkp[T.value].toString())}if(S)return" ("+this.evaluateNodeToWhereClause(e.left,r,n,a,i)+" NOT IN ("+m.join(",")+")) "}return s=this.evaluateNodeToWhereClause(e.right,r,n,a,i)," ("+this.evaluateNodeToWhereClause(e.left,r,n,a,i)+" NOT IN ("+s.join(",")+")) "}return(d=this.evaluateNodeToWhereClause(e.right,r,n,a,i))instanceof Array?" ("+this.evaluateNodeToWhereClause(e.left,r,n,a,i)+" NOT IN ("+d.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(e.left,r,n,a,i)+" NOT IN ("+d+")) ";case"BETWEEN":return c=this.evaluateNodeToWhereClause(e.right,r,n,t.BADNESS,i)," ("+this.evaluateNodeToWhereClause(e.left,r,n,t.BADNESS,i)+" BETWEEN "+c[0]+" AND "+c[1]+" ) ";case"NOTBETWEEN":return c=this.evaluateNodeToWhereClause(e.right,r,n,t.BADNESS,i)," ("+this.evaluateNodeToWhereClause(e.left,r,n,t.BADNESS,i)+" NOT BETWEEN "+c[0]+" AND "+c[1]+" ) ";case"LIKE":return""!==e.escape?" ("+this.evaluateNodeToWhereClause(e.left,r,n,t.BADNESS,i)+" LIKE "+this.evaluateNodeToWhereClause(e.right,r,n,t.BADNESS,i)+" ESCAPE '"+e.escape+"') ":" ("+this.evaluateNodeToWhereClause(e.left,r,n,t.BADNESS,i)+" LIKE "+this.evaluateNodeToWhereClause(e.right,r,n,t.BADNESS,i)+") ";case"NOT LIKE":return""!==e.escape?" ("+this.evaluateNodeToWhereClause(e.left,r,n,t.BADNESS,i)+" NOT LIKE "+this.evaluateNodeToWhereClause(e.right,r,n,t.BADNESS,i)+" ESCAPE '"+e.escape+"') ":" ("+this.evaluateNodeToWhereClause(e.left,r,n,t.BADNESS,i)+" NOT LIKE "+this.evaluateNodeToWhereClause(e.right,r,n,t.BADNESS,i)+") ";case"<>":case"=":if("column_ref"===e.left.type&&"string"===e.right.type){if(e.left.column.toUpperCase()===this.field.name.toUpperCase()&&void 0!==this.lkp[e.right.value.toString()])return" ("+a+" "+e.operator+" "+this.lkp[e.right.value.toString()].toString()+") "}else if("column_ref"===e.right.type&&"string"===e.left.type&&e.right.column.toUpperCase()===this.field.name.toUpperCase())return" ("+this.lkp[e.right.value.toString()].toString()+" "+e.operator+" "+a+") ";return" ("+this.evaluateNodeToWhereClause(e.left,r,n,t.BADNESS,i)+" "+e.operator+" "+this.evaluateNodeToWhereClause(e.right,r,n,t.BADNESS,i)+") ";case"<":case">":case">=":case"<=":case"*":case"-":case"+":case"/":return" ("+this.evaluateNodeToWhereClause(e.left,r,n,t.BADNESS,i)+" "+e.operator+" "+this.evaluateNodeToWhereClause(e.right,r,n,t.BADNESS,i)+") "}throw new Error("Not Supported Operator "+e.operator);case"null":return"null";case"bool":return!0===e.value?"1":"0";case"string":return"'"+e.value.toString().replace(/'/g,"''")+"'";case"timestamp":case"date":return l.makeDateString(e.value,r);case"number":return e.value.toString();case"column_ref":return"CURRENT_DATE"===e.column.toUpperCase()?l.makeToday(!0,r):"CURRENT_TIMESTAMP"===e.column.toUpperCase()?l.makeToday(!1,r):n&&n.toLowerCase()===e.column.toLowerCase()?"("+a+")":e.column;case"function":var C=this.evaluateNodeToWhereClause(e.args,r,n,t.BADNESS,i);return l.translateFunctionToDatabaseSpecific(e.name,C,r)}throw new Error("Unsupported sql syntax "+e.type)},t.prototype.extractValue=function(e){return this.codefield instanceof c.WhereClause?this.reverseLkp[this.codefield.calculateValueCompiled(e)]:e.attributes[this.codefield]},t.BADNESS="_!!!_BAD_LKP_!!!!",t}(f);t.StringToCodeAdapted=y;var _=function(e){function t(t,r){var n=e.call(this)||this;return n.field=t,n.sql=r,n}return r(t,e),t.prototype.rewriteSql=function(e,t){return{rewritten:!0,where:l.reformulateWithoutField(e,this.field.name,l.toWhereClause(this.sql,o.FeatureServiceDatabaseType.Standardised),t.getFieldsIndex())}},t.prototype.postInitialization=function(e,t){},t.prototype.extractValue=function(e){return this.sql.calculateValueCompiled(e)},t}(f);t.SqlExpressionAdapted=_;var g=function(e){function t(t){var r=e.call(this,t)||this;return r._calcFunc=null,r.declaredClass="esri.arcade.featureset.actions.Adapted",r.adaptedFields=null,r._extraFilter=null,r._extraFilter=t.extraFilter,r._parent=t.parentfeatureset,r._maxProcessing=30,r.adaptedFields=t.adaptedFields,r}return r(t,e),t.findField=function(e,t){for(var r=0,n=e;r<n.length;r++){var a=n[r];if(a.name.toLowerCase()===t.toString().toLowerCase())return a}return null},t.prototype._initialiseFeatureSet=function(){null!==this._parent?(this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.spatialReference=new d({wkid:4326}),this.objectIdField="",this.geometryType=o.layerGeometryEsriConstants.point,this.typeIdField="",this.types=null),this.fields=[];for(var e=0,t=this.adaptedFields;e<t.length;e++){var r=t[e];r.postInitialization(this,this._parent),this.fields.push(r.field)}},t.prototype._getSet=function(e){var t=this;return null===this._wset?this._ensureLoaded().then(function(){return t._extraFilter?t._getFilteredSet("",null,null,null,e):t._parent._getSet(e)}).then(function(r){return t._checkCancelled(e),t._wset=new s(r._candidates.slice(0),r._known.slice(0),r._ordered,t._clonePageDefinition(r.pagesDefinition)),t._wset}):u.resolve(this._wset)},t.prototype._isInFeatureSet=function(e){return this._parent._isInFeatureSet(e)},t.prototype._getFeatures=function(e,t,r,i){var o=this,l=[];-1!==t&&void 0===this._featureCache[t]&&l.push(t);var c=this._maxQueryRate();if(!0===this._checkIfNeedToExpandKnownPage(e,c,i))return this._expandPagedSet(e,c,0,0,i).then(function(n){return o._getFeatures(e,t,r,i)});for(var d=0,f=e._lastFetchedIndex;f<e._known.length&&(++d<=r&&(e._lastFetchedIndex+=1),!(void 0===this._featureCache[e._known[f]]&&(e._known[f]!==t&&l.push(e._known[f]),l.length>=c-1)));f++);if(0===l.length)return u.resolve("success");e=new s([],l,e._ordered,null);var h=Math.min(l.length,r);return this._parent._getFeatures(e,-1,h,i).then(function(e){o._checkCancelled(i);for(var t=[],r=0;r<h;r++){var s=o._parent._featureFromCache(l[r]);void 0!==s&&t.push({geometry:s.geometry,attributes:s.attributes,id:l[r]})}for(var u=0,c=t;u<c.length;u++){for(var d=c[u],f=[],p=0,y=o.adaptedFields;p<y.length;p++){var _=y[p];f[_.field.name]=_.extractValue(d)}o._featureCache[d.id]=new n({attributes:f,geometry:a.cloneGeometry(d.geometry)})}return"success"})},t.prototype._fetchAndRefineFeatures=function(e,t,r){return u.reject(new Error("Fetch and Refine should not be called in this featureset"))},t.prototype._getFilteredSet=function(e,t,r,n,a){var i,o=this,u=this.reformulateWithoutAdaptions(r);i=u.cannot,r=u.where;var c=!1;if(null!==n){c=!0;for(var d=0,f=this.adaptedFields;d<f.length;d++){var p=f[d];if(!(p instanceof h)&&!0===n.scanForField(p.field.name)){n=null,c=!1;break}}}return null!==r?null!==this._extraFilter&&(r=l.combine(this._extraFilter,r)):r=this._extraFilter,this._ensureLoaded().then(function(){return o._parent._getFilteredSet(e,t,r,n,a)}).then(function(e){return o._checkCancelled(a),!0===i?new s(e._candidates.slice(0).concat(e._known.slice(0)),[],!0===c&&e._ordered,o._clonePageDefinition(e.pagesDefinition)):new s(e._candidates.slice(0),e._known.slice(0),!0===c&&e._ordered,o._clonePageDefinition(e.pagesDefinition))})},t.prototype.reformulateWithoutAdaptions=function(e){var t={cannot:!1,where:e};if(null!==e)for(var r=0,n=this.adaptedFields;r<n.length;r++){var a=n[r];if(!0===l.scanForField(e,a.field.name)){var i=a.rewriteSql(e,this);if(!0!==i.rewritten){t.cannot=!0,t.where=null;break}t.where=i.where}}return t},t.prototype._stat=function(e,t,r,n,a,i,s){var o=this,c=!1,d=this.reformulateWithoutAdaptions(t);return c=d.cannot,t=d.where,d=this.reformulateWithoutAdaptions(a),c=c||d.cannot,null!==(a=d.where)?null!==this._extraFilter&&(a=l.combine(this._extraFilter,a)):a=this._extraFilter,!0===c?null===a&&""===r&&null===n?this._manualStat(e,t,i,s):u.resolve({calculated:!1}):this._parent._stat(e,t,r,n,a,i,s).then(function(l){return!1===l.calculated?null===a&&""===r&&null===n?o._manualStat(e,t,i,s):{calculated:!1}:l})},t.prototype._canDoAggregates=function(e,t,r,n,a){if(null===this._parent)return u.resolve(!1);for(var i=0;i<e.length;i++)for(var s=0,o=this.adaptedFields;s<o.length;s++){var c=o[s];if(e[i].toLowerCase()===c.field.name.toLowerCase()&&!(c instanceof h))return u.resolve(!1)}var d=[];for(i=0;i<t.length;i++){var f=t[i];if(null!==f.workingexpr){var p=this.reformulateWithoutAdaptions(f.workingexpr);if(p.cannot)return u.resolve(!1);var y=f.clone();y.workingexpr=p.where,d.push(y)}else d.push(f)}var _=this.reformulateWithoutAdaptions(a);return _.cannot?u.resolve(!1):(null!==(a=_.where)?null!==this._extraFilter&&(a=l.combine(this._extraFilter,a)):a=this._extraFilter,this._parent._canDoAggregates(e,d,r,n,a))},t.prototype._getAggregatePagesDataSourceDefinition=function(e,t,r,n,a,i,s){if(null===this._parent)return u.reject(new Error("Should never be called"));for(var o=[],c=0;c<t.length;c++){var d=t[c];if(null!==d.workingexpr){var f=this.reformulateWithoutAdaptions(d.workingexpr);if(f.cannot)return u.reject(new Error("Should never be called"));var h=d.clone();h.workingexpr=f.where,o.push(h)}else o.push(d)}var p=this.reformulateWithoutAdaptions(a);return p.cannot?u.reject(new Error("Should never be called")):(null!==(a=p.where)?null!==this._extraFilter&&(a=l.combine(this._extraFilter,a)):a=this._extraFilter,this._parent._getAggregatePagesDataSourceDefinition(e,o,r,n,a,i,s))},t}(i);t.AdaptedFeatureSet=g}.apply(null,n))||(e.exports=a)},2552:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(2183),r(2192),r(355)],void 0===(a=function(e,t,r,n,a){function i(e){if("function"===e.parseTree.type){if(0===e.parseTree.args.value.length)return{name:e.parseTree.name,expr:null};if(e.parseTree.args.value.length>1)throw new Error("Statistic does not have 1 or 0 Parameters");var t=a.WhereClause.create(n.toWhereClauseFromTree(e.parseTree.args.value[0],r.FeatureServiceDatabaseType.Standardised,e.parameters),e.fieldsIndex);return{name:e.parseTree.name,expr:t}}return null}return function(){function e(){}return e.prototype.clone=function(){var t=new e;return t.field=this.field,t.tofieldname=this.tofieldname,t.typeofstat=this.typeofstat,t.workingexpr=this.workingexpr,t},e.parseStatField=function(t,r,n){var s=new e;s.field=t;var o=a.WhereClause.create(r,n),l=i(o);if(null===l)throw new Error("Invalid Statistic Function");var u=l.name.toUpperCase().trim();if("MIN"===u){if(s.typeofstat="MIN",s.workingexpr=l.expr,null===o)throw new Error("Invalid Statistic Function Parameters")}else if("MAX"===u){if(s.typeofstat="MAX",s.workingexpr=l.expr,null===o)throw new Error("Invalid Statistic Function Parameters")}else if("COUNT"===u)s.typeofstat="COUNT",s.workingexpr=l.expr;else if("STDEV"===u){if(s.typeofstat="STDEV",s.workingexpr=l.expr,null===o)throw new Error("Invalid Statistic Function Parameters")}else if("SUM"===u){if(s.typeofstat="SUM",s.workingexpr=l.expr,null===o)throw new Error("Invalid Statistic Function Parameters")}else if("MEAN"===u){if(s.typeofstat="MEAN",s.workingexpr=l.expr,null===o)throw new Error("Invalid Statistic Function Parameters")}else if("AVERAGE"===u){if(s.typeofstat="AVERAGE",s.workingexpr=l.expr,null===o)throw new Error("Invalid Statistic Function Parameters")}else{if("VARIANCE"!==u)throw new Error("Invalid Statistic Function");if(s.typeofstat="VARIANCE",s.workingexpr=l.expr,null===o)throw new Error("Invalid Statistic Function Parameters")}return s},e.prototype.toStatisticsName=function(){switch(this.typeofstat.toUpperCase()){case"MIN":return"min";case"MAX":return"max";case"SUM":return"sum";case"COUNT":return"count";case"VARIANCE":return"var";case"STDEV":return"stddev";case"MEAN":case"AVERAGE":return"avg";default:return"count"}},e}()}.apply(null,n))||(e.exports=a)}}]);