(function(){(this||window).webpackJsonp.registerAbsMids({"esri/layers/graphics/data/executeTileQuery":2282,"esri/views/2d/layers/features/support/TileUpdateQueue":2284,"esri/views/2d/layers/features/controllers/OnDemandController":2645,"esri/views/2d/layers/features/support/DataTile":2647,"esri/views/2d/layers/features/support/DataTileFeaturesIndex":2648,"esri/core/SetPool":2649,"esri/views/support/OrderedQueueProcessor":2650})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[79],{2282:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(4),r(9),r(11),r(116),r(44),r(74),r(811),r(361)],void 0===(n=function(e,t,r,i,n,s,o,u,a,l){function d(e,t,r,i,n,s,o,u){o&&!s?i.forEachInBounds(n,function(i){if(!t.has(i.objectId)){var n=l.getCentroid(r,i,u),s=i.attributes;n&&(t.add(i.objectId),e.push(new a.Feature(s,i.localId,null,n)))}}):s&&!o?i.forEachInBounds(n,function(i){if(!t.has(i.objectId)){var n=i.attributes,s=l.getGeometry(r,i,0,u);s&&(t.add(i.objectId),e.push(new a.Feature(n,i.localId,s,null)))}}):i.forEachInBounds(n,function(i){if(!t.has(i.objectId)){var n=i.attributes,s=l.getGeometry(r,i,0,u),o=l.getCentroid(r,i,u);s&&o&&(t.add(i.objectId),e.push(new a.Feature(n,i.localId,s,o)))}})}Object.defineProperty(t,"__esModule",{value:!0}),t.executeTileQueryForIds=function(e,t,r){var i=r.pixelBuffer*t.resolution,n=o.pad(t.bounds,i,o.create()),s=[];return e.featureStore.forEachInBounds(n,function(t){return s.push(e.featureAdapter.getObjectId(t))}),s},t.executeTileQuery=function(e,t,r){var i=r.returnGeometry,n=r.returnCentroid,a=r.pixelBuffer,l=new s.default,h=[],c=a*t.resolution,f=o.pad(t.bounds,c,o.create());if(d(h,l,e,e.featureStore,f,i,n,{originPosition:"upperLeft",scale:[t.resolution,t.resolution],translate:[t.bounds[0],t.bounds[3]]}),"esriGeometryPoint"===e.geometryType||n){var p=u.getInfo(e.spatialReference);if(p){var y=p.valid,_=y[0],g=y[1];if(f[0]<_){var v=o.fromValues(g-c,f[1],g,f[3]);d(h,l,e,e.featureStore,v,i,n,{originPosition:"upperLeft",scale:[t.resolution,t.resolution],translate:[g,t.bounds[3]]})}if(f[2]>g){var b=o.fromValues(_,f[1],_+c,f[3]);d(h,l,e,e.featureStore,b,i,n,{originPosition:"upperLeft",scale:[t.resolution,t.resolution],translate:[_-g+t.bounds[0],t.bounds[3]]})}}}return h.sort(function(t,r){return t.attributes[e.objectIdField]-r.attributes[e.objectIdField]}),{features:h,objectIds:l}}}.apply(null,i))||(e.exports=n)},2284:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1),r(0),r(9),r(11),r(8),r(7),r(60),r(2),r(45),r(820)],void 0===(n=function(e,t,r,i,n,s,o,u,a,l,d,h){Object.defineProperty(t,"__esModule",{value:!0});var c=[0,0],f=function(e){function t(t){var r=e.call(this,t)||this;return r._queue=new Map,r._isPaused=!1,r._scheduledNextHandle=null,r._timestamp=Date.now(),r.tileInfoView=null,r._next=r._next.bind(r),r._finalize=r._finalize.bind(r),r}return r(t,e),Object.defineProperty(t.prototype,"length",{get:function(){return this._queue.size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return this._queue.size>0||null!=this._onGoingTile},enumerable:!0,configurable:!0}),t.prototype.abort=function(e){this._onGoingTile&&this._onGoingTile.tileId===e&&(this._onGoingTile.abortController.abort(),this._onGoingTile=null),this._queue.delete(e),this._scheduleNext(),this.notifyChange("updating")},t.prototype.clear=function(){this._queue.clear(),this._onGoingTile&&(this._onGoingTile.abortController.abort(),this._onGoingTile=null),this._cancelNext(),this.notifyChange("updating")},t.prototype.has=function(e){return this._queue.has(e)},t.prototype.isOngoing=function(e){return this._onGoingTile&&this._onGoingTile.tileId===e},t.prototype.pause=function(){this._isPaused||(this._isPaused=!0,this._cancelNext())},t.prototype.push=function(e,t){if(!this._queue.has(e)){var r=u.createAbortController();this._queue.set(e,{tileId:e,key:h.TileKey.pool.acquire(e),timestamp:t||this._timestamp,abortController:r}),this._scheduleNext(),this.notifyChange("updating")}},t.prototype.refresh=function(){this._timestamp=Date.now(),this.reset()},t.prototype.reset=function(){var e=this._onGoingTile;if(e){var t=e.tileId;this.push(t,this._timestamp)}this.notifyChange("updating")},t.prototype.resume=function(){this._isPaused&&(this._isPaused=!1,this._scheduleNext()),this.notifyChange("updating")},t.prototype._finalize=function(){this._onGoingTile=null,this.notifyChange("updating"),this._scheduleNext()},t.prototype._cancelNext=function(){this._scheduledNextHandle&&(this._scheduledNextHandle.remove(),this._scheduledNextHandle=null)},t.prototype._scheduleNext=function(){this._isPaused||this._scheduledNextHandle||0===this._queue.size||null!=this._onGoingTile||(this._scheduledNextHandle=a.schedule(this._next))},t.prototype._next=function(){return s(this,void 0,void 0,function(){var e,t,r,i,s;return n(this,function(n){switch(n.label){case 0:if(null==this._scheduledNextHandle||0===this._queue.size||this._onGoingTile)return this._scheduledNextHandle=null,[2];if(this._scheduledNextHandle=null,e=this._peek(),t=e.abortController.signal,r=e.tileId,i=e.key,h.TileKey.pool.release(i),this._queue.delete(r),this._onGoingTile=e,s=this.process(r,this._timestamp,{signal:t}),this.notifyChange("updating"),!function(e){return e&&"function"==typeof e.then}(s))return[3,4];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,s];case 2:return n.sent(),[3,4];case 3:return n.sent(),[3,4];case 4:return this._finalize(),[2]}})})},t.prototype._peek=function(){var e=this;if(!this.state)throw new Error("state not set");var t=this.tileInfoView,r=this.state.center,i=Number.NEGATIVE_INFINITY,n=Number.POSITIVE_INFINITY,s=null;return this._queue.forEach(function(o,u){t.getTileCoords(c,o.key);var a=e._timestamp-o.timestamp;if(isNaN(a))(l=d.vec2.distance(c,r))<n&&(n=l,s=o);else if(a===i){var l;(l=d.vec2.distance(c,r))<n&&(n=l,s=o)}else a>i&&(i=a,n=Number.POSITIVE_INFINITY,s=o)}),s},i([l.property({readOnly:!0})],t.prototype,"length",null),i([l.property({constructOnly:!0})],t.prototype,"process",void 0),i([l.property()],t.prototype,"state",void 0),i([l.property({constructOnly:!0})],t.prototype,"tileInfoView",void 0),i([l.property({readOnly:!0})],t.prototype,"updating",null),i([l.subclass("esri.views.2d.layers.features.support.TileUpdateQueue")],t)}(l.declared(o));t.default=f}.apply(null,i))||(e.exports=n)},2645:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1),r(0),r(4),r(9),r(11),r(116),r(47),r(15),r(26),r(13),r(7),r(2),r(30),r(183),r(2282),r(484),r(2118),r(2283),r(2647),r(2648),r(2208),r(2284),r(821),r(2650)],void 0===(n=function(e,t,r,i,n,s,o,u,a,l,d,h,c,f,p,y,_,g,v,b,T,I,m,x,F,w){Object.defineProperty(t,"__esModule",{value:!0});var E=h.getLogger("esri.views.2d.layers.features.controllers.OnDemandController"),S=d("esri-featurelayer-webgl"),Q=d("esri-mobile"),q={maxDrillLevel:S&&"object"==typeof S&&null!=S.maxDrillLevel?S.maxDrillLevel:Q?1:4,maxRecordCountFactor:S&&"object"==typeof S&&null!=S.maxRecordCountFactor?S.maxRecordCountFactor:Q?1:3,enablePBFQuery:!S||"object"!=typeof S||null==S.enablePBFQuery||S.enablePBFQuery},j=new u.default,C=[],P=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="on-demand",t._queryInfoHash=null,t._dataTileIndex=new I.default,t._editsQueue=new w.OrderedQueueProcessor({concurrency:1,process:function(e,r){return t._processEditsEvent(e,r)}}),t._featuresInFlight=new Map,t}return r(t,e),t.prototype.initialize=function(){var e=this;this._set("queryEngine",this._createQueryEngine()),this._set("featureStore",this.queryEngine.featureStore),this._dataTileIndex.featureStore=this.featureStore,this._dataTileIndex.forEach(function(e){return e.done=!1}),this._fetchQueue=new F({concurrency:10,strategy:"center-first",tileInfoView:this.tileStore.tileScheme,process:function(t,r){return e._fetchTile(t,e.queryInfo,r)}}),this._patchQueue=new F({concurrency:10,strategy:"center-first",tileInfoView:this.tileStore.tileScheme,process:function(t,r){return e._fetchTile(t.dataTile,t.queryInfo,r)}}),this._updateQueue=new x.default({tileInfoView:this.tileStore.tileScheme,process:function(t,r,i){return e._updateTile(t,r,i)}})},t.prototype.destroy=function(){this._fetchQueue.clear(),this._patchQueue.clear(),this._updateQueue.clear(),this._editsQueue.destroy(),this.queryEngine.destroy()},Object.defineProperty(t.prototype,"updating",{get:function(){return this._fetchQueue.updating||this._updateQueue.updating},enumerable:!0,configurable:!0}),t.prototype.update=function(e,t){return o(this,void 0,void 0,function(){var r,i,n=this;return s(this,function(s){switch(s.label){case 0:return this.validateConfig(e,t),r=this.renderer.getAttributeHash(),i=e.availableFields.filter(function(e){return-1===n.availableFields.indexOf(e)}),this._set("config",e),[4,this.updatePixelBuffer()];case 1:return s.sent(),t?r===this.renderer.getAttributeHash()?[3,3]:[4,this.attributeStore.setAttributeBindings(this.renderer,this.arcadeInfo)]:[3,5];case 2:s.sent(),s.label=3;case 3:return[4,this.attributeStore.updateFilters(this)];case 4:return s.sent(),this.refresh(),[2];case 5:return i.length?[4,this._handleAttributeChange(i)]:[3,7];case 6:s.sent(),s.label=7;case 7:return"heatmap"===this.renderer.type?[2]:r===this.renderer.getAttributeHash()?[3,9]:[4,this.attributeStore.setAttributeBindings(this.renderer,this.arcadeInfo)];case 8:s.sent(),this.featureStore.forEach(function(e){return n.attributeStore.setAttributeData(e.localId,e,n.geometryInfo,n.viewParams)}),s.label=9;case 9:return[4,this.attributeStore.updateFilters(this)];case 10:return s.sent(),[4,this.attributeStore.sendUpdates()];case 11:return s.sent(),[2]}})})},t.prototype.invalidate=function(){for(var e=0,t=this.tileStore.tiles;e<t.length;e++){var r=t[e];this._updateQueue.push(r.id,Date.now())}},t.prototype.onEdits=function(e){var t=this;this._fetchQueue.pause(),this._fetchQueue.reset(),this._editsQueue.push(e).then(function(){0===t._editsQueue.length&&t._fetchQueue.resume()})},t.prototype.queryFeatures=function(e){return a.safeCast(this.queryEngine.executeQuery(e))},t.prototype.queryFeatureCount=function(e){return a.safeCast(this.queryEngine.executeQueryForCount(e))},t.prototype.queryObjectIds=function(e){return a.safeCast(this.queryEngine.executeQueryForIds(e))},t.prototype.queryExtent=function(e){return a.safeCast(this.queryEngine.executeQueryForExtent(e))},t.prototype.redraw=function(){this._updateQueue.pause(),this._manageTiles(this.tileStore.tiles),this._updateQueue.resume()},t.prototype.refresh=function(){this._queryInfoHash=Math.random().toString(),this.queryEngine&&this.queryEngine.destroy(),this.featureStore&&this.featureStore.clear(),this._set("queryEngine",this._createQueryEngine()),this._set("featureStore",this.queryEngine.featureStore),this._dataTileIndex.featureStore=this.featureStore,this._dataTileIndex.forEach(function(e){return e.done=!1}),this._editsQueue.pause(),this._fetchQueue.pause(),this._updateQueue.pause(),this._editsQueue.clear(),this._fetchQueue.clear(),this._updateQueue.clear(),this._manageTiles(this.tileStore.tiles),this._fetchQueue.resume(),this._editsQueue.resume(),this._updateQueue.resume()},t.prototype.setViewState=function(e){var t=this,r=this.viewState&&this.viewState.scale;this.inherited(arguments),this._fetchQueue.state=e,this._updateQueue.state=e,r!==this.viewState.scale&&this.attributeStore.hasScaleExpr&&(this.featureStore.forEach(function(e){return t.attributeStore.setAttributeData(e.localId,e,t.geometryInfo,t.viewParams)}),this.attributeStore.sendUpdates())},t.prototype.onTileUpdate=function(e){this._manageTiles(e.added,e.removed)},t.prototype.onFeatureAdd=function(e){if(this._featuresInFlight.has(e.objectId)){var t=this._featuresInFlight.get(e.objectId).attributes;e.attributes=n({},t,e.attributes),this._featuresInFlight.delete(e.objectId)}e.localId=this.attributeStore.createLocalId(e.objectId),this.attributeStore.setAttributeData(e.localId,e,this.geometryInfo,this.viewParams)},t.prototype._handleAttributeChange=function(e){return o(this,void 0,void 0,function(){return s(this,function(t){switch(t.label){case 0:return[4,this._fetchChangedFields(e)];case 1:return t.sent(),[2]}})})},t.prototype._fetchChangedTileFields=function(e,t){return o(this,void 0,void 0,function(){var r;return s(this,function(i){return(r=this._dataTileIndex.get(e.id))?!1?[2,this._fetchChangedTileFieldsPaged(r,t)]:[2,this._fetchChangedTileFieldsDrill(r,t)]:[2]})})},t.prototype._fetchChangedTileFieldsDrill=function(e,t,r){return void 0===r&&(r=0),o(this,void 0,void 0,function(){var i,o,u,a,l,d,h,f,p,y,_=this;return s(this,function(s){switch(s.label){case 0:return i=n({},this.queryInfo,{returnGeometry:!1,returnCentroid:!1,outFields:t.concat([this.service.objectIdField])}),e.returnExceeded=e.returnExceeded||r>=q.maxDrillLevel,o=e.key,u={key:o,dataTile:e,queryInfo:i},[4,this._patchQueue.push(u)];case 1:return(a=s.sent()).exceededTransferLimit&&r<q.maxDrillLevel?(l=e.tile.createChildTiles(),d=l.map(function(t){var r=new T.default;return r.tile=t,r.displayTile=e.displayTile,r}),[4,c.all(d.map(function(e){return _._fetchChangedTileFieldsDrill(e,t,r+1)}))]):[3,3];case 2:return s.sent(),[2];case 3:for(h=0,f=a.features;h<f.length;h++)p=f[h],this.featureStore.has(p.objectId)?(y=this.featureStore.getFeature(p.objectId)).attributes=n({},y.attributes,p.attributes):this._featuresInFlight.set(p.objectId,p);return[2]}})})},t.prototype._fetchChangedTileFieldsPaged=function(e,t,r){return void 0===r&&(r=0),o(this,void 0,void 0,function(){var i,o,u,a,l,d,h,c,f,p,y;return s(this,function(s){switch(s.label){case 0:return i=this.service.capabilities.query.supportsMaxRecordCountFactor,o=this.service.tileMaxRecordCount,u=o*(i?1:q.maxRecordCountFactor),a=n({},this.queryInfo,{returnGeometry:!1,returnCentroid:!1,outFields:t.concat([this.service.objectIdField]),resultOffset:r*u,num:u}),e.returnExceeded=!0,l=e.key,d={key:l,dataTile:e,queryInfo:a},[4,this._patchQueue.push(d)];case 1:for(h=s.sent(),c=0,f=h.features;c<f.length;c++)p=f[c],this.featureStore.has(p.objectId)?(y=this.featureStore.getFeature(p.objectId)).attributes=n({},y.attributes,p.attributes):this._featuresInFlight.set(p.objectId,p);return h.exceededTransferLimit?[2,this._fetchChangedTileFieldsPaged(e,t,r+1)]:[2]}})})},t.prototype._fetchChangedFields=function(e){return o(this,void 0,void 0,function(){var t,r,i=this;return s(this,function(n){switch(n.label){case 0:return t=this.tileStore.tiles,r=t.map(function(t){return i._fetchChangedTileFields(t,e)}),[4,c.all(r)];case 1:return n.sent(),[2]}})})},t.prototype._manageTiles=function(e,t){void 0===t&&(t=null);for(var r=this._dataTileIndex,i=this._fetchQueue,n=this._updateQueue,s="esriGeometryPoint"===this.service.geometryType,o=this,u=0,a=e;u<a.length;u++){!function(e){var t=r.get(e.id);t?(t.displayTile=e,s?r.forEach(function(r){m.isChildOf(r,t)&&(r.displayTile=e)}):t.done=!1):((t=new T.default).tile=e.clone(),t.displayTile=e,r.add(t)),o._processDataTile(t)}(h=a[u])}if(t)for(var l=0,d=t;l<d.length;l++){var h=d[l];j.add(h),n.abort(h.id)}r.forEach(function(e){j.has(e.displayTile)&&C.push(e)});for(var c=0,f=C;c<f.length;c++){var p=f[c];i.abort(p.id),r.delete(p)}C.length=0,j.clear()},t.prototype._processDataTile=function(e){var t=this,r=e.displayTile,i=e.key,n=this._dataTileIndex,s=this._fetchQueue,o=i.id,u=this._queryInfoHash,a=i.level-r.key.level>=q.maxDrillLevel;if(n.add(e),e.done||s.has(o)){if(e.queryInfoHash!==u||e.returnExceeded!==a)if(e.done)e.done=!1;else{if(!s.isOngoing(o))return e.queryInfoHash=u,void(e.returnExceeded=a);s.abort(o)}}else e.queryInfoHash=u,e.returnExceeded=a;e.done?this._invalidateTile(e.displayTile):s.has(o)||s.push(e).then(function(r){return t._handleResponse(e,r)}).catch(function(t){c.isAbortError(t)||E.error(new l("featurelayer-controller:tile-error","Encountered an error when handling tile response",t)),e.done=!0})},t.prototype._handleResponse=function(e,t){if(e.done=!0,y.hydrateOptimizedFeatureSet(t),t.exceededTransferLimit)if(e.returnExceeded)this._dataTileIndex.setTileFeatures(e,t.features),this._deleteChildrenDataTiles(e);else for(var r=0,i=e.tile.createChildTiles();r<i.length;r++){var n=i[r],s=new T.default;s.tile=n,s.displayTile=e.displayTile,this._processDataTile(s)}else this._dataTileIndex.setTileFeatures(e,t.features),this._deleteChildrenDataTiles(e);this._invalidateTile(e.tile),this.attributeStore.sendUpdates()},t.prototype._deleteChildrenDataTiles=function(e){this._dataTileIndex.forEach(function(t){m.isChildOf(t,e)&&C.push(t)});for(var t=0,r=C;t<r.length;t++){var i=r[t];this._fetchQueue.abort(i.id),this._dataTileIndex.delete(i)}C.length=0},t.prototype._fetchTile=function(e,t,r){return o(this,void 0,void 0,function(){var i,n,o,u,a,l,d,h,c,f=this;return s(this,function(s){return i=new p({xmin:e.bounds[0],ymin:e.bounds[1],xmax:e.bounds[2],ymax:e.bounds[3],spatialReference:this.spatialReference}),n="esriGeometryPoint"===this.service.geometryType?e.tile:e.displayTile,o=n.extent,u=n.resolution,a=e.returnExceeded,l=this._createQuery(i,o,u,t,q.maxRecordCountFactor,a),d=this.service.source,h=q.enablePBFQuery&&this.service.capabilities.query.supportsFormatPBF,c=r.signal,[2,h?g.executeQueryPBF(d,l,{type:"optimized"},{signal:c}).then(function(e){return e.data}):g.executeQuery(d,l,{signal:c}).then(function(e){return y.convertFromFeatureSet(e.data,f.service.objectIdField)})]})})},t.prototype._invalidateTile=function(e){for(var t=this._pixelBuffer,r=this._updateQueue,i=0,n=this.tileStore.intersections(e,t);i<n.length;i++){var s=n[i].tile;r.push(s.id,s.updateTimestamp)}},t.prototype._updateTile=function(e,t,r){var i=this,n=this.tileStore.get(e),s=this.queryInfo,o=s.returnCentroid,u=s.returnGeometry,a={pixelBuffer:this._pixelBuffer,returnGeometry:u,returnCentroid:o},l=_.executeTileQuery(this.queryEngine,n,a),d=l.features,h=l.objectIds,f={geometryType:this.service.geometryType,features:d,fields:this.service.fields,objectIdFieldName:this.service.objectIdField,transform:n.transform};return this._applyProcessing(f,r).then(function(e){var s=[],o=!0;return i._dataTileIndex.forEach(function(e){n.id!==e.id&&m.isChildOf(e,n)&&o&&!e.done&&(o=!1)}),o&&n&&n.objectIds.forEach(function(e){if(!h.has(e)){var t=i.attributeStore.getLocalId(e);s.push(t)}}),h.forEach(function(e){n.objectIds.add(e)}),n.updateTimestamp=t,i.attributeStore.sendUpdates(),i.processor.onTileData(n,{clear:!0,addOrUpdate:e.features,remove:s,transformParams:v.Utils.getTransformParams(e)},r).catch(function(e){c.isAbortError(e)||E.error("update-tile",e)})})},t.prototype._processEditsEvent=function(e,t){return o(this,void 0,void 0,function(){var r,i,o,u,a,l,d,h=this;return s(this,function(s){switch(s.label){case 0:return r=function(e){return e.objectId},i=e.addedFeatures.concat(e.updatedFeatures).map(r),o=e.deletedFeatures.map(r),u=this._createTempQueryEngine(),a=this._createObjectIdsQuery(i),i.length?[4,g.executeQuery(this.service.source,a)]:[3,2];case 1:l=s.sent().data,d=y.convertFromFeatureSet(l,this.service.objectIdField).features,this._dataTileIndex.addOrUpdateFeatures(d),u.featureStore.addMany(d),s.label=2;case 2:return this._dataTileIndex.deleteFeaturesById(o),this.attributeStore.sendUpdates(),this.tileStore.tiles.map(function(e){var r=_.executeTileQuery(u,e,n({},h.queryInfo,{pixelBuffer:h._pixelBuffer})).features,s=o.concat(i).map(function(e){return h.attributeStore.getLocalId(e)}),a={transform:e.transform,hasZ:!1,hasM:!1};return h.processor.onTileData(e,{addOrUpdate:r,remove:s,transformParams:a},{signal:t}).catch(function(e){c.isAbortError(e)||E.error("update-tile",e)})}),u.destroy(),[2]}})})},t.prototype._createObjectIdsQuery=function(e){var t=this._createDefaultQuery(this.queryInfo);return t.objectIds=e,t},i([f.property()],t.prototype,"_fetchQueue",void 0),i([f.property()],t.prototype,"_patchQueue",void 0),i([f.property()],t.prototype,"_updateQueue",void 0),i([f.property({readOnly:!0})],t.prototype,"queryEngine",void 0),i([f.property({readOnly:!0})],t.prototype,"featureStore",void 0),i([f.property({dependsOn:["_fetchQueue.updating","_updateQueue.updating"]})],t.prototype,"updating",null),i([f.subclass("esri.views.2d.layers.features.controllers.OnDemandController")],t)}(f.declared(b.default));t.default=P}.apply(null,i))||(e.exports=n)},2647:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this.displayTile=null,this.tile=null,this.done=!1,this.queryInfoHash=null,this.returnExceeded=!1}return Object.defineProperty(e.prototype,"key",{get:function(){return this.tile.key},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.tile.id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bounds",{get:function(){return this.tile.bounds},enumerable:!0,configurable:!0}),e}();t.default=r}.apply(null,i))||(e.exports=n)},2648:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(231),r(116),r(2649),r(823),r(2208)],void 0===(n=function(e,t,r,i,n,s,o){Object.defineProperty(t,"__esModule",{value:!0});var u=[],a=new i.default,l=function(){function e(){this._tileById=new r.default,this._tilesToFeatures=new r.default,this._featureToTiles=new r.default}return e.prototype.destroy=function(){this.clear()},e.prototype.add=function(e){var t=this;if(!this.has(e.id)){var r=e;this._tileById.set(r.id,r),this._tilesToFeatures.set(r,n.default.acquire()),this._tilesToFeatures.forEach(function(e,i){r!==i&&(o.isParentOf(r,i)?e.forEach(function(e){t._link(r,e)}):o.isChildOf(r,i)&&t.featureStore.forEachInBounds(r.bounds,function(i){e.has(i.objectId)&&t._link(r,i.objectId)}))})}},e.prototype.clear=function(){this._tilesToFeatures.forEach(function(e){return n.default.release(e)}),this._tilesToFeatures.clear(),this._featureToTiles.forEach(function(e){return n.default.release(e)}),this._featureToTiles.clear(),this._tileById.clear()},e.prototype.delete=function(e){var t=this,r=this.get(e.id);u.length=0,this._tilesToFeatures.get(r).forEach(function(e){var i=t._featureToTiles.get(e);i.has(r)&&1===i.size?u.push(e):t._unlink(r,e)});for(var i=0,n=u;i<n.length;i++){var s=n[i];this._unlink(r,s)}this.featureStore.removeManyById(u),this._tilesToFeatures.delete(r),this._tileById.delete(r.id),u.length=0},e.prototype.forEach=function(e,t){return this._tileById.forEach(e,t)},e.prototype.get=function(e){return this._tileById.get(e)},e.prototype.has=function(e){return this._tileById.has(e)},e.prototype.setTileFeatures=function(e,t){var r=this,i=this.get(e.id);this._tilesToFeatures.has(i)||(this._tileById.set(i.id,i),this._tilesToFeatures.set(i,n.default.acquire()));for(var s=0,o=t;s<o.length;s++){var l=o[s];a.add(l.objectId)}u.length=0,this._tilesToFeatures.get(i).forEach(function(e){if(!a.has(e)){var t=r._featureToTiles.get(e);t.has(i)&&1===t.size?u.push(e):r._unlink(i,e)}});for(var d=0,h=u;d<h.length;d++){var c=h[d];this._unlink(i,c)}this.featureStore.removeManyById(u),this.featureStore.addMany(t),a.forEach(function(e){r._link(i,e)}),a.clear(),u.length=0},e.prototype.addOrUpdateFeatures=function(e){for(var t=this,r=new i.default,n=new s.default({geometryType:this.featureStore.geometryType,hasM:this.featureStore.hasM,hasZ:this.featureStore.hasZ},null),o=0,u=this.deleteFeaturesById(e.map(function(e){return e.objectId}));o<u.length;o++){var a=u[o];r.add(a)}n.addMany(e),this._tileById.forEach(function(e){n.forEachInBounds(e.bounds,function(i){t._link(e,i.objectId),r.add(e)})}),this.featureStore.addMany(e);var l=[];return r.forEach(function(e){return l.push(e)}),l},e.prototype.deleteFeaturesById=function(e){for(var t=this,r=new i.default,s=this,o=0,u=e;o<u.length;o++){!function(e){var i=s._featureToTiles.get(e);i&&(i.forEach(function(i){r.add(i),t._tilesToFeatures.get(i).delete(e)}),n.default.release(i),s._featureToTiles.delete(e))}(u[o])}this.featureStore.removeManyById(e);var a=[];return r.forEach(function(e){return a.push(e)}),a},e.prototype._link=function(e,t){this._featureToTiles.get(t)||this._featureToTiles.set(t,n.default.acquire()),this._featureToTiles.get(t).add(e),this._tilesToFeatures.get(e).add(t)},e.prototype._unlink=function(e,t){this._featureToTiles.get(t).delete(e),this._tilesToFeatures.get(e).delete(t),0===this._featureToTiles.get(t).size&&(n.default.release(this._featureToTiles.get(t)),this._featureToTiles.delete(t))},e}();t.default=l}.apply(null,i))||(e.exports=n)},2649:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(116)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this._pool=[],this._set=new r.default}return e.prototype.acquire=function(){if(0===this._pool.length)return new r.default;var e=this._pool.pop();return this._set.delete(e),e},e.prototype.release=function(e){e&&!this._set.has(e)&&(e.clear(),this._pool.length<5e4&&(this._pool.push(e),this._set.add(e)))},e.acquire=function(){return n.acquire()},e.release=function(e){return n.release(e)},e}();t.default=i;var n=new i}.apply(null,i))||(e.exports=n)},2650:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(9),r(11),r(7),r(836)],void 0===(n=function(e,t,r,i,n,s){Object.defineProperty(t,"__esModule",{value:!0});var o=function(){return function(e,t){this.item=e,this.promise=t,this.deferred=n.createDeferred(),this.status=0,this.value=null,this.error=null}}(),u=function(){function e(e){this._queue=[],this._queueMap=new Map,this._processor=new s.QueueProcessor(e)}return e.prototype.destroy=function(){this.clear(),this._processor.destroy()},Object.defineProperty(e.prototype,"length",{get:function(){return this._queue.length},enumerable:!0,configurable:!0}),e.prototype.abort=function(e){var t=this._queueMap.get(e);t&&(0===t.status?this._processor.abort(e):(t.status=1,t.error=n.createAbortError()))},e.prototype.clear=function(){this._queue.length=0,this._queueMap.clear(),this._processor.clear()},e.prototype.get=function(e){return i(this,void 0,void 0,function(){var t;return r(this,function(r){return[2,(t=this._queueMap.get(e))?t.promise:void 0]})})},e.prototype.isOngoing=function(e){return this._processor.isOngoing(e)},e.prototype.has=function(e){return this._queueMap.has(e)},e.prototype.pause=function(){this._processor.pause()},e.prototype.resume=function(){this._processor.resume()},e.prototype.reset=function(){this._processor.reset()},e.prototype.push=function(e){return i(this,void 0,void 0,function(){var t,i,n=this;return r(this,function(r){return t=this._processor.push(e),i=new o(e,t),this._queue.push(i),this._queueMap.set(e,i),t.then(function(e){return n._success(i,e)},function(e){return n._error(i,e)}),[2,i.deferred.promise]})})},e.prototype._success=function(e,t){e.status=2,e.value=t,this._drain()},e.prototype._error=function(e,t){e.status=1,e.error=t,this._drain()},e.prototype._drain=function(){for(;;){var e=this._queue[0];if(!e||0===e.status)return;this._queue.shift(),this._queueMap.delete(e.item),2===e.status?e.deferred.resolve(e.value):e.deferred.reject(e.error)}},e}();t.OrderedQueueProcessor=u}.apply(null,i))||(e.exports=n)}}]);