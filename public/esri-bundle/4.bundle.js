(function(){(this||window).webpackJsonp.registerAbsMids({"esri/views/2d/layers/features/support/Tile":2208,"esri/views/2d/layers/graphics/GraphicsView2D":2219,"esri/views/2d/layers/features/tileRenderers/support/visualVariablesUtils":2220,"esri/views/2d/layers/graphics/graphicsUtils":2221,"esri/views/2d/layers/features/support/TileStore":2245,"esri/core/MapPool":2266,"esri/views/2d/layers/features/support/AttributeStore":2267,"esri/views/layers/GraphicsView":2268,"esri/views/2d/layers/graphics/GraphicContainer":2501,"esri/views/2d/layers/graphics/GraphicProcessingQueue":2502,"esri/views/2d/layers/graphics/GraphicStore":2503,"esri/views/2d/layers/graphics/GraphicStoreItem":2504})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{2208:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(116),i(236),i(30),i(44),i(814),i(202)],void 0===(n=function(e,t,i,r,n,a,s,o){function l(e,t){var i=e.bounds,r=t.bounds;return e.key.id!==t.key.id&&e.key.world===t.key.world&&i[0]<=r[0]&&i[1]<=r[1]&&i[2]>=r[2]&&i[3]>=r[3]}Object.defineProperty(t,"__esModule",{value:!0}),t.isParentOf=l,t.isChildOf=function(e,t){return l(t,e)};var u=function(){function e(e,t){this.bounds=a.create(),this.key=new o(0,0,0,0),this.objectIds=new i.default,this.key.set(t);var r=e.getLODInfoAt(this.key);this.tileInfoView=e,this.tileInfoView.getTileBounds(this.bounds,this.key,!0),this.resolution=r.resolution,this.scale=r.scale,this.level=r.level,this.needsClear=!0}return Object.defineProperty(e.prototype,"id",{get:function(){return this.key.id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"extent",{get:function(){return n.fromBounds(this.bounds,this.tileInfoView.tileInfo.spatialReference)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"transform",{get:function(){return{originPosition:"upperLeft",scale:[this.resolution,this.resolution],translate:[this.bounds[0],this.bounds[3]]}},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this.tileInfoView,this.id)},e.prototype.createChildTiles=function(){for(var t=this.key.getChildKeys(),i=r.acquire(),n=0;n<t.length;n++)i[n]=new e(this.tileInfoView,t[n]);return i},e.prototype.getQuantizationParameters=function(){return s.default.fromJSON({mode:"view",originPosition:"upperLeft",tolerance:this.resolution,extent:{xmin:this.bounds[0],ymin:this.bounds[1],xmax:this.bounds[2],ymax:this.bounds[3],spatialReference:this.tileInfoView.tileInfo.spatialReference}})},e}();t.Tile=u,t.default=u}.apply(null,r))||(e.exports=n)},2219:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(1),i(0),i(4),i(9),i(11),i(47),i(353),i(284),i(2266),i(14),i(7),i(7),i(20),i(2),i(63),i(44),i(49),i(74),i(245),i(496),i(813),i(2118),i(2267),i(2245),i(2501),i(2502),i(2503),i(2221),i(2268)],void 0===(n=function(e,t,i,r,n,a,s,o,l,u,h,c,p,d,f,g,y,v,_,m,b,x,w,S,M,I,T,G,z,P,C){function A(e,t,i){if(i.has(e))return i.get(e);var r={tile:t,addedOrModified:[],removed:[]};return i.set(e,r),r}Object.defineProperty(t,"__esModule",{value:!0});var k=function(e){function t(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var r=e.apply(this,t)||this;return r._tiles=new Map,r._graphicStoreUpdate=!1,r._graphicsSet=new Set,r._matcher=p.resolve(null),r._tileUpdateSet=new Set,r._tilesToUpdate=new Map,r._graphicIdToAbortController=new Map,r._pendingUpdates=0,r._attached=!1,r.lastUpdateId=-1,r.updateRequested=!1,r.graphicUpdateHandler=r.graphicUpdateHandler.bind(r),r.addOrUpdateGraphic=r.addOrUpdateGraphic.bind(r),r._processAnalyzedGraphics=r._processAnalyzedGraphics.bind(r),r._graphicsChangeHandler=r._graphicsChangeHandler.bind(r),r}return i(t,e),t.prototype.initialize=function(){var e=this;this._tileStore=new I.default(this.view.featuresTilingScheme),this.container=new T.default({tileInfoView:this.view.featuresTilingScheme,localToGlobalId:function(t){return e._attributeStore.getFeatureId(t)}}),this._attributeStore=new M.default({type:"local",initialize:function(t){return p.resolve(e.container.attributeView.initialize(t))},update:function(t){return o.safeCast(e.container.attributeView.requestUpdate(t))},render:function(){return e.container.requestRender()}});this._graphicStore=new z.default(this.view.featuresTilingScheme,this.view.state.scale,this.uid,this.graphics,function(t){var i=e._attributeStore.createLocalId(t.uid);e._attributeStore.setData(i,0,0,t.visible?1:0)},function(t){e._attributeStore.freeLocalId(t.uid)}),this._graphicProcessingQueue=new G.default({process:this.addOrUpdateGraphic});var t=new S.WGLTemplateStore(this.container.getMaterialItems),i=this._tileStore.tileScheme.tileInfo;this.renderer&&(this._matcher=S.createMatcher(this.renderer,t,null)),this._meshFactory=new S.WGLMeshFactory(null,this.uid,null,t,null,i),this.watch("renderer",function(i){i&&(e._matcher=S.createMatcher(e.renderer,t,null))}),this._tileStore.on("update",this._onTileUpdate.bind(this)),this.container.on("attach",function(){e.graphics.items.length>0&&e._graphicsChangeHandler({target:e.graphics,added:e.graphics.items,removed:[],moved:[]}),e.handles.add(e.graphics.on("change",e._graphicsChangeHandler),"graphics"),e._attached=!0,e.notifyChange("updating")}),this.container.on("detach",function(){e._graphicProcessingQueue&&e._graphicProcessingQueue.clear()})},t.prototype.destroy=function(){this.container.dispose(),this._set("graphics",null),this._graphicProcessingQueue&&(this._graphicProcessingQueue.destroy(),this._graphicProcessingQueue=null),this._graphicStore.clear(),this._tileStore.destroy(),this._attributeStore=null},Object.defineProperty(t.prototype,"updating",{get:function(){return!this._attached||0!==this._pendingUpdates||this._graphicProcessingQueue.updating||this._tileUpdateSet.size>0||this._tilesToUpdate.size>0},enumerable:!0,configurable:!0}),t.prototype.install=function(e){e.addChild(this.container)},t.prototype.uninstall=function(e){e.removeChild(this.container)},t.prototype.hitTest=function(e,t){if(!this.view||!this.view.position)return p.resolve();var i=this.view.toMap(f.createScreenPoint(e,t));return this.searchFeatures(i).then(function(e){return e&&e.length?e[0]:null})},t.prototype.searchFeatures=function(e,t){var i=this;return void 0===t&&(t=2),p.create(function(r){r(i._graphicStore.hitTest(e.x,e.y,t,i.view.state.resolution,i.view.state.rotation))})},t.prototype.update=function(e){var t=e.state,i=this.view.featuresTilingScheme.getClosestInfoForScale(t.scale).level;this._graphicStore.updateLevel(i),this._tileStore.setViewState(t),this._graphicStoreUpdate=!0,this.updateRequested=!1},t.prototype.viewChange=function(){this.requestUpdate()},t.prototype.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate(this))},t.prototype.processUpdate=function(e){this.updateRequested&&(this.updateRequested=!1,this.update(e))},t.prototype.graphicUpdateHandler=function(e){var t=e.graphic,i=e.property,r=e.newValue,n=t;switch(i){case"attributes":break;case"geometry":case"symbol":this._graphicProcessingQueue.push(n,"update");break;case"visible":this._setVisible(n.uid,r),this._attributeStore.sendUpdates()}},t.prototype.highlight=function(e){return this.container.highlight(e)},t.prototype._getIntersectingTiles=function(e){var t=this._graphicStore.getBounds(e);return t&&0!==v.width(t)&&0!==v.height(t)?this._tileStore.boundsIntersections(t):[]},t.prototype._updateTile=function(e){var t=this,i=e.tile,r=this._getGraphicsData(i,e.addedOrModified);return o.safeCast(this._processGraphics(i.key,r)).then(function(r){return t._patchTile(i.key,{addOrUpdate:r,remove:e.removed}),r})},t.prototype._graphicsChangeHandler=function(e){var t=this;if(this._pendingUpdates++,this.notifyChange("updating"),!this._graphicStoreUpdate){var i=this.view.state,r=this.view.featuresTilingScheme.getClosestInfoForScale(i.scale).level;this._graphicStore.updateLevel(r),this._tileStore.setViewState(i)}for(var n=e.added,a=e.removed,s=e.moved,o=this._tilesToUpdate,l=[],u=new Array(n.length),h=0;h<n.length;h++){var c=n[h];u[h]=c,this._graphicsSet.add(c),l.push(this.addGraphic(c))}for(var d=0,f=a;d<f.length;d++){var g=f[d];this._abortProcessingGraphic(g.uid);for(var y=0,v=this._getIntersectingTiles(g);y<v.length;y++){var _=v[y];A(_.key.id,_,o).removed.push(this._attributeStore.getLocalId(g.uid))}this._graphicsSet.delete(g),this._graphicStore.remove(g)}for(var m=0,b=s;m<b.length;m++)for(var x=b[m],w=0,S=this._getIntersectingTiles(x);w<S.length;w++){_=S[w];A(_.key.id,_,o).addedOrModified.push(x)}p.all(l).then(function(){for(var e,i=0;i<u.length;i++){e=u[i];for(var r=0,n=t._getIntersectingTiles(e);r<n.length;r++){var a=n[r];A(a.key.id,a,o).addedOrModified.push(e)}}t._graphicStore.updateZ();var s=[];return o.forEach(function(e){return s.push(t._updateTile(e))}),p.all(s).then(function(){o.clear(),t._pendingUpdates--,t.notifyChange("updating")})}).catch(function(){o.clear(),t._pendingUpdates--,t.notifyChange("updating")})},t.prototype._getSymbolResources=function(e,t){return s(this,void 0,void 0,function(){var i,r,n,s,o,l,u,h;return a(this,function(a){switch(a.label){case 0:return this.container.attached?(i=c.isSome(e.symbol)?e.symbol:null)?[3,3]:this.renderer?[4,this.renderer.getSymbolAsync(e,{scale:this.view.scale})]:[3,2]:[2,p.resolve(null)];case 1:return i=a.sent(),[3,3];case 2:i=this._getNullSymbol(e),a.label=3;case 3:return[4,x.expandSymbol(i,x.constructUrlFn,t)];case 4:if(i=a.sent(),r=[],"text"===i.type){for(n=new Set,o=(s=i).text,l=0;l<o.length;l++)n.add(o.charCodeAt(l));u=[],n.forEach(function(e){return u.push(e)}),r.push({symbol:s.toJSON(),id:0,glyphIds:u})}else r.push({symbol:i.toJSON(),id:e.uid,glyphIds:null});return[4,this.container.getMaterialItems(r,t).then(function(e){return e&&e.length>0?e[0].mosaicItem:null})];case 5:return h=a.sent(),[2,{symbol:i,mosaicItem:h}]}})})},t.prototype._projectAndNormalizeGeometry=function(e){return s(this,void 0,void 0,function(){var t,i,r,n=this;return a(this,function(a){return c.isNone(e.geometry)?[2,p.resolve(null)]:(t=e.geometry,_.isPolygon(t)?(i=t.rings,t.rings=i):_.isPolyline(t)?(r=t.paths,t.paths=r):_.isExtent(t)&&(t=y.fromExtent(t)),[2,b.checkProjectionSupport(t.spatialReference,this.view.spatialReference).then(function(){var e=P.normalizeCentralMeridian(t),i=b.project(e,t.spatialReference,n.view.spatialReference);return P.ensureClosedRings(i),i})])})})},t.prototype._onTileUpdate=function(e){var t=m.getInfo(this.view.spatialReference);if(e.added&&e.added.length>0)for(var i=0,r=e.added;i<r.length;i++){var n=r[i];this._addNewTile(n,t)}if(e.removed&&e.removed.length>0)for(var a=0,s=e.removed;a<s.length;a++){var o=s[a];this._removeTile(o.key)}},t.prototype.addOrUpdateGraphic=function(e,t,i){return this._addOrUpdateGraphic(e,t,i)},t.prototype.addGraphic=function(e){var t=this;this._abortProcessingGraphic(e.uid);var i=d.createAbortController();this._graphicIdToAbortController.set(e.uid,i);var r={signal:i.signal};return this._addOrUpdateGraphic(e,"add",r).then(function(){t._graphicIdToAbortController.delete(e.uid)}).catch(function(i){if(t._graphicIdToAbortController.delete(e.uid),!p.isAbortError(i))throw i})},t.prototype._addOrUpdateGraphic=function(e,t,i){var r=this,n=this._projectAndNormalizeGeometry(e),a=this._getSymbolResources(e,i);return p.all([n,a]).then(function(n){var a=n[0],s=n[1];return"add"===t?r._addProjectedGraphic(e,s,a):r._updateGraphic(e,s,a,i)})},t.prototype._addProjectedGraphic=function(e,t,i){this._graphicsSet.has(e)&&this._graphicStore.add(e,t,i)},t.prototype._updateGraphic=function(e,t,i,r){var n=this;if(!this._graphicStore.has(e)||p.isAborted(r))return p.resolve();for(var a=this._graphicStore.update(e,t,i),s=a.oldBounds,l=a.newBounds,u=0===v.width(s)&&0===v.height(s),c=0===v.width(l)&&0===v.height(l),d=u?[]:this._tileStore.boundsIntersections(s),f=c?[]:this._tileStore.boundsIntersections(l),g=h.acquire(),y=0,_=d;y<_.length;y++){var m=_[y];g.set(m.key,{addOrUpdate:null,remove:[this._attributeStore.getLocalId(e.uid)]})}for(var b=0,x=f;b<x.length;b++){m=x[b];var w=this._getGraphicData(m,e);if(g.has(m.key)){var S=g.get(m.key);S.remove.length=0,S.addOrUpdate=w}else g.set(m.key,{addOrUpdate:w,remove:null})}var M=[];return g.forEach(function(e,t){var i=o.safeCast(n._processGraphics(t,e.addOrUpdate,r)).then(function(i){n._patchTile(t,{addOrUpdate:i,remove:e.remove})});M.push(i)}),h.release(g),p.all(M).then(function(){})},t.prototype._addTile=function(e,t){var i=v.create();this.view.featuresTilingScheme.getTileBounds(i,e);var r=new S.WGLTile(e,i,!0),n={clear:!0,addOrUpdate:t,remove:[]};this._tiles.set(e,r),this.container.addChild(r),r.setData(n,!1,!1)},t.prototype._addNewTile=function(e,t){var i=this,r=this._graphicStore.queryTileData(e);if(t)for(var n=Math.round((t.valid[1]-t.valid[0])/e.resolution),a=0,s=r;a<s.length;a++){var o=s[a];o.geometry&&_.isPoint(o.geometry)&&this._wrapPoints(o,n)}var l=e.key;this._tileUpdateSet.add(e.key),this.notifyChange("updating"),this._processGraphics(l,r).then(function(e){i._addTile(l,e),i._tileUpdateSet.delete(l),i.notifyChange("updating")}).catch(function(e){if(i._tileUpdateSet.delete(l),i.notifyChange("updating"),!p.isAbortError(e))throw e})},t.prototype._removeTile=function(e){if(this._tiles.has(e)){var t=this._tiles.get(e);this.container.removeChild(t)}},t.prototype._patchTile=function(e,t){this._tiles.has(e)&&(this._tiles.get(e).setData(t,!1,!1),this.container.requestRender())},t.prototype._setVisible=function(e,t){var i=this._attributeStore.getLocalId(e);this._attributeStore.setData(i,0,0,t?1:0)},t.prototype._getGraphicsData=function(e,t){var i=m.getInfo(this.view.spatialReference),r=this._graphicStore.getGraphicsData(e,t);if(i)for(var n=Math.round((i.valid[1]-i.valid[0])/e.resolution),a=0,s=r;a<s.length;a++){var o=s[a];o.geometry&&_.isPoint(o.geometry)&&this._wrapPoints(o,n)}return r.sort(function(e,t){return e.insertAfter-t.insertAfter}),r},t.prototype._getGraphicData=function(e,t){var i=this._graphicStore.getGraphicData(e,t),r=[i],n=m.getInfo(this.view.spatialReference);if(n){var a=Math.round((n.valid[1]-n.valid[0])/e.resolution);i.geometry&&_.isPoint(i.geometry)&&this._wrapPoints(i,a)}return r},t.prototype._wrapPoints=function(e,t){var i=e.geometry;512===t?i.x<20?e.geometry={points:[[i.x,i.y],[t,0]]}:i.x>492&&(e.geometry={points:[[i.x,i.y],[-t,0]]}):i.x<-20?e.geometry={points:[[i.x,i.y],[t,0]]}:i.x>532&&(e.geometry={points:[[i.x,i.y],[-t,0]]})},t.prototype._processGraphics=function(e,t,i){return s(this,void 0,void 0,function(){var r,n;return a(this,function(a){switch(a.label){case 0:return t&&t.length&&this._meshFactory?(r=this._meshFactory,[4,o.safeCast(this._matcher.then(function(e){return r.analyze(t,e,null,null,i)}))]):[2,null];case 1:return n=a.sent(),this._attributeStore.sendUpdates(),[2,this._processAnalyzedGraphics(e,n)]}})})},t.prototype._processAnalyzedGraphics=function(e,t){for(var i=this._meshFactory,r=i.createMeshData(t.length),n=this._attributeStore,a=0,s=t;a<s.length;a++){var o=s[a];o.insertAfter=-1===o.insertAfter?-1:n.getLocalId(o.insertAfter),o.localId=n.getLocalId(o.attributes[this.uid]),i.write(r,o,null,null,e.level)}return S.TileData.fromMeshData(r)},t.prototype._abortProcessingGraphic=function(e){this._graphicIdToAbortController.has(e)&&this._graphicIdToAbortController.get(e).abort()},t.prototype._getNullSymbol=function(e){var t=e.geometry;return _.isPolyline(t)?w.errorPolylineSymbol2D:_.isPolygon(t)||_.isExtent(t)?w.errorPolygonSymbol2D:w.errorPointSymbol2D},r([g.property()],t.prototype,"_graphicProcessingQueue",void 0),r([g.property({constructOnly:!0})],t.prototype,"graphics",void 0),r([g.property({dependsOn:["_graphicProcessingQueue.updating"]})],t.prototype,"updating",null),r([g.property()],t.prototype,"view",void 0),r([g.property()],t.prototype,"updateRequested",void 0),r([g.subclass("esri.views.2d.layers.support.GraphicsView2D")],t)}(g.declared(C,l,u.Identifiable));t.default=k}.apply(null,r))||(e.exports=n)},2220:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(20),i(2118),i(293)],void 0===(n=function(e,t,i,r,n){function a(e){return{value:e.value,size:i.toPt(e.size)}}function s(e){return e.map(function(e){return a(e)})}function o(e){if("string"==typeof e||"number"==typeof e)return i.toPt(e);var t=e;return{type:"size",expression:t.expression,stops:s(t.stops)}}function l(e){var t={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if(r.Utils.isString(e.field)){if(!e.stops)return null;if(e.stops.length>8)return null;for(var i=e.stops,n=0;n<8;++n){var a=i[Math.min(n,i.length-1)];t.values[n]=a.value,t.opacities[n]=a.opacity}}else{if(!(e.stops&&e.stops.length>=0))return null;var s=e.stops&&e.stops.length>=0&&e.stops[0].opacity;for(n=0;n<8;n++)t.values[n]=1/0,t.opacities[n]=s}return t}Object.defineProperty(t,"__esModule",{value:!0});var u=r.enums.WGLVVFlag;t.getVisualVariableSizeValueRepresentationRatio=function(e,t){if(!e||!t)return e;switch(t){case"radius":case"distance":return 2*e;case"diameter":case"width":return e;case"area":return Math.sqrt(e)}return e},t.stopToSizeStop=a,t.normalizeSizeStops=s,t.normalizeSizeElement=o,t.getVisualVariablesFields=function(e){var t=e&&e.length>0?{}:null;return t&&e.forEach(function(e){var i=e.type;e.field&&(t[i]=e.field)}),t},t.convertVisualVariables=function(e){var t=e&&e.length>0?{}:null,a=t?{}:null;if(!t)return{vvFields:t,vvRanges:a};for(var h=0,c=e;h<c.length;h++){var p=c[h],d=p.type;if(p.field&&(t[d]=p.field),"size"===d){a.size||(a.size={});var f=p;switch(r.getTypeOfSizeVisualVariable(f)){case u.SIZE_MINMAX_VALUE:a.size.minMaxValue={minDataValue:f.minDataValue,maxDataValue:f.maxDataValue,minSize:o(f.minSize),maxSize:o(f.maxSize)};break;case u.SIZE_SCALE_STOPS:a.size.scaleStops={stops:s(f.stops)};break;case u.SIZE_FIELD_STOPS:for(var g=[],y=[],v=s(f.stops),_=v.length,m=0;m<6;m++){var b=v[Math.min(m,_-1)];g.push(b.value),y.push(i.pt2px(b.size))}a.size.fieldStops={values:g,sizes:y};break;case u.SIZE_UNIT_VALUE:a.size.unitValue={unit:f.valueUnit,valueRepresentation:f.valueRepresentation}}}else if("color"===d){var x=n.convertVisualVariables([p],{modelSize:null,symbolSize:null,unitInMeters:1,transformation:null});for(a.color=x.color,m=0;m<32;m+=4)r.color.premultiplyAlpha(a.color.colors,m,!0)}else if("opacity"===d)a.opacity=l(p);else if("rotation"===d){var w=p;a.rotation={type:w.rotationType}}}return{vvFields:t,vvRanges:a}}}.apply(null,r))||(e.exports=n)},2221:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(14),i(20),i(475),i(809),i(45),i(285),i(32),i(44),i(493),i(295),i(49),i(136),i(74),i(74),i(2118)],void 0===(n=function(e,t,i,r,n,a,s,o,l,u,h,c,p,d,f,g,y){function v(e,t,i,a,o){var l,u,h=r.pt2px(i.xoffset),c=r.pt2px(i.yoffset),p=G*i.angle,d=G*o;switch(i.type){case"simple-marker":var f=i;l=u=r.pt2px(f.size);break;case"picture-marker":var g=i;l=r.pt2px(g.width),u=r.pt2px(g.height)}var y=n.mat2d.identity(A);n.mat2d.translate(y,y,s.vec2.set(k,e,t)),n.mat2d.rotate(y,y,d-p),n.mat2d.scale(y,y,s.vec2.set(k,a,-a)),n.mat2d.translate(y,y,s.vec2.set(k,h,-c));var v=[0,0];s.vec2.transformMat2d(v,s.vec2.set(k,-.5*l,-.5*u),y);var _=[0,0];s.vec2.transformMat2d(_,s.vec2.set(k,-.5*l,.5*u),y);var m=[0,0];s.vec2.transformMat2d(m,s.vec2.set(k,.5*l,-.5*u),y);var b=[0,0];return s.vec2.transformMat2d(b,s.vec2.set(k,.5*l,.5*u),y),{rings:[[v,m,b,_,v]]}}function _(e,t,i,a,o){var l=y.CIMSymbolHelper.getEnvelope(i.data);if(!l)return null;var u=r.pt2px(l.width),h=r.pt2px(l.height),c=r.pt2px(l.x),p=r.pt2px(l.y),d=0*G,f=G*o,g=n.mat2d.identity(A);n.mat2d.translate(g,g,s.vec2.set(k,e,t)),n.mat2d.rotate(g,g,f-d),n.mat2d.scale(g,g,s.vec2.set(k,a,-a)),n.mat2d.translate(g,g,s.vec2.set(k,c,-p));var v=[0,0];s.vec2.transformMat2d(v,s.vec2.set(k,-.5*u,-.5*h),g);var _=[0,0];s.vec2.transformMat2d(_,s.vec2.set(k,-.5*u,.5*h),g);var m=[0,0];s.vec2.transformMat2d(m,s.vec2.set(k,.5*u,-.5*h),g);var b=[0,0];return s.vec2.transformMat2d(b,s.vec2.set(k,.5*u,.5*h),g),{rings:[[v,m,b,_,v]]}}function m(e,t,i,a,o,l){var u=y.alignmentUtils.getYAnchorDirection(i.verticalAlignment||"baseline"),h="baseline"===(i.verticalAlignment||"baseline"),c=r.pt2px(i.xoffset),p=r.pt2px(i.yoffset),d=r.pt2px(i.font.size)/24,f=4*d,g=h?25*d:a[1]+(1+u)*a[3]*.5,v=G*i.angle,_=G*l,m=n.mat2d.identity(A);n.mat2d.translate(m,m,s.vec2.set(k,e,t)),n.mat2d.rotate(m,m,_-v),n.mat2d.scale(m,m,s.vec2.set(k,o,-o)),n.mat2d.translate(m,m,s.vec2.set(k,c,-p)),n.mat2d.translate(m,m,s.vec2.set(k,-f,-f-g));var b=[0,0];s.vec2.transformMat2d(b,s.vec2.set(k,a[0],a[1]),m);var x=[0,0];s.vec2.transformMat2d(x,s.vec2.set(k,a[0],a[1]+a[3]),m);var w=[0,0];s.vec2.transformMat2d(w,s.vec2.set(k,a[0]+a[2],a[1]),m);var S=[0,0];return s.vec2.transformMat2d(S,s.vec2.set(k,a[0]+a[2],a[1]+a[3]),m),{rings:[[b,w,S,x,b]]}}function b(e,t,i){if(!i||0===i.glyphMosaicItems.length)return e;var n=y.bidiText(t.text),a=n[0],s=n[1],o=y.alignmentUtils.getJustification(t.horizontalAlignment||"center"),l=y.alignmentUtils.getXAnchorDirection(t.horizontalAlignment||"center"),u=i.glyphMosaicItems,h=new y.TextShapingNew([u],y.definitions.TEXT_MAX_WIDTH,y.definitions.TEXT_LINE_HEIGHT,y.definitions.TEXT_SPACING,[0,.5*-P],.5*(1-l),0,o).getShaping(a,s),c=y.fontUtils.getFontDecorationTop(t.font.decoration);isNaN(c)||y.TextShapingNew.addDecoration(h,c);var p=y.TextShapingNew.getBox(h),d=r.pt2px(t.font.size)/L;return e[0]=d*p.x,e[1]=d*p.y,e[2]=d*p.width,e[3]=d*p.height,e}function x(e,t,i,r,n,a,s){var o;switch(r.type){case"simple-marker":case"picture-marker":o=v(t,i,r,a,0);break;case"text":o=m(t,i,r,n,a,0);break;case"cim":o=_(t,i,r,a,0)}for(var l,u,h=0,c=0;c<o.rings[0].length-1;c++)l=(t-(u=o.rings[0][c])[0])*(t-u[0])+(i-u[1])*(i-u[1]),h=Math.max(h,l);h=Math.sqrt(h);var p=d.normalizeMapX(t-h,s),f=d.normalizeMapX(t+h,s);if(p>f){var y=g.getInfo(s);if(y){var b=y.valid;p=b[0],f=b[1]}}return e[0]=p,e[1]=i-h,e[2]=f,e[3]=i+h,e}function w(e,t){return Math.ceil((e-t)/(2*t))}function S(e,t){var i,r=t.valid,n=r[0],a=r[1],s=2*a,o=0;return e>a?(e-=(i=Math.ceil(Math.abs(e-a)/s))*s,o=i):e<n&&(e+=(i=Math.ceil(Math.abs(e-n)/s))*s,o=-i),{x:e,frameId:o}}function M(e,t){var i=t.xmin,r=t.ymin,n=t.xmax,a=t.ymax;return I(e,i,r)&&I(e,i,a)&&I(e,n,a)&&I(e,n,r)}function I(e,t,i){return t>=e.xmin&&t<=e.xmax&&i>=e.ymin&&i<=e.ymax}function T(e,t,i){var r;if(Array.isArray(e)){if((r=e[0])>t){var n=w(r,t);e[0]=r+n*(-2*t)}else if(r<i){n=w(r,i);e[0]=r+n*(-2*i)}}else if((r=e.x)>t){n=w(r,t);e.x+=n*(-2*t)}else if(r<i){n=w(r,i);e.x+=n*(-2*i)}return e}Object.defineProperty(t,"__esModule",{value:!0});var G=Math.PI/180,z=y.definitions.TEXT_MAX_WIDTH,P=y.definitions.TEXT_LINE_HEIGHT,C=y.definitions.TEXT_SPACING,A=a.mat2df32.create(),k=o.vec2f32.create(),V=u.create();t.ensureClosedRings=function(e){if(p.isPolygon(e))for(var t=0,i=e.rings;t<i.length;t++){var r=i[t];r.length<3||r[0][0]===r[r.length-1][0]&&r[0][1]===r[r.length-1][1]||r.push(r[0])}},t.getBounds=function(e,t,i,r,n,a,s,o){if(!r||!i)return e[0]=e[1]=e[2]=e[3]=0,t[0]=t[1]=t[2]=t[3]=0,e;var l=r;if(!p.isPoint(l)){h.getBoundsXY(e,l);var u=t[0];0===u&&(u=function(e,t){var i=0;switch(e.type){case"simple-fill":case"picture-fill":var r=e.outline;if(!r)return 0;i=r.width;break;case"simple-line":i=e.width;break;case"simple-marker":i=e.size;break;case"picture-marker":i=Math.max(e.width,e.height);break;case"text":var n=[0,0,0,0];b(n,e,t),i=Math.max(n[0],n[1]);break;case"cim":var a=y.CIMSymbolHelper.getEnvelope(e.data);i=Math.sqrt(a.width*a.width+a.height*a.height)}return i}(i,n),t[0]=u);var c=a*u/2;return e[0]-=c,e[1]-=c,e[2]+=c,e[3]+=c,e}var d=l.x,f=l.y;return"text"===i.type&&0===t[2]&&0===t[3]&&b(t,i,n),x(e,d,f,i,t,a,o),e},t.isMarkerSymbol=function(e){return"simple-marker"===e||"picture-marker"===e||"text"===e},t.graphicGeometryToNumber=function(e){switch(i.expect(e.geometry).type){case"point":case"multipoint":return 0;case"polyline":return 1;case"polygon":case"extent":return 2}return 0};var U=o.vec2f32.create(),D=o.vec2f32.create(),E=o.vec2f32.create(),O=o.vec2f32.create(),N=o.vec2f32.create(),R=o.vec2f32.create(),B=o.vec2f32.create();t.isPointOnPolyline=function(e,t,i,r){s.vec2.set(E,t,i);for(var n,a,o,l,u,h,c,p,d,f=e.paths,g=1/0,y=0;y<f.length;y++){var v=f[y];if(!(v.length<2))for(var _=1;_<v.length;_++)n=v[_-1][0],o=v[_-1][1],a=v[_][0],l=v[_][1],u=Math.min(n,a)-r,h=Math.min(o,l)-r,c=Math.max(n,a)+r,p=Math.max(o,l)+r,t<u||t>c||i<h||i>p||(s.vec2.set(U,n,o),s.vec2.set(D,a,l),s.vec2.subtract(O,D,U),s.vec2.subtract(N,U,E),s.vec2.scale(R,O,s.vec2.dot(O,N)/s.vec2.dot(O,O)),s.vec2.subtract(B,N,R),g>(d=s.vec2.dot(B,B))&&(g=d))}return Math.sqrt(g)<=r},t.getMarkerSymbolBounds=v,t.getCIMMarkerBounds=_,t.getTextSymbolBounds=m,t.normalizeCentralMeridian=function(e){var t,i,r,n,a,s,o,l,u=null;if(!e)return null;t=e.spatialReference,i=f.getInfo(t),r=t.isWebMercator,n=F[s=r?102100:4326].maxX,a=F[s].minX,o=F[s].plus180Line,l=F[s].minus180Line;var d,g=e.toJSON();if(!i)return g;if("mesh"===e.type)d=g;else if(p.isPoint(g))d=T(g,n,a);else if(p.isMultipoint(g))g.points=g.points.map(function(e){return T(e,n,a)}),d=g;else if(p.isExtent(g))d=function(e,t){if(!t)return e;var i=function(e,t){var i,r=[],n=e.ymin,a=e.ymax,s=e.xmax-e.xmin,o=e.xmin,l=e.xmax,u=t.valid,h=u[0],c=u[1],p=(i=S(e.xmin,t)).x,d=i.frameId,f=(i=S(e.xmax,t)).x,g=i.frameId,y=p===f&&s>0;if(s>2*c){var v={xmin:o<l?p:f,ymin:n,xmax:c,ymax:a},_={xmin:h,ymin:n,xmax:o<l?f:p,ymax:a},m={xmin:0,ymin:n,xmax:c,ymax:a},b={xmin:h,ymin:n,xmax:0,ymax:a},x=[],w=[];M(v,m)&&x.push(d),M(v,b)&&w.push(d),M(_,m)&&x.push(g),M(_,b)&&w.push(g);for(var I=d+1;I<g;I++)x.push(I),w.push(I);r.push({extent:v,frameIds:[d]},{extent:_,frameIds:[g]},{extent:m,frameIds:x},{extent:b,frameIds:w})}else p>f||y?r.push({extent:{xmin:p,ymin:n,xmax:c,ymax:a},frameIds:[d]},{extent:{xmin:h,ymin:n,xmax:f,ymax:a},frameIds:[g]}):r.push({extent:{xmin:p,ymin:n,xmax:f,ymax:a},frameIds:[d]});return r}(e,t).map(function(e){return e.extent});return i.length<2?i[0]||e:i.length>2?(e.xmin=t.valid[0],e.xmax=t.valid[1],e):{rings:i.map(function(e){return[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]})}}(g,i);else if(p.isPolygon(g)||p.isPolyline(g)){var y=V;h.getBoundsXY(y,g);var v={xmin:y[0],ymin:y[1],xmax:y[2],ymax:y[3]},_=w(v.xmin,a)*(2*n),m=0===_?g:function(e,t){for(var i=0,r=function(e){return p.isPolygon(e)?e.rings:e.paths}(e);i<r.length;i++)for(var n=0,a=r[i];n<a.length;n++){var s=a[n];s[0]+=t}return e}(g,_);v.xmin+=_,v.xmax+=_,c.extentIntersectsPolyline(v,o)&&v.xmax!==n?u=m:c.extentIntersectsPolyline(v,l)&&v.xmin!==a?u=m:d=m}else d=e.clone();return null!==u?(new q).cut(u,n):d};var L=24;t.getTextSymbolSize=b,t.getTextSymbolEstimatedSize=function(e,t,i){var n=y.bidiText(t.text),a=n[0],s=n[1],o=y.alignmentUtils.getJustification(t.horizontalAlignment||"center"),l=y.alignmentUtils.getXAnchorDirection(t.horizontalAlignment||"center"),u=new y.TextShapingNew([],z,P,C,[0,.5*-P],.5*(1-l),0,o).getEstimatedShaping(a,s,i),h=y.TextShapingNew.getBox(u),c=r.pt2px(t.font.size)/L;return e[0]=c*h.x,e[1]=c*h.y,e[2]=c*h.width,e[3]=c*h.height,e};var F={102100:{maxX:20037508.342788905,minX:-20037508.342788905,plus180Line:{paths:[[[20037508.342788905,-20037508.342788905],[20037508.342788905,20037508.342788905]]],spatialReference:l.WebMercator},minus180Line:{paths:[[[-20037508.342788905,-20037508.342788905],[-20037508.342788905,20037508.342788905]]],spatialReference:l.WebMercator}},4326:{maxX:180,minX:-180,plus180Line:{paths:[[[180,-180],[180,180]]],spatialReference:l.WGS84},minus180Line:{paths:[[[-180,-180],[-180,180]]],spatialReference:l.WGS84}}},q=function(){function e(){}return e.prototype.cut=function(e,t){var i;if(e.rings)this.closed=!0,i=e.rings,this.minPts=4;else{if(!e.paths)return null;this.closed=!1,i=e.paths,this.minPts=2}for(var r=i.length,n=-2*t,a=0;a<r;a++){var s=i[a];if(s&&s.length>=this.minPts){for(var o=[],l=0,u=s;l<u.length;l++){var h=u[l];o.push([h[0]+n,h[1]])}i.push(o)}}return this.closed?e.rings=i:e.paths=i,e},e}()}.apply(null,r))||(e.exports=n)},2245:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(12),i(0),i(116),i(50),i(26),i(830),i(2208),i(202)],void 0===(n=function(e,t,i,r,n,a,s,o,l,u){Object.defineProperty(t,"__esModule",{value:!0});var h={added:[],removed:[]},c=new n.default,p=new u(0,0,0,0),d=function(e){function t(t){var i=e.call(this)||this;return i._tiles=new Map,i._index=o(9,s("csp-restrictions")?function(e){return{minX:e.bounds[0],minY:e.bounds[1],maxX:e.bounds[2],maxY:e.bounds[3]}}:[".bounds[0]",".bounds[1]",".bounds[2]",".bounds[3]"]),i.tiles=[],i.tileScheme=t,i}return i(t,e),t.prototype.destroy=function(){this._tiles.clear()},t.prototype.has=function(e){return this._tiles.has(e)},t.prototype.get=function(e){return this._tiles.get(e)},t.prototype.findByKey=function(e){return this._tiles.get(e.id)},t.prototype.intersections=function(e,t){var i="string"==typeof e?this.get(e):e;if(!i)return[];for(var r=t*i.resolution,n=i.bounds[0]-r,a=i.bounds[1]-r,s=i.bounds[2]+r,o=i.bounds[3]+r,l=[],u=0,h=this._index.search({minX:n,minY:a,maxX:s,maxY:o});u<h.length;u++){var c=h[u],p=c.bounds.slice();p[0]=Math.max(p[0],n),p[1]=Math.max(p[1],a),p[2]=Math.min(p[2],s),p[3]=Math.min(p[3],o),p[2]-p[0]>0&&p[3]-p[1]>0&&l.push({bounds:p,tile:c})}return l},t.prototype.boundsIntersections=function(e){return this._index.search({minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]})},t.prototype.setViewState=function(e){var t=this.tileScheme.getTileCoverage(e,0);if(t){var i=t.spans,r=t.lodInfo,n=r.level;if(i.length>0)for(var a=0,s=i;a<s.length;a++)for(var o=s[a],u=o.row,d=o.colFrom,f=o.colTo,g=d;g<=f;g++){var y=p.set(n,u,r.normalizeCol(g),r.getWorldForColumn(g)).id;if(c.add(y),!this.has(y)){var v=new l.default(this.tileScheme,y);this._tiles.set(y,v),this._index.insert(v),this.tiles.push(v),h.added.push(v)}}for(var _=this.tiles.length-1;_>=0;_--){v=this.tiles[_];c.has(v.id)||(this._tiles.delete(v.id),this.tiles.splice(_,1),this._index.remove(v),h.removed.push(v))}(h.added.length||h.removed.length)&&this.emit("update",h),c.clear(),h.added.length=0,h.removed.length=0}},t}(a);t.default=d}.apply(null,r))||(e.exports=n)},2266:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(92)],void 0===(n=function(e,t,i){var r=function(){function e(e,t){void 0===e&&(e=50),void 0===t&&(t=50),this._pool=new i(Map,!1,function(e){return e.clear()},t,e)}return e.prototype.acquire=function(){return this._pool.acquire()},e.prototype.release=function(e){this._pool.release(e)},e.acquire=function(){return n.acquire()},e.release=function(e){return n.release(e)},e}(),n=new r(100);return r}.apply(null,r))||(e.exports=n)},2267:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(9),i(11),i(15),i(26),i(13),i(37),i(14),i(7),i(232),i(233),i(472),i(2118),i(2215),i(2220),i(231),i(147)],void 0===(n=function(e,t,r,n,a,s,o,l,u,h,c,p,d,f,g,y){Object.defineProperty(t,"__esModule",{value:!0});var v=(d.enums.PixelType,o.getLogger("esri.views.layers.2d.features.support.AttributeStore")),_=f.debug.createDebugLogger(f.debug.DEBUG_ATTR_UPDATES,v),m=function(e,t){return function(i,r,n){var a;try{a=t(i,r,n)}catch(e){a=NaN}return(null===a||isNaN(a)||a===1/0)&&e||a}},b={sharedArrayBuffer:s("esri-shared-array-buffer"),oesTextureFloat:s("esri-webgl-texture-float"),maxTextureSize:s("esri-webgl-max-texture-size")},x=function(){function e(e,t,i,r){this.texelSize=4,this.descriptors=[];var n=r.pixelType,a=r.layout;this.data=this._initData(n,i,e,t),this.pixelType=n,this.layout=a,this._resetRange(),this._shared=e,this._ctype=t}return Object.defineProperty(e.prototype,"buffer",{get:function(){return this.data.buffer},enumerable:!0,configurable:!0}),e.prototype.getData=function(e,t){return this.data[e*this.texelSize+t]},e.prototype.setData=function(e,t,i){var r=1<<t;0!=(this.layout&r)?(this.data[e*this.texelSize+t]=i,this.dirtyStart=Math.min(this.dirtyStart,e),this.dirtyEnd=Math.max(this.dirtyEnd,e)):v.error("mapview-attributes-store","Tried to set a value for a texel's readonly component")},e.prototype.expand=function(e){var t=this._initData(this.pixelType,e,this._shared,this._ctype);t.set(this.data),this.data=t},e.prototype.toMessage=function(){var e=this.dirtyStart,t=this.dirtyEnd,i=this.texelSize;if(e>t)return null;this._resetRange();var r=!(this._shared||"local"===this._ctype),n=this.pixelType,a=this.layout;return this.data.slice?{start:e,end:t,data:r&&this.data.slice(e*i,(t+1)*i)||null,pixelType:n,layout:a}:r?{start:e,end:t,data:new(f.Utils.getPixelArrayCtor(this.pixelType))(Array.prototype.slice.call(this.data,e*i,(t+1)*i)),pixelType:n,layout:a}:{start:e,end:t,data:null,pixelType:n,layout:a}},e.prototype._initData=function(e,t,i,r){for(var n=i&&"local"!==r?SharedArrayBuffer:ArrayBuffer,a=f.Utils.getPixelArrayCtor(e),s=new a(new n(t*t*4*a.BYTES_PER_ELEMENT)),o=0;o<s.length;o+=4)s[o+1]=255;return s},e.prototype._resetRange=function(){this.dirtyStart=this.data.length/4,this.dirtyEnd=0},e}(),w=function(){function e(e){this._attributeComputeMap=new Map,this._blocks=new Array,this._idMap=new Map,this._localToObjectId=new Map,this._filters=new Array(f.definitions.MAX_FILTERS),this._freeList=[],this._abortController=h.createAbortController(),this._hasScaleExpr=!1,this._size=32,this._idCounter=0;var t=b.oesTextureFloat?5126:5121;_("Creating AttributeStore "+(b.sharedArrayBuffer?"with":"without")+" shared memory"),this._client=e,this._blockDescriptors=[{pixelType:5121,layout:7},{pixelType:t,layout:15},{pixelType:t,layout:15}],this._blocks=this._blockDescriptors.map(function(e){return null})}return e.prototype.destroy=function(){this._abortController.abort()},Object.defineProperty(e.prototype,"hasScaleExpr",{get:function(){return this._hasScaleExpr},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_signal",{get:function(){return this._abortController.signal},enumerable:!0,configurable:!0}),e.prototype.createLocalId=function(e){if(!this._idMap.has(e)){var t=this._getFreeId();this._idMap.set(e,-1===t?0:t),this._localToObjectId.set(t,e)}return this._idMap.get(e)},e.prototype.freeLocalId=function(e){var t=this._idMap.get(e);this._idMap.delete(e),this._localToObjectId.delete(t),this._freeList.push(t)},e.prototype.getFeatureId=function(e){return this._localToObjectId.get(e)},e.prototype.getLocalId=function(e){return this._idMap.has(e)?this._idMap.get(e):null},e.prototype.updateFilters=function(e){return n(this,void 0,void 0,function(){var t,i,n,a,s,o,l=this;return r(this,function(r){switch(r.label){case 0:return t=e.config,i=e.service,n=e.spatialReference,a=t.filters,s=t.definitionExpression,o=a.map(function(t,r){return l._updateFilter(e,t,r,i,s,n)}),[4,h.all(o)];case 1:return r.sent(),[2]}})})},e.prototype.setAttributeBindings=function(e,t){return n(this,void 0,void 0,function(){return r(this,function(i){switch(this._hasScaleExpr=!1,e.type){case"simple":case"class-breaks":case"unique-value":case"dictionary":return[2,this._bindVVEvaluators(e.visualVariables,t)];case"dot-density":return[2,this._bindDDEvaluators(e.attributes,t)];case"heatmap":break;default:v.error(new a("attribute-store","Found invalid renderer type: "+e))}return[2]})})},e.prototype.setData=function(e,t,i,r){this._getBlock(t).setData(e,i,r)},e.prototype.setAttributeData=function(e,t,i,r){var n=this,a=e;this._getBlock(0).setData(a,0,this._getFilterFlags(t));var s=this._attributeComputeMap,o=b.oesTextureFloat?1:2;s.forEach(function(e,s){var u=s*o%4,h=Math.floor(s*o/4),c=n._getBlock(h+1),p=e(t,{$view:r},i);if(b.oesTextureFloat)c.setData(a,u,p);else if(p===f.definitions.NAN_MAGIC_NUMBER)c.setData(a,u,255),c.setData(a,u+1,255);else{var d=l.clamp(Math.round(p),-32767,32766)+32768,g=255&d,y=(65280&d)>>8;c.setData(a,u,g),c.setData(a,u+1,y)}})},e.prototype.sendUpdates=function(){var e=this;if(this._nextUpdate)return this._nextUpdate.promise;if(this._currUpdate)return this._nextUpdate=h.createResolver(),this._nextUpdate.promise;var t={blocks:this._blocks.map(function(e){return u.isSome(e)?e.toMessage():null})};return this._currUpdate=this._createResources().then(function(){var i=e._client.update(t,e._signal).then(function(){if(e._currUpdate=null,e._nextUpdate){var t=e._nextUpdate;e._nextUpdate=null,e.sendUpdates().then(function(){return t.resolve()})}});return e._client.render(),i}),this._currUpdate},e.prototype._createResources=function(){var e=this;if(u.isSome(this._createResourcesPromise))return this._createResourcesPromise;_("Initializing AttributeStore");var t={shared:b.sharedArrayBuffer||"local"===this._client.type,size:this._size,blocks:u.mapMany(this._blocks,function(e){return{buffer:e.buffer,pixelType:e.pixelType}})},i=this._client.initialize(t,this._signal);return this._createResourcesPromise=i,i.then(function(){if(u.isNone(e._createResourcesPromise))return e._createResources()}),i},e.prototype._getBlock=function(e){var t=this._blocks[e];if(u.isSome(t))return t;_("Initializing AttributeBlock at index "+e);var i=b.sharedArrayBuffer,r=this._client.type,n=new x(i,r,this._size,this._blockDescriptors[e]);return this._blocks[e]=n,this._createResourcesPromise=null,n},e.prototype._expand=function(){if(this._size<b.maxTextureSize){var e=this._size<<=1;return _("Expanding block size to",e,this._blocks),u.forEachSome(this._blocks,function(t){return t.expand(e)}),this._createResourcesPromise=null,this._size=e,0}return v.error(new a("mapview-limitations","Maximum number of onscreen features exceeded.")),-1},e.prototype._getFreeId=function(){return this._freeList.length?this._freeList.pop():this._idCounter>=this._size*this._size&&this._expand()?-1:this._idCounter++},e.prototype._updateFilter=function(e,t,i,a,s,o){return n(this,void 0,void 0,function(){var n,l,h,c,p,d,f,g=this;return r(this,function(r){switch(r.label){case 0:return n=this._filters[i],(u.isSome(n)&&n.hash)===JSON.stringify(t)?[2]:(l=1<<i,u.isNone(t)?(this._filters[i]=null,this._idMap.forEach(function(e){var t=g._getBlock(0).getData(e,0);g._getBlock(0).setData(e,0,t|l)}),[2]):[4,e.queryObjectIds(t)]);case 1:return h=r.sent(),t.hiddenIds&&t.hiddenIds.length&&(h=h.filter(function(e){return-1===t.hiddenIds.indexOf(e)})),c=h.map(function(e){return g._idMap.get(e)}),[4,this._getFilter(i,a)];case 2:for(r.sent().update(t,s,o),this._idMap.forEach(function(e){var t=g._getBlock(0).getData(e,0);g._getBlock(0).setData(e,0,t&~l)}),p=0;p<c.length;p++)null!=(d=c[p])&&(f=this._getBlock(0).getData(d,0),this._getBlock(0).setData(d,0,f|l));return[2]}})})},e.prototype._getFilter=function(e,t){return n(this,void 0,void 0,function(){var n,a,s;return r(this,function(r){switch(r.label){case 0:return n=this._filters[e],u.isSome(n)?[2,n]:[4,new Promise(function(e,t){i.e(69).then(function(){var t=[i(2347)];e.apply(null,t)}.bind(this)).catch(t.bind(this))})];case 1:return a=r.sent().default,s=new a({geometryType:t.geometryType,hasM:!1,hasZ:!1,timeInfo:t.timeInfo,fieldsIndex:new c(t.fields)}),this._filters[e]=s,[2,s]}})})},e.prototype._getFilterFlags=function(e){for(var t=0,i=0;i<this._filters.length;i++){var r=this._filters[i];t|=(u.isNone(r)||r.check(e)?1:0)<<i}return t},e.prototype._bindVVEvaluators=function(e,t){return n(this,void 0,void 0,function(){var i=this;return r(this,function(a){switch(a.label){case 0:return this._attributeComputeMap.clear(),u.isSome(e)?[4,h.all(e.map(function(e){return n(i,void 0,void 0,function(){var i,n;return r(this,function(r){switch(r.label){case 0:return i=f.Utils.getVVType(e.type),[4,this._createGetValueFunction(e,t)];case 1:return n=r.sent(),u.isSome(n)&&this._attributeComputeMap.set(i,n),[2]}})})}))]:[3,2];case 1:a.sent(),a.label=2;case 2:return[2]}})})},e.prototype._bindDDEvaluators=function(e,t){return n(this,void 0,void 0,function(){var i,n,a,s=this;return r(this,function(r){switch(r.label){case 0:return this._attributeComputeMap.clear(),e.length>f.definitions.DOT_DENSITY_MAX_FIELDS&&v.warn("mapview-invalid-value","DotDensityRenderer supports a maximum of "+f.definitions.DOT_DENSITY_MAX_FIELDS+" attribtues, but found "+e.length),[4,h.all(e.map(function(e){return s._createNormalizedFunction(e,t)}))];case 1:for(i=r.sent().map(function(e){return m(0,e)}),n=0;n<f.definitions.DOT_DENSITY_MAX_FIELDS;n++)(a=n<e.length&&i[n])?this._attributeComputeMap.set(n,a):this._attributeComputeMap.has(n)&&this._attributeComputeMap.delete(n);return[2]}})})},e.prototype._createGetValueFunction=function(e,t){return n(this,void 0,void 0,function(){var i,n,a,s,o,l,u;return r(this,function(r){switch(r.label){case 0:return"size"!==e.type?[3,2]:(i=f.getTypeOfSizeVisualVariable(e))===f.enums.WGLVVFlag.SIZE_SCALE_STOPS?[2,null]:(n=i===f.enums.WGLVVFlag.SIZE_UNIT_VALUE,a=n&&function(t){return y.getVisualVariableSizeValueRepresentationRatio(t,e.valueRepresentation)},s=m,o=[f.definitions.NAN_MAGIC_NUMBER],[4,this._createNormalizedFunction(e,t,a)]);case 1:return[2,s.apply(void 0,o.concat([r.sent()]))];case 2:return l=m,u=[f.definitions.NAN_MAGIC_NUMBER],[4,this._createNormalizedFunction(e,t)];case 3:return[2,l.apply(void 0,u.concat([r.sent()]))]}})})},e.prototype._createNormalizedFunction=function(e,t,i){return n(this,void 0,void 0,function(){var n,s,o;return r(this,function(r){switch(r.label){case 0:return(n=e.field)?"string"==typeof n?(s=e.normalizationField)?[2,function(e){if(e.attributes[n]&&e.attributes[s]){var t=e.attributes[n]/e.attributes[s];return i?i(t):t}}]:[2,i?function(e){return i(e.attributes[n])}:function(e){return e.attributes[n]}]:(v.error(new a("mapview-rendering:invalid-type","The field for a vv must be a string or a number, but got "+typeof n)),[2,function(e){}]):e.valueExpression?(this._hasScaleExpr=this._hasScaleExpr||-1!==e.valueExpression.indexOf("scale"),[4,p.createVVExpression(e.valueExpression,t.spatialReference,t.fields)]):[3,2];case 1:return o=r.sent(),[2,g.callWithOptimizedFeature.bind(null,o)];case 2:return v.error("Unable to create a normalized function for visual variable: "+e),[2,function(e){}]}})})},e}();t.default=w}.apply(null,r))||(e.exports=n)},2268:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(1),i(0),i(8),i(2)],void 0===(n=function(e,t,i,r,n,a){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.graphics=null,t.renderer=null,t.view=null,t}return i(t,e),r([a.property()],t.prototype,"graphics",void 0),r([a.property()],t.prototype,"renderer",void 0),r([a.property()],t.prototype,"updating",void 0),r([a.property()],t.prototype,"view",void 0),r([a.subclass("esri.views.layers.GraphicsView")],t)}(a.declared(n))}.apply(null,r))||(e.exports=n)},2501:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(4),i(12),i(9),i(11),i(50),i(18),i(7),i(2118)],void 0===(n=function(e,t,i,r,n,a,s,o,l,u){Object.defineProperty(t,"__esModule",{value:!0});var h=function(e){function t(t){var i=e.call(this)||this;return i._highlightMap=new Map,i._localToGlobalId=t,i}return r(t,e),Object.defineProperty(t.prototype,"isEmpty",{get:function(){return 0===this._highlightMap.size},enumerable:!0,configurable:!0}),t.prototype.has=function(e){var t=this._localToGlobalId(e);return this._highlightMap.has(t)},t.prototype.create=function(e){for(var t=this,i={remove:null,objectIds:e,objectIdSet:new Set,remove:function(){return t._delete(i)}},r=0,n=e;r<n.length;r++){var a=n[r];i.objectIdSet.add(a),this._highlightMap.has(a)||this._highlightMap.set(a,new Set),this._highlightMap.get(a).add(i)}return this.emit("change"),i},t.prototype._delete=function(e){for(var t=0,i=e.objectIds;t<i.length;t++){var r=i[t],n=this._highlightMap.get(r);n.delete(e),0===n.size&&this._highlightMap.delete(r)}this.emit("change")},t}(s),c=function(e){function t(t){var i=e.call(this)||this;return i._displayHeight=0,i._displayWidth=0,i._rendererInfo=new u.WGLRendererInfo,i._tileDataChangeHandles=new o,i.attributeView=new u.AttributeStoreView,i._tileDataChangeHandler=function(e){e.target.buildHLList(i._highlightManager)},i._highlightManagerChangeHandler=function(){for(var e=0,t=i.children;e<t.length;e++)t[e].buildHLList(i._highlightManager)},i.tileInfoView=t.tileInfoView,i.getMaterialItems=i.getMaterialItems.bind(i),i._highlightManager=new h(t.localToGlobalId),i._highlightManagerChangeHandle=i._highlightManager.on("change",i._highlightManagerChangeHandler.bind(i)),i}return r(t,e),t.prototype.dispose=function(){this.removeAllChildren();for(var e=0,t=this.children;e<t.length;e++)t[e].dispose();this._tileDataChangeHandles.removeAll(),this._highlightManagerChangeHandle.remove(),this.attributeView.destroy()},t.prototype.disposeWebGLResources=function(){for(var e=0,t=this.children;e<t.length;e++)t[e].clear()},t.prototype.highlight=function(e){return this._highlightManager.create(e)},t.prototype.displayWidth=function(){return this._displayWidth},Object.defineProperty(t.prototype,"displayHeight",{get:function(){return this._displayHeight},enumerable:!0,configurable:!0}),t.prototype.setVisibility=function(e,t){},t.prototype.getMaterialItems=function(e,t){var i=e;if(!i||0===i.length)return null;for(var r=[],n=this.stage.painter.textureManager,a=0,s=i;a<s.length;a++){var o=s[a];r.push(n.rasterizeItem(o.symbol,o.glyphIds,t))}return l.all(r).then(function(e){return e.map(function(e,t){return{id:i[t].id,mosaicItem:e}})})},t.prototype.addChild=function(t){e.prototype.addChild.call(this,t);var i=t.on("change",this._tileDataChangeHandler);return this._tileDataChangeHandles.add(i,t),t},t.prototype.removeChild=function(t){return e.prototype.removeChild.call(this,t),this._tileDataChangeHandles.remove(t),t},t.prototype.renderChildren=function(e){var t=this.stage.painter;if(this._updateTilesTransform(e.state,this.tileInfoView.getClosestInfoForScale(e.state.scale).level),e.drawPhase===u.enums.WGLDrawPhase.MAP){this.attributeView.update(this.stage.context),this.attributeView.bindTextures(this.stage.context);var r=this.tileInfoView.getClosestInfoForScale(e.state.scale).level,n=this.tileInfoView.tileInfo.scaleToZoom(e.state.scale),a=this._rendererInfo,s=i({},e,{rendererInfo:a,requiredLevel:r,displayLevel:n,context:this.stage.context,painter:t,attributeView:this.attributeView});this.sortChildren(function(e,t){return e.key.level-t.key.level!=0?e.key.level-t.key.level:e.key.row-t.key.row!=0?e.key.row-t.key.row:e.key.col-t.key.col});var o=s.drawPhase;t.draw(s,this.children,o,null),this._highlightManager.isEmpty||t.highlight(s,this.children)}},t.prototype._updateTilesTransform=function(e,t){for(var i=0,r=this.children;i<r.length;i++){var n=r[i],a=this.tileInfoView.tileInfo.lods[n.key.level].resolution/(e.resolution*e.pixelRatio);n.setTransform(e,a)}},t}(u.Container);t.default=c}.apply(null,r))||(e.exports=n)},2502:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(1),i(0),i(8),i(7),i(60),i(2)],void 0===(n=function(e,t,i,r,n,a,s,o){Object.defineProperty(t,"__esModule",{value:!0});var l=function(e){function t(t){var i=e.call(this,t)||this;return i._queue=new Map,i._queueArray=[],i._onGoingGraphic=null,i._onGoingPromise=null,i._scheduledNextHandle=null,i._next=i._next.bind(i),i._finalize=i._finalize.bind(i),i}return i(t,e),Object.defineProperty(t.prototype,"length",{get:function(){return this._queueArray.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return this._queueArray.length>0||null!==this._onGoingPromise},enumerable:!0,configurable:!0}),t.prototype.cancel=function(e){if(this._onGoingGraphic&&this._onGoingGraphic.graphic===e&&(this._ongoingAbortController.abort(),this._onGoingGraphic=this._onGoingPromise=null),this._queue.has(e)){var t=this._queue.get(e);this._queue.delete(e);var i=this._queueArray.indexOf(t);this._queueArray.slice(i,1)}this._scheduleNext(),this.notifyChange("updating")},t.prototype.clear=function(){this._queue.clear(),this._queueArray.length=0,this._onGoingPromise&&(this._ongoingAbortController.abort(),this._onGoingGraphic=this._onGoingPromise=null),this._cancelNext(),this.notifyChange("updating")},t.prototype.has=function(e){return this._queue.has(e)},t.prototype.isOngoing=function(e){return this._onGoingGraphic&&this._onGoingGraphic.graphic===e},t.prototype.push=function(e,t){if(!this._queue.has(e)){var i={graphic:e,addOrUpdate:t};this._queueArray.push(i),this._queue.set(e,i),this._scheduleNext(),this.notifyChange("updating")}},t.prototype.refresh=function(){this.reset()},t.prototype.reset=function(){var e=this._onGoingGraphic;if(e){var t=e.graphic,i=e.addOrUpdate;this.push(t,i)}},t.prototype._finalize=function(){this._onGoingGraphic=null,this._ongoingAbortController=null,this._onGoingPromise=null,this.notifyChange("updating"),this._scheduleNext()},t.prototype._cancelNext=function(){this._scheduledNextHandle&&(this._scheduledNextHandle.remove(),this._scheduledNextHandle=null)},t.prototype._scheduleNext=function(){this._scheduledNextHandle||0===this._queue.size||null!=this._onGoingGraphic||(this._scheduledNextHandle=s.schedule(this._next))},t.prototype._next=function(){if(null==this._scheduledNextHandle||0===this._queue.size||this._onGoingGraphic)this._scheduledNextHandle=null;else{this._scheduledNextHandle=null;var e=this._peek(),t=e.graphic,i=e.addOrUpdate,r=a.createAbortController();this._queue.delete(t),this._onGoingGraphic=e,this._onGoingPromise=this.process(t,i,{signal:r.signal}),this._ongoingAbortController=r,this._onGoingPromise.then(this._finalize,this._finalize),this.notifyChange("updating")}},t.prototype._peek=function(){return 0===this._queueArray.length?null:this._queueArray.pop()},r([o.property({readOnly:!0})],t.prototype,"length",null),r([o.property({readOnly:!0})],t.prototype,"updating",null),r([o.property({constructOnly:!0})],t.prototype,"process",void 0),r([o.subclass("esri.views.2d.layers.graphics.GraphicProcessingQueue")],t)}(o.declared(n));t.default=l}.apply(null,r))||(e.exports=n)},2503:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(4),i(294),i(231),i(26),i(20),i(830),i(44),i(186),i(49),i(136),i(2504),i(2221)],void 0===(n=function(e,t,i,r,n,a,s,o,l,u,h,c,p,d){function f(e,t,i,r,n){return g.minX=t,g.minY=i,g.maxX=r,g.maxY=n,e.search(g)}Object.defineProperty(t,"__esModule",{value:!0});var g={minX:0,minY:0,maxX:0,maxY:0},y=l.create(),v=[],_=function(){function e(e,t,i,r,s,l){this._graphics=r,this._onAdd=s,this._onRemove=l,this._index=o(9,a("csp-restrictions")?function(e){return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}}:[".bounds[0]",".bounds[1]",".bounds[2]",".bounds[3]"]),this._itemByGraphic=new n.default,this._currentLevel=-1/0,this._tileInfoView=e,this._uidFieldName=i;var u=e.getClosestInfoForScale(t);u&&(this._currentLevel=u.level,this._resolution=this._tileInfoView.getTileResolution(u.level))}return e.prototype.hitTest=function(e,t,i,r,n){e=c.normalizeMapX(e,this._tileInfoView.spatialReference);var a=.5*r*i;y[0]=e-a,y[1]=t-a,y[2]=e+a,y[3]=t+a;var o=.5*r*(i+50),p=f(this._index,e-o,t-o,e+o,t+o);if(!p||0===p.length)return[];for(var g,v={x:e,y:t},_=[],m=0,b=p;m<b.length;m++){var x=b[m];if(x.graphic.visible)switch(h.getJsonType(x.geometry)){case"esriGeometryPoint":var w=x.symbol;if(!w)continue;var S=x.geometry,M=void 0;switch(w.type){case"text":M=d.getTextSymbolBounds(S.x,S.y,w,x.size,this._resolution,n);break;case"cim":M=d.getCIMMarkerBounds(S.x,S.y,w,this._resolution,n);break;default:M=d.getMarkerSymbolBounds(S.x,S.y,w,this._resolution,n)}u.polygonContainsPoint(M,v)&&_.push(x);break;case"esriGeometryPolyline":var I=x.symbol;if(!I)continue;g=1.5*r*window.devicePixelRatio*s.pt2px(I.width),d.isPointOnPolyline(x.geometry,e,t,g)&&_.push(x);break;case"esriGeometryEnvelope":var T=x.geometry,G=l.fromValues(T.xmin,T.ymin,T.xmax,T.ymax);l.intersects(G,y)&&_.push(x);break;case"esriGeometryPolygon":u.polygonContainsPoint(x.geometry,v)&&_.push(x);break;case"esriGeometryMultipoint":var z=x.symbol;if(!z)continue;for(var P=x.geometry.points,C=void 0,A=0;A<P.length;A++){if("text"===z.type){var k=z;C=d.getTextSymbolBounds(P[A][0],P[A][1],k,x.size,this._resolution,n)}else C=d.getMarkerSymbolBounds(P[A][0],P[A][1],z,this._resolution,n);if(u.polygonContainsPoint(C,v)){_.push(x);break}}}}return _.sort(function(e,t){var i=d.graphicGeometryToNumber(e.graphic),r=d.graphicGeometryToNumber(t.graphic);return i===r?t.zorder-e.zorder:i-r}),_.map(function(e){return e.graphic})},e.prototype.getGraphicsData=function(e,t){var r=f(this._index,e.bounds[0],e.bounds[1],e.bounds[2],e.bounds[3]);if(0===r.length||0===t.length)return[];r.sort(function(e,t){return e.zorder-t.zorder}),r[0].insertAfter=-1;for(var n=1;n<r.length;n++)r[n].insertAfter=r[n-1].graphic.uid;r.sort(function(e,t){return e.graphic.uid-t.graphic.uid}),t.sort(function(e,t){return e.uid-t.uid});for(var a,s=0,o=0,l=[],u={originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[e.bounds[0],e.bounds[3]]},h=0,c=t;h<c.length;h++){var d=c[h];for(o=-2;s<r.length;)if(a=r[s],s++,d.uid===a.graphic.uid){o=a.insertAfter;break}if(a.geometry&&-2!==o){var g=a.getGeometryQuantized(u),y=i({},a.graphic.attributes);y[this._uidFieldName]=d.uid,l.push({centroid:p.default.getCentroidQuantized(a,u,this._scale),geometry:g,attributes:y,symbol:a.symbol,insertAfter:o})}}return l},e.prototype.getGraphicData=function(e,t){var r=this._itemByGraphic.get(t);if(!r)return null;var n=f(this._index,e.bounds[0],e.bounds[1],e.bounds[2],e.bounds[3]);n.sort(function(e,t){return e.zorder-t.zorder});var a=n.indexOf(r),s=0===a||-1===a?-1:n[a-1].graphic.uid,o={originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[e.bounds[0],e.bounds[3]]},l=r.getGeometryQuantized(o),u=i({},r.graphic.attributes);return u[this._uidFieldName]=t.uid,{centroid:p.default.getCentroidQuantized(r,o,this._scale),geometry:l,attributes:u,symbol:r.symbol,insertAfter:s}},e.prototype.queryTileData=function(e){var t=50*e.resolution,i=l.pad(e.bounds,t,l.create()),r=f(this._index,i[0],i[1],i[2],i[3]),n=[];return this._createTileGraphics(n,r,{originPosition:"upperLeft",scale:[e.resolution,e.resolution],translate:[e.bounds[0],e.bounds[3]]}),n},e.prototype.has=function(e){return this._itemByGraphic.has(e)},e.prototype.getBounds=function(e){return this._itemByGraphic.has(e)?this._itemByGraphic.get(e).bounds:null},e.prototype.add=function(e,t,i){if(e){this._onAdd(e);var r=p.default.acquire(e,t,i,this._resolution,this._scale,this._tileInfoView.spatialReference);return this._itemByGraphic.set(e,r),i&&this._index.insert(r),r.bounds}},e.prototype.remove=function(e){if(this._itemByGraphic.has(e)){this._onRemove(e);var t=this._itemByGraphic.get(e);this._index.remove(t),this._itemByGraphic.delete(e)}},e.prototype.updateZ=function(){for(var e,t,i=this._graphics.items,r=0;r<i.length;r++)t=i[r],(e=this._itemByGraphic.get(t))&&(e.zorder=r)},e.prototype.update=function(e,t,i){var r=this._itemByGraphic.get(e),n=l.clone(r.bounds);return r.size[0]=r.size[1]=0,this._index.remove(r),r.set(e,t,i,this._resolution,this._scale,this._tileInfoView.spatialReference),i&&this._index.insert(r),{oldBounds:n,newBounds:r.bounds}},e.prototype.updateLevel=function(e){var t=this;if(this._currentLevel!==e){this._currentLevel=e;var i=this._tileInfoView.getTileResolution(e);this._resolution=i,this._scale=this._tileInfoView.getTileScale({level:e,row:0,col:0,world:0}),this._index.clear();var n=this._itemByGraphic.values();v.length=0,r.forOf(n,function(e){e.updateBounds(e.symbol,t._resolution,t._scale,t._tileInfoView.spatialReference),e.geometry&&v.push(e)}),this._index.load(v)}},e.prototype.clear=function(){this._itemByGraphic.clear(),this._index.clear()},e.prototype._createTileGraphics=function(e,t,r){var n=this._uidFieldName;t.sort(function(e,t){return e.zorder-t.zorder});for(var a,s,o,l,u=0;u<t.length;u++){a=(o=t[u]).graphic,s=o.getGeometryQuantized(r),l=0===u?-1:t[u-1].graphic.uid;var h=i({},o.graphic.attributes);h[n]=a.uid,e.push({centroid:p.default.getCentroidQuantized(o,r,this._scale),geometry:s,attributes:h,symbol:o.symbol,insertAfter:l})}},e}();t.default=_}.apply(null,r))||(e.exports=n)},2504:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(14),i(44),i(508),i(49),i(500),i(2221)],void 0===(n=function(e,t,i,r,n,a,s,o){Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(){this.bounds=r.create(),this.graphic=null,this.size=[0,0,0,0]}return e.acquire=function(t,i,r,n,a,s){var o;return void 0===t&&(t=null),0===e._pool.length?o=new e:(o=e._pool.pop(),this._set.delete(o)),o.acquire(t,i,r,n,a,s),o},e.release=function(e){e&&!this._set.has(e)&&(e.release(),this._pool.push(e),this._set.add(e))},e.getCentroidQuantized=function(e,t,r){if(a.isPolygon(e.geometry)){var l=e.symbol;if(i.isNone(l))return null;if(o.isMarkerSymbol(l.type)){var u=n.polygonCentroid(e.geometry);return s.quantizePoint(t,{},{x:u[0],y:u[1]},!1,!1)}}return null},e.prototype.acquire=function(e,t,i,r,n,a){void 0===e&&(e=null),e&&this.set(e,t,i,r,n,a)},e.prototype.release=function(){this.graphic=null,this.symbol=null,this.geometry=null},e.prototype.set=function(e,t,i,r,n,a){this.graphic=e,this.geometry=i,this.symbol=t.symbol,o.getBounds(this.bounds,this.size,t.symbol,i,t.mosaicItem,r,n,a)},e.prototype.updateBounds=function(e,t,i,r){o.getBounds(this.bounds,this.size,e,this.geometry,null,t,i,r)},e.prototype.getGeometryQuantized=function(e){if(a.isPolygon(this.geometry)){var t=this.geometry.rings;if(1===t.length&&2===t[0].length)return s.quantizeGeometry(e,{paths:[[t[0][0],t[0][1]]]})}return s.quantizeGeometry(e,this.geometry)},e._pool=[],e._set=new Set,e}();t.default=l}.apply(null,r))||(e.exports=n)}}]);