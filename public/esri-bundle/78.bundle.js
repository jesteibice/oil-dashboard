(function(){(this||window).webpackJsonp.registerAbsMids({"esri/views/2d/mapViewDeps":2169,"esri/core/throttle":2281,"esri/views/2d/LabelManager":2553,"esri/views/2d/navigation/MapViewNavigation":2554,"esri/views/2d/navigation/ZoomBox":2555,"esri/views/2d/navigation/actions/Pan":2556,"esri/views/2d/navigation/actions/Pinch":2557,"esri/views/2d/navigation/actions/Rotate":2558,"esri/views/2d/magnifier/MagnifierView2D":2559})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[78],{2169:function(t,e,i){var o,n;o=[i.dj.c(t.i),e,i(2553),i(2219),i(2554),i(2559)],void 0===(n=function(t,e,i,o,n,a){Object.defineProperty(e,"__esModule",{value:!0}),e.LabelManager=i.default,e.GraphicsView2D=o.default,e.MapViewNavigation=n.default,e.MagnifierView2D=a.default}.apply(null,o))||(t.exports=n)},2281:function(t,e,i){var o,n;o=[i.dj.c(t.i),e],void 0===(n=function(t,e){function i(t,e,i,o){var n=null,a=1e3;"number"==typeof e?(a=e,o=i):(n=e,a=i);var r,s=0,u=function(){s=0,t.apply(o,r)},p=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];n&&n.apply(o,t),r=t,a?s||(s=setTimeout(u,a)):u()};return p.remove=function(){s&&(clearTimeout(s),s=0)},p.forceUpdate=function(){s&&(clearTimeout(s),u())},p.hasPendingUpdates=function(){return!!s},p}Object.defineProperty(e,"__esModule",{value:!0}),e.throttle=i,e.default=i}.apply(null,o))||(t.exports=n)},2553:function(t,e,i){var o,n;o=[i.dj.c(t.i),e,i(1),i(0),i(8),i(353),i(2281),i(2),i(2118)],void 0===(n=function(t,e,i,o,n,a,r,s,u){Object.defineProperty(e,"__esModule",{value:!0});var p=64,m=function(t){function e(e){var i=t.call(this)||this;return i._applyVisivilityPassThrottled=r.throttle(i._applyVisivilityPass,p,i),i._previousResolution=Number.POSITIVE_INFINITY,i.lastUpdateId=-1,i.updateRequested=!1,i.view=null,i}return i(e,t),e.prototype.initialize=function(){var t=this;this.collisionEngine=new u.CollisionEngine(this.view.featuresTilingScheme),this._layerViewSorter=new u.LayerViewSorter(function(e,i){t.collisionEngine.registerLayerView(e,i);var o=e.tileRenderer;o&&o.forEachTile(function(i){i.isDirty=!0,t.addTile(e,i)}),t.requestUpdate()},function(e){t.collisionEngine.unregisterLayerView(e),t.requestUpdate()}),this.handles.add(this.view.allLayerViews.on("change",function(e){t._layerViewSorter.update(e)}))},e.prototype.destroy=function(){this._layerViewSorter.destroy(),this._layerViewSorter=null,this.collisionEngine=null,this._applyVisivilityPassThrottled.remove()},Object.defineProperty(e.prototype,"updating",{get:function(){return this.updateRequested},enumerable:!0,configurable:!0}),e.prototype.update=function(t){var e=this._previousResolution,i=t.state.resolution;this._previousResolution=i,i===e&&this._applyVisivilityPassThrottled(t)},e.prototype.viewChange=function(){this.requestUpdate()},e.prototype.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate(this))},e.prototype.processUpdate=function(t){this._set("updateParameters",t),this.updateRequested&&(this.update(t),this.updateRequested=!1)},e.prototype.addTile=function(t,e){this.collisionEngine.addTile(t,e)},e.prototype.removeTile=function(t,e){this.collisionEngine.removeTile(t,e)},e.prototype._applyVisivilityPass=function(t){var e=this.view.featuresTilingScheme.getClosestInfoForScale(t.state.scale).level;this.collisionEngine.run(t.state,e)},o([s.property()],e.prototype,"updateRequested",void 0),o([s.property({readOnly:!0})],e.prototype,"updateParameters",void 0),o([s.property({dependsOn:["updateRequested"]})],e.prototype,"updating",null),o([s.property()],e.prototype,"view",void 0),o([s.subclass("esri.views.2d.layers.labels.LabelManager")],e)}(s.declared(n,a));e.default=m}.apply(null,o))||(t.exports=n)},2554:function(t,e,i){var o,n;o=[i.dj.c(t.i),e,i(1),i(0),i(96),i(8),i(2),i(34),i(234),i(2555),i(2556),i(2557),i(2558)],void 0===(n=function(t,e,i,o,n,a,r,s,u,p,m,l,h){Object.defineProperty(e,"__esModule",{value:!0});var c=new n({targetGeometry:new s}),d=[0,0],v=function(t){function e(e){var i=t.call(this)||this;return i._endTimer=null,i.animationManager=null,i}return i(e,t),e.prototype.initialize=function(){this.pan=new m({navigation:this}),this.rotate=new h({navigation:this}),this.pinch=new l({navigation:this}),this.zoomBox=new p({view:this.view,navigation:this})},e.prototype.destroy=function(){this.zoomBox.destroy(),this.zoomBox=null,this.animationManager=null},Object.defineProperty(e.prototype,"momentumEnabled",{get:function(){return!0},enumerable:!0,configurable:!0}),e.prototype.begin=function(){this._set("interacting",!0)},e.prototype.end=function(){var t=this;this._endTimer&&(clearTimeout(this._endTimer),this._endTimer=0),this._endTimer=setTimeout(function(){t._set("interacting",!1)},0)},e.prototype.zoom=function(t,e){if(void 0===e&&(e=this._getDefaultAnchor()),this.stop(),this.begin(),this.view.constraints.snapToZoom&&this.view.constraints.effectiveLODs)return t<1?this.zoomIn(e):this.zoomOut(e);this.setViewpoint(e,t,0,[0,0])},e.prototype.zoomIn=function(t){void 0===t&&(t=this._getDefaultAnchor());var e=this.view,i=e.scale,o=e.constraints.snapToNextScale(i);return e.goTo(this._scaleAndRotateViewpoint(c,t,o/i,0),{animate:this.momentumEnabled})},e.prototype.zoomOut=function(t){void 0===t&&(t=this._getDefaultAnchor());var e=this.view,i=e.scale,o=e.constraints.snapToPreviousScale(i);return e.goTo(this._scaleAndRotateViewpoint(c,t,o/i,0),{animate:this.momentumEnabled})},e.prototype.setViewpoint=function(t,e,i,o){this.begin(),this.view.state.viewpoint=this._scaleRotateTranslateViewpoint(this.view.viewpoint,t,e,i,o),this.end()},e.prototype.continousRotateClockwise=function(){var t=this.get("view.viewpoint");this.animationManager.animateContinous(t,function(t){u.rotateBy(t,t,-1)})},e.prototype.continousRotateCounterclockwise=function(){var t=this.get("view.viewpoint");this.animationManager.animateContinous(t,function(t){u.rotateBy(t,t,1)})},e.prototype.resetRotation=function(){this.view.rotation=0},e.prototype.continousPanLeft=function(){var t=this.get("view.viewpoint");this.animationManager.animateContinous(t,function(t){u.translateBy(t,t,[-10,0])})},e.prototype.continousPanRight=function(){var t=this.get("view.viewpoint");this.animationManager.animateContinous(t,function(t){u.translateBy(t,t,[10,0])})},e.prototype.continousPanUp=function(){var t=this.get("view.viewpoint");this.animationManager.animateContinous(t,function(t){u.translateBy(t,t,[0,10])})},e.prototype.continousPanDown=function(){var t=this.get("view.viewpoint");this.animationManager.animateContinous(t,function(t){u.translateBy(t,t,[0,-10])})},e.prototype.stop=function(){this.pan.stopMomentumNavigation(),this.animationManager.stop(),this.end(),this._endTimer&&(clearTimeout(this._endTimer),this._endTimer=0,this._set("interacting",!1))},e.prototype._getDefaultAnchor=function(){var t=this.view.size;return d[0]=.5*t[0],d[1]=.5*t[1],d},e.prototype._scaleAndRotateViewpoint=function(t,e,i,o){var n=this.view,a=n.size,r=n.padding,s=n.constraints,p=n.scale,m=n.viewpoint,l=p*i,h=s.canZoomInTo(l),c=s.canZoomOutTo(l);return i<1&&!h||i>1&&!c?m:u.padAndScaleAndRotateBy(t,m,i,o,e,a,r)},e.prototype._scaleRotateTranslateViewpoint=function(t,e,i,o,n){var a=this.view,r=a.size,s=a.padding,p=a.constraints,m=a.scale,l=a.viewpoint,h=m*i,c=p.canZoomInTo(h),d=p.canZoomOutTo(h);return(i<1&&!c||i>1&&!d)&&(i=1),u.translateBy(l,l,n),u.padAndScaleAndRotateBy(t,l,i,o,e,r,s)},o([r.property()],e.prototype,"animationManager",void 0),o([r.property({type:Boolean,readOnly:!0})],e.prototype,"interacting",void 0),o([r.property()],e.prototype,"pan",void 0),o([r.property()],e.prototype,"pinch",void 0),o([r.property()],e.prototype,"rotate",void 0),o([r.property()],e.prototype,"view",void 0),o([r.property()],e.prototype,"zoomBox",void 0),o([r.subclass("esri.views.2d.navigation.MapViewNavigation")],e)}(r.declared(a));e.default=v}.apply(null,o))||(t.exports=n)},2555:function(t,e,i){var o,n;o=[i.dj.c(t.i),e,i(1),i(0),i(8),i(20),i(2)],void 0===(n=function(t,e,i,o,n,a,r){var s="esri-zoom-box__container",u="esri-zoom-box__overlay",p="esri-zoom-box__overlay-background",m="esri-zoom-box__outline",l="Shift",h="Ctrl";return function(t){function e(e){var i=t.call(this,e)||this;return i._container=null,i._overlay=null,i._backgroundShape=null,i._boxShape=null,i._box={x:0,y:0,width:0,height:0},i._redraw=i._redraw.bind(i),i}return i(e,t),e.prototype.destroy=function(){this.view=null},Object.defineProperty(e.prototype,"view",{set:function(t){var e=this;this._handles&&this._handles.forEach(function(t){t.remove()}),this._handles=null,this._destroyOverlay(),this._set("view",t),t&&(t.on("drag",[l],function(t){return e._handleDrag(t,1)}),t.on("drag",[l,h],function(t){return e._handleDrag(t,-1)}))},enumerable:!0,configurable:!0}),e.prototype._start=function(t,e,i,o){this._createContainer(),this._createOverlay(),this.navigation.begin()},e.prototype._update=function(t,e,i,o){this._box.x=t,this._box.y=e,this._box.width=i,this._box.height=o,this._rafId||(this._rafId=requestAnimationFrame(this._redraw))},e.prototype._end=function(t,e,i,o,n){var r=this.view,s=r.toMap(a.createScreenPoint(t+.5*i,e+.5*o)),u=Math.max(i/r.width,o/r.height);-1===n&&(u=1/u),this._destroyOverlay(),this.navigation.end(),r.goTo({center:s,scale:r.scale*u})},e.prototype._updateBox=function(t,e,i,o){var n=this._boxShape;n.setAttributeNS(null,"x",""+t),n.setAttributeNS(null,"y",""+e),n.setAttributeNS(null,"width",""+i),n.setAttributeNS(null,"height",""+o),n.setAttributeNS(null,"class",m)},e.prototype._updateBackground=function(t,e,i,o){this._backgroundShape.setAttributeNS(null,"d",this._toSVGPath(t,e,i,o,this.view.width,this.view.height))},e.prototype._createContainer=function(){var t=document.createElement("div");t.className=s,this.view.root.appendChild(t),this._container=t},e.prototype._createOverlay=function(){var t=this.view.width,e=this.view.height,i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttributeNS(null,"d","M 0 0 L "+t+" 0 L "+t+" "+e+" L 0 "+e+" Z"),i.setAttributeNS(null,"class",p);var o=document.createElementNS("http://www.w3.org/2000/svg","rect"),n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),n.setAttributeNS(null,"class",u),n.appendChild(i),n.appendChild(o),this._container.appendChild(n),this._backgroundShape=i,this._boxShape=o,this._overlay=n},e.prototype._destroyOverlay=function(){this._container&&this._container.parentNode&&this._container.parentNode.removeChild(this._container),this._container=this._backgroundShape=this._boxShape=this._overlay=null},e.prototype._toSVGPath=function(t,e,i,o,n,a){var r=t+i,s=e+o;return"M 0 0 L "+n+" 0 L "+n+" "+a+" L 0 "+a+" ZM "+t+" "+e+" L "+t+" "+s+" L "+r+" "+s+" L "+r+" "+e+" Z"},e.prototype._handleDrag=function(t,e){var i,o,n,a,r=t.x,s=t.y,u=t.origin.x,p=t.origin.y;switch(r>u?(i=u,n=r-u):(i=r,n=u-r),s>p?(o=p,a=s-p):(o=s,a=p-s),t.action){case"start":this._start(i,o,n,a);break;case"update":this._update(i,o,n,a);break;case"end":this._end(i,o,n,a,e)}t.stopPropagation()},e.prototype._redraw=function(){if(this._rafId&&(this._rafId=null,this._overlay)){var t=this._box,e=t.x,i=t.y,o=t.width,n=t.height;this._updateBox(e,i,o,n),this._updateBackground(e,i,o,n),this._rafId=requestAnimationFrame(this._redraw)}},o([r.property()],e.prototype,"navigation",void 0),o([r.property()],e.prototype,"view",null),o([r.subclass("esri.views.2d.navigation.ZoomBox")],e)}(r.declared(n))}.apply(null,o))||(t.exports=n)},2556:function(t,e,i){var o,n;o=[i.dj.c(t.i),e,i(1),i(0),i(35),i(96),i(8),i(20),i(2),i(10),i(6),i(234),i(532)],void 0===(n=function(t,e,i,o,n,a,r,s,u,p,m,l,h){return function(t){function e(e){var i=t.call(this)||this;return i.animationTime=0,i.momentumEstimator=new h.PanPlanarMomentumEstimator(500,6,.92),i.momentum=null,i.tmpMomentum=m.vec3f64.create(),i.momentumFinished=!1,i.viewpoint=new a({targetGeometry:new n.Point,scale:0,rotation:0}),i.watch("momentumFinished",function(t){t&&i.navigation.stop()}),i}return i(e,t),e.prototype.begin=function(t,e){this.navigation.begin(),this.momentumEstimator.reset(),this.addToEstimator(e),this.previousDrag=e},e.prototype.update=function(t,e){this.addToEstimator(e);var i=e.center.x,o=e.center.y,n=this.previousDrag;i=n?n.center.x-i:-i,o=n?o-n.center.y:o,t.viewpoint=l.translateBy(this.viewpoint,t.viewpoint,[i||0,o||0]),this.previousDrag=e},e.prototype.end=function(t,e){this.addToEstimator(e);var i=this.navigation.momentumEnabled;this.momentum=i?this.momentumEstimator.evaluateMomentum():null,this.animationTime=0,this.momentum&&this.onAnimationUpdate(t),this.previousDrag=null,this.navigation.end()},e.prototype.addToEstimator=function(t){var e=t.center.x,i=t.center.y,o=s.createScreenPointArray(-e,i),n=m.vec3f64.fromValues(-e,i,0);this.momentumEstimator.add(o,n,.001*t.timestamp)},e.prototype.onAnimationUpdate=function(t){var e=this;this.navigation.animationManager.animateContinous(t.viewpoint,function(i,o){e.momentumFinished=!e.momentum||e.momentum.isFinished(e.animationTime);var n=.001*o;if(!e.momentumFinished){var a=e.momentum.valueDelta(e.animationTime,n);p.vec3.scale(e.tmpMomentum,e.momentum.direction,a),t.viewpoint=l.translateBy(i,i,e.tmpMomentum)}e.animationTime+=n})},e.prototype.stopMomentumNavigation=function(){this.momentum&&(this.momentumEstimator.reset(),this.momentum=null,this.navigation.stop())},o([u.property()],e.prototype,"momentumFinished",void 0),o([u.property()],e.prototype,"viewpoint",void 0),o([u.property()],e.prototype,"navigation",void 0),o([u.subclass("esri.views.2d.navigation.actions.Pan")],e)}(u.declared(r))}.apply(null,o))||(t.exports=n)},2557:function(t,e,i){var o,n;o=[i.dj.c(t.i),e,i(1),i(0),i(35),i(96),i(8),i(2),i(45),i(46),i(234),i(533),i(534)],void 0===(n=function(t,e,i,o,n,a,r,s,u,p,m,l,h){return function(t){function e(e){var i=t.call(this,e)||this;return i._animationTime=0,i._momentumFinished=!1,i._rotationMomentumEstimator=new l.RotationMomentumEstimator(.6,.15,.95),i._rotationDirection=1,i._zoomDirection=1,i._zoomMomentumEstimator=new h.ZoomMomentumEstimator,i._zoomOnly=null,i.zoomMomentum=null,i.rotateMomentum=null,i.viewpoint=new a({targetGeometry:new n.Point,scale:0,rotation:0}),i.watch("_momentumFinished",function(t){t&&i.navigation.stop()}),i}return i(e,t),e.prototype.begin=function(t,e){this.navigation.begin(),this._rotationMomentumEstimator.reset(),this._zoomMomentumEstimator.reset(),this._zoomOnly=null,this._previousAngle=this._startAngle=e.angle,this._previousRadius=this._startRadius=e.radius,this._previousCenter=e.center,this._updateTimestamp=null,t.constraints.rotationEnabled&&this.addToRotateEstimator(0,e.timestamp),this.addToZoomEstimator(e,1)},e.prototype.update=function(t,e){null===this._updateTimestamp&&(this._updateTimestamp=e.timestamp);var i=e.angle,o=e.radius,n=e.center,a=Math.abs(180*(i-this._startAngle)/Math.PI),r=Math.abs(o-this._startRadius),s=this._startRadius/o;if(this._previousRadius){var u=o/this._previousRadius,p=180*(i-this._previousAngle)/Math.PI;this._rotationDirection=p>=0?1:-1,this._zoomDirection=u>=1?1:-1,t.constraints.rotationEnabled?(null===this._zoomOnly&&e.timestamp-this._updateTimestamp>200&&(this._zoomOnly=r-a>0),null===this._zoomOnly||this._zoomOnly?p=0:this.addToRotateEstimator(i-this._startAngle,e.timestamp)):p=0,this.addToZoomEstimator(e,s),this.navigation.setViewpoint([n.x,n.y],1/u,p,[this._previousCenter.x-n.x,n.y-this._previousCenter.y])}this._previousAngle=i,this._previousRadius=o,this._previousCenter=n},e.prototype.end=function(t,e){this.navigation.momentumEnabled&&(this.rotateMomentum=this._rotationMomentumEstimator.evaluateMomentum(),this.zoomMomentum=this._zoomMomentumEstimator.evaluateMomentum(),this._animationTime=0,(this.rotateMomentum||this.zoomMomentum)&&this.onAnimationUpdate(t)),this.navigation.end()},e.prototype.addToRotateEstimator=function(t,e){this._rotationMomentumEstimator.add(t,.001*e)},e.prototype.addToZoomEstimator=function(t,e){this._zoomMomentumEstimator.add(e,.001*t.timestamp)},e.prototype.canZoomIn=function(t){var e=t.scale,i=t.constraints.effectiveMaxScale;return 0===i||e>i},e.prototype.canZoomOut=function(t){var e=t.scale,i=t.constraints.effectiveMinScale;return 0===i||e<i},e.prototype.onAnimationUpdate=function(t){var e=this;this.navigation.animationManager.animateContinous(t.viewpoint,function(i,o){var n=!e.canZoomIn(t)&&e._zoomDirection>1||!e.canZoomOut(t)&&e._zoomDirection<1,a=!e.rotateMomentum||e.rotateMomentum.isFinished(e._animationTime),r=n||!e.zoomMomentum||e.zoomMomentum.isFinished(e._animationTime),s=.001*o;if(e._momentumFinished=a&&r,!e._momentumFinished){var l=e.rotateMomentum?Math.abs(e.rotateMomentum.valueDelta(e._animationTime,s))*e._rotationDirection*180/Math.PI:0,h=e.zoomMomentum?Math.abs(e.zoomMomentum.valueDelta(e._animationTime,s)):1,c=p.vec2f64.create(),d=p.vec2f64.create();if(e._previousCenter){u.vec2.set(c,e._previousCenter.x,e._previousCenter.y),m.getPaddingScreenTranslation(d,t.size,t.padding),u.vec2.add(c,c,d);var v=t.constraints,y=t.scale,f=y*h;h<1&&!v.canZoomInTo(f)?(h=y/v.effectiveMaxScale,e.zoomMomentum=null,e.rotateMomentum=null):h>1&&!v.canZoomOutTo(f)&&(h=y/v.effectiveMinScale,e.zoomMomentum=null,e.rotateMomentum=null),m.scaleAndRotateBy(i,t.viewpoint,h,l,c,t.size)}}e._animationTime+=s})},e.prototype.stopMomentumNavigation=function(){(this.rotateMomentum||this.zoomMomentum)&&(this.rotateMomentum&&(this._rotationMomentumEstimator.reset(),this.rotateMomentum=null),this.zoomMomentum&&(this._zoomMomentumEstimator.reset(),this.zoomMomentum=null),this.navigation.stop())},o([s.property()],e.prototype,"_momentumFinished",void 0),o([s.property()],e.prototype,"viewpoint",void 0),o([s.property()],e.prototype,"navigation",void 0),o([s.subclass("esri.views.2d.navigation.actions.Pinch")],e)}(s.declared(r))}.apply(null,o))||(t.exports=n)},2558:function(t,e,i){var o,n;o=[i.dj.c(t.i),e,i(1),i(0),i(35),i(96),i(8),i(2),i(45),i(46),i(234)],void 0===(n=function(t,e,i,o,n,a,r,s,u,p,m){var l=p.vec2f64.create(),h=p.vec2f64.create();return function(t){function e(e){var i=t.call(this,e)||this;return i._previousCenter=p.vec2f64.create(),i.viewpoint=new a({targetGeometry:new n.Point,scale:0,rotation:0}),i}return i(e,t),e.prototype.begin=function(t,e){this.navigation.begin(),u.vec2.set(this._previousCenter,e.center.x,e.center.y)},e.prototype.update=function(t,e){var i=t.state,o=i.size,n=i.padding;u.vec2.set(l,e.center.x,e.center.y),m.getAnchor(h,o,n),t.viewpoint=m.rotateBy(this.viewpoint,t.content.viewpoint,m.angleBetween(h,this._previousCenter,l)),u.vec2.copy(this._previousCenter,l)},e.prototype.end=function(t,e){this.navigation.end()},o([s.property()],e.prototype,"viewpoint",void 0),o([s.property()],e.prototype,"navigation",void 0),o([s.subclass("esri.views.2d.actions.Rotate")],e)}(s.declared(r))}.apply(null,o))||(t.exports=n)},2559:function(t,e,i){var o,n;o=[i.dj.c(t.i),e,i(12),i(11),i(9),i(23),i(7),i(472),i(2118)],void 0===(n=function(t,e,i,o,n,a,r,s,u){Object.defineProperty(e,"__esModule",{value:!0});var p=(s.enums.DataType,s.enums.Usage,s.enums.TextureSamplingMode,s.enums.TextureType,s.enums.TextureWrapMode,s.enums.PrimitiveType,s.enums.PixelFormat,s.enums.PixelType,u.enums.WGLDrawPhase),m=function(e){function m(){var i=e.call(this)||this;return i.visible=!1,i._loadResources(t.toUrl("../../../images/magnifier/mask.png"),t.toUrl("../../../images/magnifier/overlay.png")),i}return i(m,e),m.prototype.destroy=function(){this._readbackTexture&&(this._readbackTexture.dispose(),this._readbackTexture=null,this._maskTexture.dispose(),this._maskTexture=null,this._overlayTexture.dispose(),this._overlayTexture=null,this._vertexArrayObject.dispose(),this._vertexArrayObject=null,this._program.dispose(),this._program=null)},Object.defineProperty(m.prototype,"magnifier",{get:function(){return this._magnifier},set:function(t){var e=this;this._magnifier=t,this._handle&&this._handle.remove(),this._handle=t.watch("version",function(){e.visible=t.visible}),this.visible=t.visible},enumerable:!0,configurable:!0}),m.prototype.doRender=function(t){var e=this.stage.context;if(t.drawPhase===p.MAP&&this._canRender()){this._updateResources(e);var i=this._magnifier,o=1/i.factor,n=Math.ceil(o*this.overlay.width),a=Math.ceil(o*this.overlay.height),r=t.state.size,s=t.pixelRatio,u=s*r[0],m=s*r[1],l=i.position||{x:.5*r[0],y:.5*r[1]},h=s*l.x,c=m-s*l.y,d=.5*n,v=.5*a;d>h?h=d:h>=u-d&&(h=u-d-1),v>c?c=v:c>=m-v&&(c=m-v-1);var y=h-d,f=c-v,_=this._readbackTexture;e.bindTexture(_,0),e.gl.copyTexImage2D(_.descriptor.target,0,_.descriptor.pixelFormat,y,f,n,a,0);var g=this.stage.background&&this.stage.background.color,w=g?[g.a*g.r/255,g.a*g.g/255,g.a*g.b/255,g.a]:[1,1,1,1],b=(h+i.offsetX)/u*2-1,T=(c-i.offsetY)/m*2-1,M=this.overlay.width/u*2,x=this.overlay.height/m*2,z=this._program;e.bindVAO(this._vertexArrayObject),e.bindTexture(this._overlayTexture,6),e.bindTexture(this._maskTexture,7),e.bindProgram(z),z.setUniform4fv("u_background",w),z.setUniform1i("u_readbackTexture",0),z.setUniform1i("u_overlyTexture",6),z.setUniform1i("u_maskTexture",7),z.setUniform2f("u_drawPos",b,T),z.setUniform1f("u_width",M),z.setUniform1f("u_height",x),e.drawArrays(5,0,4),e.bindVAO()}},m.prototype._canRender=function(){return this.mask&&this.overlay&&null!=this._magnifier},m.prototype._loadResources=function(t,e){return o(this,void 0,void 0,function(){var i,o,s;return n(this,function(n){switch(n.label){case 0:return[4,r.all([a(t,{responseType:"image"}),a(e,{responseType:"image"})])];case 1:return i=n.sent(),o=i[0].data,s=i[1].data,this.mask=o,this.overlay=s,this.requestRender(),[2]}})})},m.prototype._updateResources=function(t){if(!this._readbackTexture){var e=1/this._magnifier.factor,i=Math.ceil(e*this.overlay.width),o=Math.ceil(e*this.overlay.height);this._program=u.createMagnifierProgram(t);var n=new Uint16Array([0,1,0,0,1,1,1,0]),a=u.magnifier.attributes;this._vertexArrayObject=new s.VertexArrayObject(t,a,{geometry:[{name:"a_pos",count:2,type:5123,offset:0,stride:4,normalized:!1,divisor:0}]},{geometry:s.BufferObject.createVertex(t,35044,n)}),this._overlayTexture=new s.Texture(t,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!0},this.overlay),this._maskTexture=new s.Texture(t,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!0},this.mask),this._readbackTexture=new s.Texture(t,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!1,width:i,height:o})}},m}(u.DisplayObject);e.default=m}.apply(null,o))||(t.exports=n)}}]);