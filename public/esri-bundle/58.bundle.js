(function(){(this||window).webpackJsonp.registerAbsMids({"esri/views/3d/layers/WMTSLayerView3D":2163,"esri/views/layers/LayerView":2174,"esri/views/layers/RefreshableLayerView":2175,"esri/views/3d/layers/LayerView3D":2176,"esri/views/3d/layers/support/layerViewUpdatingProperties":2180,"esri/views/3d/layers/TiledLayerView3D":2199})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{2163:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1),r(0),r(9),r(11),r(15),r(18),r(13),r(7),r(29),r(2),r(2199),r(2175)],void 0===(n=function(e,t,r,i,n,a,o,l,s,p,u,c,d,y){var h=s.getLogger("esri.views.3d.layers.WMTSLayerView3d");return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._handles=new l,t}return r(t,e),t.prototype.initialize=function(){var e=this,t=u.whenTrueOnce(this.view,"basemapTerrain.tilingSchemeDone").then(function(){var t=function(){return new o("layerview:no-compatible-tiling-scheme","None of the tiling schemes supported by the service are compatible with the scene.")};if(!e.view.basemapTerrain.tilingSchemeLocked)return p.reject(t());var r,i=e.view.basemapTerrain.tilingScheme,n=e.layer.activeLayer;if(n&&n.tileMatrixSet){var a=(r=n.tileMatrixSet).tileInfo,l=e._getTileInfoSupportError(a,r.fullExtent)||e._getTileInfoCompatibilityError(a,i);if(l)return p.reject(l)}else{if(!(r=e._getCompatibleTileMatrixSet()))return p.reject(t());n.tileMatrixSetId=r.id}e._set("tileInfo",r.tileInfo),e._set("fullExtent",r.fullExtent),e.layer.fullExtent=r.fullExtent});this.addResolvingPromise(t),this.when(function(){return e._initialized()})},t.prototype.destroy=function(){this._handles.removeAll()},t.prototype.refresh=function(){this.emit("data-changed")},t.prototype.canResume=function(){if(!this.inherited(arguments))return!1;var e=this.layer.activeLayer.tileMatrixSet;return e&&!this._getTileInfoError(e.tileInfo,e.fullExtent)},t.prototype.doRefresh=function(e){return a(this,void 0,void 0,function(){return n(this,function(e){return this.suspended?[2]:(this.emit("data-changed"),[2])})})},t.prototype._initialized=function(){var e=this;this._handles.add(this.watch("layer.activeLayer.styleId, tileMatrixSet",function(){return e.refresh()})),this._handles.add(this.layer.watch("activeLayer",function(t){var r=t.tileMatrixSet;if(r){var i=e._getTileInfoError(r.tileInfo,r.fullExtent);i&&(h.error("The selected tile matrix set is not compatible with the view",i),r=null)}else(r=e._getCompatibleTileMatrixSet())?t.tileMatrixSetId=r.id:h.error("The layer does not provide a tiling scheme that is compatible with the view");e.notifyChange("suspended"),e.canResume()&&e.refresh()}))},t.prototype._getCompatibleTileMatrixSet=function(){var e=this;return this.layer.activeLayer.tileMatrixSets.find(function(t){var r=t.tileInfo;return!e._getTileInfoError(r,t.fullExtent)})},t.prototype._getTileInfoError=function(e,t){return this._getTileInfoSupportError(e,t)||this._getTileInfoCompatibilityError(e,this.view.basemapTerrain.tilingScheme)},i([c.property()],t.prototype,"fullExtent",void 0),i([c.property()],t.prototype,"layer",void 0),i([c.property({dependsOn:["layer.activeLayer"]})],t.prototype,"suspended",void 0),i([c.property()],t.prototype,"tileInfo",void 0),i([c.subclass("esri.views.3d.layers.WMTSLayerView3D")],t)}(c.declared(d,y))}.apply(null,i))||(e.exports=n)},2174:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1),r(0),r(50),r(353),r(284),r(13),r(283),r(7),r(2)],void 0===(n=function(e,t,r,i,n,a,o,l,s,p,u){return function(e){function t(t){var r=e.call(this)||this;return r.layer=null,r.parent=null,r.view=null,r}return r(t,e),t.prototype.initialize=function(){var e=this;this.addResolvingPromise(this.layer),this.when().catch(function(t){if("layerview:create-error"!==t.name){var r=e.layer&&e.layer.id||"no id",i=e.layer&&e.layer.title||"no title";return l.getLogger(e.declaredClass).error("#resolve()","Failed to resolve layer view (layer title: '"+i+"', id: '"+r+"')",t),p.reject(t)}})},t.prototype.destroy=function(){this.layer=this.view=this.parent=null},Object.defineProperty(t.prototype,"suspended",{get:function(){return!this.canResume()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!this.suspended&&this.isUpdating()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visible",{get:function(){return!0===this.get("layer.visible")},set:function(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fullOpacity",{get:function(){var e=function(e){return null==e?1:e};return e(this.get("layer.opacity"))*e(this.get("parent.fullOpacity"))},enumerable:!0,configurable:!0}),t.prototype.canResume=function(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1},t.prototype.isUpdating=function(){return!1},i([u.property()],t.prototype,"layer",void 0),i([u.property()],t.prototype,"parent",void 0),i([u.property({readOnly:!0,dependsOn:["view","visible","layer.loaded","parent.suspended"]})],t.prototype,"suspended",null),i([u.property({type:Boolean,dependsOn:["suspended"],readOnly:!0})],t.prototype,"updating",null),i([u.property()],t.prototype,"view",void 0),i([u.property({dependsOn:["layer.visible"]})],t.prototype,"visible",null),i([u.property({dependsOn:["layer.opacity","parent.fullOpacity"]})],t.prototype,"fullOpacity",null),i([u.subclass("esri.views.layers.LayerView")],t)}(u.declared(a,n,o.Identifiable,s))}.apply(null,i))||(e.exports=n)},2175:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1),r(0),r(9),r(11),r(8),r(7),r(2)],void 0===(n=function(e,t,r,i,n,a,o,l,s){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.refreshTimestamp=null,t.refreshDebounced=l.debounce(function(e,r){return a(t,void 0,void 0,function(){var t;return n(this,function(i){switch(i.label){case 0:return"number"==typeof e?t=e:(t=Date.now(),r=e),this._set("refreshTimestamp",t),this.doRefresh?[4,this.doRefresh(r)]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}})})},2e3),t}return r(t,e),t.prototype.refresh=function(e){void 0===e&&(e=Date.now()),this._set("refreshTimestamp",e),this.doRefresh&&this.doRefresh()},i([s.property()],t.prototype,"layer",void 0),i([s.aliasOf("layer.refreshInterval")],t.prototype,"refreshInterval",void 0),i([s.property({readOnly:!0})],t.prototype,"refreshTimestamp",void 0),i([s.subclass("esri.layers.mixins.RefreshableLayerView")],t)}(s.declared(o))}.apply(null,i))||(e.exports=n)},2176:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1),r(0),r(7),r(29),r(2),r(473),r(2174)],void 0===(n=function(e,t,r,i,n,a,o,l,s){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.slicePlaneEnabled=!1,t.supportsHeightUnitConversion=!1,t}return r(t,e),t.prototype.postscript=function(e){this.inherited(arguments),l.mayHaveHeightModelInfo(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())},t.prototype._validateHeightModelInfo=function(){var e=this;return n.create(function(t,r){a.whenFalseOnce(e.view.defaultsFromMap,"isHeightModelInfoSearching",function(){var i=l.rejectLayerError(e.layer,e.view.heightModelInfo,e.supportsHeightUnitConversion);i?r(i):t()})})},i([o.property()],t.prototype,"view",void 0),i([o.property()],t.prototype,"slicePlaneEnabled",void 0),i([o.subclass("esri.views.3d.layers.LayerView3D")],t)}(o.declared(s))}.apply(null,i))||(e.exports=n)},2180:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.updatingPercentageValue={value:100,readOnly:!0},t.updatingPercentage={dependsOn:["updating","updatingPercentageValue"],readOnly:!0,value:0,get:function(){return this.updating?this.updatingPercentageValue:0}}}.apply(null,i))||(e.exports=n)},2199:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1),r(0),r(4),r(15),r(2),r(2176),r(2180),r(203)],void 0===(n=function(e,t,r,i,n,a,o,l,s,p){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._isUpdating=!1,t}return r(t,e),Object.defineProperty(t.prototype,"imageFormatIsOpaque",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isOpaque",{get:function(){return this.fullOpacity>=1&&this.imageFormatIsOpaque},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataLevelRange",{get:function(){var e=this.tileInfo.lods,t=e[0].scale,r=e[e.length-1].scale;return this.levelRangeFromScaleRange(t,r)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"displayLevelRange",{get:function(){var e=this.tileInfo.lods,t=this.layer.minScale||e[0].scale,r=this.layer.maxScale||e[e.length-1].scale,i=this.levelRangeFromScaleRange(t,r);return this.layer.maxScale&&i.maxLevel++,i},enumerable:!0,configurable:!0}),t.prototype.getTileUrl=function(e,t,r){return this.layer.getTileUrl(e,t,r)},t.prototype.updatingChanged=function(e){this._isUpdating=e,this.notifyChange("updating")},t.prototype.isUpdating=function(){return this._isUpdating},t.prototype._getTileInfoSupportError=function(e,t){var r=p.checkIfTileInfoSupportedForView(e,t,this.view.spatialReference,this.view.basemapTerrain.manifold);if(r){var i={layer:this.layer,error:r},n=void 0;switch(r.name){case"tilingscheme:local-gcs-not-supported":n=new a("layerview:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes",i);break;case"tilingscheme:spatial-reference-mismatch":case"tilingscheme:global-unsupported-spatial-reference":n=new a("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",i);break;default:n=new a("layerview:tiling-scheme-unsupported","The tiling scheme of this layer is not supported by SceneView",i)}return n}return null},t.prototype._getTileInfoCompatibilityError=function(e,t){return t.compatibleWith(e)?null:new a("layerview:tiling-scheme-incompatible","The tiling scheme of this layer is incompatible with the tiling scheme of the surface")},t.prototype.levelRangeFromScaleRange=function(e,t){var r={minLevel:0,maxLevel:1/0},i=this.view.basemapTerrain&&this.view.basemapTerrain.tilingScheme;if(!i)return r;var n=i.levels[0],a=function(e){var t=Math.log(n.scale/e)/Math.LN2;return.5-Math.abs(.5-t%1)<1e-9?Math.round(t):Math.ceil(t)};return null!=e&&e>0&&(r.minLevel=Math.max(0,a(e))),null!=t&&t>0&&(r.maxLevel=Math.max(0,a(t))),r},i([o.property({readOnly:!0})],t.prototype,"imageFormatIsOpaque",null),i([o.property(s.updatingPercentage)],t.prototype,"updatingPercentage",void 0),i([o.property(s.updatingPercentageValue)],t.prototype,"updatingPercentageValue",void 0),i([o.property({readOnly:!0})],t.prototype,"fullExtent",void 0),i([o.property({readOnly:!0,dependsOn:["fullOpacity","imageFormatIsOpaque"]})],t.prototype,"isOpaque",null),i([o.property({readOnly:!0,dependsOn:["tileInfo","view.basemapTerrain.tilingScheme"]})],t.prototype,"dataLevelRange",null),i([o.property({readOnly:!0,dependsOn:["tileInfo","view.basemapTerrain.tilingScheme","layer.minScale","layer.maxScale"]})],t.prototype,"displayLevelRange",null),i([o.property()],t.prototype,"layer",void 0),i([o.property({readOnly:!0})],t.prototype,"tileInfo",void 0),i([o.subclass("esri.views.3d.layers.TiledLayerView3D")],t)}(o.declared(l))}.apply(null,i))||(e.exports=n)}}]);