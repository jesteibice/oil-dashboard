(function(){(this||window).webpackJsonp.registerAbsMids({"esri/views/3d/layers/LayerView3D":2176,"esri/views/3d/layers/support/projectExtentUtils":2186,"esri/views/3d/layers/graphics/QueryEngine":2217,"esri/views/3d/layers/graphics/Graphics3DFrustumVisibility":2218,"esri/views/3d/layers/support/attributeUtils":2238,"esri/renderers/support/renderingInfoUtils":2261,"esri/views/3d/layers/graphics/Graphics3DFeatureLikeLayerView":2262,"esri/views/3d/layers/graphics/Graphics3DFilterVisibility":2263,"esri/views/3d/layers/FeatureLikeLayerView3D":2327})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{2176:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(1),i(0),i(7),i(29),i(2),i(473),i(2174)],void 0===(n=function(e,t,i,r,n,s,o,a,u){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.slicePlaneEnabled=!1,t.supportsHeightUnitConversion=!1,t}return i(t,e),t.prototype.postscript=function(e){this.inherited(arguments),a.mayHaveHeightModelInfo(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())},t.prototype._validateHeightModelInfo=function(){var e=this;return n.create(function(t,i){s.whenFalseOnce(e.view.defaultsFromMap,"isHeightModelInfoSearching",function(){var r=a.rejectLayerError(e.layer,e.view.heightModelInfo,e.supportsHeightUnitConversion);r?i(r):t()})})},r([o.property()],t.prototype,"view",void 0),r([o.property()],t.prototype,"slicePlaneEnabled",void 0),r([o.subclass("esri.views.3d.layers.LayerView3D")],t)}(o.declared(u))}.apply(null,r))||(e.exports=n)},2186:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(47),i(7),i(57),i(357)],void 0===(n=function(e,t,i,r,n,s){Object.defineProperty(t,"__esModule",{value:!0}),t.toViewIfLocal=function(e){var t=e.view.spatialReference,o=e.layer.fullExtent,a=o&&o.spatialReference;return a?a.equals(t)?r.resolve(o.clone()):n.canProject(a,t)?r.resolve(n.project(o,t)):e.view.state.isLocal?i.safeCast(s.projectGeometry(o,t,e.layer.portalItem).then(function(t){if(!e.destroyed&&t)return t}).catch(function(){return null})):r.resolve(null):r.resolve(null)}}.apply(null,r))||(e.exports=n)},2217:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(0),i(1),i(9),i(11),i(35),i(8),i(14),i(2),i(30),i(811),i(93),i(163)],void 0===(n=function(e,t,i,r,n,s,o,a,u,l,p,h,c,d){Object.defineProperty(t,"__esModule",{value:!0});var y=h.default,f=function(e){function t(t){var i=e.call(this)||this;return i._dataQueryEngineInstance=null,i}return r(t,e),Object.defineProperty(t.prototype,"queryGeometryType",{get:function(){switch(this.layer.geometryType){case"multipoint":case"point":case"polygon":case"polyline":return this.layer.geometryType;case"mesh":return"polygon"}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"defaultQueryJSON",{get:function(){return new d({outSpatialReference:this.spatialReference}).toJSON()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dataQueryEngine",{get:function(){return this.ensureDataQueryEngine()},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){this.clear()},t.prototype.clear=function(){return!!this._dataQueryEngineInstance&&(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null,!0)},t.prototype.executeQueryForIdSet=function(e,t){return s(this,void 0,void 0,function(){return n(this,function(i){return[2,this.dataQueryEngine.executeQueryForIdSet(this._ensureQueryJSON(e),t)]})})},t.prototype.executeQueryForCount=function(e,t){return s(this,void 0,void 0,function(){return n(this,function(i){return[2,this.dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(e),t)]})})},t.prototype.executeQueryForExtent=function(e,t){return s(this,void 0,void 0,function(){var i,r,s,o;return n(this,function(n){switch(n.label){case 0:return[4,this.dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(e),t)];case 1:return i=n.sent(),r=i.count,s=i.extent,o=p.fromJSON(s),[2,{count:r,extent:o}]}})})},t.prototype.executeQueryForIds=function(e,t){return s(this,void 0,void 0,function(){return n(this,function(i){return[2,this.dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(e),t)]})})},t.prototype.executeQuery=function(e,t){return s(this,void 0,void 0,function(){var i,r,s=this;return n(this,function(n){switch(n.label){case 0:return[4,this.dataQueryEngine.executeQuery(this._ensureQueryJSON(e),t)];case 1:return i=n.sent(),(r=c.fromJSON(i)).features.forEach(function(e){e.layer=s.layer,e.sourceLayer=s.layer}),[2,r]}})})},t.prototype._ensureQueryJSON=function(e){return u.isNone(e)?this.defaultQueryJSON:("outSpatialReference"in e&&!e.outSpatialReference&&(e.outSpatialReference=this.spatialReference),e.toJSON())},t.prototype.ensureDataQueryEngine=function(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;var e="timeInfo"in this.layer&&this.layer.timeInfo&&this.layer.timeInfo.toJSON()||null,t=this.layer.objectIdField,i=o.featureGeometryTypeKebabDictionary.toJSON(this.queryGeometryType),r=this.layer.fields.map(function(e){return e.toJSON()}),n=this.layerView.view.resourceController.scheduler,s=this.priority,a=this.spatialReference.toJSON(),u=this.layerView.graphics3d.graphicsCore.featureStore,l=this.layerView,p=l.hasZ,h=l.hasM;return this._dataQueryEngineInstance=new y({hasZ:p,hasM:h,geometryType:i,fields:r,timeInfo:e,spatialReference:a,objectIdField:t,featureStore:u,scheduler:n,priority:s}),this._dataQueryEngineInstance},i([l.property({constructOnly:!0})],t.prototype,"layerView",void 0),i([l.property({constructOnly:!0})],t.prototype,"priority",void 0),i([l.property({readOnly:!0,aliasOf:"layerView.view.spatialReference"})],t.prototype,"spatialReference",void 0),i([l.property({readOnly:!0,aliasOf:"layerView.layer"})],t.prototype,"layer",void 0),i([l.property({readOnly:!0,dependsOn:["layer.geometryType"]})],t.prototype,"queryGeometryType",null),i([l.property({readOnly:!0,dependsOn:["spatialReference"]})],t.prototype,"defaultQueryJSON",null),i([l.subclass("esri.views.3d.layers.graphics.QueryEngine")],t)}(l.declared(a));t.QueryEngine=f,t.default=f}.apply(null,r))||(e.exports=n)},2218:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(1),i(0),i(8),i(18),i(29),i(2),i(64),i(829)],void 0===(n=function(e,t,i,r,n,s,o,a,u,l){var p=-.3*u.earthRadius;return function(e){function t(){var t=e.call(this)||this;return t.suspended=!1,t._dirty=!0,t.extent=null,t.extentIntersectionDirty=!0,t._isVisibleBelowSurface=!1,t.handles=new s,t.layerView=null,t}return i(t,e),Object.defineProperty(t.prototype,"dirty",{get:function(){return this._dirty},set:function(e){e!==this._dirty&&(this._dirty=e,this.notifyChange("updating"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return this.dirty},enumerable:!0,configurable:!0}),t.prototype.setup=function(e){var t=this;this.layerView=e,this.extentIntersection=new l.FrustumExtentIntersection({renderCoordsHelper:e.view.renderCoordsHelper});var i=e.view,r=i.basemapTerrain,n=i.resourceController.scheduler;this.handles.add([i.on("resize",function(){return t.viewChange()}),i.state.watch("camera",function(){return t.viewChange()},!0),n.registerTask(6,function(){return t.update()},function(){return t.dirty}),r.on("elevation-bounds-change",function(){return t.elevationBoundsChange()})]),"local"===i.viewingMode?this.isVisibleBelowSurface=!0:this.handles.add(o.init(r,["opacity","wireframe"],function(){return t.isVisibleBelowSurface=!r.isOpaque()}))},t.prototype.destroy=function(){this.layerView=null,this.extent=null,this.extentIntersection=null,this.handles&&(this.handles.destroy(),this.handles=null)},t.prototype.setExtent=function(e){this.extent=e,this.extentIntersectionDirty=!0,this.dirty=!0},t.prototype.viewChange=function(){this.dirty=!0},t.prototype.elevationBoundsChange=function(){this.dirty=!0,this.extentIntersectionDirty=!0},Object.defineProperty(t.prototype,"isVisibleBelowSurface",{set:function(e){this._isVisibleBelowSurface=e,this.dirty=!0,this.extentIntersectionDirty=!0},enumerable:!0,configurable:!0}),t.prototype.update=function(){this.updateSuspendFrustumVisible(),this.dirty=!1},t.prototype.updateExtentIntersection=function(){if(this.extentIntersectionDirty){this.extentIntersectionDirty=!1;var e,t=this.layerView.view;if(this._isVisibleBelowSurface)e=p;else{var i=t.basemapTerrain.getElevationBounds(),r=i[0],n=i[1];e=r-Math.max(1,(n-r)*(1.2-1))}this.extentIntersection.update(this.extent,t.spatialReference,e)}},t.prototype.updateSuspendFrustumVisible=function(){if(this.extent){this.updateExtentIntersection();var e=this.layerView.view.frustum;this._set("suspended",!this.extentIntersection.isVisibleInFrustum(e))}else this._set("suspended",!1)},r([a.property({readOnly:!0})],t.prototype,"suspended",void 0),r([a.property({readOnly:!0})],t.prototype,"updating",null),r([a.subclass("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],t)}(a.declared(n))}.apply(null,r))||(e.exports=n)},2238:function(e,t,i){var r,n;r=[i.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.attributeLookup=function(e,t){for(var i=t.toLowerCase(),r=0,n=Object.keys(e);r<n.length;r++){var s=n[r];if(s.toLowerCase()===i)return e[s]}return null}}.apply(null,r))||(e.exports=n)},2261:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(4),i(14),i(495),i(358)],void 0===(n=function(e,t,i,r,n,s){function o(e,t){if(!e||e.symbol)return null;var i=t.renderer;return e&&i&&i.getObservationRenderer?i.getObservationRenderer(e):i}function a(e,t){if(r.isSome(e.symbol))return e.symbol;var n=o(e,t);return n&&n.getSymbol(e,i({},t,{arcadeUtils:s}))}Object.defineProperty(t,"__esModule",{value:!0}),t.getRenderer=o,t.getSymbol=a,t.getRenderingInfo=function(e,t){var i=o(e,t),r=a(e,t);if(!r)return null;var s={renderer:i,symbol:r};if(!(i&&"visualVariables"in i&&i.visualVariables))return s;for(var u=["proportional","proportional","proportional"],l=0,p=n.getVisualVariableValues(i,e,t);l<p.length;l++){var h=p[l],c=h.variable,d=h.value;if("color"===c.type)s.color=d.toRgba();else if("size"===c.type)if("outline"===c.target)s.outlineSize=d;else{var y=c.axis,f=c.useSymbolValue?"symbolValue":d;"width"===y?u[0]=f:"depth"===y?u[1]=f:"height"===y?u[2]=f:u[0]=u[1]="width-and-depth"===y?f:u[2]=f}else"opacity"===c.type?s.opacity=d:"rotation"===c.type&&"tilt"===c.axis?s.tilt=d:"rotation"===c.type&&"roll"===c.axis?s.roll=d:"rotation"===c.type&&(s.heading=d)}return(isFinite(u[0])||isFinite(u[1])||isFinite(u[2]))&&(s.size=u),s}}.apply(null,r))||(e.exports=n)},2262:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(1),i(0),i(9),i(11),i(62),i(8),i(47),i(36),i(18),i(29),i(2),i(57),i(824),i(163),i(492),i(2234),i(2235),i(2263),i(2218),i(2236),i(2237),i(105),i(2238)],void 0===(n=function(e,t,i,r,n,s,o,a,u,l,p,h,c,d,y,f,g,b,v,m,w,E,_,x,C){var V=function(e){function t(t){var i=e.call(this)||this;return i._handles=new p,i.highlights=new E,i.suspendResumeExtentMode="computed",i.dataExtent=null,i.suspendResumeExtent=null,i}return i(t,e),Object.defineProperty(t.prototype,"suspended",{get:function(){return this.scaleVisibility&&this.scaleVisibility.suspended||this.frustumVisibility&&this.frustumVisibility.suspended},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!!(this.graphicsCore&&this.graphicsCore.updating||this.frustumVisibility&&this.frustumVisibility.updating)},enumerable:!0,configurable:!0}),t.prototype.normalizeCtorArgs=function(e){var t=e.frustumVisibilityEnabled?new w:null,i=e.scaleVisibilityEnabled?new _:null,r=(e.filterVisibilityEnabled||e.timeExtentVisibilityEnabled)&&"multipatch"!==e.layer.geometryType?new m.Graphics3DFilterVisibility:null,n=e.elevationAlignmentEnabled?new v:null;return{graphicsCore:new b({owner:e.owner,layer:e.layer,asyncUpdates:e.asyncGraphicsUpdates,elevationFeatureExpressionEnabled:e.elevationFeatureExpressionEnabled,graphicSymbolSupported:!1,hasZ:e.owner.hasZ,hasM:e.owner.hasM}),frustumVisibility:t,scaleVisibility:i,filterVisibility:r,elevationAlignment:n,updateClippingExtent:e.updateClippingExtent,suspendResumeExtentMode:e.suspendResumeExtentMode,dataExtent:e.dataExtent}},t.prototype.initialize=function(){var e=this;this.scaleVisibility&&this._handles.add(this.layer.watch(["minScale","maxScale"],function(){return e.scaleVisibility.layerMinMaxScaleChangeHandler()})),this.filterVisibility&&this._handles.add(this.owner.watch(["filter","timeExtent"],function(){return e.filterVisibility.filterChanged()})),this.elevationAlignment&&this._handles.add(this.layer.watch("elevationInfo",function(t,i){y.diff(t,i)&&e.graphicsCore.elevationInfoChange()})),this._handles.add(this.layer.watch("labelsVisible",function(){return e.graphicsCore.updateVisibilityInfo()})),this._handles.add(this.layer.watch("labelingInfo",function(t,i){y.diff(t,i)&&e.graphicsCore.updateLabelingInfo()}))},t.prototype.setup=function(){return s(this,void 0,void 0,function(){var e,t,i,r,s=this;return n(this,function(n){switch(n.label){case 0:return this.frustumVisibility&&this.frustumVisibility.setup(this.owner),e=this.owner,t=this.owner.view.basemapTerrain,i=function(e,t,i){return s.graphicsCore.spatialIndex.queryGraphicUIDsInExtent(e,t,i)},this.scaleVisibility&&this.scaleVisibility.setup(e,this.layer,i,this.graphicsCore,t),this.filterVisibility&&("filter"in e||"timeExtent"in e)&&this.filterVisibility.setup(e,this.graphicsCore),this.elevationAlignment&&(r=e.view.elevationProvider,this.elevationAlignment.setup(e,i,this.graphicsCore,r)),this.highlights&&this.highlights.setup(this.graphicsCore),this._set("labeling",this.owner.view.labeler.addGraphicsOwner(this.graphicsCore,this.scaleVisibility)),this._set("deconfliction",e.view.deconflictor.addGraphicsOwner(this.graphicsCore)),[4,u.result(this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,scaleVisibility:this.scaleVisibility,filterVisibility:this.filterVisibility,deconflictor:this.deconfliction,labeler:this.labeling,highlights:this.highlights}))];case 1:return n.sent(),this._handles.add([this.layer.watch("renderer",function(e){return s.graphicsCore.rendererChange(e)}),e.watch("fullOpacity",function(){return s.graphicsCore.opacityChange()})]),this.setupSuspendResumeExtent(),this.updateClippingExtent&&(this._handles.add(e.view.watch("clippingArea",function(){return s._updateClippingExtent()})),this._updateClippingExtent()),this.graphicsCore.startCreateGraphics(),this.graphicsCore.labelsEnabled?[4,u.result(this.graphicsCore.updateLabelingInfo())]:[3,3];case 2:n.sent(),n.label=3;case 3:return[2]}})})},t.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null);for(var e=0,t=["frustumVisibility","scaleVisibility","filterVisibility","elevationAlignment","highlights","graphicsCore"];e<t.length;e++){var i=t[e],r=this[i];r&&(r.destroy(),this._set(i,null))}this._set("layer",null),this._set("owner",null)},t.prototype.highlight=function(e,t,i){var r=this;if(e instanceof f){var n=this.highlights.acquireSet(t,i),s=n.set,a=n.handle;return this.owner.queryObjectIds(e).then(function(e){return r.highlights.setObjectIds(s,e)}),a}if("number"==typeof e)return this.highlight([e],t,i);if(e instanceof o)return this.highlight([e],t,i);if("toArray"in e&&(e=e.toArray()),Array.isArray(e)&&e.length>0){if(e[0]instanceof o){var u=e;if(!i||!u[0].attributes||null===C.attributeLookup(u[0].attributes,i)){var l=u.map(function(e){return e.uid}),p=this.highlights.acquireSet(t,null),h=p.set;a=p.handle;return this.highlights.setUids(h,l),a}e=u.map(function(e){return C.attributeLookup(e.attributes,i)})}if("number"==typeof e[0]){var c=e,d=this.highlights.acquireSet(t,i);h=d.set,a=d.handle;return this.highlights.setObjectIds(h,c),a}}return I},t.prototype._updateClippingExtent=function(){var e=this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(e,this.owner.view.spatialReference)&&(this.updateClippingExtent(e)||this.graphicsCore.recreateAllGraphics())},t.prototype.setupSuspendResumeExtent=function(){var e=this;(this.frustumVisibility||this.scaleVisibility)&&this._handles.add(h.init(this,"suspendResumeExtentMode",function(){switch(e._handles.remove(O),e.suspendResumeExtentMode){case"computed":e._handles.add(h.init(e.graphicsCore,"computedExtent",function(t){return e.updateSuspendResumeExtent(t)}),O);break;case"data":e._handles.add(h.init(e,"dataExtent",function(t){return e.updateSuspendResumeExtent(t)}),O);break;default:l.neverReached(e.suspendResumeExtentMode)}}))},t.prototype.updateSuspendResumeExtent=function(e){e?this.suspendResumeExtentChanged(this.extentToSuspendResumeRect(e,this.suspendResumeExtent)):this.suspendResumeExtentChanged(null)},t.prototype.extentToSuspendResumeRect=function(e,t){var i=this.owner.view.spatialReference;if(!e.spatialReference.equals(i)){if(!d.canProject(e,i))return;e=d.project(e,i)}return x.enlargeExtent(e,t,g.SUSPEND_RESUME_EXTENT_OPTIMISM)},t.prototype.suspendResumeExtentChanged=function(e){this.frustumVisibility&&this.frustumVisibility.setExtent(e),this.scaleVisibility&&this.scaleVisibility.setExtent(e)},r([c.property({aliasOf:"graphicsCore.layer"})],t.prototype,"layer",void 0),r([c.property({aliasOf:"graphicsCore.owner"})],t.prototype,"owner",void 0),r([c.property({constructOnly:!0})],t.prototype,"updateClippingExtent",void 0),r([c.property({constructOnly:!0})],t.prototype,"graphicsCore",void 0),r([c.property({constructOnly:!0})],t.prototype,"scaleVisibility",void 0),r([c.property({constructOnly:!0})],t.prototype,"filterVisibility",void 0),r([c.property({constructOnly:!0})],t.prototype,"elevationAlignment",void 0),r([c.property({constructOnly:!0})],t.prototype,"frustumVisibility",void 0),r([c.property({readOnly:!0})],t.prototype,"deconfliction",void 0),r([c.property({readOnly:!0})],t.prototype,"labeling",void 0),r([c.property({readOnly:!0})],t.prototype,"highlights",void 0),r([c.property()],t.prototype,"suspendResumeExtentMode",void 0),r([c.property()],t.prototype,"dataExtent",void 0),r([c.property({readOnly:!0,dependsOn:["scaleVisibility.suspended","frustumVisibility.suspended"]})],t.prototype,"suspended",null),r([c.property({readOnly:!0,dependsOn:["graphicsCore.updating","frustumVisibility.updating"]})],t.prototype,"updating",null),r([c.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureLikeLayerView")],t)}(c.declared(a)),O="suspendResumeExtentMode",I={remove:function(){},pause:function(){},resume:function(){}};return V}.apply(null,r))||(e.exports=n)},2263:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(1),i(0),i(8),i(18),i(13),i(14),i(29),i(2),i(2217),i(808)],void 0===(n=function(e,t,i,r,n,s,o,a,u,l,p,h){Object.defineProperty(t,"__esModule",{value:!0});var c=o.getLogger("esri.views.3d.layers.graphics.Graphics3DFilterVisibility"),d=function(e){function t(){var t=e.call(this)||this;return t.filter=null,t._dirty=!1,t._querying=!1,t._handles=new s,t}return i(t,e),Object.defineProperty(t.prototype,"updating",{get:function(){return this._dirty||this._querying||null!=this._queryResult},enumerable:!0,configurable:!0}),t.prototype.setup=function(e,t){var i=this;this._layerView=e,this._core=t,this._objectIdField=e.layer.objectIdField,this._queryEngine=new p.default({layerView:this._layerView,priority:4});var r=this._layerView.view.resourceController.scheduler;this._handles.add(r.registerTask(4,function(e){return i._update(e)},function(){return i._needsUpdate()})),this._handles.add(u.on(t.owner,"loadedGraphics","change",function(e){return i._graphicsChanged(e)},function(){return i.dirty=!0}))},t.prototype.destroy=function(){this._handles.destroy(),this._handles=null,this.clear(),this._layerView=null,this._core=null},t.prototype.clear=function(){this._queryEngine.clear()&&(this._core.modifyGraphics3DGraphicVisibilities(function(e){return e.clearVisibilityFlag(2)}),this._queryResult=null,this._querying=!1),this.dirty=!1,this.notifyChange("updating")},t.prototype._graphicsChanged=function(e){(!this._queryEngine||e.added&&e.added.length>0)&&(this.dirty=!0)},t.prototype.updateVisibility=function(e){this.active&&(e.hasVisibilityFlag(2,0)||e.setVisibilityFlag(2,!1,0),this.dirty=!0)},t.prototype.filterChanged=function(){this.filter=this.recomputeFilter(),this.dirty=!0},Object.defineProperty(t.prototype,"active",{get:function(){return this.filter&&this._core.graphics3DGraphics.size>0},enumerable:!0,configurable:!0}),t.prototype.recomputeFilter=function(){var e="filter"in this._layerView?this._layerView.filter:null,t="timeExtent"in this._layerView?this._layerView.timeExtent:null;if(!t)return e;var i=a.isSome(e)?e.clone():new h;return i.timeExtent=i.timeExtent?i.timeExtent.intersection(t):t,i},t.prototype._needsUpdate=function(){return this._dirty&&!this._querying||null!=this._queryResult},t.prototype._update=function(e){var t=this;this.active?(!this._dirty||this._querying||e.done||(this._querying=!0,this.dirty=!1,this._queryEngine.executeQueryForIdSet(this.filter).then(function(e){t._queryResult=e,t._querying=!1}).catch(function(e){c.warn("FeatureFilter query failed: "+e),t._queryResult=new Set,t._core.graphics3DGraphics.forEach(function(e){return t._queryResult.add(t._getFeatureId(e.graphic))}),t._querying=!1}),e.madeProgress()),this._queryResult&&!e.done&&(this._core.modifyGraphics3DGraphicVisibilities(function(i){if(e.done)return!1;var r=t._queryResult.has(t._getFeatureId(i.graphic));return!!i.setVisibilityFlag(2,r,0)&&(e.madeProgress(),!0)}),e.done||(this._queryResult=null)),this.notifyChange("updating")):this.clear()},t.prototype._getFeatureId=function(e){return null==e.objectId?e.attributes[this._objectIdField]:e.objectId},Object.defineProperty(t.prototype,"dirty",{set:function(e){this._dirty!==e&&(this._dirty=e,this.notifyChange("updating"))},enumerable:!0,configurable:!0}),r([l.property({readOnly:!0})],t.prototype,"updating",null),r([l.subclass("esri.views.3d.layers.graphics.Graphics3DFilterVisibility")],t)}(l.declared(n));t.Graphics3DFilterVisibility=d}.apply(null,r))||(e.exports=n)},2327:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(1),i(0),i(9),i(11),i(47),i(15),i(14),i(7),i(29),i(2),i(91),i(2261),i(163),i(2176),i(2262),i(2217),i(2186)],void 0===(n=function(e,t,i,r,n,s,o,a,u,l,p,h,c,d,y,f,g,b,v){return function(e){function t(t){var i=e.call(this)||this;return i.controller=null,i.asyncGraphicsUpdates=!1,i.suspendResumeExtentMode="computed",i.slicePlaneEnabled=!1,i.supportsDraping=!0,i.overlayUpdating=!1,i.fullExtentInLocalViewSpatialReference=null,i.suspendResumeExtent=null,i._controllerCreated=!1,i.clippingExtent=null,i.supportsHeightUnitConversion=!0,i.pendingController=null,i.queryEngine=null,i}return i(t,e),t.prototype.initialize=function(){var e=this;this.layer.isTable?this.addResolvingPromise(l.reject(new a("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:this.layer}))):(this._set("graphics3d",new g({owner:this,layer:this.layer,frustumVisibilityEnabled:!0,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentVisibilityEnabled:!0,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!0,asyncGraphicsUpdates:this.asyncGraphicsUpdates,suspendResumeExtentMode:this.suspendResumeExtentMode,updateClippingExtent:function(t){return e.updateClippingExtent(t)}})),this.handles.add([this.watch("asyncGraphicsUpdates",function(t){e.graphics3d.graphicsCore.asyncUpdates=t}),this.watch("suspendResumeExtentMode",function(t){e.graphics3d.suspendResumeExtentMode=t})]),this.drawingOrder=this.view.getDrawingOrder(this.layer.uid),this.addResolvingPromise(o.safeCast(this.graphics3d.setup()).then(function(){return e.validateGeometryType()}).then(function(){e.queryEngine=new b.default({layerView:e,priority:4})}).then(function(){return v.toViewIfLocal(e)}).then(function(t){return e.fullExtentInLocalViewSpatialReference=t}).then(function(){return e.initializeController()})),this.notifyChange("updating"))},t.prototype.destroy=function(){this.destroyPendingController(),this.controller&&(this.controller.destroy(),this.controller=null),this.graphics3d&&(this.graphics3d.destroy(),this._set("graphics3d",null)),this.queryEngine&&(this.queryEngine.destroy(),this.queryEngine=null),this.loadedGraphics=null},t.prototype.destroyPendingController=function(){this.pendingController&&(this.pendingController.destroy(),this.pendingController=null)},Object.defineProperty(t.prototype,"drawingOrder",{set:function(e){this.graphics3d.graphicsCore.setDrawingOrder(e),this._set("drawingOrder",e)},enumerable:!0,configurable:!0}),t.prototype.getRenderingInfo=function(e,t){var i=d.getRenderingInfo(e,{renderer:t});if(i&&i.color){var r=i.color;r[0]=r[0]/255,r[1]=r[1]/255,r[2]=r[2]/255}return i},t.prototype.getGraphicFromGraphicUid=function(e){var t=this,i=null;return this.loadedGraphics&&this.loadedGraphics.forEach(function(r){r.uid===e&&(i=c.hydrateGraphic(r,t.layer))}),i},Object.defineProperty(t.prototype,"graphics3DGraphics",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphics:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"graphics3DGraphicsByObjectID",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphicsByObjectID:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"symbolUpdateType",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.symbolUpdateType:null},enumerable:!0,configurable:!0}),t.prototype.whenGraphicBounds=function(e,t){return this.graphics3d?this.graphics3d.graphicsCore.whenGraphicBounds(e,t):null},t.prototype.whenSymbolLayerSize=function(e,t){return this.graphics3d?o.safeCast(this.graphics3d.graphicsCore.whenSymbolLayerSize(e,t)):null},t.prototype.queryFeatures=function(e,t){return o.safeCast(this.queryEngine.executeQuery(this._ensureQuery(e),u.get(t,"signal")))},t.prototype.queryObjectIds=function(e,t){return o.safeCast(this.queryEngine.executeQueryForIds(this._ensureQuery(e),u.get(t,"signal")))},t.prototype.queryFeatureCount=function(e,t){return o.safeCast(this.queryEngine.executeQueryForCount(this._ensureQuery(e),u.get(t,"signal")))},t.prototype.queryExtent=function(e,t){return o.safeCast(this.queryEngine.executeQueryForExtent(this._ensureQuery(e),u.get(t,"signal")))},t.prototype._ensureQuery=function(e){return u.isNone(e)?this.createQuery():y.from(e)},t.prototype.highlight=function(e,t){return void 0===t&&(t={}),this.graphics3d.highlight(e,t,this.layer.objectIdField)},t.prototype.getStats=function(){var e=this.graphics3d.graphicsCore.getStats();return e.features=this.loadedGraphics.length,e.updating=this.updating,e.elevationUpdating=this.graphics3d.elevationAlignment.updating,e.visibilityFrustum=!this.graphics3d.frustumVisibility.suspended,e.visibilityScale=!this.graphics3d.scaleVisibility.suspended,e},t.prototype.canResume=function(){return!(!this.inherited(arguments)||this.graphics3d&&this.graphics3d.suspended)},t.prototype.isUpdating=function(){return!(!this.graphics3d||this.graphics3d.destroyed)&&(!this._controllerCreated||this.controller&&this.controller.updating||this.overlayUpdating||!this.view.basemapTerrain||!this.view.basemapTerrain.ready||this.graphics3d.updating)},t.prototype.initializeController=function(){return s(this,void 0,void 0,function(){var e;return n(this,function(t){switch(t.label){case 0:return[4,this.createController()];case 1:return e=t.sent(),this.pendingController=e,[4,e.when()];case 2:return t.sent(),this.setControllerWhenInitialized(e),[2]}})})},t.prototype.setControllerWhenInitialized=function(e){return s(this,void 0,void 0,function(){return n(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.when()];case 1:return t.sent(),[3,3];case 2:return t.sent(),[3,3];case 3:return this._controllerCreated=!0,this.notifyChange("updating"),this.isResolved()?[4,p.whenTrueOnce(this.view,"basemapTerrain.ready")]:(this.destroyPendingController(),[2]);case 4:return t.sent(),this.pendingController=null,this.controller=e,this.loadedGraphics=e.graphics,this.notifyChange("updating"),[2]}})})},t.prototype.updateClippingExtent=function(e){if(this.clippingExtent=e,!this.controller)return!1;switch(this.controller.type){case"stream":return!1;case"feature-tile-3d":return this.controller.extent=e,!0}},t.prototype.validateGeometryType=function(){var e=this.layer;switch(e.geometryType){case"multipatch":case"multipoint":return l.reject(new a("featurelayerview3d:unsupported-geometry-type","Unsupported geometry type ${geometryType}",{geometryType:e.geometryType}))}},r([h.property()],t.prototype,"loadedGraphics",void 0),r([h.property({dependsOn:["graphics3d.suspended"]})],t.prototype,"suspended",void 0),r([h.property({dependsOn:["graphics3d.updating","controller.updating","overlayUpdating"]})],t.prototype,"updating",void 0),r([h.property()],t.prototype,"controller",void 0),r([h.property()],t.prototype,"graphics3d",void 0),r([h.property({readOnly:!0})],t.prototype,"asyncGraphicsUpdates",void 0),r([h.property({readOnly:!0})],t.prototype,"suspendResumeExtentMode",void 0),r([h.property({type:Boolean})],t.prototype,"slicePlaneEnabled",void 0),r([h.property({aliasOf:"graphics3d.graphicsCore.hasDraped"})],t.prototype,"hasDraped",void 0),r([h.property({readOnly:!0,type:Boolean})],t.prototype,"supportsDraping",void 0),r([h.property({type:Boolean})],t.prototype,"overlayUpdating",void 0),r([h.property()],t.prototype,"drawingOrder",null),r([h.subclass("esri.views.3d.layers.FeatureLikeLayerView3D")],t)}(h.declared(f))}.apply(null,r))||(e.exports=n)}}]);