(function(){(this||window).webpackJsonp.registerAbsMids({"esri/views/3d/layers/FeatureLayerView3D":2139,"esri/views/3d/layers/support/layerViewUpdatingProperties":2180,"esri/views/3d/layers/graphics/Graphics3DVerticalScale":2260,"esri/layers/graphics/controllers/FeatureTileController3D":2478,"esri/views/3d/layers/support/FeatureTileFetcher3D":2479,"esri/views/3d/layers/support/featureReference":2480,"esri/views/3d/layers/support/FeatureTile":2481,"esri/views/3d/layers/support/featureTileQuery3D":2482,"esri/views/3d/layers/support/FeatureTileFetcher3DDebugger":2483,"esri/views/3d/support/EventedSet":2491})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[76],{2139:function(e,t,r){var i,s;i=[r.dj.c(e.i),t,r(1),r(0),r(4),r(9),r(11),r(47),r(36),r(15),r(7),r(29),r(2),r(91),r(2478),r(2327),r(2180),r(2491),r(2325)],void 0===(s=function(e,t,r,i,s,n,a,o,u,l,c,h,p,d,f,y,m,g,v){return function(e){function t(t){var r=e.call(this)||this;return r._controllerTotal=0,r._graphicsCoreTotal=0,r.suspendResumeExtentMode="data",r}return r(t,e),Object.defineProperty(t.prototype,"updatingPercentageValue",{get:function(){var e=0,t=0;this.controller&&this.controller.updating&&(e+=this.controller.updatingRemaining,t=this.controller.updatingTotal);var r=0;this.graphics3d&&this.graphics3d.graphicsCore&&(e+=this.graphics3d.graphicsCore.updatingRemaining,r=this.graphics3d.graphicsCore.updatingTotal),0===t&&0===r?(this._controllerTotal=0,this._graphicsCoreTotal=0):(this._controllerTotal=Math.max(t,this._controllerTotal),this._graphicsCoreTotal=Math.max(r,this._graphicsCoreTotal));var i=this._controllerTotal+this._graphicsCoreTotal;return i?(i-e)/i*100:100},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maximumNumberOfFeaturesExceeded",{get:function(){return!!this.controller&&!(this.suspended||!this.controller.maximumNumberOfFeaturesExceeded)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"asyncGraphicsUpdates",{get:function(){if(this.controller)switch(this.controller.mode){case"snapshot":return this.controller.serviceDataCount>5e3;case"tiles":return!0;default:u.neverReached(this.controller.mode)}return!0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasZ",{get:function(){var e=this.layer,t=e.capabilities&&e.capabilities.data;return!(!t||!t.supportsZ)&&(null!=e.returnZ?e.returnZ:t.supportsZ)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasM",{get:function(){var e=this.layer,t=e.capabilities&&e.capabilities.data;return!(!t||!t.supportsM)&&"returnM"in e&&null!=e.returnM&&e.returnM},enumerable:!0,configurable:!0}),t.prototype.fetchPopupFeatures=function(e,t){return a(this,void 0,void 0,function(){var e;return n(this,function(r){return(e=this.validateFetchPopupFeatures(t))?[2,c.reject(e)]:[2,this.fetchClientPopupFeatures(t)]})})},t.prototype.setVisibility=function(e,t){this.graphics3d.graphicsCore.setObjectIdVisibility(e,t)},t.prototype.createQuery=function(){return this.inherited(arguments)},t.prototype.queryFeatures=function(e,t){var r=this,i=arguments,s=function(){return r.inherited(i)};return"mesh"===this.layer.geometryType?o.safeCast(this._queryFeaturesMesh(this._ensureQuery(e),s)):o.safeCast(s())},t.prototype.createController=function(){return a(this,void 0,void 0,function(){var e,t=this;return n(this,function(r){return e=new f({layerView:this,graphics:new g.EventedSet,extent:this.clippingExtent,hasZ:this.hasZ,hasM:this.hasM}),this.handles.add(h.init(e,"serviceDataExtent",function(e){t.graphics3d&&(t.graphics3d.dataExtent=e)})),this.handles.add(h.init(this,"suspended",function(t){t?e.suspend():e.resume()},!0)),this.handles.add(h.init(this.graphics3d.graphicsCore,"displayFeatureLimit",function(){return t.updateDisplayFeatureLimit(e)})),this.handles.add(this.view.resourceController.memoryController.events.on("quality-changed",function(){return t.updateDisplayFeatureLimit()})),[2,e]})})},t.prototype.doRefresh=function(e){return a(this,void 0,void 0,function(){return n(this,function(e){return!this.suspended&&this.controller&&this.controller.refresh(),[2]})})},t.prototype.getStats=function(){var e=this.inherited(arguments);if(this.controller&&e.features){var t=this.controller.debug;e.features+="/"+t.storedFeatures+"/"+t.totalFeatures,e.totalVertices=t.totalVertices}var r=this.controller&&this.controller.displayFeatureLimit,i=r&&r.maximumSymbolComplexity;e.numTiles=this.controller?this.controller.tileDescriptors.length:0,e.partial=this.maximumNumberOfFeaturesExceeded,e.mode=this.controller?this.controller.mode:"n/a",e.symbolComplexity=i?"f:"+i.primitivesPerFeature+",v:"+i.primitivesPerCoordinate:"n/a";var s=this.graphics3d&&this.graphics3d.graphicsCore,n=s?s.unprocessedMemoryEstimate:0,a=this.controller?this.controller.expectedFeatureDiff*s.usedMemoryPerGraphic:0,o=function(e){return""+(e/1024/1024).toFixed(1)};return e.memory="u:"+o(this.getUsedMemory())+", pc:"+o(n)+", pf:"+o(a)+" MB",e},t.prototype.getUsedMemory=function(){var e=this.graphics3d&&this.graphics3d.graphicsCore;return(e?e.usedMemory:0)+(this.controller?this.controller.memoryForUnusedFeatures:0)},t.prototype.getUnloadedMemory=function(){var e=this.graphics3d&&this.graphics3d.graphicsCore;return(e?e.unprocessedMemoryEstimate:0)+(this.controller?this.controller.expectedFeatureDiff*e.usedMemoryPerGraphic:0)},t.prototype.ignoresMemoryFactor=function(){return this.controller&&this.controller.hasMaximumNumberOfFeaturesOverride},t.prototype.updateDisplayFeatureLimit=function(e){if(void 0===e&&(e=this.controller),e&&this.graphics3d&&this.graphics3d.graphicsCore){var t=this.graphics3d.graphicsCore.displayFeatureLimit,r=this.view.resourceController.memoryController.memoryFactor;if(1===r)e.displayFeatureLimit=t;else{var i=Math.ceil(t.maximumNumberOfFeatures*r),n=Math.ceil(t.maximumTotalNumberOfFeatures*r),a=Math.ceil(t.minimumTotalNumberOfFeatures*r);e.displayFeatureLimit=s({},t,{maximumNumberOfFeatures:i,maximumTotalNumberOfFeatures:n,minimumTotalNumberOfFeatures:a})}}},t.prototype._queryFeaturesMesh=function(e,t){return a(this,void 0,void 0,function(){var r,i,s,a,o,u,l,c;return n(this,function(n){switch(n.label){case 0:return[4,this._validateQueryFeaturesMesh(e)];case 1:return n.sent(),[4,t()];case 2:if(r=n.sent(),e&&e.outStatistics)return[2,r];for(i=this.layer.objectIdField,s=this.graphics3d.graphicsCore.graphics3DGraphicsByObjectID,a=[],o=0,u=r.features;o<u.length;o++)(l=u[o]).geometry?(c=s.get(l.attributes[i]))&&(l.geometry=d.hydrateGeometry(c.graphic.geometry),a.push(l)):a.push(l);return r.features=a,[2,r]}})})},t.prototype._validateQueryFeaturesMesh=function(e){return a(this,void 0,void 0,function(){var t,r,i,s;return n(this,function(n){if(!e)return[2];for(t=function(e){throw new l("feature-layer-view:unsupported-query","Queries on Mesh feature collection layers do not support '"+e+"'")},r=0,i=["quantizationParameters","geometryPrecision","maxAllowableOffset"];r<i.length;r++)s=i[r],null!=e[s]&&t(s);return"returnM"in e&&e.returnM&&t("returnM"),"returnCentroid"in e&&e.returnCentroid&&t("returnCentroid"),e.outSpatialReference&&!e.outSpatialReference.equals(this.view.spatialReference)&&t("outSpatialReference"),[2]})})},i([p.property()],t.prototype,"layer",void 0),i([p.property()],t.prototype,"controller",void 0),i([p.property({readOnly:!0,dependsOn:["controller.updatingRemaining","controller.updatingTotal","graphics3d.graphicsCore.updatingRemaining","graphics3d.graphicsCore.updatingTotal"]})],t.prototype,"updatingPercentageValue",null),i([p.property({aliasOf:"controller.maximumNumberOfFeatures",set:null,get:null})],t.prototype,"maximumNumberOfFeatures",void 0),i([p.property({dependsOn:["suspended","controller.maximumNumberOfFeaturesExceeded"]})],t.prototype,"maximumNumberOfFeaturesExceeded",null),i([p.property(m.updatingPercentage)],t.prototype,"updatingPercentage",void 0),i([p.property({readOnly:!0,dependsOn:["controller.mode"]})],t.prototype,"asyncGraphicsUpdates",null),i([p.property({readOnly:!0})],t.prototype,"hasZ",null),i([p.property({readOnly:!0})],t.prototype,"hasM",null),i([p.property()],t.prototype,"suspendResumeExtentMode",void 0),i([p.subclass("esri.views.3d.layers.FeatureLayerView3D")],t)}(p.declared(y,v))}.apply(null,i))||(e.exports=s)},2180:function(e,t,r){var i,s;i=[r.dj.c(e.i),t],void 0===(s=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.updatingPercentageValue={value:100,readOnly:!0},t.updatingPercentage={dependsOn:["updating","updatingPercentageValue"],readOnly:!0,value:0,get:function(){return this.updating?this.updatingPercentageValue:0}}}.apply(null,i))||(e.exports=s)},2260:function(e,t,r){var i,s;i=[r.dj.c(e.i),t,r(14),r(59)],void 0===(s=function(e,t,r,i){return function(){function e(e){this.sourceSpatialReference=e.sourceSpatialReference,this.destSpatialReference=e.destSpatialReference}return e.prototype.adjust=function(e){var t=this._getVerticalUnitScale();1!==t&&this._scaleVerticalUnits(e,t)},e.prototype._getVerticalUnitScale=function(){return this.sourceSpatialReference&&!this.sourceSpatialReference.equals(this.destSpatialReference)?i.getMetersPerVerticalUnitForSR(this.sourceSpatialReference)/i.getMetersPerVerticalUnitForSR(this.destSpatialReference):1},e.prototype._vertexListsScaleZ=function(e,t){for(var r=0;r<e.length;++r)for(var i=e[r],s=0;s<i.length;++s){i[s][2]*=t}},e.prototype._scaleVerticalUnits=function(e,t){for(var i=0;i<e.length;++i){var s=e[i].geometry;!r.isNone(s)&&s.hasZ&&(this._geometryIsPoint(s)?null!==s.z&&(s.z*=t):this._geometryIsPolyline(s)?this._vertexListsScaleZ(s.paths,t):this._geometryIsPolygon(s)&&this._vertexListsScaleZ(s.rings,t))}},e.prototype._geometryIsPoint=function(e){return"point"===e.type},e.prototype._geometryIsPolygon=function(e){return"polygon"===e.type},e.prototype._geometryIsPolyline=function(e){return"polyline"===e.type},e}()}.apply(null,i))||(e.exports=s)},2478:function(e,t,r){var i,s;i=[r.dj.c(e.i),t,r(1),r(0),r(4),r(9),r(11),r(8),r(47),r(31),r(36),r(15),r(18),r(5),r(13),r(14),r(283),r(7),r(29),r(2),r(166),r(357),r(494),r(2260),r(2479),r(2483),r(95)],void 0===(s=function(e,t,r,i,s,n,a,o,u,l,c,h,p,d,f,y,m,g,v,F,b,x,T,_,O,E,C){var w=f.getLogger("esri.layers.graphics.controllers.FeatureTileController3D"),S=function(e){function t(t){var r=e.call(this)||this;return r.type="feature-tile-3d",r.serviceDataExtent=null,r.serviceDataCount=s.constants.NO_SERVICE_DATA_COUNT,r.vertexLimitExceeded=!1,r.displayFeatureLimit=null,r.suspended=!1,r.asyncTasks=new l,r.tileFetcher=null,r.handles=new p,r.fetchDataInfoPromise=null,r.fetchDataInfoAbortController=null,r.lifeCycleAbortController=g.createAbortController(),r}var s;return r(t,e),s=t,Object.defineProperty(t.prototype,"extent",{set:function(e){if(!e||e.spatialReference.equals(this.layerView.view.spatialReference)){var t=this._get("extent");if(t!==e&&!(t&&e&&t.equals(e))){var r=e?e.clone():null;this._set("extent",r)}}else w.error("#extent=","extent needs to be in the same spatial reference as the view")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!!(this.tileFetcher&&this.tileFetcher.updating||null!=this.fetchDataInfoPromise||this.asyncTasks.length>0||"tiles"===this.mode&&this.layerView.view.featureTiles&&this.layerView.view.featureTiles.updating)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updatingTotal",{get:function(){return this.updating&&this.tileFetcher?this.tileFetcher.updatingTotal:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updatingRemaining",{get:function(){return this.updating&&this.tileFetcher?this.tileFetcher.updatingRemaining:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"expectedFeatureDiff",{get:function(){return this.updating&&this.tileFetcher?this.tileFetcher.expectedFeatureDiff:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"memoryForUnusedFeatures",{get:function(){return this.tileFetcher?this.tileFetcher.memoryForUnusedFeatures:0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maximumNumberOfFeaturesExceeded",{get:function(){return!(!this.tileFetcher||!this.tileFetcher.maximumNumberOfFeaturesExceeded)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filteredDataExtent",{get:function(){return this.extent},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maximumNumberOfFeatures",{get:function(){return this.displayFeatureLimit?this.displayFeatureLimit.maximumNumberOfFeatures:0},set:function(e){e!==this.maximumNumberOfFeatures&&(null==e?this._clearOverride("maximumNumberOfFeatures"):this._override("maximumNumberOfFeatures",e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasMaximumNumberOfFeaturesOverride",{get:function(){return this._isOverridden("maximumNumberOfFeatures")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mode",{get:function(){if(this.serviceDataCount===s.constants.NO_SERVICE_DATA_COUNT||this.vertexLimitExceeded)return"tiles";var e=this.layerView,t=e.layer,r=e.view,i=r&&r.featureTiles,n=i&&i.tilingScheme;if(t&&t.minScale&&this.serviceDataExtent&&n){var a=this.approximateExtentSizeAtScale(t.minScale,n);if((this.serviceDataExtent.width/a+this.serviceDataExtent.height/a)/2>s.constants.MAX_SNAPSHOT_MIN_SCALE_FACTOR)return"tiles"}return!this.maximumNumberOfFeatures||this.serviceDataCount<=this.maximumNumberOfFeatures?"snapshot":"tiles"},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"maxTotalSnapshotVertices",{get:function(){var e=this._get("maxTotalSnapshotVertices")||0,t="snapshot"===this.mode&&this.tileFetcher&&this.tileFetcher.totalVertices||0;return Math.max(e,t)},enumerable:!0,configurable:!0}),t.prototype.approximateExtentSizeAtScale=function(e,t){var r=this.layerView.view,i=Math.ceil((r.width/t.pixelSize[0]+r.height/t.pixelSize[1])/2),s=t.levels[0];return i*((s.tileSize[0]/(s.scale/e)+s.tileSize[1]/(s.scale/e))/2)},Object.defineProperty(t.prototype,"tileDescriptors",{get:function(){return"snapshot"===this.mode?new l([{id:"dummy-tile-full-extent",lij:[0,0,0]}]):this.layerView.view.featureTiles?this.layerView.view.featureTiles.tiles:new l},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"test",{get:function(){return{fetchDataInfoPromise:this.fetchDataInfoPromise}},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){var e=this;this.handles.add([this.watch("vertexLimitInfo",function(){return e.registerAsyncTask(e.updateVertexLimitExceeded(null,e.lifeCycleAbortController.signal))}),v.init(this,"mode",function(){return e.modeChanged()})]);var t=g.resolve().then(function(){return e.verifyCapabilities()}).then(function(){return e.registerAsyncTask(e.fetchServiceDataInfo())}).then(function(){return e.initializeTileFetcher()});this.addResolvingPromise(t)},t.prototype.verifyCapabilities=function(){var e=this.layerView.layer;if(!e.get("capabilities.operations.supportsQuery"))throw new h("graphicscontroller:query-capability-required","Service requires query capabilities to be used as a feature layer",{layer:e})},t.prototype.registerAsyncTask=function(e){var t=this.asyncTasks;t.add(e);var r=function(){return t.remove(e)};return e.then(r,r),e},t.prototype.destroy=function(){this.cancelFetchServiceDataInfo(),this.tileFetcher&&(this.tileFetcher.destroy(),this.tileFetcher=null),this.handles&&(this.handles.destroy(),this.handles=null),this.tilesHandle&&(this.tilesHandle.remove(),this.tilesHandle=null),this.lifeCycleAbortController&&(this.lifeCycleAbortController.abort(),this.lifeCycleAbortController=null)},t.prototype.suspend=function(){this.suspended||(this.suspended=!0,this.tileFetcher&&this.tileFetcher.suspend())},t.prototype.resume=function(){this.suspended&&(this.suspended=!1,this.tileFetcher&&this.tileFetcher.resume())},t.prototype.refresh=function(){var e=this,t=function(){e.tileFetcher&&e.tileFetcher.filtersChanged()};this.registerAsyncTask(this.fetchServiceDataInfo().then(t,t))},t.prototype.initializeTileFetcher=function(){var e=this,t=this.layerView.view;v.whenOnce(t.featureTiles,"tilingScheme",this.lifeCycleAbortController.signal).then(function(){var r=e,i=r.layerView,s=r.tileDescriptors,n=i.layer,a=new _({sourceSpatialReference:n.spatialReference,destSpatialReference:t.spatialReference});e.tileFetcher=new O.FeatureTileFetcher3D({layerView:i,filterExtent:e.filteredDataExtent,tilingScheme:t.featureTiles.tilingScheme,tileDescriptors:s,features:e.graphics,verticalScale:a,viewingMode:t.viewingMode,hasZ:e.hasZ,hasM:e.hasM}),e.suspended?e.tileFetcher.suspend():e.tileFetcher.resume();e.handles.add([n.watch("definitionExpression",function(){return e.definitionExpressionChanged()}),i.watch("availableFields",function(t,r){return e.attributesChanged(r,t)}),n.on("apply-edits",function(t){return e.applyEdits(t)}),e.watch("filteredDataExtent",function(t){return e.tileFetcher.filterExtent=t},!0),e.watch("tileDescriptors",function(t){return e.tileFetcher.tileDescriptors=t},!0),v.init(e,"maximumNumberOfFeatures",function(t){e.tileFetcher.maximumNumberOfFeatures=t,e.tileFetcher.useTileCount=e.serviceDataCount>t},!0),v.init(e,"serviceDataCount",function(t){return e.tileFetcher.useTileCount=t>e.maximumNumberOfFeatures},!0),v.init(C,"FEATURE_TILE_FETCH_SHOW_TILES",function(r){r&&e.tileFetcher&&!e.tileFetcher.debugger?(e.tileFetcher.debugger=new E.FeatureTileFetcher3DDebugger(e.tileFetcher,t.featureTiles.tilingScheme.toTileInfo(),t),e.tileFetcher.debugger.update()):!r&&e.tileFetcher&&e.tileFetcher.debugger&&(e.tileFetcher.debugger.destroy(),e.tileFetcher.debugger=null)})]),e.supportsExceedsLimitQuery||e.watch("maxTotalSnapshotVertices",function(){return e.registerAsyncTask(e.updateVertexLimitExceeded(null,e.lifeCycleAbortController.signal))})})},t.prototype.modeChanged=function(){switch(this.mode){case"tiles":this.tilesHandle||(this.tilesHandle=this.layerView.view.featureTiles.addClient());break;default:w.warn("Unhandled feature layer mode "+this.mode);case"snapshot":this.tilesHandle&&(this.tilesHandle.remove(),this.tilesHandle=null)}},t.prototype.definitionExpressionChanged=function(){this._set("maxTotalSnapshotVertices",0),this.notifyChange("maxTotalSnapshotVertices"),this.refresh()},t.prototype.applyEdits=function(e){var t=this;this.tileFetcher.applyEdits(e).then(function(e){e&&(e.deletedFeatures.length||e.updatedFeatures.length||e.addedFeatures.length)&&t.registerAsyncTask(t.updateServiceDataExtent(t.lifeCycleAbortController.signal))})},t.prototype.attributesChanged=function(e,t){if(!e||-1===e.indexOf("*"))if(e&&t){for(var r=new Set,i=0,s=e;i<s.length;i++){var n=s[i];r.add(n)}for(var a=0,o=t;a<o.length;a++){n=o[a];if(!r.has(n))return void this.refresh()}}else this.refresh()},t.prototype.createVertexLimitExceededQuery=function(e){var t=this.layerView.layer,r=t.createQuery();return r.outStatistics=[new T({statisticType:"exceedslimit",maxVertexCount:e,outStatisticFieldName:"exceedslimit",maxPointCount:1e8,maxRecordCount:1e8})],t.capabilities.query.supportsCacheHint&&(r.cacheHint=!0),r},t.prototype.createDataInfoQuery=function(){var e=this.layerView.layer,t=e.createQuery();return t.outSpatialReference=this.layerView.view.spatialReference,e.capabilities.query.supportsCacheHint&&(t.cacheHint=!0),t},t.prototype.fullExtentIsAccurate=function(){var e=this.layerView.layer;if(e.definitionExpression)return!1;switch(e.type){case"feature":case"stream":return b.isHostedAgolService(e.url);case"csv":case"geojson":return!0;default:c.neverReached(e)}},t.prototype.updateServiceDataExtent=function(e){return a(this,void 0,void 0,function(){var t;return n(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.tryUpdateServiceDataExtent(e)];case 1:return r.sent(),[3,3];case 2:return t=r.sent(),g.isAbortError(t)||this._set("serviceDataExtent",d.clone(this.layerView.fullExtentInLocalViewSpatialReference)),[3,3];case 3:return[2]}})})},t.prototype.tryUpdateServiceDataExtent=function(e){return a(this,void 0,void 0,function(){var t,r,i,a,o,u,l,c,h,p,f;return n(this,function(n){switch(n.label){case 0:return t=this.layerView,r=t.layer,i=r.capabilities.query.supportsExtent,a=d.clone(t.fullExtentInLocalViewSpatialReference),o=r.fullExtent,u=this.fullExtentIsAccurate(),l=this.serviceDataCount,i&&l<=s.constants.MAX_FEATURE_COUNT_FOR_EXTENT&&(!a||!u)?(c=this.createDataInfoQuery(),[4,r.queryExtent(c,{timeout:s.constants.QUERY_EXTENT_TIMEOUT,signal:e})]):[3,2];case 1:return h=n.sent(),this._set("serviceDataExtent",h.extent),[3,6];case 2:return a?(this._set("serviceDataExtent",a),[3,6]):[3,3];case 3:return o?(p="portalItem"in r?r.portalItem:null,[4,x.projectGeometry(o,t.view.spatialReference,p,e)]):[3,5];case 4:return f=n.sent(),this._set("serviceDataExtent",f),[3,6];case 5:this._set("serviceDataExtent",null),n.label=6;case 6:return[2]}})})},t.prototype.updateServiceDataCount=function(e){return a(this,void 0,void 0,function(){var t,r,i;return n(this,function(n){switch(n.label){case 0:return t=this.layerView.layer,[4,u.result(t.queryFeatureCount(this.createDataInfoQuery(),{timeout:s.constants.QUERY_STATISTICS_TIMEOUT,signal:e}))];case 1:if(!0===(r=n.sent()).ok)this._set("serviceDataCount",r.value);else{if(g.isAbortError(r.error))throw r.error;i=s.constants.NO_SERVICE_DATA_COUNT,this._set("serviceDataCount",i)}return[2]}})})},Object.defineProperty(t.prototype,"vertexLimitInfo",{get:function(){if(!this.displayFeatureLimit||!this.displayFeatureLimit.maximumSymbolComplexity)return null;var e=this.displayFeatureLimit,t=e.maximumSymbolComplexity,r=e.maximumTotalNumberOfPrimitives,i=t.primitivesPerCoordinate,s=t.primitivesPerFeature,n=this._get("vertexLimitInfo");return n&&n.maximumTotalNumberOfPrimitives===r&&n.primitivesPerCoordinate===i&&n.primitivesPerFeature===s?n:{primitivesPerCoordinate:i,primitivesPerFeature:s,maximumTotalNumberOfPrimitives:r}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"supportsExceedsLimitQuery",{get:function(){var e=this.layerView.layer;return e.capabilities&&e.capabilities.operations&&e.capabilities.operations.supportsExceedsLimitStatistics},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"minimumNumberOfVerticesForGeometry",{get:function(){var e=this.layerView.layer.geometryType;switch(e){case"point":case"multipoint":return 1;case"polygon":return 4;case"polyline":return 2;case"multipatch":case"mesh":return 3;default:return c.neverReached(e),0}},enumerable:!0,configurable:!0}),t.prototype.updateVertexLimitExceeded=function(e,t){return a(this,void 0,void 0,function(){var r,i,a,o,l,c,h,p,d,f,m,v,F;return n(this,function(n){switch(n.label){case 0:return r=this.vertexLimitInfo&&this.vertexLimitInfo.primitivesPerFeature<=0,i=this.layerView.layer,a=this.supportsExceedsLimitQuery,r?(o=this.vertexLimitInfo,l=o.primitivesPerFeature,c=o.primitivesPerCoordinate,h=o.maximumTotalNumberOfPrimitives,0!==l&&y.isSome(e)?[4,e]:[3,2]):(this._set("vertexLimitExceeded",!1),[2]);case 1:n.sent(),n.label=2;case 2:return p=this.serviceDataCount,f=p!==s.constants.NO_SERVICE_DATA_COUNT,d=f?Math.ceil((h-p*l)/(c||1)):Math.ceil(h/(c||1)),f&&this.minimumNumberOfVerticesForGeometry*p>d?(this._set("vertexLimitExceeded",!0),[2]):(a||this._set("vertexLimitExceeded",this.maxTotalSnapshotVertices>d),[4,u.result(i.queryFeatures(this.createVertexLimitExceededQuery(d),{timeout:s.constants.QUERY_STATISTICS_TIMEOUT,signal:t}))]);case 3:if(!1===(m=n.sent()).ok){if(g.isAbortError(m.error))throw m.error;return this._set("vertexLimitExceeded",!1),[2]}return v=m.value,(F=v.features[0])&&F.attributes?this._set("vertexLimitExceeded",!!F.attributes.exceedslimit):this._set("vertexLimitExceeded",!1),[2]}})})},t.prototype.fetchServiceDataInfo=function(){return a(this,void 0,void 0,function(){var e,t,r,i,s,a=this;return n(this,function(n){return this.cancelFetchServiceDataInfo(),e=g.createAbortController(),t=e.signal,r=this.updateServiceDataCount(t),i=g.eachAlways([r,this.updateVertexLimitExceeded(r,t)]),s=i.then(function(){return a.updateServiceDataExtent(t)}).catch(function(e){g.isAbortError(e)||w.error("#fetchServiceDataInfo()",e)}).then(function(){s===a.fetchDataInfoPromise&&(a.fetchDataInfoPromise=null,a.fetchDataInfoAbortController=null),e=null}),e&&(this.fetchDataInfoPromise=s),this.fetchDataInfoAbortController=e,[2,i.catch(function(){})]})})},t.prototype.cancelFetchServiceDataInfo=function(){var e=this.fetchDataInfoAbortController;e&&(this.fetchDataInfoAbortController=null,this.fetchDataInfoPromise=null,e.abort())},Object.defineProperty(t.prototype,"debug",{get:function(){return{storedFeatures:this.tileFetcher?this.tileFetcher.storedFeatures:0,totalFeatures:this.tileFetcher?this.tileFetcher.totalFeatures:0,totalVertices:this.tileFetcher?this.tileFetcher.totalVertices:0}},enumerable:!0,configurable:!0}),i([F.property({readOnly:!0})],t.prototype,"type",void 0),i([F.property({constructOnly:!0})],t.prototype,"graphics",void 0),i([F.property({constructOnly:!0})],t.prototype,"layerView",void 0),i([F.property()],t.prototype,"extent",null),i([F.property({dependsOn:["tileFetcher.updating","mode","layerView.view.featureTiles.updating","fetchDataInfoPromise","asyncTasks.length"]})],t.prototype,"updating",null),i([F.property({dependsOn:["updating","tileFetcher.updatingTotal"]})],t.prototype,"updatingTotal",null),i([F.property({dependsOn:["updating","tileFetcher.updatingRemaining"]})],t.prototype,"updatingRemaining",null),i([F.property({dependsOn:["updating","tileFetcher.expectedFeatureDiff"]})],t.prototype,"expectedFeatureDiff",null),i([F.property({dependsOn:["tileFetcher.memoryForUnusedFeatures"]})],t.prototype,"memoryForUnusedFeatures",null),i([F.property({dependsOn:["tileFetcher.maximumNumberOfFeaturesExceeded"]})],t.prototype,"maximumNumberOfFeaturesExceeded",null),i([F.property({readOnly:!0})],t.prototype,"serviceDataExtent",void 0),i([F.property({readOnly:!0})],t.prototype,"serviceDataCount",void 0),i([F.property({readOnly:!0})],t.prototype,"vertexLimitExceeded",void 0),i([F.property({readOnly:!0,dependsOn:["extent"]})],t.prototype,"filteredDataExtent",null),i([F.property()],t.prototype,"displayFeatureLimit",void 0),i([F.property({type:Number,dependsOn:["displayFeatureLimit"]})],t.prototype,"maximumNumberOfFeatures",null),i([F.property({readOnly:!0,dependsOn:["serviceDataCount","displayFeatureLimit","maximumNumberOfFeatures","vertexLimitExceeded","serviceDataExtent","layerView.layer.minScale","layerView.view.featureTiles.tilingScheme"]})],t.prototype,"mode",null),i([F.property({readOnly:!0,dependsOn:["mode","tileFetcher.totalVertices"]})],t.prototype,"maxTotalSnapshotVertices",null),i([F.property({readOnly:!0,dependsOn:["mode"]})],t.prototype,"tileDescriptors",null),i([F.property({constructOnly:!0})],t.prototype,"hasZ",void 0),i([F.property({constructOnly:!0})],t.prototype,"hasM",void 0),i([F.property({readOnly:!0})],t.prototype,"asyncTasks",void 0),i([F.property()],t.prototype,"tileFetcher",void 0),i([F.property()],t.prototype,"fetchDataInfoPromise",void 0),i([F.property({readOnly:!0,dependsOn:["displayFeatureLimit"]})],t.prototype,"vertexLimitInfo",null),s=i([F.subclass("esri.layers.graphics.controllers.FeatureTileController3D")],t)}(F.declared(o,m));return function(e){!function(e){e.NO_SERVICE_DATA_COUNT=1/0,e.MAX_SNAPSHOT_MIN_SCALE_FACTOR=5,e.reset=function(){e.MAX_FEATURE_COUNT_FOR_EXTENT=1e4,e.QUERY_STATISTICS_TIMEOUT=12e3,e.QUERY_EXTENT_TIMEOUT=1e4}}(e.constants||(e.constants={}))}(S||(S={})),S.constants.reset(),S}.apply(null,i))||(e.exports=s)},2479:function(e,t,r){var i,s;i=[r.dj.c(e.i),t,r(1),r(0),r(4),r(11),r(9),r(8),r(47),r(18),r(13),r(150),r(7),r(60),r(29),r(2),r(44),r(91),r(814),r(163),r(2480),r(2481),r(2482),r(836)],void 0===(s=function(e,t,r,i,s,n,a,o,u,l,c,h,p,d,f,y,m,g,v,F,b,x,T,_){function O(e){return"dummy-tile-full-extent"===e.id}Object.defineProperty(t,"__esModule",{value:!0});var E=b.SingleFeatureReference,C=b.MultiFeatureReference,w=c.getLogger("esri.views.3d.layers.support.FeatureTileFetcher3D"),S=function(e){function t(t){var r=e.call(this,t)||this;return r.useTileCount=!1,r.updating=!1,r.updatingTotal=0,r.updatingRemaining=0,r.expectedFeatureDiff=0,r.maximumNumberOfFeaturesExceeded=!1,r.maximumNumberOfFeaturesExceededThrottle=1e3,r.maximumNumberOfFeaturesExceededNext=0,r._fullRatio=1,r._farRatio=1,r.changes={updates:{adds:[],removes:[]},adds:[],removes:[]},r.handles=new l,r._dirty=!1,r.idToFeatureTile=new Map,r.displayingFeatureReferences=new Map,r.numDisplayingFeatureReferences=0,r.suspended=!0,r.pendingEdits=null,r}return r(t,e),Object.defineProperty(t.prototype,"maximumNumberOfFeatures",{set:function(e){e=e||1/0;var t=this._get("maximumNumberOfFeatures");e===t||e<1||(this._set("maximumNumberOfFeatures",e),this.maximumFeaturesUpdated(t,e))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"memoryForUnusedFeatures",{get:function(){var e=0;return this.forEachFeatureTile(function(t){return e+=t.estimatedUnusedSize}),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalVertices",{get:function(){var e=0;return this.forEachFeatureTile(function(t){return e+=t.numVertices}),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"totalFeatures",{get:function(){var e=0;return this.forEachFeatureTile(function(t){return e+=t.numFeatures}),e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"filterExtent",{set:function(e){if(e&&this.tilingScheme&&!e.spatialReference.equals(this.tilingScheme.spatialReference))w.error("#filterExtent=","extent needs to be in the same spatial reference as the tiling scheme");else{var t=this._get("filterExtent");if(!(t===e||t&&e&&t.equals(e))){var r=e?e.clone():null;this._set("filterExtent",r),this.reclip(r,t)}}},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){var e=this;this.capabilities=this.calculateCapabilities(),this.fetchQueue=this.createFetchQueue();var t=this.layerView.layer;this.handles.add(f.on(this,"tileDescriptors","change",function(){return e.setDirty()},function(){return e.setDirty()})),this.handles.add(t.watch("hasService",function(){return e._initMemCache()})),f.init(t,"hasService",function(){return e._initMemCache()}),this.objectIdField=t.objectIdField,this.FeatureReferenceClass=this.capabilities.supportsMultipleResolutions?C:E,this.featureTileQuery=T.createFeatureTileQuery3D(t);var r=this.layerView.view.resourceController.scheduler;this.handles.add(r.registerTask(2,function(t){return e.update(t)},function(){return e._dirty||e.maximumNumberOfFeaturesExceededNext>0})),this.setDirty()},t.prototype.destroy=function(){var e=this;this.handles&&(this.handles.destroy(),this.handles=null),this.forEachFeatureTile(function(t){e.cancelFetchTile(t),e.removeTile(t)}),this.idToFeatureTile.clear(),this.displayingFeatureReferences.clear(),this.fetchQueue.destroy(),this.fetchQueue=null,this.featureTileQuery=null,this.pendingEdits&&(this.pendingEdits.controller.abort(),this.pendingEdits=null),this._memCache&&this._memCache.destroy(),this._memCache=null},Object.defineProperty(t.prototype,"paused",{get:function(){return this.suspended||!!this.pendingEdits},enumerable:!0,configurable:!0}),t.prototype.filtersChanged=function(){var e=this;this.fetchQueue.clear(),this._memCache&&this._memCache.clear(),this.forEachFeatureTile(function(t){e.resetFetchTile(t),e.queueFetchTile(t)}),this.setDirty()},t.prototype.suspend=function(){this.suspended||(this.suspended=!0,this.pause(),this.setDirty())},t.prototype.resume=function(){this.suspended&&(this.suspended=!1,this.unpause())},t.prototype.pause=function(){this.paused&&(this.fetchQueue.pause(),this.fetchQueue.reset(),this.updated())},t.prototype.unpause=function(){this.paused||(this.setDirty(),this.fetchQueue.resume(),this.updated())},t.prototype.getFeatureTileById=function(e){return this.idToFeatureTile.get(e)||null},t.prototype.forEachFeatureTile=function(e){this.idToFeatureTile.forEach(e)},t.prototype.applyEdits=function(e){var t=this;this.pendingEdits||(this.pendingEdits={edits:p.resolve(),count:0,controller:p.createAbortController()},this.pause()),this.pendingEdits.count++;var r=this.pendingEdits.edits.then(function(){return e.result.catch(function(e){if(p.isAbortError(e))throw e;return null}).then(function(e){return e?(t.applyEditsDeleteFeatures(e.deletedFeatures),u.safeCast(t.applyEditsAddUpdateFeatures(e.addedFeatures,e.updatedFeatures,t.pendingEdits.controller.signal).then(function(){return e}))):e}).then(function(e){return 0==--t.pendingEdits.count&&(t.pendingEdits=null,t._memCache&&t._memCache.clear(),t.unpause(),t.updated()),e})});return this.pendingEdits.edits=r,this.updated(),r},t.prototype.applyEditsDeleteFeatures=function(e){var t=this;if(0!==e.length){var r=new Set;e.forEach(function(e){return r.add(e.objectId)}),this.forEachFeatureTile(function(e){if(e.features){var i=e.features.filter(function(e){return!r.has(g.getObjectId(e,t.objectIdField))});i.length!==e.features.length&&(e.setFeatures(i,0),t.invalidateCounts())}})}},t.prototype.applyEditsAddUpdateFeatures=function(e,t,r){return n(this,void 0,void 0,function(){var i,s,n,o=this;return a(this,function(a){switch(a.label){case 0:return i=[],s=new Set,e.forEach(function(e){return i.push(e.objectId)}),t.forEach(function(e){i.push(e.objectId),s.add(e.objectId)}),0===i.length?[2]:(n=[],this.forEachFeatureTile(function(e){var t=u.safeCast(o.applyEditsAddUpdateTile(e,i,s,r));t&&n.push(t)}),[4,p.eachAlways(n)]);case 1:return a.sent(),[2]}})})},t.prototype.applyEditsAddUpdateTile=function(e,t,r,i){return n(this,void 0,void 0,function(){var s,n,o,u,l,c,h,p=this;return a(this,function(a){switch(a.label){case 0:return e.features?((s=this.createQuery(e)).resultType=void 0,s.cacheHint=!1,s.objectIds=t,[4,this.queryFeatures(s,i)]):[2];case 1:if(n=a.sent(),o=null,r.size>0&&((u=e.features.filter(function(e){return!r.has(g.getObjectId(e,p.objectIdField))})).length!==e.features.length&&(o=u)),n.features.length>0)for(o||(o=e.features.slice()),this.verticalScale.adjust(n.features),l=0,c=n.features;l<c.length;l++)h=c[l],o.push(h);return o&&(e.setFeatures(o,0),this.invalidateCounts()),[2]}})})},t.prototype.queryFeatures=function(e,t){return this.featureTileQuery.queryFeaturesDehydrated(e,{signal:t,timeout:P})},t.prototype.calculateCapabilities=function(){var e=this.layerView.layer,t=!!(e.capabilities&&e.capabilities.query&&e.capabilities.query.supportsPagination),r=!!(e.capabilities&&e.capabilities.query&&e.capabilities.query.supportsResultType),i=!!(e.capabilities&&e.capabilities.query&&e.capabilities.query.supportsQuantization),s=!!(e.capabilities&&e.capabilities.query&&e.capabilities.query.supportsQuantizationEditMode),n=!!(e.capabilities&&e.capabilities.query&&e.capabilities.query.supportsMaxRecordCountFactor),a=!!(e.capabilities&&e.capabilities.query&&e.capabilities.query.supportsFormatPBF),o=!!(e.capabilities&&e.capabilities.query&&e.capabilities.query.supportsCacheHint);return{supportsMultipleResolutions:this.calculateSupportsMultipleResolutions(),supportsPagination:t,supportsResultType:r,supportsCacheHint:o,supportsQuantization:i,supportsQuantizationEditMode:s,supportsMaxRecordCountFactor:n,supportsFormatPBF:a}},t.prototype.calculateSupportsMultipleResolutions=function(){var e=this.layerView.layer;switch(e.geometryType){case"polyline":return!0;case"polygon":return e.capabilities&&e.capabilities.query&&e.capabilities.query.supportsQuantization;default:return!1}},t.prototype.createFetchQueue=function(){var e=this;return new _.QueueProcessor({concurrency:6,priority:2,scheduler:this.layerView.view.resourceController.scheduler,peeker:function(t){return e.highestPriorityTile(t)},process:function(t,r){return e.fetchTile(t,r)}})},t.prototype.highestPriorityTile=function(e){return e.reduce(function(e,t){return e&&e.descriptor.loadPriority<=t.descriptor.loadPriority?e:t},null)},t.prototype._initMemCache=function(){var e=this.layerView.layer;"hasService"in e&&e.hasService?this._memCache||(this._memCache=this.layerView.view.resourceController.memoryController.getMemCache(e.uid)):this._memCache&&(this._memCache.destroy(),this._memCache=null)},t.prototype.setDirty=function(){this._dirty=!0,this.updated()},t.prototype.update=function(e){var t=this;if(this.maximumNumberOfFeaturesExceededNext&&h()>=this.maximumNumberOfFeaturesExceededNext&&this.updateMaximumNumberOfFeaturesExceeded(),this._dirty&&this.constructed){this._dirty=!1;var r=this.getListOfTiles();this.markTilesNotAlive(r),this.addTiles(r),this.filterExtentTiles(r),this.removeTiles(r);var i=this.sortTiles(r);e.run(function(){return t.displayTiles(i,e)})&&e.run(function(){return t.queueFetchTiles(i,e)})&&e.run(function(){return t.updateMemoryEstimates(i,e)})||this.setDirty(),this.updated()}},t.prototype.markTilesNotAlive=function(e){for(var t=0,r=e;t<r.length;t++)r[t].alive=!1},t.prototype.addTiles=function(e){var t=this;this.suspended||this.tileDescriptors.forEach(function(r){var i=t.getFeatureTileById(r.id);i?i.alive=!0:e.push(t.addTile(r))})},t.prototype.filterExtentTiles=function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t];i.alive&&(i.filtered=!i.intersects(this.filterExtent),i.filtered&&this.clearTile(i))}},t.prototype.removeTiles=function(e){for(var t=e.length-1;t>=0;t--){var r=e[t];r.alive||(this.removeTile(r),t!==e.length-1&&(e[t]=e[e.length-1]),e.pop())}},t.prototype.sortTiles=function(e){return e.sort(function(e,t){return e.descriptor.loadPriority-t.descriptor.loadPriority}),e},t.prototype.displayTiles=function(e,t){for(var r=this,i=this.updateRatio(e),s=function(e){var t=r._fullRatio<1?i(e)*r._farRatio:1;return e.reduceFeatures(t,r.objectIdField)&&r.setDirty(),r.showTile(e)},n=this,a=0,o=e;a<o.length;a++){if("break"===function(e){if(!t.run(function(){return s(e)}))return n.setDirty(),"break"}(o[a]))break}return t.hasProgressed},t.prototype.queueFetchTiles=function(e,t){for(var r=this,i=this,s=0,n=e;s<n.length;s++){var a=function(e){if(!t.run(function(){return r.queueFetchTile(e)}))return i.setDirty(),{value:!0}}(n[s]);if("object"==typeof a)return a.value}return t.hasProgressed},t.prototype.updateMemoryEstimates=function(e,t){var r=this;return e.some(function(e){if(!t.run(function(){return e.updateMemoryEstimates()}))return r.setDirty(),!0}),t.hasProgressed},t.prototype.reclip=function(e,t){var r=this;this.constructed&&(this.forEachFeatureTile(function(i){i.displayingFeatures&&0!==i.displayingFeatures.length&&(i.intersection(t,D),i.intersection(e,M),m.equals(D,M)||r.hideTileFeatures(i))}),this.forEachFeatureTile(function(e){return r.showTile(e)}),this.updated())},t.prototype.updated=function(){var e=this,t=this._dirty||this.fetchQueue.length>0||!!this.pendingEdits;if(this._set("updating",t),t){var r=0,i=0,s=0,n=0,a=0,o=0,u=this.displayingFeatureReferences.size/this.numDisplayingFeatureReferences;this.forEachFeatureTile(function(t){if(++s,t.isFetching&&t.hasPreciseFeatureCount){var r=e.maximumFeaturesForTile(t)*(1-t.emptyFeatureRatio),l=t.displayingFeatures?t.displayingFeatures.length*u:0;o+=r-l}t.needsFetching?++a:t.numFeatures>0&&(++n,i+=t.numFeatures)});var l=a+=this.fetchQueue?this.fetchQueue.length:0;i?r=i+(l=a*i/n):r=s,o=Math.min(this.maximumNumberOfFeatures-this.features.length,o),this._set("updatingTotal",r),this._set("updatingRemaining",l),this._set("expectedFeatureDiff",o)}else this._set("updatingTotal",0),this._set("updatingRemaining",0),this._set("expectedFeatureDiff",0);this.debugger&&this.debugger.update(),this.updating||(this.maximumNumberOfFeaturesExceededNext=this.maximumNumberOfFeaturesExceededNext||h()+this.maximumNumberOfFeaturesExceededThrottle)},t.prototype.updateMaximumNumberOfFeaturesExceeded=function(){if(!this.updating){var e=!1;this.forEachFeatureTile(function(t){e=e||t.perTileMaximumNumberOfFeaturesExceeded}),this.maximumNumberOfFeaturesExceededNext=0,this._set("maximumNumberOfFeaturesExceeded",e)}},t.prototype.updateRatio=function(e){for(var t=function(e){for(var t=0,r=0,i=e;r<i.length;r++){var s=i[r];s.features&&s.features.length>0&&s.alive&&(t=Math.max(t,s.descriptor.lij[0]))}return t}(e),r=function(e){return 1/(1<<t-e.descriptor.lij[0])},i=0,s=0,n=0,a=e;n<a.length;n++){var o=a[n],u=o.numFeatures;i+=u,s+=u*r(o)}return this._fullRatio=Math.min(1,this.maximumNumberOfFeatures/i),this._farRatio=this.maximumNumberOfFeatures/s,this.scheduleUpdated(),r},t.prototype.maximumFeaturesUpdated=function(e,t){var r=this;e!==t&&(t>e&&this.forEachFeatureTile(function(e){if(e.featuresMissing){var t=r.maximumFeaturesForTile(e);e.features&&(e.features.length>=t||5===e.fetchStatus)||(r.cancelFetchTile(e),r.resetFetchTile(e))}}),this.setDirty())},t.prototype.addTile=function(e){var t=new x(e);return this.idToFeatureTile.set(t.id,t),this.resetFetchTile(t),this.referenceDisplayingFeaturesFromRelatedTiles(t),t},t.prototype.referenceDisplayingFeaturesFromRelatedTiles=function(e){var t=this,r=e.descriptor.resolution;this.forEachFeatureTile(function(i){if(i.displayingFeatures&&t.tilesAreRelated(e,i)){e.displayingFeatures=e.displayingFeatures||[];for(var s=0,n=i.displayingFeatures;s<n.length;s++){var a=n[s];e.displayingFeatures.push(a);var o=t.displayingFeatureReferences.get(g.getObjectId(a,t.objectIdField));o.ref(r,o.feature),t.numDisplayingFeatureReferences++}}}),e.featureLimit=e.displayingFeatures?e.displayingFeatures.length:0},t.prototype.tilesAreRelated=function(e,t){if(e===t)return!1;var r=e.descriptor.lij,i=t.descriptor.lij;if(!r||!i)return!0;var s=r[0]<i[0],n=s?r:i,a=s?i:r,o=a[0]-n[0];if(0===o)return!1;var u=1<<o;return Math.floor(a[1]/u)===n[1]&&Math.floor(a[2]/u)===n[2]},t.prototype.removeTile=function(e){this.clearTile(e),this.idToFeatureTile.delete(e.id)},t.prototype.resetFetchTile=function(e){e.intersects(this.filterExtent)?(e.fetchStatus=0,e.filtered=!1):(e.needsFetching&&(e.fetchStatus=4),e.filtered=!0)},t.prototype.cancelFetchTile=function(e){e.fetchRequest&&(e.fetchRequest=null,e.fetchStatus=0,this.fetchQueue.abort(e))},t.prototype.fetchTile=function(e,t){return n(this,void 0,void 0,function(){var r,i,s,n,o,u,l,c,h,d,f,y;return a(this,function(a){switch(a.label){case 0:if(!this.needsNumFeatures(e))return[3,4];a.label=1;case 1:return a.trys.push([1,3,,4]),r=e,[4,this.fetchCount(e,t)];case 2:return r.numFeatures=a.sent(),this.updateRatio(this.getListOfTiles()),[3,4];case 3:return i=a.sent(),p.isAbortError(i)?[2]:[3,4];case 4:return s=this.maximumFeaturesForTile(e),n=this.getMaxRecordCount(e),o=Math.ceil(s/n),O(e)||!this.capabilities.supportsMaxRecordCountFactor||e.numFeatures<=s&&o>F.MAX_MAX_RECORD_COUNT_FACTOR?[2,this.fetchPagedTile(e,t)]:((u=this.createQuery(e)).maxRecordCountFactor=Math.ceil(s/n),e.isRefetching&&e.features&&e.features.length>0&&(l=Math.ceil(e.features.length/(1-e.emptyFeatureRatio)/n),u.maxRecordCountFactor=Math.max(l+1,u.maxRecordCountFactor)),[4,this.queryFeatures(u,t)]);case 5:return c=a.sent(),h=c.features,d=c.exceededTransferLimit,f=d?u.maxRecordCountFactor>=F.MAX_MAX_RECORD_COUNT_FACTOR?5:4:5,e.featuresMissing=h.length<e.numFeatures||d,y=this._removeEmptyFeatures(h),this.verticalScale.adjust(h),e.setFeatures(h,y),this.invalidateCounts(),[2,f]}})})},t.prototype.fetchCount=function(e,t){return n(this,void 0,void 0,function(){return a(this,function(r){return[2,this.layerView.layer.queryFeatureCount(this.createFeatureCountQuery(e),{signal:t})]})})},t.prototype.fetchPagedTile=function(e,t){return n(this,void 0,void 0,function(){var r,i,s,n,o,u,l,c,h,p,d;return a(this,function(a){switch(a.label){case 0:r=0,i=0,n=0,o=this.maximumFeaturesForTile(e)-n,u=this.getMaxRecordCount(e),a.label=1;case 1:return l=this.createQuery(e),c=this.setPagingParameters(l,r,o,u),[4,this.queryFeatures(l,t)];case 2:return h=a.sent(),p=h.features,d=h.exceededTransferLimit,r+=l.num,n+=p.length,i+=this._removeEmptyFeatures(p),this.verticalScale.adjust(p),e.featuresMissing=r<e.numFeatures||d,s=s?s.concat(p):p,e.setFeatures(s,i),this.invalidateCounts(),this.setDirty(),o=this.maximumFeaturesForTile(e)-n,!c||!d||o<=0?[2,d?4:5]:[3,1];case 3:return[2]}})})},t.prototype.createFeatureCountQuery=function(e){var t=this.createQuery(e);return this.capabilities.supportsCacheHint&&(t.resultType=void 0,t.cacheHint=!0),t},t.prototype.createQuery=function(e){var t=this.layerView.layer.createQuery();t.outFields=this.layerView.availableFields,t.returnZ=this.hasZ,t.returnM=this.hasM;var r=this.tilingScheme.spatialReference;t.outSpatialReference=r;var i=e.descriptor.extent;return i&&(t.geometry=m.toExtent(i,r)),this.setResolutionParams(t,e),this.useTileQuery(e)?t.resultType="tile":this.capabilities.supportsCacheHint&&(t.cacheHint=!0),t},t.prototype.setPagingParameters=function(e,t,r,i){return!!this.capabilities.supportsPagination&&(e.start=t,r>0&&this.capabilities.supportsMaxRecordCountFactor?(e.maxRecordCountFactor=Math.ceil(r/i),e.num=Math.min(e.maxRecordCountFactor*i,r)):e.num=Math.min(i),!0)},t.prototype.getEffectiveTileResolution=function(e){if(null==e.descriptor.resolution)return null;var t="global"===this.viewingMode?this.tilingScheme.resolutionAtLevel(3):1/0;return Math.min(e.descriptor.resolution,t)*N},t.prototype.setResolutionParams=function(e,t){if(this.capabilities.supportsMultipleResolutions){var r=this.layerView.layer;if("point"!==r.geometryType){var i=this.getEffectiveTileResolution(t);null!=i&&(this.capabilities.supportsQuantization?e.quantizationParameters=new v.default({mode:"view",originPosition:"upper-left",tolerance:i,extent:r.fullExtent}):"polyline"===r.geometryType&&(e.maxAllowableOffset=i))}}},t.prototype._removeEmptyFeatures=function(e){for(var t=e.length,r=0;r<e.length;){var i=e[r];g.hasVertices(i.geometry)?++r:(e[r]=e[e.length-1],--e.length)}return t-e.length},t.prototype.needsNumFeatures=function(e){return this.useTileCount&&!e.hasPreciseFeatureCount&&!O(e)},t.prototype.getMaxRecordCount=function(e){var t=this.layerView.layer;return this.useTileQuery(e)&&t&&"tileMaxRecordCount"in t&&t.tileMaxRecordCount>0&&this.capabilities.supportsResultType?t.tileMaxRecordCount:t&&"maxRecordCount"in t&&t.maxRecordCount>0?t.maxRecordCount:R},t.prototype.useTileQuery=function(e){return(!O(e)||!this.capabilities.supportsCacheHint)&&this.capabilities.supportsResultType},t.prototype.queueFetchTile=function(e){var t=this;if(!e.needsFetching)return!1;var r=this._memCache&&this._memCache.pop(e.id);if(r)return e.loadCache(r),this.setDirty(),this.scheduleUpdated(),!0;e.fetchStatus=e.needsRefetching?3:2;var i=!1,s=!1,n=this.fetchQueue.push(e).then(function(t){e.fetchRequest=null,e.fetchStatus=t}).catch(function(r){e.fetchRequest===n&&(e.fetchRequest=null,e.fetchStatus=4),p.isAbortError(r)?i=!0:(e.setFeatures([],0),t.invalidateCounts(),e.featuresMissing=!1,w.error("#fetchTile()",t.layerView.layer,r&&r.message?r.message:r))}).then(function(){s=!0,i||t.setDirty(),t.scheduleUpdated()});return s||(e.fetchRequest=n),!0},t.prototype.scheduleUpdated=function(){var e=this;this.handles&&!this.handles.has("scheduleUpdated")&&this.handles.add(d.schedule(function(){e.handles.remove("scheduleUpdated"),e.updated()}),"scheduleUpdated")},t.prototype.showTile=function(e){if(e.displayingFeatures&&!e.needsDisplayUpdate)return!1;if(0===e.featureLimit||!e.features){var t=e.displayingFeatures&&e.displayingFeatures.length>0;return this.hideTileFeatures(e),e.displayingFeatures=[],t}for(var r=e.descriptor.resolution,i=this.changes.updates,s=this.changes.adds,n=0;n<e.featureLimit;++n){var a=e.features[n],o=g.getObjectId(a,this.objectIdField),u=this.displayingFeatureReferences.get(o);if(u){var l=u.ref(r,a);l.oldVersion!==l.newVersion&&(i.removes.push(l.oldVersion),i.adds.push(l.newVersion))}else this.displayingFeatureReferences.set(o,new this.FeatureReferenceClass(r,a)),s.push(a);this.numDisplayingFeatureReferences++}return this.hideTileFeatures(e),this.applyChanges(),e.displayingFeatures=e.features.slice(0,e.featureLimit),!0},t.prototype.hideTile=function(e){this.cancelFetchTile(e),this.hideTileFeatures(e)},t.prototype.hideTileFeatures=function(e){if(e.displayingFeatures){for(var t=this.changes.updates,r=this.changes.removes,i=0,s=e.displayingFeatures;i<s.length;i++){var n=s[i],a=g.getObjectId(n,this.objectIdField),o=this.displayingFeatureReferences.get(a);if(o){var u=o.unref(e.descriptor.resolution);this.numDisplayingFeatureReferences--,u?u.oldVersion!==u.newVersion&&(null==u.newVersion?(this.displayingFeatureReferences.delete(a),r.push(u.oldVersion)):(t.adds.push(u.newVersion),t.removes.push(u.oldVersion))):console.error("Hiding unreferenced feature")}}this.applyChanges(),e.displayingFeatures=null}},t.prototype.applyChanges=function(){var e=this.changes.updates;e.removes.length>0&&(this.features.removeMany(e.removes),e.removes.length=0),e.adds.length>0&&(this.features.addMany(e.adds),e.adds.length=0);for(var t=this.changes.adds,r=this.changes.removes,i=Math.min(t.length,r.length),s=0;s<i;){var n=Math.min(s+V,i);this.features.addMany(t.slice(s,n)),this.features.removeMany(r.slice(s,n)),s=n}t.length>i&&this.features.addMany(0===s?t:t.slice(s)),r.length>i&&this.features.removeMany(0===s?r:r.slice(s)),t.length=0,r.length=0},t.prototype.clearTile=function(e){if(this.hideTile(e),e.features&&this._memCache){var t=16+e.estimatedSize;this._memCache.put(e.id,e.cacheItem,t)}e.setFeatures(null,0),this.invalidateCounts()},t.prototype.invalidateCounts=function(){this.notifyChange("totalVertices"),this.notifyChange("totalFeatures"),this.notifyChange("memoryForUnusedFeatures")},t.prototype.getListOfTiles=function(){var e=new Array(this.idToFeatureTile.size),t=0;return this.forEachFeatureTile(function(r){return e[t++]=r}),e},Object.defineProperty(t.prototype,"storedFeatures",{get:function(){return this.getListOfTiles().reduce(function(e,t){return e+(t.features?t.features.length:0)},0)},enumerable:!0,configurable:!0}),t.prototype.maximumFeaturesForTile=function(e){var t=e.hasPreciseFeatureCount?e.numFeatures:this.maximumNumberOfFeatures,r=this._fullRatio<1?this._farRatio:1;return Math.min(Math.ceil(t*r/(1-e.emptyFeatureRatio)),t)},Object.defineProperty(t.prototype,"test",{get:function(){var e=this;return{update:function(t){e.fetchQueue.test.update(t),e.update(t)}}},enumerable:!0,configurable:!0}),i([y.property({constructOnly:!0})],t.prototype,"features",void 0),i([y.property()],t.prototype,"tileDescriptors",void 0),i([y.property({constructOnly:!0})],t.prototype,"tilingScheme",void 0),i([y.property({value:1/0})],t.prototype,"maximumNumberOfFeatures",null),i([y.property()],t.prototype,"useTileCount",void 0),i([y.property({constructOnly:!0})],t.prototype,"layerView",void 0),i([y.property({readOnly:!0})],t.prototype,"updating",void 0),i([y.property({readOnly:!0})],t.prototype,"updatingTotal",void 0),i([y.property({readOnly:!0})],t.prototype,"updatingRemaining",void 0),i([y.property({readOnly:!0})],t.prototype,"expectedFeatureDiff",void 0),i([y.property({readOnly:!0})],t.prototype,"memoryForUnusedFeatures",null),i([y.property({readOnly:!0})],t.prototype,"maximumNumberOfFeaturesExceeded",void 0),i([y.property({constructOnly:!0})],t.prototype,"maximumNumberOfFeaturesExceededThrottle",void 0),i([y.property({readOnly:!0})],t.prototype,"totalVertices",null),i([y.property({readOnly:!0})],t.prototype,"totalFeatures",null),i([y.property()],t.prototype,"filterExtent",null),i([y.property({constructOnly:!0})],t.prototype,"verticalScale",void 0),i([y.property({constructOnly:!0})],t.prototype,"viewingMode",void 0),i([y.property({constructOnly:!0})],t.prototype,"hasZ",void 0),i([y.property({constructOnly:!0})],t.prototype,"hasM",void 0),i([y.subclass("esri.views.3d.layers.support.FeatureTileFetcher3D")],t)}(y.declared(o));t.FeatureTileFetcher3D=S;var R=2e3,D=m.create(),M=m.create(),P=6e5,V=200,N=1/3;t.default=S}.apply(null,i))||(e.exports=s)},2480:function(e,t,r){var i,s;i=[r.dj.c(e.i),t,r(91)],void 0===(s=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){this.highestResolutionVersion=null,this.versions=[],this.markedTile=null,this.ref(e,t)}return Object.defineProperty(e.prototype,"isReferenced",{get:function(){return 0!==this.versions.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSingle",{get:function(){return 1===this.versions.length&&1===this.versions[0].refCount},enumerable:!0,configurable:!0}),e.prototype.ref=function(e,t){var i=this.feature;n.oldVersion=i,this.feature&&(t.uid=this.feature.uid);for(var s=0,a=this.versions;s<a.length;s++){var o=a[s];if(o.resolution===e){o.refCount++;var u=this.highestResolutionVersion===o&&!r.equals(t,o.feature);return(u||this.highestResolutionVersion!==o)&&(o.feature=t),n.newVersion=u?t:i,n}}var l={feature:t,resolution:e,refCount:1};return this.versions.push(l),!this.highestResolutionVersion||e<this.highestResolutionVersion.resolution?(n.newVersion=t,this.highestResolutionVersion=l):n.newVersion=i,n},e.prototype.unref=function(e){for(var t=0;t<this.versions.length;t++){var r=this.versions[t];if(r.resolution===e)return r.refCount--,n.oldVersion=this.feature,0===r.refCount&&(this.versions[t]=this.versions[this.versions.length-1],this.versions.length--,this.highestResolutionVersion===r&&(this.recalculateHighestResolutionVersion(),n.oldVersion=r.feature)),n.newVersion=this.feature,n}return null},Object.defineProperty(e.prototype,"feature",{get:function(){return this.highestResolutionVersion?this.highestResolutionVersion.feature:null},enumerable:!0,configurable:!0}),e.prototype.recalculateHighestResolutionVersion=function(){if(0!==this.versions.length){for(var e=this.versions[0],t=1;t<this.versions.length;t++){var r=this.versions[t];r.resolution<e.resolution&&(e=r)}this.highestResolutionVersion=e}else this.highestResolutionVersion=null},e}();t.MultiFeatureReference=i;var s=function(){function e(e,t){this._feature=t,this.refCount=1,this.markedTile=null}return Object.defineProperty(e.prototype,"isReferenced",{get:function(){return 0!==this.refCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSingle",{get:function(){return 1===this.refCount},enumerable:!0,configurable:!0}),e.prototype.ref=function(e,t){return++this.refCount,n.oldVersion=this._feature,this.feature&&(t.uid=this.feature.uid),r.equals(this._feature,t)||(this._feature=t),n.newVersion=this._feature,n},e.prototype.unref=function(e){return n.oldVersion=this._feature,this.refCount>0&&(this.refCount--,!this.isReferenced)?(n.newVersion=null,n):(n.newVersion=this._feature,n)},Object.defineProperty(e.prototype,"feature",{get:function(){return this._feature},enumerable:!0,configurable:!0}),e}();t.SingleFeatureReference=s;var n={oldVersion:null,newVersion:null}}.apply(null,i))||(e.exports=s)},2481:function(e,t,r){var i,s;i=[r.dj.c(e.i),t,r(58),r(44),r(91)],void 0===(s=function(e,t,r,i,s){var n=function(){function e(t){this.descriptor=t,this.fetchRequest=null,this.fetchStatus=0,this._features=null,this._numVertices=0,this._featureLimit=0,this.featuresMissing=!0,this._shuffled=!1,this._numFeatures=e.UNKNOWN_COUNT,this._emptyFeatureRatio=0,this._estimatedSize=-1,this._estimatedUnusedSize=0,this._estimatedUnusedSizeDirty=!1,this.displayingFeatures=null,this.alive=!0,this.filtered=!1}return Object.defineProperty(e.prototype,"perTileMaximumNumberOfFeaturesExceeded",{get:function(){return!this.filtered&&(this.featuresMissing||this.features&&this.featureLimit!==this.features.length)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"features",{get:function(){return this._features},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"featureLimit",{get:function(){return this._featureLimit},set:function(e){this._featureLimit!==e&&(this._featureLimit=e,this._estimatedUnusedSizeDirty=!0)},enumerable:!0,configurable:!0}),e.prototype.setFeatures=function(e,t){this._features=e,this._shuffled=!1,this._estimatedSize=-1,this._estimatedUnusedSizeDirty=!0,e&&e.length>0?(this._emptyFeatureRatio=t/(e.length+t),this._numVertices=e.reduce(function(e,t){return e+s.numVertices(t.geometry)},0)):(this._emptyFeatureRatio=0,this._numVertices=0)},Object.defineProperty(e.prototype,"emptyFeatureRatio",{get:function(){return this._emptyFeatureRatio},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numFeatures",{get:function(){return this._numFeatures!==e.UNKNOWN_COUNT?this._numFeatures:this._features?this._features.length:0},set:function(e){this._numFeatures=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"numVertices",{get:function(){return this._numVertices},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasPreciseFeatureCount",{get:function(){return this._numFeatures!==e.UNKNOWN_COUNT},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.descriptor.id},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"estimatedSize",{get:function(){return this.updateMemoryEstimates(),this._estimatedSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"estimatedUnusedSize",{get:function(){return this._estimatedUnusedSize},enumerable:!0,configurable:!0}),e.prototype.updateMemoryEstimates=function(){if(this._estimatedSize<0){if(this._estimatedSize=0,this._estimatedUnusedSize=0,this._features)for(var e=0;e<this._features.length;++e){var t=s.estimateSize(this._features[e]);this._estimatedSize+=t,e>=this.featureLimit&&(this._estimatedUnusedSize+=t)}return!0}if(this._estimatedUnusedSizeDirty){if(this._estimatedUnusedSize=0,this._estimatedUnusedSizeDirty=!1,this._features)for(e=this.featureLimit;e<this._features.length;++e)this._estimatedUnusedSize+=s.estimateSize(this._features[e]);return!0}return!1},Object.defineProperty(e.prototype,"isFetching",{get:function(){return 2===this.fetchStatus||3===this.fetchStatus},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isRefetching",{get:function(){return 3===this.fetchStatus},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needsFetching",{get:function(){return 0===this.fetchStatus||1===this.fetchStatus},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needsRefetching",{get:function(){return 1===this.fetchStatus},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isFetched",{get:function(){return 4===this.fetchStatus||5===this.fetchStatus},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needsDisplayUpdate",{get:function(){return!!this._features&&!function(e,t,r){if(!t||!e||r!==t.length||r>e.length)return!1;for(var i=0;i<r;++i)if(e[i]!==t[i])return!1;return!0}(this._features,this.displayingFeatures,this.featureLimit)},enumerable:!0,configurable:!0}),e.prototype.intersects=function(e){return!e||!this.descriptor.extent||(i.fromExtent(e,a),i.intersects(this.descriptor.extent,a))},e.prototype.intersection=function(e,t){return e||this.descriptor.extent?(e?(i.fromExtent(e,t),this.descriptor.extent&&i.intersection(t,this.descriptor.extent,t)):i.set(t,this.descriptor.extent),t):(i.set(t,i.POSITIVE_INFINITY),t)},e.prototype._shuffle=function(e){this._features.sort(function(t,r){return s.getObjectId(t,e)-s.getObjectId(r,e)}),r.shuffle(this._features,16438),this._shuffled=!0,this._estimatedUnusedSizeDirty=!0},e.prototype.reduceFeatures=function(e,t){if(e<=0)return!1;var r=!1;return this._features?(this.featureLimit=Math.ceil(this.numFeatures*e),this.featureLimit>this._features.length&&(this.featureLimit=this._features.length,4===this.fetchStatus&&this._features.length>0&&(this.fetchStatus=1,r=!0)),!this._shuffled&&e<1&&this._shuffle(t)):this.featureLimit=0,r},Object.defineProperty(e.prototype,"cacheItem",{get:function(){return{features:this.features,numFeatures:this._numFeatures,emptyFeatureRatio:this._emptyFeatureRatio,fetchStatus:this.fetchStatus,featuresMissing:this.featuresMissing}},enumerable:!0,configurable:!0}),e.prototype.loadCache=function(e){this.fetchRequest=null,this._features=e.features,this._numFeatures=e.numFeatures,this._emptyFeatureRatio=e.emptyFeatureRatio,this.fetchStatus=e.fetchStatus,this.featuresMissing=e.featuresMissing,this._estimatedSize=-1,this._estimatedUnusedSizeDirty=!0},e}();(n||(n={})).UNKNOWN_COUNT=-1;var a=i.create();return n}.apply(null,i))||(e.exports=s)},2482:function(e,t,r){var i,s;i=[r.dj.c(e.i),t,r(1),r(0),r(8),r(2),r(91),r(484)],void 0===(s=function(e,t,r,i,s,n,a,o){Object.defineProperty(t,"__esModule",{value:!0});var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),Object.defineProperty(t.prototype,"queryFeaturesDehydrated",{get:function(){var e=this,t=this.layer.capabilities,r=t&&t.query;if(r&&r.supportsFormatPBF){var i={type:"dehydrated",applyTransform:!0,useWorker:!0,maxStringAttributeLength:1024};return function(t,r){return o.executeQueryPBF(e.layer.parsedUrl,t,i,r).then(function(e){return e.data})}}return function(t,r){return o.executeQuery(e.layer.parsedUrl,t,r).then(function(e){return a.fromFeatureSetJSON(e.data)})}},enumerable:!0,configurable:!0}),i([n.property({constructOnly:!0})],t.prototype,"layer",void 0),i([n.property({readOnly:!0,dependsOn:["layer.capabilities.query.supportsFormatPBF"]})],t.prototype,"queryFeaturesDehydrated",null),i([n.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],t)}(n.declared(s)),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.queryFeaturesDehydrated=function(e,t){var r=this;return this.source.queryFeaturesJSON(e,t).then(a.fromFeatureSetJSON,function(i){if(i&&"query-features-json:unsupported"===i.name)return r.source.queryFeatures(e,t);throw i})},i([n.property({constructOnly:!0})],t.prototype,"layer",void 0),i([n.aliasOf("layer.source")],t.prototype,"source",void 0),i([n.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileClientQuery3D")],t)}(n.declared(s));t.createFeatureTileQuery3D=function(e){switch(e.source.type){case"feature-layer":return new u({layer:e});case"memory":case"csv":case"geojson":return new l({layer:e});case"stream-layer":throw new Error("Tile based queries unsupported for stream sources")}}}.apply(null,i))||(e.exports=s)},2483:function(e,t,r){var i,s;i=[r.dj.c(e.i),t,r(62),r(63),r(205),r(289),r(290),r(188),r(298)],void 0===(s=function(e,t,r,i,s,n,a,o,u){Object.defineProperty(t,"__esModule",{value:!0});var l=[[0,179,255],[117,62,128],[0,104,255],[215,189,166],[32,0,193],[98,162,206],[102,112,129],[52,125,0],[142,118,246],[138,83,0],[92,122,255],[122,55,83],[0,142,255],[81,40,179],[0,200,244],[13,24,127],[0,170,147],[19,58,241],[22,44,35]],c=function(){function e(e,t,r){this.loadingGraphics=new Map,this.loadedGraphics=new Map,this.pendingGraphics=new Map,this._enabled=!0,this.tileFetcher=e,this.view=r,this.tilingScheme=new u(t),this.loadedSymbols=l.map(function(e){return new a(new s({material:{color:[e[0],e[1],e[2],.6]},outline:{color:"black",size:1}}))}),this.loadingSymbols=[new a(new s({material:{color:[200,200,200,.4]},outline:{color:[30,30,30],size:1}}))],this.pendingSymbols=[new a(new s({material:{color:[100,100,100,.4]},outline:{color:[30,30,30],size:1}}))],this.dataExtentSymbol=new a(new s({material:{color:[0,0,0,0]},outline:{color:"green",size:4}}))}return e.prototype.destroy=function(){this.enabled=!1},Object.defineProperty(e.prototype,"enabled",{get:function(){return this._enabled},set:function(e){this._enabled=e,this.update()},enumerable:!0,configurable:!0}),e.prototype.update=function(){var e=this;this._enabled?(this.synchronizeMaps(this.loadingGraphics,{filter:function(e){return e.isFetching},symbols:this.loadingSymbols}),this.synchronizeMaps(this.loadedGraphics,{filter:function(e){return!e.isFetching},symbols:this.loadedSymbols}),this.synchronizeMaps(this.pendingGraphics,{filter:function(e){return!e.isFetching},symbols:this.pendingSymbols}),this.showDataExtent(this.tileFetcher.filterExtent)):(this.loadingGraphics.forEach(function(t){e.view.graphics.removeMany(t)}),this.loadingGraphics.clear(),this.loadedGraphics.forEach(function(t){e.view.graphics.removeMany(t)}),this.loadedGraphics.clear(),this.pendingGraphics.forEach(function(t){e.view.graphics.removeMany(t)}),this.pendingGraphics.clear(),this.dataExtentGraphic&&(this.view.graphics.remove(this.dataExtentGraphic),this.dataExtentGraphic=null))},e.prototype.showDataExtent=function(e){if(this.dataExtentGraphic&&(this.view.graphics.remove(this.dataExtentGraphic),this.dataExtentGraphic=null),e){var t=i.fromExtent(e);this.dataExtentGraphic=new r({geometry:t,symbol:this.dataExtentSymbol}),this.view.graphics.add(this.dataExtentGraphic)}},e.prototype.synchronizeMaps=function(e,t){var i=this,s=[];e.forEach(function(e,r){var n=i.tileFetcher.getFeatureTileById(r);n&&t.filter(n)||(i.view.graphics.removeMany(e),s.push(r))}),s.forEach(function(t){return e.delete(t)}),this.tileFetcher.forEachFeatureTile(function(s){if(t.filter(s)&&!e.has(s.id)){var a=s.descriptor.lij,u=a[0],l=a[1],c=a[2];i.tilingScheme.ensureMaxLod(u);var h=i.tilingScheme.getExtentGeometry(u,l,c),p=[new r({geometry:h,symbol:t.symbols[u%t.symbols.length]}),new r({geometry:h.center,symbol:new n({verticalOffset:{screenLength:40/.75},callout:{type:"line",color:"white",border:{color:"black"}},symbolLayers:[new o({text:u+"/"+l+"/"+c,halo:{color:"white",size:1/.75},material:{color:"black"},size:16})]})})];e.set(s.id,p),i.view.graphics.addMany(p)}})},e}();t.FeatureTileFetcher3DDebugger=c,t.default=c}.apply(null,i))||(e.exports=s)},2491:function(e,t,r){var i,s;i=[r.dj.c(e.i),t,r(12),r(135),r(116),r(50)],void 0===(s=function(e,t,r,i,s,n){Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._set=new s.default,t}return r(t,e),t.prototype.clear=function(){if(this._set.size>0){var e=this.toArray();this._set.clear(),this.emit("change",{added:[],removed:e})}},Object.defineProperty(t.prototype,"length",{get:function(){return this._set.size},enumerable:!0,configurable:!0}),t.prototype.addMany=function(e){if(0!==e.length){for(var t=0,r=e;t<r.length;t++){var i=r[t];this._set.add(i)}this.emit("change",{added:e,removed:[]})}},t.prototype.removeMany=function(e){for(var t=[],r=0,i=e;r<i.length;r++){var s=i[r];this._set.delete(s)&&t.push(s)}t.length>0&&this.emit("change",{added:[],removed:t})},t.prototype.toArray=function(){return i.from(this._set)},t.prototype.find=function(e){for(var t=this._set.entries(),r=t.next();!r.done;r=t.next())if(e(r.value[0]))return r.value[0]},t.prototype.forEach=function(e){this._set.forEach(function(t){return e(t)})},t}(n);t.EventedSet=a}.apply(null,i))||(e.exports=s)}}]);