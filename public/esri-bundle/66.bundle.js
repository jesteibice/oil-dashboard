(function(){(this||window).webpackJsonp.registerAbsMids({"esri/views/2d/layers/features/tileRenderers/support/visualVariablesUtils":2220,"esri/views/2d/layers/features/tileRenderers/BaseTileRenderer":2286,"esri/views/2d/layers/features/tileRenderers/SymbolTileRenderer":2660,"esri/views/2d/layers/features/tileRenderers/support/WGLFeatureView":2661})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[66],{2220:function(e,t,i){var r,s;r=[i.dj.c(e.i),t,i(20),i(2118),i(293)],void 0===(s=function(e,t,i,r,s){function a(e){return{value:e.value,size:i.toPt(e.size)}}function n(e){return e.map(function(e){return a(e)})}function l(e){if("string"==typeof e||"number"==typeof e)return i.toPt(e);var t=e;return{type:"size",expression:t.expression,stops:n(t.stops)}}function o(e){var t={values:[0,0,0,0,0,0,0,0],opacities:[0,0,0,0,0,0,0,0]};if(r.Utils.isString(e.field)){if(!e.stops)return null;if(e.stops.length>8)return null;for(var i=e.stops,s=0;s<8;++s){var a=i[Math.min(s,i.length-1)];t.values[s]=a.value,t.opacities[s]=a.opacity}}else{if(!(e.stops&&e.stops.length>=0))return null;var n=e.stops&&e.stops.length>=0&&e.stops[0].opacity;for(s=0;s<8;s++)t.values[s]=1/0,t.opacities[s]=n}return t}Object.defineProperty(t,"__esModule",{value:!0});var u=r.enums.WGLVVFlag;t.getVisualVariableSizeValueRepresentationRatio=function(e,t){if(!e||!t)return e;switch(t){case"radius":case"distance":return 2*e;case"diameter":case"width":return e;case"area":return Math.sqrt(e)}return e},t.stopToSizeStop=a,t.normalizeSizeStops=n,t.normalizeSizeElement=l,t.getVisualVariablesFields=function(e){var t=e&&e.length>0?{}:null;return t&&e.forEach(function(e){var i=e.type;e.field&&(t[i]=e.field)}),t},t.convertVisualVariables=function(e){var t=e&&e.length>0?{}:null,a=t?{}:null;if(!t)return{vvFields:t,vvRanges:a};for(var p=0,h=e;p<h.length;p++){var c=h[p],d=c.type;if(c.field&&(t[d]=c.field),"size"===d){a.size||(a.size={});var f=c;switch(r.getTypeOfSizeVisualVariable(f)){case u.SIZE_MINMAX_VALUE:a.size.minMaxValue={minDataValue:f.minDataValue,maxDataValue:f.maxDataValue,minSize:l(f.minSize),maxSize:l(f.maxSize)};break;case u.SIZE_SCALE_STOPS:a.size.scaleStops={stops:n(f.stops)};break;case u.SIZE_FIELD_STOPS:for(var y=[],v=[],w=n(f.stops),V=w.length,b=0;b<6;b++){var g=w[Math.min(b,V-1)];y.push(g.value),v.push(i.pt2px(g.size))}a.size.fieldStops={values:y,sizes:v};break;case u.SIZE_UNIT_VALUE:a.size.unitValue={unit:f.valueUnit,valueRepresentation:f.valueRepresentation}}}else if("color"===d){var _=s.convertVisualVariables([c],{modelSize:null,symbolSize:null,unitInMeters:1,transformation:null});for(a.color=_.color,b=0;b<32;b+=4)r.color.premultiplyAlpha(a.color.colors,b,!0)}else if("opacity"===d)a.opacity=o(c);else if("rotation"===d){var T=c;a.rotation={type:T.rotationType}}}return{vvFields:t,vvRanges:a}}}.apply(null,r))||(e.exports=s)},2286:function(e,t,i){var r,s;r=[i.dj.c(e.i),t,i(1),i(0),i(8),i(353),i(2)],void 0===(s=function(e,t,i,r,s,a,n){Object.defineProperty(t,"__esModule",{value:!0});var l=function(e){function t(t){var i=e.call(this)||this;return i.tiles=new Map,i.layer=null,i}return i(t,e),t.prototype.destroy=function(){this.tiles.clear(),this.layer=this.layerView=this.tileInfoView=this.tiles=null},Object.defineProperty(t.prototype,"updating",{get:function(){return this.isUpdating()},enumerable:!0,configurable:!0}),t.prototype.acquireTile=function(e){var t=this,i=this.createTile(e);return i.once("isReady",function(){return t.notifyChange("updating")}),this.tiles.set(e.id,i),i},t.prototype.forEachTile=function(e){this.tiles.forEach(e)},t.prototype.releaseTile=function(e){this.tiles.delete(e.key.id),this.disposeTile(e)},t.prototype.isUpdating=function(){var e=!0;return this.tiles.forEach(function(t){e=e&&t.isReady}),!e},t.prototype.invalidateLabels=function(){},t.prototype.requestUpdate=function(){this.layerView.requestUpdate()},r([n.property()],t.prototype,"layer",void 0),r([n.property()],t.prototype,"layerView",void 0),r([n.property()],t.prototype,"tileInfoView",void 0),r([n.property()],t.prototype,"updating",null),r([n.subclass("esri.views.2d.layers.features.tileRenderers.BaseTileRenderer")],t)}(n.declared(s,a));t.default=l}.apply(null,r))||(e.exports=s)},2660:function(e,t,i){var r,s;r=[i.dj.c(e.i),t,i(1),i(0),i(4),i(8),i(2),i(44),i(2118),i(2324),i(2286),i(2220),i(2661)],void 0===(s=function(e,t,i,r,s,a,n,l,o,u,p,h,c){Object.defineProperty(t,"__esModule",{value:!0});var d=function(e){function t(t){return e.call(this)||this}return i(t,e),t.prototype.install=function(e){var t=new c.WGLFeatureView({tileInfoView:this.tileInfoView,layer:this.layer,layerView:this.layerView});this.featuresView=t,e.addChild(t)},t.prototype.uninstall=function(e){e.removeChild(this.featuresView),this.featuresView.dispose(),this.featuresView=null},t.prototype.updateHighlight=function(){this.featuresView.updateHighlight()},t.prototype.hitTest=function(e,t){return this.featuresView.hitTest(e,t)},t.prototype.supportsRenderer=function(e){return null!=e&&-1!==["simple","class-breaks","unique-value","dot-density","dictionary"].indexOf(e.type)},t.prototype.clear=function(){this.featuresView.disposeWebGLResources()},t.prototype.onConfigUpdate=function(){if("visualVariables"in this.layer.renderer){var e=(u.simplifyVVRenderer(this.layer.renderer).visualVariables||[]).map(function(e){var t=e.clone();return"normalizationField"in e&&(t.normalizationField=null),e.valueExpression&&"$view.scale"!==e.valueExpression&&(t.valueExpression=null,t.field="nop"),t});this.featuresView.visualVariablesInfo=h.convertVisualVariables(e)}},t.prototype.onTileData=function(e){var t=this.tiles.get(e.tileKey);t&&this.featuresView.onTileData(t,e.data)},t.prototype.onTileError=function(e){var t=this.tiles.get(e.tileKey);t&&this.featuresView.onTileError(t)},t.prototype.getMaterialItems=function(e){return this.featuresView.getMaterialItems(e)},t.prototype.invalidateLabels=function(){this.layer.labelingInfo&&this.layer.labelsVisible&&(this.tiles.forEach(function(e){return e.isDirty=!0}),this.layerView.view.labelManager.requestUpdate())},t.prototype.createTile=function(e){var t=l.create();return this.tileInfoView.getTileBounds(t,e),new o.WGLTile(e,t)},t.prototype.disposeTile=function(e){this.featuresView.removeChild(e)},r([n.subclass("esri.views.2d.layers.features.tileRenderers.SymbolTileRenderer")],t)}(n.declared(a,p.default));t.default=d}.apply(null,r))||(e.exports=s)},2661:function(e,t,i){var r,s;r=[i.dj.c(e.i),t,i(4),i(12),i(9),i(11),i(14),i(7),i(7),i(34),i(2118)],void 0===(s=function(e,t,i,r,s,a,n,l,o,u,p){Object.defineProperty(t,"__esModule",{value:!0});var h=p.enums.WGLDrawPhase,c=function(e){function t(t){var i=e.call(this)||this;return i._rendererInfo=new p.WGLRendererInfo,i._pointToCallbacks=new Map,i._displayWidth=0,i._displayHeight=0,i.layer=null,i.tileInfoView=t.tileInfoView,i.layer=t.layer,i._layerView=t.layerView,i.attributeView=new p.AttributeStoreView,i}return r(t,e),t.prototype.dispose=function(){this.removeAllChildren();for(var e=0,t=this.children;e<t.length;e++)t[e].dispose();this.attributeView.destroy()},t.prototype.disposeWebGLResources=function(){for(var e=0,t=this.children;e<t.length;e++)t[e].clear()},t.prototype.displayWidth=function(){return this._displayWidth},Object.defineProperty(t.prototype,"displayHeight",{get:function(){return this._displayHeight},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visualVariablesInfo",{get:function(){return this._visualVariablesInfo},set:function(e){this._visualVariablesInfo=e,this.requestRender()},enumerable:!0,configurable:!0}),t.prototype.hitTest=function(e,t){var i=this,r=[e,t];return l.create(function(e,t){i._pointToCallbacks.set(r,{resolve:e,reject:t}),i.requestRender()},function(){i._pointToCallbacks.has(r)&&i._pointToCallbacks.delete(r)})},t.prototype.whenAttached=function(){var e=this;return this.attached?l.resolve():l.create(function(t){return e.once("attached",function(){return t()})})},t.prototype.getMaterialItems=function(e){var t=this;return this.whenAttached().then(function(){var i=e;if(t.stage&&i&&0!==i.length){for(var r=[],s=t.stage.painter.textureManager,a=0,n=i;a<n.length;a++){var l=n[a];r.push(s.rasterizeItem(l.symbol,l.glyphIds))}return o.all(r).then(function(t){return t.map(function(t,i){return{id:e[i].id,mosaicItem:t}})})}})},t.prototype.onTileData=function(e,t){return a(this,void 0,void 0,function(){var r,a,n,l;return s(this,function(s){switch(s.label){case 0:return r=!(!this.layer.labelingInfo||!this.layer.labelingInfo.length),a=t.addOrUpdate&&p.TileData.decode(t.addOrUpdate),n=i({},t,{addOrUpdate:a}),[4,this._layerView.getLocalIdsToHighlight()];case 1:return l=s.sent(),e.setData(n,r,this.layer.labelsVisible),e.buildHLList(l),this.contains(e)||this.addChild(e),this.requestRender(),this._layerView&&this._layerView.view.labelManager.requestUpdate(),[2]}})})},t.prototype.onTileError=function(e){e.clear(),this.contains(e)||this.addChild(e),this.requestRender()},t.prototype.addChild=function(t){var i=e.prototype.addChild.call(this,t);return this.layer.labelingInfo&&this._layerView&&this._layerView.view.labelManager.addTile(this._layerView,t),this._buildHLList(),i},t.prototype.removeChild=function(t){var i=e.prototype.removeChild.call(this,t);return this.layer.labelingInfo&&this._layerView&&this._layerView.view.labelManager.removeTile(this._layerView,t.key.id),this._buildHLList(),i},t.prototype.renderChildren=function(e){var t=this,r=e.state,s=this.stage.painter,a=this._visualVariablesInfo&&this._visualVariablesInfo.vvRanges;this._updateTilesTransform(r,this.tileInfoView.getClosestInfoForScale(r.scale).level),this._rendererInfo.update(r,this.layer.renderer,a,this._layerView.effects),this.attributeView.update(this.stage.context),this.attributeView.bindTextures(this.stage.context);var l=this.tileInfoView.getClosestInfoForScale(r.scale).level,o=this.tileInfoView.tileInfo.scaleToZoom(r.scale),u=i({},e,{rendererInfo:this._rendererInfo,requiredLevel:l,displayLevel:o,context:this.stage.context,painter:this.stage.painter,attributeView:this.attributeView});this.sortChildren(function(e,t){return e.key.level-t.key.level!=0?e.key.level-t.key.level:e.key.row-t.key.row!=0?e.key.row-t.key.row:e.key.col-t.key.col});var p=u.drawPhase;if(p&(h.LABEL|h.LABEL_ALPHA)){var c=this.layer;if(!(c.labelsVisible&&c.labelingInfo&&c.labelingInfo.length>0))return;this._updateTilesTransform(u.state,u.requiredLevel)}s.draw(u,this.children,p,this._painterOptions),this._layerView.hasHighlight()&&s.highlight(u,this.children),this._pointToCallbacks.forEach(function(e,i){e.resolve(t._hitTest(u,i[0],i[1]))}),this._pointToCallbacks.clear(),this._layerView.effects&&this._layerView.effects.some(function(e){return n.isSome(e)&&!e.done})&&this.requestRender()},t.prototype.updateHighlight=function(){this._buildHLList()},t.prototype._hitTest=function(e,t,i){var r=this.stage,s=r.painter,a=r.context,n=e.requiredLevel,l=[0,0];e.state.toMap(l,[t,i]);var o=e.state.clone(),c=o.viewpoint.clone();return c.targetGeometry=new u(l[0],l[1],e.state.spatialReference),o.viewpoint=c,o.size=[p.Utils.C_HITTEST_SEARCH_SIZE,p.Utils.C_HITTEST_SEARCH_SIZE],this._updateTilesTransform(o,n),s.hitTest({globalOpacity:1,painter:s,context:a,drawPhase:h.HITTEST,pixelRatio:e.pixelRatio,displayLevel:e.displayLevel,rendererInfo:this._rendererInfo,requiredLevel:n,state:o,stationary:e.stationary,attributeView:this.attributeView},this.children)},t.prototype._updateTilesTransform=function(e,t){for(var i=0,r=this.children;i<r.length;i++){var s=r[i],a=this.tileInfoView.tileInfo.lods[s.key.level].resolution,n=a/(e.resolution*e.pixelRatio);s.setTransform(e,n),s.setLabelTransform(e,a)}},t.prototype._buildHLList=function(){return a(this,void 0,void 0,function(){var e,t,i;return s(this,function(r){switch(r.label){case 0:return[4,this._layerView.getLocalIdsToHighlight()];case 1:for(e=r.sent(),t=0,i=this.children;t<i.length;t++)i[t].buildHLList(e);return[2]}})})},t}(p.Container);t.WGLFeatureView=c}.apply(null,r))||(e.exports=s)}}]);