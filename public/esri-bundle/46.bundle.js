(function(){(this||window).webpackJsonp.registerAbsMids({"esri/views/3d/layers/DynamicLayerView3D":2119,"esri/views/3d/layers/MapImageLayerView3D":2150,"esri/views/layers/LayerView":2174,"esri/views/layers/RefreshableLayerView":2175,"esri/views/3d/layers/LayerView3D":2176,"esri/views/3d/layers/support/projectExtentUtils":2186,"esri/renderers/support/clickToleranceUtils":2187,"esri/views/3d/layers/support/overlayImageUtils":2204,"esri/views/support/drapedUtils":2259,"esri/views/layers/MapImageLayerView":2273})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[46,34],{2119:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1),r(0),r(4),r(9),r(11),r(47),r(13),r(7),r(29),r(2),r(21),r(30),r(44),r(2176),r(2204),r(2186),r(95),r(106),r(235),r(184),r(165),r(2175)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u,p,d,c,h,y,f,m,g,v,w,x,b,_,R){var O=l.getLogger("esri.views.3d.layers.DynamicLayerView3D"),M=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.supportsDraping=!0,t.hasDraped=!0,t.fullExtentInLocalViewSpatialReference=null,t.overlayUpdating=!1,t.maximumDataResolution=null,t._images=[],t._extents=[],t.updateWhenStationary=!0,t}return r(t,e),Object.defineProperty(t.prototype,"drawingOrder",{get:function(){return this._get("drawingOrder")},set:function(e){if(e!==this._get("drawingOrder")){this._set("drawingOrder",e);var t=new Set;this._images.forEach(function(r){r&&r.material&&(r.material.renderPriority=e,t.add(r.material.id))}),t.size>0&&(this.view._stage.renderView.getDrapedRenderer().updateRenderOrder(t),this.emit("draped-data-change"))}},enumerable:!0,configurable:!0}),t.prototype.initialize=function(){var e=this;this.drawingOrder=this.view.getDrawingOrder(this.layer.uid),this.addResolvingPromise(g.toViewIfLocal(this).then(function(t){return e._set("fullExtentInLocalViewSpatialReference",t)})),this.handles.add(this.watch("suspended",function(){return e._suspendedChangeHandler()})),this.handles.add(this.view.resourceController.scheduler.registerIdleStateCallbacks(function(){e._isScaleRangeActive()&&e.notifyChange("suspended")},function(){})),this._isScaleRangeLayer()&&this.handles.add([this.layer.watch("minScale",function(){return e.notifyChange("suspended")}),this.layer.watch("maxScale",function(){return e.notifyChange("suspended")})]),this.handles.add(this.watch("fullOpacity",this._opacityChangeHandler.bind(this)))},t.prototype.destroy=function(){this.clear()},t.prototype.setDrapingExtent=function(e,t,r,i,n,a){var o=this._extentAndSizeAtResolution(t,r,i),s=o.size,l=o.extent;if(a*=this.view.pixelRatio,"imageMaxWidth"in this.layer||"imageMaxHeight"in this.layer){var u=this.layer.imageMaxWidth,p=this.layer.imageMaxHeight;if(s.width>u){var d=u/s.width;s.height=Math.floor(s.height*d),s.width=u,a*=d}if(s.height>p){d=p/s.height;s.width=Math.floor(s.width*d),s.height=p,a*=d}}var c=this._extents[e];c&&y.equals(c.extent,l)&&!this._imageSizeDiffers(l,r,c.imageSize,s)||(this._extents[e]={extent:y.create(l),spatialReference:r,imageSize:s,renderLocalOrigin:n,pixelRatio:a},this.suspended||this._fetch(e))},t.prototype.getGraphicFromGraphicUid=function(e){return null},t.prototype.clear=function(){for(var e=0;e<this._images.length;e++)this._clearImage(e)},t.prototype.doRefresh=function(e){return o(this,void 0,void 0,function(){var t,r;return a(this,function(i){switch(i.label){case 0:if(this.suspended)return[2];for(t=[],r=0;r<this._extents.length;r++)this._extents[r]&&t.push(this._fetch(r,e));return[4,u.eachAlways(t)];case 1:return i.sent(),[2]}})})},t.prototype.canResume=function(){if(!this.inherited(arguments))return!1;if(this._isScaleRangeLayer()){var e=this.layer,t=e.minScale,r=e.maxScale;if(t>0||r>0){var i=this.view.scale;if(i<r||t>0&&i>t)return!1}}return!0},t.prototype.isUpdating=function(){if(this.overlayUpdating)return!0;for(var e=0,t=this._images;e<t.length;e++)if(t[e].loadingPromise)return!0;return!1},t.prototype.processResult=function(e,t){(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement)&&(e.image=t)},t.prototype.findExtentInfoAt=function(e){for(var t=0,r=this._extents;t<r.length;t++){var i=r[t],n=i.extent;if(new h(n[0],n[1],n[2],n[3],i.spatialReference).contains(e))return i}return null},t.prototype.getFetchOptions=function(){},t.prototype.redraw=function(e){for(var t=!1,r=0;r<this._images.length;r++){var i=this._images[r];i&&e(i)&&(t=!0,this._createStageObjects(r,i.image))}t&&this.emit("draped-data-change")},t.prototype._imageSizeDiffers=function(e,t,r,i){if(!this.maximumDataResolution)return!0;if(v.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS)return!0;var n=y.width(e)/this.maximumDataResolution.x,a=y.height(e)/this.maximumDataResolution.y,o=n/r.width,s=a/r.height,l=n/i.width,u=a/i.height,p=Math.abs(o-l),d=Math.abs(s-u);return p>1.5||d>1.5},t.prototype._fetch=function(e,t){return o(this,void 0,void 0,function(){var r,i,o,l,p,d,c,f=this;return a(this,function(a){switch(a.label){case 0:return this.suspended?[2]:(r=this._extents[e],i=r.extent,o=new h(i[0],i[1],i[2],i[3],r.spatialReference),this._images[e]||(this._images[e]={texture:null,material:null,rendergeometry:null,loadingPromise:null,loadingAbortController:null,image:null,pixelData:null,renderExtent:y.create(i)}),(l=this._images[e]).loadingAbortController&&(l.loadingAbortController.abort(),l.loadingAbortController=null),0===o.width||0===o.height?(this._clearImage(e),[2]):(p=u.createAbortController(),l.loadingAbortController=p,u.onAbort(t,function(){return p.abort()}),d=s.safeCast(this._waitFetchReady(p.signal)).then(function(){var e=n({requestAsImageElement:!0,pixelRatio:r.pixelRatio},f.getFetchOptions(),{signal:p.signal});return f.layer.fetchImage(o,r.imageSize.width,r.imageSize.height,e)}),l.loadingPromise=d,u.always(d,function(){l.loadingPromise=null,l.loadingAbortController=null}),c=d.then(function(t){y.set(l.renderExtent,i),f.processResult(l,t),f._createStageObjects(e,l.image),0===e&&f._images[1]&&f._images[1].rendergeometry&&f._createStageObjects(1,null),f.notifyChange("updating"),f.emit("draped-data-change")}).catch(function(e){throw e&&!u.isAbortError(e)&&O.error(e),f.notifyChange("updating"),e}),this.notifyChange("updating"),[4,c]));case 1:return a.sent(),[2]}})})},t.prototype._clearImage=function(e){var t=this._images[e],r=this.view._stage;t&&(t.rendergeometry&&(r.renderView.getDrapedRenderer().removeRenderGeometries([t.rendergeometry]),t.rendergeometry=null),t.texture&&(r.remove(w.ModelContentType.TEXTURE,t.texture.id),t.texture=null),t.material&&(r.remove(w.ModelContentType.MATERIAL,t.material.id),t.material=null),t.loadingAbortController&&(t.loadingAbortController.abort(),t.loadingAbortController=null),t.loadingPromise=null,t.image=null,t.pixelData=null)},t.prototype._createStageObjects=function(e,t){var r=this.view._stage,i=this._images[e];i.texture&&(r.remove(w.ModelContentType.TEXTURE,i.texture.id),i.texture=null),t?(i.texture=new b(t,"dynamicLayer",{width:t.width,height:t.height,wrap:{s:33071,t:33071}}),r.add(w.ModelContentType.TEXTURE,i.texture)):i.material&&(r.remove(w.ModelContentType.MATERIAL,i.material.id),i.material=null),!i.material&&i.texture?(i.material=new _({ambient:[1,1,1],diffuse:[0,0,0],transparent:!0,opacity:this.fullOpacity,textureId:i.texture.id,receiveSSAO:!1},"dynamicLayer"),i.material.renderPriority=this.drawingOrder,r.add(w.ModelContentType.MATERIAL,i.material)):i.material&&t&&i.material.setParameterValues({textureId:i.texture.id});var n=r.renderView.getDrapedRenderer();if(i.material){var a=void 0,o=this._extents[e].renderLocalOrigin;if(0===e)a=m.createGeometryForExtent(i.renderExtent,-1);else{if(1!==e)return void console.error("DynamicLayerView3D._createStageObjects: Invalid extent idx");var s=this._images[0].renderExtent;if(!s)return;a=m.createOuterImageGeometry(s,i.renderExtent,-1)}var l=new x(a);l.material=i.material,l.origin=o,l.transformation=c.mat4f64.create(),l.name="dynamicLayer",l.uniqueName="dynamicLayer#"+a.id,n.addRenderGeometries([l]),i.rendergeometry&&n.removeRenderGeometries([i.rendergeometry]),i.rendergeometry=l}else i.rendergeometry&&(n.removeRenderGeometries([i.rendergeometry]),i.rendergeometry=null)},t.prototype._isScaleRangeLayer=function(){return"minScale"in this.layer&&"maxScale"in this.layer},t.prototype._isScaleRangeActive=function(){return!!this._isScaleRangeLayer()&&(this.layer.minScale>0||this.layer.maxScale>0)},t.prototype._extentAndSizeAtResolution=function(e,t,r){var i=y.width(e)/y.height(e),n={width:r,height:r};i>1.0001?n.height=r/i:i<.9999&&(n.width=r*i);var a=this._clippedExtent(e,t,S);return n.width=Math.round(n.width/(y.width(e)/y.width(a))),n.height=Math.round(n.height/(y.height(e)/y.height(a))),{size:n,extent:a}},t.prototype._clippedExtent=function(e,t,r){if("local"!==this.view.viewingMode)return y.set(r,e);var i=this.view.basemapTerrain,n=i.extent;return i.ready&&n?y.intersection(e,n,r):y.set(r,e)},t.prototype._opacityChangeHandler=function(e){for(var t=0,r=this._images;t<r.length;t++){var i=r[t];i&&i.material&&i.material.setParameterValues({opacity:e})}this.emit("draped-data-change")},t.prototype._suspendedChangeHandler=function(){this.suspended?(this.clear(),this.emit("draped-data-change")):this.refresh()},t.prototype._waitFetchReady=function(e){return o(this,void 0,void 0,function(){return a(this,function(t){switch(t.label){case 0:return this.updateWhenStationary?[4,p.whenOnce(this.view,"stationary",e)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},i([d.property()],t.prototype,"layer",void 0),i([d.property({dependsOn:["view.scale","layer.minScale","layer.maxScale"]})],t.prototype,"suspended",void 0),i([d.property({type:Boolean})],t.prototype,"supportsDraping",void 0),i([d.property({type:Boolean})],t.prototype,"hasDraped",void 0),i([d.property({value:0,type:Number})],t.prototype,"drawingOrder",null),i([d.property({readOnly:!0})],t.prototype,"fullExtentInLocalViewSpatialReference",void 0),i([d.property()],t.prototype,"overlayUpdating",void 0),i([d.property({dependsOn:["overlayUpdating"]})],t.prototype,"updating",void 0),i([d.subclass("esri.views.3d.layers.DynamicLayerView3D")],t)}(d.declared(f,R)),S=y.create();return M}.apply(null,i))||(e.exports=n)},2150:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1),r(0),r(2),r(833),r(2119),r(2273),r(2259)],void 0===(n=function(e,t,r,i,n,a,o,s,l){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._exportImageParameters=null,t.updateWhenStationary=!0,t}return r(t,e),t.prototype.initialize=function(){var e=this;this._exportImageParameters=new a.ExportImageParameters({view:this.view,layer:this.layer}),this.handles.add(this._exportImageParameters.watch("version",function(t){e.refreshDebounced()}))},t.prototype.destroy=function(){this._exportImageParameters&&(this._exportImageParameters.layer=null,this._exportImageParameters.destroy(),this._exportImageParameters=null)},t.prototype.createFetchPopupFeaturesQueryGeometry=function(e,t){return l.createQueryGeometry(e,t,this.view)},t.prototype.getFetchOptions=function(){return{timeExtent:this._exportImageParameters.timeExtent,timestamp:this.refreshTimestamp}},i([n.subclass("esri.views.3d.layers.MapImageLayerView3D")],t)}(n.declared(o,s))}.apply(null,i))||(e.exports=n)},2174:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1),r(0),r(50),r(353),r(284),r(13),r(283),r(7),r(2)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u,p){return function(e){function t(t){var r=e.call(this)||this;return r.layer=null,r.parent=null,r.view=null,r}return r(t,e),t.prototype.initialize=function(){var e=this;this.addResolvingPromise(this.layer),this.when().catch(function(t){if("layerview:create-error"!==t.name){var r=e.layer&&e.layer.id||"no id",i=e.layer&&e.layer.title||"no title";return s.getLogger(e.declaredClass).error("#resolve()","Failed to resolve layer view (layer title: '"+i+"', id: '"+r+"')",t),u.reject(t)}})},t.prototype.destroy=function(){this.layer=this.view=this.parent=null},Object.defineProperty(t.prototype,"suspended",{get:function(){return!this.canResume()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!this.suspended&&this.isUpdating()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visible",{get:function(){return!0===this.get("layer.visible")},set:function(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fullOpacity",{get:function(){var e=function(e){return null==e?1:e};return e(this.get("layer.opacity"))*e(this.get("parent.fullOpacity"))},enumerable:!0,configurable:!0}),t.prototype.canResume=function(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1},t.prototype.isUpdating=function(){return!1},i([p.property()],t.prototype,"layer",void 0),i([p.property()],t.prototype,"parent",void 0),i([p.property({readOnly:!0,dependsOn:["view","visible","layer.loaded","parent.suspended"]})],t.prototype,"suspended",null),i([p.property({type:Boolean,dependsOn:["suspended"],readOnly:!0})],t.prototype,"updating",null),i([p.property()],t.prototype,"view",void 0),i([p.property({dependsOn:["layer.visible"]})],t.prototype,"visible",null),i([p.property({dependsOn:["layer.opacity","parent.fullOpacity"]})],t.prototype,"fullOpacity",null),i([p.subclass("esri.views.layers.LayerView")],t)}(p.declared(a,n,o.Identifiable,l))}.apply(null,i))||(e.exports=n)},2175:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1),r(0),r(9),r(11),r(8),r(7),r(2)],void 0===(n=function(e,t,r,i,n,a,o,s,l){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.refreshTimestamp=null,t.refreshDebounced=s.debounce(function(e,r){return a(t,void 0,void 0,function(){var t;return n(this,function(i){switch(i.label){case 0:return"number"==typeof e?t=e:(t=Date.now(),r=e),this._set("refreshTimestamp",t),this.doRefresh?[4,this.doRefresh(r)]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}})})},2e3),t}return r(t,e),t.prototype.refresh=function(e){void 0===e&&(e=Date.now()),this._set("refreshTimestamp",e),this.doRefresh&&this.doRefresh()},i([l.property()],t.prototype,"layer",void 0),i([l.aliasOf("layer.refreshInterval")],t.prototype,"refreshInterval",void 0),i([l.property({readOnly:!0})],t.prototype,"refreshTimestamp",void 0),i([l.subclass("esri.layers.mixins.RefreshableLayerView")],t)}(l.declared(o))}.apply(null,i))||(e.exports=n)},2176:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1),r(0),r(7),r(29),r(2),r(473),r(2174)],void 0===(n=function(e,t,r,i,n,a,o,s,l){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.slicePlaneEnabled=!1,t.supportsHeightUnitConversion=!1,t}return r(t,e),t.prototype.postscript=function(e){this.inherited(arguments),s.mayHaveHeightModelInfo(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())},t.prototype._validateHeightModelInfo=function(){var e=this;return n.create(function(t,r){a.whenFalseOnce(e.view.defaultsFromMap,"isHeightModelInfoSearching",function(){var i=s.rejectLayerError(e.layer,e.view.heightModelInfo,e.supportsHeightUnitConversion);i?r(i):t()})})},i([o.property()],t.prototype,"view",void 0),i([o.property()],t.prototype,"slicePlaneEnabled",void 0),i([o.subclass("esri.views.3d.layers.LayerView3D")],t)}(o.declared(l))}.apply(null,i))||(e.exports=n)},2186:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(47),r(7),r(57),r(357)],void 0===(n=function(e,t,r,i,n,a){Object.defineProperty(t,"__esModule",{value:!0}),t.toViewIfLocal=function(e){var t=e.view.spatialReference,o=e.layer.fullExtent,s=o&&o.spatialReference;return s?s.equals(t)?i.resolve(o.clone()):n.canProject(s,t)?i.resolve(n.project(o,t)):e.view.state.isLocal?r.safeCast(a.projectGeometry(o,t,e.layer.portalItem).then(function(t){if(!e.destroyed&&t)return t}).catch(function(){return null})):i.resolve(null):i.resolve(null)}}.apply(null,i))||(e.exports=n)},2187:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){function r(e,t){return t&&t.xoffset?Math.max(e,Math.abs(t.xoffset)):t&&t.yoffset?Math.max(e,Math.abs(t.yoffset)):e}function i(e,t){return"number"==typeof e?e:e&&e.stops&&e.stops.length?function(e){for(var t=0,r=0,i=0;i<e.length;i++){var n=e[i].size;"number"==typeof n&&(t+=n,r++)}return t/r}(e.stops):t}function n(e,t){if(!t)return e;for(var r=t.filter(function(e){return"size"===e.type}).map(function(t){var r=t.maxSize,n=t.minSize;return(i(r,e)+i(n,e))/2}),n=0,a=r.length,o=0;o<a;o++)n+=r[o];var s=Math.floor(n/a);return Math.max(s,e)}Object.defineProperty(t,"__esModule",{value:!0}),t.calculateTolerance=function(e){if(!e)return 6;var t="visualVariables"in e?n(6,e.visualVariables):6;if("simple"===e.type)return r(t,e.symbol);if("unique-value"===e.type){var i=t;return e.uniqueValueInfos.forEach(function(e){i=r(i,e.symbol)}),i}if("class-breaks"===e.type){var a=t;return e.classBreakInfos.forEach(function(e){a=r(a,e.symbol)}),a}return e.type,t}}.apply(null,i))||(e.exports=n)},2204:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(44),r(109),r(167),r(22)],void 0===(n=function(e,t,r,i,n,a){function o(e,t){var r=[[e[0],e[1],t],[e[2],e[1],t],[e[2],e[3],t],[e[0],e[3],t]];return n.createSquareGeometry(r)}Object.defineProperty(t,"__esModule",{value:!0});var s=new Float32Array([0,0,1]);t.createGeometryForExtent=o,t.createOuterImageGeometry=function(e,t,n){if(!r.intersects(e,t))return o(t,n);for(var l=[e[1]-t[1],Math.min(e[3],t[3])-Math.max(e[1],t[1]),t[3]-e[3],123456],u=[e[0]-t[0],Math.min(e[2],t[2])-Math.max(e[0],t[0]),t[2]-e[2],123456],p=t[2]-t[0],d=t[3]-t[1],c=u[0]>0&&u[2]>0?3:2,h=l[0]>0&&l[2]>0?3:2,y=(h+1)*(c+1),f=new Float32Array(3*y),m=new Float32Array(2*y),g=new Uint32Array(6*(h*c-1)),v=0,w=0,x=0,b=0,_=0,R=0;R<4;R++){var O=l[R];if(!(O<=0)){for(var M=0,S=0;S<4;S++){var I=u[S];I<=0||(f[w++]=t[0]+M,f[w++]=t[1]+v,f[w++]=n,m[x++]=M/p,m[x++]=v/d,S<3&&R<3&&(1!==S||1!==R)&&(g[_++]=b,g[_++]=b+1,g[_++]=b+c+1,g[_++]=b+1,g[_++]=b+c+2,g[_++]=b+c+1),b++,M+=I)}v+=O}}var E={};E[a.VertexAttrConstants.POSITION]={size:3,data:f},E[a.VertexAttrConstants.NORMAL]={size:3,data:s},E[a.VertexAttrConstants.UV0]={size:2,data:m};for(var A={},L=new Uint32Array(g.length),P=0;P<L.length;P++)L[P]=0;return A[a.VertexAttrConstants.POSITION]=g,A[a.VertexAttrConstants.NORMAL]=L,A[a.VertexAttrConstants.UV0]=g,new i(E,A)}}.apply(null,i))||(e.exports=n)},2259:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(35),r(14),r(59),r(2187)],void 0===(n=function(e,t,r,i,n,a){function o(e,t,i,a){var o;if(void 0===a&&(a=new r.Extent),"2d"===i.type)o=t*i.resolution;else if("3d"===i.type){var s=i.basemapTerrain,l=s.overlayManager,u=l?l.overlayPixelSizeInMapUnits(e):1;o=s&&!s.spatialReference.equals(i.spatialReference)?n.getMetersPerUnitForSR(s.spatialReference)/n.getMetersPerUnitForSR(i.spatialReference):t*u}var p=e.x-o,d=e.y-o,c=e.x+o,h=e.y+o,y=i.spatialReference;return a.xmin=Math.min(p,c),a.ymin=Math.min(d,h),a.xmax=Math.max(p,c),a.ymax=Math.max(d,h),a.spatialReference=y,a}Object.defineProperty(t,"__esModule",{value:!0}),t.createQueryGeometry=o,t.intersectsDrapedGeometry=function(e,t,r){var n=r.toMap(e);return i.isNone(n)?null:o(n,a.calculateTolerance(),r,s).intersects(t)?n:null};var s=new r.Extent}.apply(null,i))||(e.exports=n)},2273:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1),r(0),r(9),r(11),r(15),r(7),r(2),r(2187),r(2175),r(116)],void 0===(n=function(e,t,r,i,n,a,o,s,l,u,p){return function(e){function t(t){return e.call(this,t)||this}return r(t,e),t.prototype.fetchPopupFeatures=function(e){return a(this,void 0,void 0,function(){var t,r,i,l,p,d=this;return n(this,function(c){switch(c.label){case 0:return t=this.layer,e?(r=this.get("view.scale"),i=[],l=function(e){var t=0===e.minScale||r<=e.minScale,n=0===e.maxScale||r>=e.maxScale;e.visible&&t&&n&&(e.sublayers?e.sublayers.forEach(l):e.popupTemplate&&e.popupEnabled&&i.push(e))},t.sublayers.forEach(l),p=i.map(function(t){return a(d,void 0,void 0,function(){var r,i,a;return n(this,function(n){switch(n.label){case 0:return[4,t.popupTemplate.getRequiredFields()];case 1:return r=n.sent(),i=t.createQuery(),a=u.calculateTolerance(t.renderer),i.geometry=this.createFetchPopupFeaturesQueryGeometry(e,a),i.outFields=r,[4,t.queryFeatures(i)];case 2:return[2,n.sent().features]}})})}),[4,s.eachAlways(p)]):[2,s.reject(new o("mapimagelayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:t}))];case 1:return[2,c.sent().reduce(function(e,t){return e.concat(t.value)},[]).filter(function(e){return null!=e})]}})})},i([l.property()],t.prototype,"layer",void 0),i([l.subclass("esri.views.layers.MapImageLayerView")],t)}(l.declared(p))}.apply(null,i))||(e.exports=n)}}]);