(function(){(this||window).webpackJsonp.registerAbsMids({"esri/views/layers/LayerView":2174,"esri/views/2d/engine/vectorTiles/renderers/rendererUtils":2206,"esri/views/2d/engine/vectorTiles/MemoryBuffer":2225,"esri/views/2d/engine/vectorTiles/TileHandler":2334,"esri/views/2d/engine/vectorTiles/RectangleBinPack":2335,"esri/views/2d/engine/vectorTiles/VectorTileDisplayObject":2336,"esri/views/2d/engine/vectorTiles/renderers/Renderer":2337,"esri/views/2d/engine/vectorTiles/GlyphMosaic":2529,"esri/views/2d/engine/vectorTiles/GlyphSource":2530,"esri/views/2d/engine/vectorTiles/SpriteMosaic":2531,"esri/views/2d/engine/vectorTiles/renderers/BackgroundRenderer":2533,"esri/views/2d/engine/vectorTiles/renderers/CircleRenderer":2534,"esri/views/2d/engine/vectorTiles/renderers/FadeRecorder":2535,"esri/views/2d/engine/vectorTiles/renderers/FillRenderer":2536,"esri/views/2d/engine/vectorTiles/renderers/LineRenderer":2537,"esri/views/2d/engine/vectorTiles/renderers/SymbolRenderer":2538,"esri/views/2d/engine/vectorTiles/renderers/IconRenderer":2539,"esri/views/2d/engine/vectorTiles/renderers/SDFRenderer":2540,"esri/views/2d/engine/vectorTiles/renderers/TileInfoRenderer":2541,"esri/views/2d/engine/vectorTiles/renderers/shaders/ProgramCache":2542,"esri/views/2d/engine/vectorTiles/renderers/shaders/Programs":2543,"esri/views/2d/engine/vectorTiles/renderers/shaders/sources/resolver":2544,"esri/views/2d/engine/vectorTiles/renderers/shaders/sources/shaderRepository":2545})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{2174:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(1),r(0),r(50),r(353),r(284),r(13),r(283),r(7),r(2)],void 0===(n=function(e,t,r,i,n,o,a,s,l,u,f){return function(e){function t(t){var r=e.call(this)||this;return r.layer=null,r.parent=null,r.view=null,r}return r(t,e),t.prototype.initialize=function(){var e=this;this.addResolvingPromise(this.layer),this.when().catch(function(t){if("layerview:create-error"!==t.name){var r=e.layer&&e.layer.id||"no id",i=e.layer&&e.layer.title||"no title";return s.getLogger(e.declaredClass).error("#resolve()","Failed to resolve layer view (layer title: '"+i+"', id: '"+r+"')",t),u.reject(t)}})},t.prototype.destroy=function(){this.layer=this.view=this.parent=null},Object.defineProperty(t.prototype,"suspended",{get:function(){return!this.canResume()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!this.suspended&&this.isUpdating()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visible",{get:function(){return!0===this.get("layer.visible")},set:function(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fullOpacity",{get:function(){var e=function(e){return null==e?1:e};return e(this.get("layer.opacity"))*e(this.get("parent.fullOpacity"))},enumerable:!0,configurable:!0}),t.prototype.canResume=function(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1},t.prototype.isUpdating=function(){return!1},i([f.property()],t.prototype,"layer",void 0),i([f.property()],t.prototype,"parent",void 0),i([f.property({readOnly:!0,dependsOn:["view","visible","layer.loaded","parent.suspended"]})],t.prototype,"suspended",null),i([f.property({type:Boolean,dependsOn:["suspended"],readOnly:!0})],t.prototype,"updating",null),i([f.property()],t.prototype,"view",void 0),i([f.property({dependsOn:["layer.visible"]})],t.prototype,"visible",null),i([f.property({dependsOn:["layer.opacity","parent.fullOpacity"]})],t.prototype,"fullOpacity",null),i([f.subclass("esri.views.layers.LayerView")],t)}(f.declared(o,n,a.Identifiable,l))}.apply(null,i))||(e.exports=n)},2206:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=new Uint32Array(1),i=new Uint8Array(r.buffer);t.int32To4Bytes=function(e){return r[0]=0|e,[i[0],i[1],i[2],i[3]]}}.apply(null,i))||(e.exports=n)},2225:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){return function(){function e(e){this._array=[],e<=0&&console.error("strideInBytes must be positive!"),this._stride=e}return Object.defineProperty(e.prototype,"array",{get:function(){return this._array},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"index",{get:function(){return 4*this._array.length/this._stride},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"itemSize",{get:function(){return this._stride},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sizeInBytes",{get:function(){return 4*this._array.length},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this.array.length=0},e.prototype.toBuffer=function(){return new Uint32Array(this._array).buffer},e.i1616to32=function(e,t){return 65535&e|t<<16},e.i8888to32=function(e,t,r,i){return 255&e|(255&t)<<8|(255&r)<<16|i<<24},e.i8816to32=function(e,t,r){return 255&e|(255&t)<<8|r<<16},e}()}.apply(null,i))||(e.exports=n)},2334:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(4),r(9),r(11),r(23),r(47),r(26),r(540),r(7),r(7),r(182),r(164),r(807),r(2529),r(2530),r(2531),r(846),r(2336),r(202),r.dj.m(e),r(147)],void 0===(n=function(e,t,i,n,o,a,s,l,u,f,c,d,h,_,p,m,v,g,y,x,b){var D=new u(10),w=new Map;return function(){function t(e,t,r,i){this.devicePixelRatio=t,this.allowUpdates=r,this._spriteMosaic=null,this._glyphMosaic=null,this._connection=null,this._updateToAbortController=new Map,this._ongoingTileRequests=new Map,this._ongoingRequestToController=new Map,this._vectorTileLayer=e,this._container=i}return t.prototype.destroy=function(){this._updateToAbortController&&this._updateToAbortController.forEach(function(e){return e.abort()}),this._ongoingTileRequests&&this.abortAll(),this._connection&&(this._connection.close(),this._connection=null),this._vectorTileLayer=null,this._spriteMosaic&&(this._spriteMosaic.dispose(),this._spriteMosaic=null),this._glyphMosaic&&(this._glyphMosaic.dispose(),this._glyphMosaic=null)},Object.defineProperty(t.prototype,"spriteMosaic",{get:function(){var e=this;return this._spriteSourcePromise.then(function(){return e._spriteMosaic})},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"glyphMosaic",{get:function(){return this._glyphMosaic},enumerable:!0,configurable:!0}),t.prototype.start=function(t){return o(this,void 0,void 0,function(){var r,o,a,u,c,_=this;return n(this,function(n){for(a in r=this._vectorTileLayer.sourceNameToSource,o=[],r)o.push(this._fetchTileMap(r[a],t));return this._spriteSourcePromise=this._vectorTileLayer.loadSpriteSource(this.devicePixelRatio,t),this._spriteSourcePromise.then(function(e){_._spriteMosaic=new v(1024,1024,250),_._spriteMosaic.setSpriteSource(e),l("stable-symbol-rendering")&&_._spriteMosaic.preloadSpriteItems()}),u=this._vectorTileLayer.styleRepository,c=new m(u.glyphs),this._glyphMosaic=new p(1024,1024,c),this._broadcastPromise=s.safeCast(h.open(d.getAbsMid("./WorkerTileHandler",e,b),{client:this,signal:t&&t.signal})).then(function(e){return _._connection=e,f.all(_._connection.broadcast("setLayers",u.styleJSON,i({},t)))}),[2,f.all(o)]})})},t.prototype.updateStyle=function(){return o(this,void 0,void 0,function(){var e,t=this;return n(this,function(r){switch(r.label){case 0:return[4,this._broadcastPromise];case 1:return r.sent(),this._updateToAbortController.forEach(function(e){return e.abort()}),this._updateToAbortController.clear(),e=this._vectorTileLayer.styleRepository,this._broadcastPromise=f.create(function(r,i){f.all(t._connection.broadcast("updateStyle",e.styleJSON)).then(r,i)}),[2,this._broadcastPromise]}})})},t.prototype.updateTile=function(e,t){return o(this,void 0,void 0,function(){var r,i,o,a,s=this;return n(this,function(n){switch(n.label){case 0:return this.allowUpdates?[4,this._broadcastPromise]:[2,null];case 1:return n.sent(),r=Math.round(_.degToByte(t.state.rotation)),e.rotation===r?[2,null]:(o=e.key,this._updateToAbortController.has(o.id)&&((i=this._updateToAbortController.get(o.id)).abort(),this._updateToAbortController.delete(o.id)),i=f.createAbortController(),e.rotation=r,a=e.client.invoke("updateSymbols",{key:e.id,rotation:r},{signal:i.signal}).then(function(t){return s._updateToAbortController.delete(o.id),e.updateSymbolData(t),t}).catch(function(e){f.isAbortError(e)||s._updateToAbortController.delete(o.id)}),this._updateToAbortController.set(e.id,i),[2,a])}})})},t.prototype.updateTileData=function(e){for(var t,r=e.tileId,i=this._container.children,n=0;n<i.length;n++)if((t=i[n]).id===r){t.updateTileData(e.tileData);break}},t.prototype.getVectorTile=function(e,t,r,i){return void 0===i&&(i=0),o(this,void 0,void 0,function(){var o,a,s;return n(this,function(n){switch(n.label){case 0:return o=new x(e,t,r,0),a=new y(o,this._vectorTileLayer.tileInfo,this._vectorTileLayer.styleRepository,0),[4,this._getVectorTileData(o,i,null)];case 1:return(s=n.sent())?a.setData(s.tileData,s.client):a.setData(null,null),[2,a]}})})},t.prototype.getVectorTile3D=function(e,t,i,a){return void 0===a&&(a=0),o(this,void 0,void 0,function(){var o,s,l,u;return n(this,function(n){switch(n.label){case 0:return[4,new Promise(function(e,t){Promise.resolve().then(function(){var t=[r(382)];e.apply(null,t)}.bind(this)).catch(t.bind(this))})];case 1:return o=n.sent(),s=new x(e,t,i,0),l=new o(s,this._vectorTileLayer.tileInfo,this._vectorTileLayer.styleRepository,0),[4,this._getVectorTileData(s,a,null)];case 2:return(u=n.sent())?l.setData(u.tileData,u.client):l.setData(null,null),[2,l]}})})},t.prototype.fetchTileData=function(e,t){return o(this,void 0,void 0,function(){var r,i,o,a;return n(this,function(n){switch(n.label){case 0:return[4,this._getRefKeys(e,t)];case 1:for(a in r=n.sent(),i=this._vectorTileLayer.sourceNameToSource,o=[],i)o.push(a);return[2,this._getSourcesData(e,o,r,t)]}})})},t.prototype.parseTileData=function(e,t,r){return o(this,void 0,void 0,function(){var o,a,s,u,f,c,d,h;return n(this,function(n){switch(n.label){case 0:return(o=e&&e.data)?(a=o.sourceName2DataAndRefKey,s=o.transferList,0===Object.keys(a).length?[2,{tileData:null,client:null}]:[4,this._broadcastPromise]):[2,{tileData:null,client:null}];case 1:return n.sent(),u=Math.round(_.degToByte(t)),[4,(f=this._connection.getAvailableClient()).invoke("createTileAndParse",{key:e.key.id,rotation:u,cacheTile:this.allowUpdates,sourceName2DataAndRefKey:a},i({},r,{transferList:s}))];case 2:if(c=n.sent(),l("esri-vector-tiles-debug")){for(h in d={},a)d[h]=a[h].refKey;return[2,{tileData:c,client:f,refKeys:d}]}return[2,{tileData:c,client:f}]}})})},Object.defineProperty(t.prototype,"updating",{get:function(){return this._ongoingTileRequests.size>0},enumerable:!0,configurable:!0}),t.prototype.abortAll=function(){this._ongoingRequestToController.forEach(function(e){return e.abort()}),this._ongoingRequestToController.clear(),this._ongoingTileRequests.clear()},t.prototype.getSprites=function(e){var t=this;return this._spriteSourcePromise.then(function(){return t._spriteMosaic.getSpriteItems(e)})},t.prototype.getGlyphs=function(e){return this._glyphMosaic.getGlyphItems(e.tileID,e.font,e.codePoints)},t.prototype.getStyleRepository=function(){return this._vectorTileLayer.styleRepository},t.prototype._getTilePayload=function(e,t,r,s){return o(this,void 0,void 0,function(){var e,o,l,u;return n(this,function(n){switch(n.label){case 0:return e=x.pool.acquire(t.id),o=this._vectorTileLayer.sourceNameToSource,l=o[r],u=l.getSourceTileUrl(e.level,e.row,e.col),x.pool.release(e),[4,a(u,i({responseType:"array-buffer"},s))];case 1:return[2,{protobuff:n.sent().data,sourceName:r}]}})})},t.prototype._fetchTileMap=function(e,t){if(e.capabilities.operations.supportsTileMap&&e.tileIndex)return f.resolve();if(!e.tileMapURL)return f.resolve();var r=D.get(e.tileMapURL);if(r)return e.tileIndex=r,f.resolve();if(w.has(e.tileMapURL))return w.get(e.tileMapURL).then(function(t){e.tileIndex=new g(t.data)});var i=a(e.tileMapURL,t);return i.then(function(t){e.tileIndex=new g(t.data),w.delete(e.tileMapURL),D.put(e.tileMapURL,e.tileIndex)}),w.set(e.tileMapURL,i),i},t.prototype._getRefKeys=function(e,t){return o(this,void 0,void 0,function(){var r,i,o,a,s;return n(this,function(n){for(o in r=this._vectorTileLayer.sourceNameToSource,i=[],r)a=r[o],s=a.getRefKey(e,t),i.push(s);return[2,f.eachAlways(i)]})})},t.prototype._getSourcesData=function(e,t,r,i){return o(this,void 0,void 0,function(){var o,a,s,l,u,c,d;return n(this,function(n){switch(n.label){case 0:for(o=[],c=0;c<r.length;c++)null==r[c].value||null==t[c]?o.push(null):(a=this._getTilePayload(e,r[c].value,t[c],i),o.push(a));return[4,f.eachAlways(o)];case 1:for(s=n.sent(),l={},u=[],c=0;c<s.length;c++)s[c].value&&s[c].value&&s[c].value.protobuff&&s[c].value.protobuff.byteLength>0&&(d=r[c].value.id,l[s[c].value.sourceName]={refKey:d,protobuff:s[c].value.protobuff},u.push(s[c].value.protobuff));return[2,{sourceName2DataAndRefKey:l,transferList:u}]}})})},t.prototype._getVectorTileData=function(e,t,r){return o(this,void 0,void 0,function(){var i,o,a,s,l,u=this;return n(this,function(n){return i=e.id,this._ongoingTileRequests.has(i)?[2,this._ongoingTileRequests.get(i)]:(o=new AbortController,a={signal:o.signal},s=r&&r.signal,l=this._getParsedVectorTileData(e,t,a).then(function(e){return u._ongoingTileRequests.delete(i),u._ongoingRequestToController.delete(i),e}).catch(function(e){return u._ongoingTileRequests.delete(i),u._ongoingRequestToController.delete(i),null}),this._ongoingTileRequests.set(i,l),this._ongoingRequestToController.set(i,o),s&&c.onAbort(s,function(){o.abort(),u._ongoingTileRequests.delete(i),u._ongoingRequestToController.delete(i)}),[2,l])})})},t.prototype._getParsedVectorTileData=function(e,t,r){return o(this,void 0,void 0,function(){var i;return n(this,function(n){switch(n.label){case 0:return[4,this.fetchTileData(e,r)];case 1:return i=n.sent(),[2,this.parseTileData({key:e,data:i},t,r)]}})})},t}()}.apply(null,i))||(e.exports=n)},2335:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2194)],void 0===(n=function(e,t,r){return function(){function e(e,t){this._width=0,this._height=0,this._free=[],this._width=e,this._height=t,this._free.push(new r.default(0,0,e,t))}return Object.defineProperty(e.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),e.prototype.allocate=function(e,t){if(e>this._width||t>this._height)return new r.default;for(var i=null,n=-1,o=0;o<this._free.length;++o){var a=this._free[o];e<=a.width&&t<=a.height&&(null===i||a.y<=i.y&&a.x<=i.x)&&(i=a,n=o)}return null===i?new r.default:(this._free.splice(n,1),i.width<i.height?(i.width>e&&this._free.push(new r.default(i.x+e,i.y,i.width-e,t)),i.height>t&&this._free.push(new r.default(i.x,i.y+t,i.width,i.height-t))):(i.width>e&&this._free.push(new r.default(i.x+e,i.y,i.width-e,i.height)),i.height>t&&this._free.push(new r.default(i.x,i.y+t,e,i.height-t))),new r.default(i.x,i.y,e,t))},e.prototype.release=function(e){for(var t=0;t<this._free.length;++t){var r=this._free[t];if(r.y===e.y&&r.height===e.height&&r.x+r.width===e.x)r.width+=e.width;else if(r.x===e.x&&r.width===e.width&&r.y+r.height===e.y)r.height+=e.height;else if(e.y===r.y&&e.height===r.height&&e.x+e.width===r.x)r.x=e.x,r.width+=e.width;else{if(e.x!==r.x||e.width!==r.width||e.y+e.height!==r.y)continue;r.y=e.y,r.height+=e.height}this._free.splice(t,1),this.release(e)}this._free.push(e)},e}()}.apply(null,i))||(e.exports=n)},2336:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(12),r(92),r(474),r(285),r(74),r(472),r(2118),r(868),r(202)],void 0===(n=function(e,t,r,i,n,o,a,s,l,u,f){var c=(s.enums.CompareFunction,s.enums.Usage,["fillVertexBuffer","fillDDVertexBuffer","fillIndexBuffer","outlineVertexBuffer","outlineDDVertexBuffer","outlineIndexBuffer","lineVertexBuffer","lineDDVertexBuffer","lineIndexBuffer","iconVertexBuffer","iconDDVertexBuffer","iconIndexBuffer","textVertexBuffer","textDDVertexBuffer","textIndexBuffer","circleVertexBuffer","circleIndexBuffer"]);return function(e){function t(){for(var t,r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];var a=e.call(this)||this;return a._renderBuckets=[],a._vectorTileData=null,a._symbolUpdateData=null,a.coords=[0,0],a.bounds=[0,0,0,0],a.tileTransform={transform:n.mat4f32.create(),displayCoord:o.vec2f32.create()},a.stencilData={mask:0,reference:0},a.triangleCount=0,r.length>0&&(t=a.acquire).call.apply(t,[a].concat(r)),a}return r(t,e),t.prototype.reset=function(){f.pool.release(this.key),this.key=null,this.coords[0]=0,this.coords[1]=0,this.bounds[0]=0,this.bounds[1]=0,this.bounds[2]=0,this.bounds[3]=0,this.width=0,this.height=0,this.resolution=null,this.rotation=0,this._vectorTileData=null,this.styleLayers=null,this.client=null,this.id=null,this.tileTransform.transform.fill(0),this.tileTransform.displayCoord.fill(0),this.stencilData.mask=0,this.stencilData.reference=0,this._renderBuckets.length=0,this._symbolUpdateData=null,this.stage=null,this.triangleCount=0,this.refKeys=null},t.prototype.acquire=function(e,t,r,i){this.key=e;var n=t.lodAt(e.level),o=null!==n?n.resolution:0,s=t.size[0]*o,l=t.origin,u=e.col*s,f=e.row*s,c=t.spatialReference,d=0;if(c&&(c._isWrappable?c._isWrappable():c.isWrappable)){var h=a.getInfo(c);d=h.valid[1]-h.valid[0]}var _=e.world*d,p=l.x+u+_,m=l.y-f,v=p+s,g=m-s;this.coords[0]=p,this.coords[1]=m,this.bounds[0]=p,this.bounds[1]=m,this.bounds[2]=v,this.bounds[3]=g,this.widthInPixels=t.size[1],this.coordRange=4096,this.resolution=o,this.rotation=i,this.styleLayers=r,this.id=e.id},t.prototype.setData=function(e,t,r){this._vectorTileData=e,this.client=t,this.refKeys=r},t.prototype.updateSymbolData=function(e){e&&(this._symbolUpdateData=e,this.requestRender())},t.prototype.updateTileData=function(e){this._vectorTileData=e,this.stage.requestRender()},t.prototype.dispose=function(){for(var e=["fillVertexArrayObject","fillDDVertexArrayObject","outlineVertexArrayObject","lineVertexArrayObject","lineDDVertexArrayObject","iconVertexArrayObject","iconDDVertexArrayObject","textVertexArrayObject","textDDVertexArrayObject","circleVertexArrayObject","fillVertexBuffer","fillDDVertexBuffer","fillIndexBuffer","outlineVertexBuffer","outlineDDVertexBuffer","outlineIndexBuffer","lineVertexBuffer","lineDDVertexBuffer","lineIndexBuffer","iconVertexBuffer","iconDDVertexBuffer","iconIndexBuffer","textVertexBuffer","textDDVertexBuffer","textIndexBuffer","circleVertexBuffer","circleIndexBuffer","texture"],t=0;t<e.length;++t){var r=e[t];this[r]&&(this[r].dispose(),this[r]=null)}this._renderBuckets.length=0},t.prototype.getCpuMemoryUsage=function(){return null!=this._vectorTileData&&this._vectorTileData.bufferData?this._vectorTileData.bufferData.reduce(function(e,t){return e+t.byteLength},0)+this._vectorTileData.bufferDataInfo.byteLength+this._vectorTileData.bucketDataInfo.byteLength:0},t.prototype.getGpuMemoryUsage=function(){var e=this,t=c.reduce(function(t,r){return e[r]?t+e[r].size:t},0);return this.texture&&(t+=this.texture.descriptor.width*this.texture.descriptor.height*4),t},t.prototype.attach=function(){return this._vectorTileData&&this.ready(),null!=this._vectorTileData},t.prototype._commitChanges=function(){this._vectorTileData&&(this.dispose(),this._createRenderBuckets(),this._createBufferObjects(),this._vectorTileData=null)},t.prototype._createRenderBuckets=function(){for(var e=new Uint32Array(this._vectorTileData.bucketDataInfo),t=e.length,r=0;r<t;){var i=e[r];switch(e[r+1]){case 0:var n=new u.BackgroundRenderBucket;n.layerID=i,this._renderBuckets.push(n),r+=2;break;case 1:var o=new u.FillRenderBucket;o.layerID=i,o.triangleElementStart=e[r+2],o.triangleElementCount=e[r+3],o.outlineElementStart=e[r+4],o.outlineElementCount=e[r+5],this._renderBuckets.push(o),r+=6;break;case 2:var a=new u.LineRenderBucket;a.layerID=i,a.triangleElementStart=e[r+2],a.triangleElementCount=e[r+3],this._renderBuckets.push(a),r+=4;break;case 3:var s=new u.SymbolRenderBucket;s.layerID=i,s.isSDF=0!==e[r+2];var l=r+3,f=e[l];if(l++,f>0)for(var c=void 0,d=void 0,h=void 0,_=0;_<f;_++)c=e[l],d=e[l+1],h=e[l+2],s.markerPerPageElementsMap.set(c,[d,h]),l+=3;var p=l,m=e[p];if(p++,m>0)for(c=void 0,d=void 0,h=void 0,_=0;_<m;_++)c=e[p],d=e[p+1],h=e[p+2],s.glyphPerPageElementsMap.set(c,[d,h]),p+=3;this._renderBuckets.push(s),r+=5+3*f+3*m;break;case 4:var v=new u.CircleRenderBucket;v.layerID=i,v.triangleElementStart=e[r+2],v.triangleElementCount=e[r+3],this._renderBuckets.push(v),r+=4;break;default:console.error("Bad bucket type!"),r+=2}}},t._createBufferToObject=function(){var e=[];return e[1]={create:s.BufferObject.createVertex,var:"fillVertexBuffer"},e[2]={create:s.BufferObject.createVertex,var:"fillDDVertexBuffer"},e[3]={create:s.BufferObject.createIndex,var:"fillIndexBuffer"},e[4]={create:s.BufferObject.createVertex,var:"outlineVertexBuffer"},e[5]={create:s.BufferObject.createVertex,var:"outlineDDVertexBuffer"},e[6]={create:s.BufferObject.createIndex,var:"outlineIndexBuffer"},e[7]={create:s.BufferObject.createVertex,var:"lineVertexBuffer"},e[8]={create:s.BufferObject.createVertex,var:"lineDDVertexBuffer"},e[9]={create:s.BufferObject.createIndex,var:"lineIndexBuffer"},e[10]={create:s.BufferObject.createVertex,var:"iconVertexBuffer"},e[11]={create:s.BufferObject.createVertex,var:"iconDDVertexBuffer"},e[12]={create:s.BufferObject.createIndex,var:"iconIndexBuffer"},e[13]={create:s.BufferObject.createVertex,var:"textVertexBuffer"},e[14]={create:s.BufferObject.createVertex,var:"textDDVertexBuffer"},e[15]={create:s.BufferObject.createIndex,var:"textIndexBuffer"},e[16]={create:s.BufferObject.createVertex,var:"circleVertexBuffer"},e[17]={create:s.BufferObject.createIndex,var:"circleIndexBuffer"},e},t.prototype._createBufferObjects=function(){for(var e=this.stage.context,r=new Uint32Array(this._vectorTileData.bufferDataInfo),i=r.length,n=0,o=0;o<i;o+=2,n++){var a=r[o];if(!(r[o+1]<=0||0===this._vectorTileData.bufferData[n].byteLength)){var s=t.bufferToObject[a];s?this[s.var]?this[s.var].setData(this._vectorTileData.bufferData[n]):this[s.var]=s.create(e,35044,this._vectorTileData.bufferData[n]):console.error("Bad buffer type "+a)}}},t.prototype.detach=function(){this.isReady&&this.client&&this.client.invoke("destructTileData",this.id),this.dispose(),e.prototype.detach.call(this)},t.prototype.doRender=function(e){if(this.visible&&this.isReady){var t=this.stage.context,r=e.renderer;if(t&&r){this._commitChanges();var i=e.drawphase;this._symbolUpdateData&&(this._updateSymbolData(e,this._symbolUpdateData),this._symbolUpdateData=null),t.setStencilFunction(514,this.stencilData.reference,this.stencilData.mask);var n,o=this.styleLayers,a=void 0!==e.layerOpacity?e.layerOpacity:1;if(0!==a){var s=this._renderBuckets.length;if(0===i)for(var l=s-1;l>=0;l--){var u=this._renderBuckets[l];if(n=o.layers[u.layerID],!u||!n)return;1!==u.type&&0!==u.type||!u.hasData()||(this.triangleCount+=r.renderBucket(t,u,e.displayLevel,e.requiredLevel,i,this,n,a))}else for(l=0;l<s;l++){u=this._renderBuckets[l];if(n=o.layers[u.layerID],!u||!n)return;u.hasData()&&(this.triangleCount+=r.renderBucket(t,u,e.displayLevel,e.requiredLevel,i,this,n,a))}}}}},t.prototype._updateSymbolData=function(e,t){if(!t||!t.bucketDataInfo)return!0;var r=new Uint32Array(t.bucketDataInfo),i=r.length;if(0===i)return!0;if(!this.isReady)return this.requestRender(),!1;for(var n=this.stage.context,o=new Uint32Array(t.bufferDataInfo),a=o.length,l=0,f=0;f<a;f+=2,l++)switch(o[f]){case 10:this.iconVertexBuffer&&(this.iconVertexBuffer.dispose(),this.iconVertexBuffer=null),this.iconVertexBuffer=s.BufferObject.createVertex(n,35044,t.bufferData[l]);break;case 11:this.iconDDVertexBuffer&&(this.iconDDVertexBuffer.dispose(),this.iconDDVertexBuffer=null),this.iconDDVertexBuffer=s.BufferObject.createVertex(n,35044,t.bufferData[l]);break;case 12:this.iconIndexBuffer&&(this.iconIndexBuffer.dispose(),this.iconIndexBuffer=null),this.iconIndexBuffer=s.BufferObject.createIndex(n,35044,t.bufferData[l]);break;case 13:this.textVertexBuffer&&(this.textVertexBuffer.dispose(),this.textVertexBuffer=null),this.textVertexBuffer=s.BufferObject.createVertex(n,35044,t.bufferData[l]);break;case 14:this.textDDVertexBuffer&&(this.textDDVertexBuffer.dispose(),this.textDDVertexBuffer=null),this.textDDVertexBuffer=s.BufferObject.createVertex(n,35044,t.bufferData[l]);break;case 15:this.textIndexBuffer&&(this.textIndexBuffer.dispose(),this.textIndexBuffer=null),this.textIndexBuffer=s.BufferObject.createIndex(n,35044,t.bufferData[l])}for(var c=[],d=0;d<this._renderBuckets.length;d++)this._renderBuckets[d]instanceof u.SymbolRenderBucket||c.push(this._renderBuckets[d]);this._renderBuckets=c;for(var h,_=0;_<i;){var p=r[_];(h=new u.SymbolRenderBucket).layerID=p,h.isSDF=0!==r[_+2],this.styleLayers.layers.length>h.layerID&&this.styleLayers.layers[h.layerID].type===h.type&&c.push(h);var m=_+3,v=r[m];if(m++,v>0)for(var g=void 0,y=void 0,x=void 0,b=0;b<v;b++)g=r[m],y=r[m+1],x=r[m+2],h.markerPerPageElementsMap.set(g,[y,x]),m+=3;var D=m,w=r[D];if(D++,w>0)for(g=void 0,y=void 0,x=void 0,b=0;b<w;b++)g=r[D],y=r[D+1],x=r[D+2],h.glyphPerPageElementsMap.set(g,[y,x]),D+=3;_+=5+3*v+3*w}return this.iconVertexArrayObject&&(this.iconVertexArrayObject.dispose(),this.iconVertexArrayObject=null),this.iconDDVertexArrayObject&&(this.iconDDVertexArrayObject.dispose(),this.iconDDVertexArrayObject=null),this.textVertexArrayObject&&(this.textVertexArrayObject.dispose(),this.textVertexArrayObject=null),this.textDDVertexArrayObject&&(this.textDDVertexArrayObject.dispose(),this.textDDVertexArrayObject=null),!0},t.pool=new i(t),t.bufferToObject=t._createBufferToObject(),t}(l.DisplayObject)}.apply(null,i))||(e.exports=n)},2337:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(24),r(474),r(354),r(356),r(472),r(2118),r(807),r(2533),r(2534),r(2535),r(2536),r(2537),r(2538),r(2541),r(2542)],void 0===(n=function(e,t,r,i,n,o,a,s,l,u,f,c,d,h,_,p,m){return a.enums.CompareFunction,a.enums.DepthStencilTargetType,a.enums.Face,a.enums.PixelFormat,a.enums.PixelType,a.enums.StencilOperation,a.enums.TargetType,a.enums.TextureSamplingMode,function(){function e(e,t,r){void 0===r&&(r=!0),this._extrudeMatrix=i.mat4f32.create(),this._extrudeNoRotationMatrix=i.mat4f32.create(),this._extrudeRotateVector=n.vec3f32.fromValues(0,0,1),this._extrudeScaleVector=n.vec3f32.fromValues(1,1,1),this._backgroundColor=o.vec4f32.fromValues(1,0,0,1),this._state={rotation:0,size:[0,0]},this._cachedWidth=0,this._cachedHeight=0,this._cachedRotation=0,this._blitRenderer=new s.BitBlitRenderer,this._globalOpacityFBO=null,this._boundFBO=null,this._programCache=null,this._spriteMosaic=e,this._glyphMosaic=t,this._ignoreSpeed=!r,this._fadeRecorder=new c.FadeRecorder(300)}return e.prototype.dispose=function(){this._backgroundRenderer&&(this._backgroundRenderer.dispose(),this._backgroundRenderer=null),this._lineRenderer&&(this._lineRenderer.dispose(),this._lineRenderer=null),this._fillRenderer&&(this._fillRenderer.dispose(),this._fillRenderer=null),this._symbolRenderer&&(this._symbolRenderer.dispose(),this._symbolRenderer=null),this._circleRenderer&&(this._circleRenderer.dispose(),this._circleRenderer=null),this._tileInfoRenderer&&(this._tileInfoRenderer.dispose(),this._tileInfoRenderer=null),this._hittestFBO&&(this._hittestFBO.dispose(),this._hittestFBO=null),this._globalOpacityFBO&&(this._globalOpacityFBO.dispose(),this._globalOpacityFBO=null),this._blitRenderer&&(this._blitRenderer.dispose(),this._blitRenderer=null),this._boundFBO=null,this._programCache&&(this._programCache.dispose(),this._programCache=null),this._cachedWidth=0,this._cachedHeight=0,this._cachedRotation=0},e.prototype.initializeProgramCache=function(e){if(null===this._programCache){var t=new m.default;t.initialize(e),this._backgroundRenderer=new u(t),this._lineRenderer=new h(t),this._fillRenderer=new d(t),this._symbolRenderer=new _(t),this._circleRenderer=new f(t),this._tileInfoRenderer=new p(t),this._programCache=t}},e.prototype.setStateParams=function(e,t,i){this._fadeRecorder.recordLevel(i),this._state=e,this._state.size[0]===this._cachedWidth&&this._state.size[1]===this._cachedHeight&&this._state.rotation===this._cachedRotation||(this._extrudeScaleVector[0]=2/e.size[0],this._extrudeScaleVector[1]=-2/e.size[1],r.mat4.identity(this._extrudeMatrix),r.mat4.rotate(this._extrudeMatrix,this._extrudeMatrix,-e.rotation*l.C_DEG_TO_RAD,this._extrudeRotateVector),r.mat4.scale(this._extrudeMatrix,this._extrudeMatrix,this._extrudeScaleVector),r.mat4.transpose(this._extrudeMatrix,this._extrudeMatrix),r.mat4.identity(this._extrudeNoRotationMatrix),r.mat4.scale(this._extrudeNoRotationMatrix,this._extrudeNoRotationMatrix,this._extrudeScaleVector),r.mat4.transpose(this._extrudeNoRotationMatrix,this._extrudeNoRotationMatrix),this._cachedWidth=this._state.size[0],this._cachedHeight=this._state.size[1],this._cachedRotation=this._state.rotation)},e.prototype.drawClippingMasks=function(e,t){if(0!==t.length){e.setDepthWriteEnabled(!1),e.setDepthTestEnabled(!1),e.setStencilTestEnabled(!0),e.setBlendingEnabled(!1),e.setColorMask(!1,!1,!1,!1),e.setStencilOp(7680,7680,7681),e.setStencilWriteMask(255),e.setClearStencil(0);var r=e.gl;e.clear(r.STENCIL_BUFFER_BIT);for(var i=0,n=t;i<n.length;i++){var o=n[i];o.attached&&o.visible&&(e.setStencilFunctionSeparate(1032,519,o.stencilData.reference,o.stencilData.mask),this._backgroundRenderer.renderSolidColor(e,{u_matrix:o.tileTransform.transform,u_normalized_origin:o.tileTransform.displayCoord,u_coord_range:o.coordRange,u_depth:0,u_color:this._backgroundColor}))}e.setColorMask(!0,!0,!0,!0),e.setBlendingEnabled(!0)}},e.prototype.renderDebug=function(e,t){var r=t.key;this._backgroundColor.set([r.col%2,r.row%2,r.col%2==0&&r.row%2==0?1:0,.5]),this._backgroundRenderer.renderSolidColor(e,{u_matrix:t.tileTransform.transform,u_normalized_origin:t.tileTransform.displayCoord,u_coord_range:t.coordRange,u_depth:0,u_color:this._backgroundColor})},e.prototype.renderBucket=function(e,t,r,i,n,o,a,s){if(!a)return 0;if(void 0!==a.minzoom&&a.minzoom>r+1e-6)return 0;if(o.key.level===i&&void 0!==a.maxzoom&&a.maxzoom<=r-1e-6)return 0;switch(t.type){case 0:if(2!==n)return this._renderBackground(e,t,r,n,o,a,s);break;case 1:if(2!==n)return this._renderFill(e,t,r,n,o,a,s);break;case 2:if(1===n||3===n)return this._renderLine(e,t,r,n,o,a,s);break;case 3:if(2===n||3===n)return this._renderSymbol(e,t,r,n,i,o,a,s);break;case 4:if(2===n||3===n)return this._renderCircle(e,t,r,n,i,o,a,s)}return 0},e.prototype.renderTileInfo=function(e,t){this._tileInfoRenderer.render(e,t)},e.prototype.setGlobalOpacity=function(e,t,r){if(1!==r){this._boundFBO=e.getBoundFramebufferObject();var i=t.pixelRatio,n=t.state.size,o=n[0],s=n[1],l=Math.round(o*i),u=Math.round(s*i);null!==this._globalOpacityFBO&&this._globalOpacityFBO.width===l&&this._globalOpacityFBO.height===u||(null!==this._globalOpacityFBO&&this._globalOpacityFBO.dispose(),this._globalOpacityFBO=a.FramebufferObject.create(e,{colorTarget:0,depthStencilTarget:3,width:l,height:u})),e.bindFramebuffer(this._globalOpacityFBO),e.setClearColor(0,0,0,0),e.clear(e.gl.COLOR_BUFFER_BIT)}},e.prototype.applyGlobalOpacity=function(e,t,r){if(1!==r){var i=t.pixelRatio,n=t.state.size,o=n[0],a=n[1],s=e.getViewport();e.setViewport(0,0,i*o,i*a),e.bindFramebuffer(this._boundFBO);var l=this._globalOpacityFBO.colorTexture;this._blitRenderer.render(e,l,9728,r),e.setViewport(s.x,s.y,s.width,s.height),this._boundFBO=null}},e.prototype.needsRedraw=function(){return this._fadeRecorder.needsRedraw()},e.prototype.hitTest=function(e,t,r,i,n,o,s){var l=[0,0],u=[0,0],f=e.state;f.toMap(l,[0,0]),f.toMap(u,[o,o]);var c=i.filter(function(e){return!(l[0]>e.bounds[2]||u[0]<e.bounds[0]||l[1]<e.bounds[3]||u[1]>e.bounds[1])});if(0===c.length)return[];c.sort(function(e,t){return e.key.level-t.key.level});for(var d=c.length,h=1;h<=d;h++){(y=c[h-1]).attached&&(y.stencilData.reference=h,y.stencilData.mask=255)}s(f,n,c);var _=e.context;this._hittestFBO||(this._hittestFBO=a.FramebufferObject.create(_,{colorTarget:0,depthStencilTarget:3,width:o,height:o}));var p=_.getViewport(),m=_.getBoundFramebufferObject();_.bindFramebuffer(this._hittestFBO),_.setViewport(0,0,o,o);var v=_.gl;_.setDepthWriteEnabled(!0),_.setStencilWriteMask(255),_.setClearColor(1,1,1,1),_.setClearDepth(1),_.setClearStencil(0),_.clear(v.COLOR_BUFFER_BIT|v.DEPTH_BUFFER_BIT|v.STENCIL_BUFFER_BIT),_.setDepthWriteEnabled(!1),this.drawClippingMasks(_,c),_.setBlendingEnabled(!1),_.setStencilWriteMask(0),_.setStencilOp(7680,7680,7681),_.setDepthFunction(515),_.setDepthTestEnabled(!0),_.setDepthWriteEnabled(!0),_.setStencilTestEnabled(!0);for(var g=0;g<d;g++){var y;(y=c[g]).attached&&y.doRender(e)}_.setStencilTestEnabled(!1),_.setDepthTestEnabled(!1),this._readbackBuffer||(this._readbackBuffer=new Uint8Array(4*o*o),this._readbackBuffer32=new Uint32Array(this._readbackBuffer.buffer)),this._hittestFBO.readPixels(0,0,o,o,6408,5121,this._readbackBuffer);var x=new Set,b=o*o,D=Math.round(b/2),w=this._readbackBuffer32[D];4294967295!==w&&x.add(w);for(h=0;h<b;h++)4294967295!==(w=this._readbackBuffer32[h])&&x.add(w);_.bindFramebuffer(m),_.setViewport(p.x,p.y,p.width,p.height);var V=[];return x.forEach(function(e){V.push(e)}),V},e.prototype._renderBackground=function(e,t,r,i,n,o,a){return this._backgroundRenderer.render(e,t,r,i,n,o,this._spriteMosaic,this._spriteMosaic.pixelRatio,a)},e.prototype._renderLine=function(e,t,r,i,n,o,a){return this._lineRenderer.render(e,t,r,i,this._state,n,o,this._spriteMosaic,this._extrudeMatrix,this._spriteMosaic.pixelRatio,a)},e.prototype._renderFill=function(e,t,r,i,n,o,a){return this._fillRenderer.render(e,t,r,this._state.rotation,i,n,o,this._spriteMosaic,this._extrudeMatrix,this._spriteMosaic.pixelRatio,a)},e.prototype._renderCircle=function(e,t,r,i,n,o,a,s){var l=!0;return n===o.key.level&&(l=!1),e.setStencilTestEnabled(l),this._circleRenderer.render(e,t,r,i,this._state.rotation,o,a,this._extrudeMatrix,s)},e.prototype._renderSymbol=function(e,t,r,i,n,o,a,s){var l=!0;return n===o.key.level&&(l=!1),e.setStencilTestEnabled(l),this._symbolRenderer.render(e,t,r,i,this._state.rotation,this._fadeRecorder.getFadeValues(this._ignoreSpeed),o,a,this._spriteMosaic,this._glyphMosaic,this._extrudeMatrix,this._extrudeNoRotationMatrix,this._spriteMosaic.pixelRatio,s)},e}()}.apply(null,i))||(e.exports=n)},2529:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(26),r(7),r(472),r(2335),r(2194)],void 0===(n=function(e,t,r,i,n,o,a){var s;return n.enums.PixelFormat,n.enums.PixelType,function(){function e(e,t,i){this.width=0,this.height=0,this._dirties=[],this._glyphData=[],this._currentPage=0,this._glyphIndex={},this._textures=[],this._rangePromises=new Map,!s&&r("stable-symbol-rendering")&&(s=new Set),this.width=e,this.height=t,this._glyphSource=i,this._binPack=new o(e-4,t-4),this._glyphData.push(new Uint8Array(e*t)),this._dirties.push(!0),this._textures.push(void 0)}return e.prototype.getGlyphItems=function(e,t,n){for(var l=this,u=[],f=this._glyphSource,c=new Set,d=0,h=n;d<h.length;d++){var _=h[d],p=Math.floor(_*(1/256));c.add(p)}var m=[];return c.forEach(function(e){if(e<=256){var r=t+e;if(l._rangePromises.has(r))m.push(l._rangePromises.get(r));else{var i=f.getRange(t,e).then(function(){l._rangePromises.delete(r)},function(){l._rangePromises.delete(r)});l._rangePromises.set(r,i),m.push(i)}}}),i.all(m).then(function(e){var i,d=l._glyphIndex[t];if(d||(d={},l._glyphIndex[t]=d),r("stable-symbol-rendering")){s.clear();for(var h=0,_=n;h<_.length;h++){var p=_[h];s.add(p)}var m=[];c.forEach(function(e){m.push(e)}),m.sort(),i=[];for(var v=0,g=m;v<g.length;v++)for(var y=g[v],x=0;x<256;++x)i.push(256*y+x)}else i=n;for(var b=0,D=i;b<D.length;b++){var w=d[p=D[b]];if(w)r("stable-symbol-rendering")&&!s.has(p)||(u[p]={sdf:!0,rect:w.rect,metrics:w.metrics,page:w.page});else{var V=f.getGlyph(t,p);if(V&&V.metrics){var O=V.metrics,T=void 0;if(0===O.width)T=new a.default(0,0,0,0);else{var A=O.width+6,P=O.height+6,z=A%4?4-A%4:4,C=P%4?4-P%4:4;1===z&&(z=5),1===C&&(C=5),(T=l._binPack.allocate(A+z,P+C)).isEmpty&&(l._dirties[l._currentPage]||(l._glyphData[l._currentPage]=null),l._currentPage=l._glyphData.length,l._glyphData.push(new Uint8Array(l.width*l.height)),l._dirties.push(!0),l._textures.push(void 0),l._binPack=new o(l.width-4,l.height-4),T=l._binPack.allocate(A+z,P+C));var M=l._glyphData[l._currentPage],I=V.bitmap,B=void 0,R=void 0;if(I)for(var j=0;j<P;j++){B=A*j,R=l.width*(T.y+j+1)+T.x;for(var k=0;k<A;k++)M[R+k+1]=I[B+k]}}d[p]={rect:T,metrics:O,tileIDs:null,page:l._currentPage},r("stable-symbol-rendering")&&!s.has(p)||(u[p]={sdf:!0,rect:T,metrics:O,page:l._currentPage}),l._dirties[l._currentPage]=!0}}}return u})},e.prototype.removeGlyphs=function(e){for(var t in this._glyphIndex){var r=this._glyphIndex[t];if(r){var i=void 0;for(var n in r)if((i=r[n]).tileIDs.delete(e),0===i.tileIDs.size){for(var o=this._glyphData[i.page],a=i.rect,s=void 0,l=void 0,u=0;u<a.height;u++)for(s=this.width*(a.y+u)+a.x,l=0;l<a.width;l++)o[s+l]=0;delete r[n],this._dirties[i.page]=!0}}}},e.prototype.bind=function(e,t,r,i){void 0===i&&(i=0),this._textures[r]||(this._textures[r]=new n.Texture(e,{pixelFormat:6406,dataType:5121,width:this.width,height:this.height},new Uint8Array(this.width*this.height)));var o=this._textures[r];o.setSamplingMode(t),this._dirties[r]&&o.setData(this._glyphData[r]),e.bindTexture(o,i),this._dirties[r]=!1},e.prototype.dispose=function(){this._binPack=null;for(var e=0,t=this._textures;e<t.length;e++){var r=t[e];r&&r.dispose()}this._textures.length=0},e}()}.apply(null,i))||(e.exports=n)},2530:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(23),r(825),r(7)],void 0===(n=function(e,t,r,i,n){var o=function(){function e(e){if(this._metrics=[],this._bitmaps=[],e)for(;e.next();)switch(e.tag()){case 1:for(var t=e.getMessage();t.next();)switch(t.tag()){case 3:for(var r=t.getMessage(),i=void 0,n=void 0,o=void 0,a=void 0,s=void 0,l=void 0,u=void 0;r.next();)switch(r.tag()){case 1:i=r.getUInt32();break;case 2:n=r.getBytes();break;case 3:o=r.getUInt32();break;case 4:a=r.getUInt32();break;case 5:s=r.getSInt32();break;case 6:l=r.getSInt32();break;case 7:u=r.getUInt32();break;default:r.skip()}i&&(this._metrics[i]={width:o,height:a,left:s,top:l,advance:u},this._bitmaps[i]=n);break;default:t.skip()}break;default:e.skip()}}return e.prototype.getMetrics=function(e){return this._metrics[e]},e.prototype.getBitmap=function(e){return this._bitmaps[e]},e}(),a=function(){function e(){this._ranges=[]}return e.prototype.getRange=function(e){return this._ranges[e]},e.prototype.addRange=function(e,t){this._ranges[e]=t},e}();return function(){function e(e){this._glyphInfo={},this._baseURL=e}return e.prototype.getRange=function(e,t){var a=this._getFontStack(e);if(a.getRange(t))return n.resolve();var s=256*t,l=s+255,u=this._baseURL.replace("{fontstack}",e).replace("{range}",s+"-"+l);return r(u,{responseType:"array-buffer"}).then(function(e){a.addRange(t,new o(new i(new Uint8Array(e.data),new DataView(e.data))))}).catch(function(){a.addRange(t,new o)})},e.prototype.getGlyph=function(e,t){var r=this._getFontStack(e);if(r){var i=Math.floor(t/256);if(!(i>256)){var n=r.getRange(i);if(n)return{metrics:n.getMetrics(t),bitmap:n.getBitmap(t)}}}},e.prototype._getFontStack=function(e){var t=this._glyphInfo[e];return t||(t=this._glyphInfo[e]=new a),t},e}()}.apply(null,i))||(e.exports=n)},2531:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(472),r(807),r(2335),r(2194)],void 0===(n=function(e,t,r,i,n,o){return r.enums.PixelFormat,r.enums.PixelType,function(){function e(e,t,r){void 0===r&&(r=0),this._size=[],this._mosaicsData=[],this._textures=[],this._dirties=[],this._maxItemSize=0,this._currentPage=0,this._pageWidth=0,this._pageHeight=0,this._mosaicRects={},this.pixelRatio=1,(e<=0||t<=0)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!"),this._pageWidth=e,this._pageHeight=t,r>0&&(this._maxItemSize=r),this._binPack=new n(e-4,t-4)}return e.prototype.getWidth=function(e){return e>=this._size.length?-1:this._size[e][0]},e.prototype.getHeight=function(e){return e>=this._size.length?-1:this._size[e][1]},e.prototype.setSpriteSource=function(e){if(this.dispose(),this.pixelRatio=e.devicePixelRatio,0===this._mosaicsData.length){this._binPack=new n(this._pageWidth-4,this._pageHeight-4);var t=Math.floor(this._pageWidth),r=Math.floor(this._pageHeight),i=new Uint32Array(t*r);this._mosaicsData[0]=i,this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0)}this._sprites=e},e.prototype.getSpriteItem=function(e,t){void 0===t&&(t=!1);var r=this._mosaicRects[e];if(r)return r;if(!this._sprites||"loaded"!==this._sprites.loadStatus)return null;var i=this._sprites.getSpriteInfo(e);if(!i||!i.width||!i.height||i.width<0||i.height<0)return null;var n=i.width,o=i.height,a=this._allocateImage(n,o),s=a[0],l=a[1],u=a[2];return s.width<=0?null:(this._copy(s,i,l,u,t),r={rect:s,width:n,height:o,sdf:i.sdf,simplePattern:!1,pixelRatio:i.pixelRatio,page:l},this._mosaicRects[e]=r,r)},e.prototype.preloadSpriteItems=function(){for(var e=0,t=this._sprites.spriteNames;e<t.length;e++){var r=t[e];this.getSpriteItem(r,!0)}},e.prototype.getSpriteItems=function(e){for(var t={},r=0,i=e;r<i.length;r++){var n=i[r];t[n]=this.getSpriteItem(n)}return t},e.prototype.getMosaicItemPosition=function(e,t){var r=this.getSpriteItem(e,t),i=r&&r.rect;if(!i)return null;i.width=r.width,i.height=r.height;var n=r.width,o=r.height;return{size:[r.width,r.height],tl:[(i.x+2)/this._size[r.page][0],(i.y+2)/this._size[r.page][1]],br:[(i.x+2+n)/this._size[r.page][0],(i.y+2+o)/this._size[r.page][1]],page:r.page}},e.prototype.bind=function(e,t,i,n){void 0===i&&(i=0),void 0===n&&(n=0),this._textures[i]||(this._textures[i]=new r.Texture(e,{pixelFormat:6408,dataType:5121,width:this._size[i][0],height:this._size[i][1]},new Uint8Array(this._mosaicsData[i].buffer)));var o=this._textures[i];o.setSamplingMode(t),this._dirties[i]&&o.setData(new Uint8Array(this._mosaicsData[i].buffer)),e.bindTexture(o,n),this._dirties[i]=!1},e._copyBits=function(e,t,r,i,n,o,a,s,l,u,f){var c=i*t+r,d=s*o+a;if(f){d-=o;for(var h=-1;h<=u;c=((++h+u)%u+i)*t+r,d+=o)for(var _=-1;_<=l;_++)n[d+_]=e[c+(_+l)%l]}else for(h=0;h<u;h++){for(_=0;_<l;_++)n[d+_]=e[c+_];c+=t,d+=o}},e.prototype._copy=function(t,r,i,n,o,a){if(this._sprites&&"loaded"===this._sprites.loadStatus&&!(i>=this._mosaicsData.length)){var s=new Uint32Array(a?a.buffer:this._sprites.image.buffer),l=this._mosaicsData[i];l&&s||console.error("Source or target images are uninitialized!");var u=a?r.width:this._sprites.width;e._copyBits(s,u,r.x,r.y,l,n[0],t.x+2,t.y+2,r.width,r.height,o),this._dirties[i]=!0}},e.prototype._allocateImage=function(e,t){e+=2,t+=2;var r=Math.max(e,t);if(this._maxItemSize&&this._maxItemSize<r){var a=Math.pow(2,Math.ceil(i.log2(e))),s=Math.pow(2,Math.ceil(i.log2(t))),l=new o.default(0,0,e,t);return this._mosaicsData.push(new Uint32Array(a*s)),this._dirties.push(!0),this._size.push([a,s]),this._textures.push(void 0),[l,this._mosaicsData.length-1,[a,s]]}var u=e%4?4-e%4:4,f=t%4?4-t%4:4;1===u&&(u=5),1===f&&(f=5);var c=this._binPack.allocate(e+u,t+f);return c.width<=0?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new n(this._pageWidth-4,this._pageHeight-4),this._allocateImage(e,t)):[c,this._currentPage,[this._pageWidth,this._pageHeight]]},e.prototype.dispose=function(){this._binPack=null,this._mosaicRects={};for(var e=0,t=this._textures;e<t.length;e++){var r=t[e];r&&r.dispose()}this._textures.length=0},e}()}.apply(null,i))||(e.exports=n)},2533:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(94),r(827),r(356),r(472),r(2225),r(2206)],void 0===(n=function(e,t,r,i,n,o,a,s){return o.enums.DataType,o.enums.PrimitiveType,o.enums.TextureSamplingMode,o.enums.Usage,function(){function e(e){this._patternMatrix=i.mat3f32.create(),this._color=n.vec4f32.create(),this._solidrendererInitialized=!1,this._rendererInitialized=!1,this._programOptions={id:!1,pattern:!1},this._programCache=e,this._color.set([1,0,0,1])}return e.prototype.dispose=function(){this._solidVertexArrayObject&&(this._solidVertexArrayObject.dispose(),this._solidVertexArrayObject=null),this._vertexArrayObject&&(this._vertexArrayObject.dispose(),this._vertexArrayObject=null)},e.prototype.renderSolidColor=function(e,t){this._solidrendererInitialized||this._initializeSolidRenderer(e),e.bindVAO(this._solidVertexArrayObject);var r=this._programOptions;r.id=!1,r.pattern=!1;var i=this._programCache.getProgram(0,0,r);e.bindProgram(i),i.setUniformMatrix4fv("u_transformMatrix",t.u_matrix),i.setUniform2fv("u_normalized_origin",t.u_normalized_origin),i.setUniform1f("u_coord_range",t.u_coord_range||4096),i.setUniform1f("u_depth",t.u_depth||0),i.setUniform4fv("u_color",t.u_color||this._color),e.drawArrays(5,0,4),e.bindVAO()},e.prototype.render=function(e,t,i,n,o,a,l,u,f){this._rendererInitialized||this._initialize(e);var c=a.getPaintValue("background-color",i),d=f*a.getPaintValue("background-opacity",i),h=a.getPaintValue("background-pattern",i),_=void 0!==h,p=c[3]*d,m=_||p<1;if(m&&0===n)return 0;if(!m&&1===n)return 0;var v=3===n,g=(v?1:0)<<1|(_?1:0),y=this._programOptions;y.id=v,y.pattern=_;var x=this._programCache.getProgram(0,g,y);if(e.bindVAO(this._vertexArrayObject),e.bindProgram(x),x.setUniform1f("u_coord_range",o.coordRange),x.setUniform1f("u_depth",a.z||0),x.setUniformMatrix4fv("u_transformMatrix",o.tileTransform.transform),x.setUniform2fv("u_normalized_origin",o.tileTransform.displayCoord),_){var b=l.getMosaicItemPosition(h,!0);if(!b)return 0;var D=512*Math.pow(2,Math.floor(i)-o.key.level)*u;r.mat3.identity(this._patternMatrix);var w=D/b.size[0],V=D/b.size[1];this._patternMatrix[0]=w,this._patternMatrix[4]=V,l.bind(e,9729,b.page,5),x.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix),x.setUniform1f("u_opacity",d),x.setUniform2f("u_pattern_tl",b.tl[0],b.tl[1]),x.setUniform2f("u_pattern_br",b.br[0],b.br[1]),x.setUniform1i("u_texture",5)}else this._color[0]=p*c[0],this._color[1]=p*c[1],this._color[2]=p*c[2],this._color[3]=p,x.setUniform4fv("u_color",this._color);if(v){var O=s.int32To4Bytes(t.layerID);x.setUniform4f("u_id",O[0],O[1],O[2],O[3])}return e.drawArrays(5,0,4),e.bindVAO(),t.triangleCount()},e.prototype._initializeSolidRenderer=function(e){if(this._solidrendererInitialized)return!0;var t=new Int8Array([0,0,1,0,0,1,1,1]),r=o.BufferObject.createVertex(e,35044,t),i=new o.VertexArrayObject(e,this._programCache.getProgramAttributes(0),{geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:2,normalized:!1,divisor:0}]},{geometry:r});return this._solidVertexArrayObject=i,this._solidrendererInitialized=!0,!0},e.prototype._initialize=function(e){if(this._rendererInitialized)return!0;var t=[];t.push(a.i1616to32(0,0)),t.push(a.i1616to32(1,0)),t.push(a.i1616to32(0,1)),t.push(a.i1616to32(1,1));var r=new Uint32Array(t),i=o.BufferObject.createVertex(e,35044,r),n=new o.VertexArrayObject(e,{a_pos:0},{geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:4,normalized:!1,divisor:0}]},{geometry:i});return this._vertexArrayObject=n,this._rendererInitialized=!0,!0},e}()}.apply(null,i))||(e.exports=n)},2534:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(24),r(474),r(354),r(356),r(472),r(807),r(2206)],void 0===(n=function(e,t,r,i,n,o,a,s,l){return a.enums.DataType,a.enums.PrimitiveType,function(){function e(e){this._viewProjMat=i.mat4f32.create(),this._offsetVector=n.vec3f32.create(),this._color=o.vec4f32.create(),this._strokeColor=o.vec4f32.create(),this._initialized=!1,this._programOptions={id:!1},this._programCache=e}return e.prototype.dispose=function(){},e.prototype.render=function(e,t,i,n,o,a,u,f,c){if(0===t.triangleElementCount)return 0;this._initialized||this._initialize(e);var d=u.hasDataDrivenRadius?1:u.getPaintValue("circle-radius",i),h=u.hasDataDrivenColor?[1,1,1,1]:u.getPaintValue("circle-color",i),_=u.hasDataDrivenOpacity?1:u.getPaintValue("circle-opacity",i),p=u.hasDataDrivenStrokeWidth?1:u.getPaintValue("circle-stroke-width",i),m=u.hasDataDrivenStrokeColor?[1,1,1,1]:u.getPaintValue("circle-stroke-color",i),v=u.hasDataDrivenStrokeOpacity?1:u.getPaintValue("circle-stroke-opacity",i),g=u.hasDataDrivenBlur?0:u.getPaintValue("circle-blur",i),y=_*h[3]*c;this._color[0]=y*h[0],this._color[1]=y*h[1],this._color[2]=y*h[2],this._color[3]=y,y=v*m[3]*c,this._strokeColor[0]=y*m[0],this._strokeColor[1]=y*m[1],this._strokeColor[2]=y*m[2],this._strokeColor[3]=y;var x=a.tileTransform.transform,b=u.getPaintValue("circle-translate",i);if(0!==b[0]||0!==b[1]){r.mat4.copy(this._viewProjMat,a.tileTransform.transform);var D=b[0],w=b[1],V=0,O=0,T=a.coordRange/512,A=(1<<a.key.level)/Math.pow(2,i)*T;if(1===u.getPaintValue("circle-translate-anchor",i)){var P=-s.C_DEG_TO_RAD*o,z=Math.sin(P),C=Math.cos(P);V=A*(D*C-w*z),O=A*(D*z+w*C)}else V=A*D,O=A*w;this._offsetVector[0]=V,this._offsetVector[1]=O,this._offsetVector[2]=0,r.mat4.translate(this._viewProjMat,this._viewProjMat,this._offsetVector),x=this._viewProjMat}var M=this._getCircleVAO(e,a);if(!M)return 0;e.bindVAO(M);var I=3===n,B=I?1:0,R=this._programOptions;R.id=I;var j=this._programCache.getProgram(5,B,R);if(e.bindProgram(j),j.setUniformMatrix4fv("u_transformMatrix",x),j.setUniformMatrix4fv("u_extrudeMatrix",f),j.setUniform2fv("u_normalized_origin",a.tileTransform.displayCoord),j.setUniform1f("u_depth",u.z),j.setUniform1f("u_radius",d),j.setUniform4fv("u_color",this._color),j.setUniform1f("u_blur",g),j.setUniform1f("u_stroke_width",p),j.setUniform4fv("u_stroke_color",this._strokeColor),j.setUniform1f("u_antialiasingWidth",1.2),I){var k=l.int32To4Bytes(t.layerID);j.setUniform4f("u_id",k[0],k[1],k[2],k[3])}return e.drawElements(4,t.triangleElementCount,5125,12*t.triangleElementStart),e.bindVAO(),t.triangleCount()},e.prototype._initialize=function(e){return!!this._initialized||(this._vertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:16,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:4,stride:16,normalized:!0,divisor:0},{name:"a_stroke_color",count:4,type:5121,offset:8,stride:16,normalized:!0,divisor:0},{name:"a_data",count:4,type:5121,offset:12,stride:16,normalized:!1,divisor:0}]},this._initialized=!0,!0)},e.prototype._getCircleVAO=function(e,t){if(t.circleVertexArrayObject)return t.circleVertexArrayObject;var r=t.circleVertexBuffer,i=t.circleIndexBuffer;return r&&i?(t.circleVertexArrayObject=new a.VertexArrayObject(e,this._programCache.getProgramAttributes(5),this._vertexAttributes,{geometry:r},i),t.circleVertexArrayObject):null},e}()}.apply(null,i))||(e.exports=n)},2535:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(150)],void 0===(n=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){return function(e,t,r,i){this.fadeSpeed=e,this.minfadeLevel=t,this.maxfadeLevel=r,this.fadeChange=i}}();t.FadeProperties=i;var n=function(){function e(e){void 0===e&&(e=300),this._levelSnapshots=[],this._duration=e}return e.prototype.recordLevel=function(e){var t=r(),i=this._levelSnapshots;0===i.length&&(i.push({level:e,now:0}),i.push({level:e,now:0})),2!==i.length&&i[0].level===e||i.push({level:e,now:t})},e.prototype.needsRedraw=function(){if(0===this._levelSnapshots.length)return!1;for(var e=this._duration,t=this._levelSnapshots,r=t.length,i=t[r-1],n=-1;r>n+1&&t[n+1].now+e<i.now;)n++;for(n<0&&(n=0);n<r;n++)if(t[n].level!==i.level)return!0;return!1},e.prototype.getFadeValues=function(e){void 0===e&&(e=!1);for(var t=this._duration,i=r(),n=this._levelSnapshots;n.length>3&&n[1].now+t<i;)n.shift();n[1].now+t<i&&(n[0].level=n[1].level);var o=n[0].level,a=n[n.length-1],s=a.level,l=Math.min(o,s),u=Math.max(o,s),f=(a.level-n[1].level)/((a.now-n[1].now)/t),c=(i-a.now)/t*f;return e?{fadeSpeed:0,minfadeLevel:l,maxfadeLevel:u,fadeChange:0}:{fadeSpeed:f,minfadeLevel:l,maxfadeLevel:u,fadeChange:c}},e}();t.FadeRecorder=n}.apply(null,i))||(e.exports=n)},2536:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(94),r(827),r(24),r(474),r(354),r(356),r(472),r(807),r(2206)],void 0===(n=function(e,t,r,i,n,o,a,s,l,u,f){return l.enums.DataType,l.enums.PrimitiveType,l.enums.TextureSamplingMode,function(){function e(e){this._viewProjMat=o.mat4f32.create(),this._offsetVector=a.vec3f32.create(),this._patternMatrix=i.mat3f32.create(),this._color=s.vec4f32.create(),this._outlineColor=s.vec4f32.create(),this._initialized=!1,this._fillProgramOptions={id:!1,dd:!1,pattern:!1},this._outlineProgramOptions={id:!1,dd:!1},this._programCache=e}return e.prototype.dispose=function(){},e.prototype.render=function(e,t,r,i,o,a,s,l,c,d,h){if(0===t.triangleElementCount)return 0;this._initialized||this._initialize(e);var _=void 0!==s.getPaintValue("fill-pattern",r),p=s.hasDataDrivenColor?[1,1,1,1]:s.getPaintValue("fill-color",r),m=s.hasDataDrivenOpacity?1:s.getPaintValue("fill-opacity",r),v=m*p[3]*h;this._color[0]=v*p[0],this._color[1]=v*p[1],this._color[2]=v*p[2],this._color[3]=v;var g,y=3===o;y&&(g=f.int32To4Bytes(t.layerID));var x=a.tileTransform.transform,b=a.coordRange/512,D=s.getPaintValue("fill-translate",r);if(0!==D[0]||0!==D[1]){n.mat4.copy(this._viewProjMat,a.tileTransform.transform);var w=D[0],V=D[1],O=0,T=0,A=(1<<a.key.level)/Math.pow(2,r)*b;if(1===s.getPaintValue("fill-translate-anchor",r)){var P=-u.C_DEG_TO_RAD*i,z=Math.sin(P),C=Math.cos(P);O=A*(w*C-V*z),T=A*(w*z+V*C)}else O=A*w,T=A*V;this._offsetVector[0]=O,this._offsetVector[1]=T,this._offsetVector[2]=0,n.mat4.translate(this._viewProjMat,this._viewProjMat,this._offsetVector),x=this._viewProjMat}var M=this._drawFill(e,t,r,o,a,s,l,x,d,h,y,g);if(!(s.getPaintValue("fill-antialias",r)&&!_&&t.outlineElementCount>0)||1!==o&&3!==o)return M;var I=s.hasDataDrivenOutline;if(s.outlineUsesFillColor){if(1!==this._color[3])return t.triangleElementCount/3;this._outlineColor[0]=this._color[0],this._outlineColor[1]=this._color[1],this._outlineColor[2]=this._color[2],this._outlineColor[3]=this._color[3]}else{var B=s.hasDataDrivenOutlineColor?[1,1,1,1]:s.getPaintValue("fill-outline-color",r),R=m*B[3]*h;this._outlineColor[0]=R*B[0],this._outlineColor[1]=R*B[1],this._outlineColor[2]=R*B[2],this._outlineColor[3]=R}var j=.75/d,k=this._getOutlineVAO(e,a,I);if(!k)return M;e.bindVAO(k);var S=(y?1:0)<<1|(I?1:0),U=this._outlineProgramOptions;U.id=y,U.dd=I;var F=this._programCache.getProgram(2,S,U);return e.bindProgram(F),F.setUniformMatrix4fv("u_transformMatrix",x),F.setUniformMatrix4fv("u_extrudeMatrix",c),F.setUniform2fv("u_normalized_origin",a.tileTransform.displayCoord),F.setUniform1f("u_depth",s.z+1/65536),F.setUniform1f("u_outline_width",j),F.setUniform4fv("u_color",this._outlineColor),y&&F.setUniform4f("u_id",g[0],g[1],g[2],g[3]),e.drawElements(4,t.outlineElementCount,5125,12*t.outlineElementStart),e.bindVAO(),M+t.outlineElementCount/3},e.prototype._initialize=function(e){return!!this._initialized||(this._fillVertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:4,normalized:!1,divisor:0}]},this._fillVertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:8,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:4,stride:8,normalized:!0,divisor:0}]},this._outlineVertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:8,normalized:!1,divisor:0},{name:"a_offset",count:2,type:5120,offset:4,stride:8,normalized:!1,divisor:0},{name:"a_xnormal",count:2,type:5120,offset:6,stride:8,normalized:!1,divisor:0}]},this._outlineVertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:12,normalized:!1,divisor:0},{name:"a_offset",count:2,type:5120,offset:4,stride:12,normalized:!1,divisor:0},{name:"a_xnormal",count:2,type:5120,offset:6,stride:12,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:8,stride:12,normalized:!0,divisor:0}]},this._initialized=!0,!0)},e.prototype._drawFill=function(e,t,i,n,o,a,s,l,u,f,c,d){var h=a.getPaintValue("fill-pattern",i),_=void 0!==h,p=a.hasDataDrivenOpacity?1:f*a.getPaintValue("fill-opacity",i),m=a.hasDataDrivenColor?[1,1,1,1]:a.getPaintValue("fill-color",i),v=p*m[3]*f;this._color[0]=v*m[0],this._color[1]=v*m[1],this._color[2]=v*m[2],this._color[3]=v;var g=a.hasDataDrivenFill,y=_||v<1||g;if(y&&0===n)return 0;if(!y&&1===n)return 0;var x=this._getFillVAO(e,o,g);if(!x)return 0;e.bindVAO(x);var b=(c?1:0)<<2|(g?1:0)<<1|(_?1:0),D=this._fillProgramOptions;D.id=c,D.dd=g,D.pattern=_;var w=this._programCache.getProgram(1,b,D);if(e.bindProgram(w),_){var V=s.getMosaicItemPosition(h,!0);if(!V)return e.bindVAO(),void e.bindProgram();var O=o.coordRange/512/Math.pow(2,Math.round(i)-o.key.level)/u;r.mat3.identity(this._patternMatrix);var T=1/(V.size[0]*O),A=1/(V.size[1]*O);this._patternMatrix[0]=T,this._patternMatrix[4]=A,s.bind(e,9729,V.page,5),w.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix),w.setUniform2f("u_pattern_tl",V.tl[0],V.tl[1]),w.setUniform2f("u_pattern_br",V.br[0],V.br[1]),w.setUniform1i("u_texture",5)}return w.setUniformMatrix4fv("u_transformMatrix",l),w.setUniform2fv("u_normalized_origin",o.tileTransform.displayCoord),w.setUniform1f("u_depth",a.z+1/65536),w.setUniform4fv("u_color",this._color),c&&w.setUniform4f("u_id",d[0],d[1],d[2],d[3]),e.drawElements(4,t.triangleElementCount,5125,12*t.triangleElementStart),e.bindVAO(),t.triangleElementCount/3},e.prototype._getFillVAO=function(e,t,r){if(r){if(t.fillDDVertexArrayObject)return t.fillDDVertexArrayObject;var i=t.fillDDVertexBuffer,n=t.fillIndexBuffer;return i&&n?(t.fillDDVertexArrayObject=new l.VertexArrayObject(e,this._programCache.getProgramAttributes(1),this._fillVertexAttributesDD,{geometry:i},n),t.fillDDVertexArrayObject):null}if(t.fillVertexArrayObject)return t.fillVertexArrayObject;i=t.fillVertexBuffer,n=t.fillIndexBuffer;return i&&n?(t.fillVertexArrayObject=new l.VertexArrayObject(e,this._programCache.getProgramAttributes(1),this._fillVertexAttributes,{geometry:i},n),t.fillVertexArrayObject):null},e.prototype._getOutlineVAO=function(e,t,r){if(r){if(t.outlineDDVertexArrayObject)return t.outlineDDVertexArrayObject;var i=t.outlineDDVertexBuffer,n=t.outlineIndexBuffer;return i&&n?(t.outlineDDVertexArrayObject=new l.VertexArrayObject(e,this._programCache.getProgramAttributes(2),this._outlineVertexAttributesDD,{geometry:i},n),t.outlineDDVertexArrayObject):null}if(t.outlineVertexArrayObject)return t.outlineVertexArrayObject;i=t.outlineVertexBuffer,n=t.outlineIndexBuffer;return i&&n?(t.outlineVertexArrayObject=new l.VertexArrayObject(e,this._programCache.getProgramAttributes(2),this._outlineVertexAttributes,{geometry:i},n),t.outlineVertexArrayObject):null},e}()}.apply(null,i))||(e.exports=n)},2537:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(24),r(474),r(285),r(354),r(356),r(472),r(807),r(2206)],void 0===(n=function(e,t,r,i,n,o,a,s,l,u){return s.enums.DataType,s.enums.PrimitiveType,s.enums.TextureSamplingMode,function(){function e(e){this._initialized=!1,this._viewProjMat=i.mat4f32.create(),this._offsetVector=o.vec3f32.create(),this._color=a.vec4f32.create(),this._dashArray=n.vec2f32.create(),this._programOptions={id:!1,dd:!1,pattern:!1},this._programCache=e}return e.prototype.dispose=function(){},e.prototype.render=function(e,t,i,n,o,a,s,f,c,d,h){if(0===t.triangleElementCount)return 0;this._initialized||this._initialize(e);var _=a.tileTransform.transform,p=a.coordRange/512,m=s.getPaintValue("line-translate",i);if(0!==m[0]||0!==m[1]){r.mat4.copy(this._viewProjMat,a.tileTransform.transform);var v=m[0],g=m[1],y=0,x=0,b=(1<<a.key.level)/Math.pow(2,i)*p,D=o.rotation;if(1===s.getPaintValue("line-translate-anchor",i)){var w=-l.C_DEG_TO_RAD*D,V=Math.sin(w),O=Math.cos(w);y=b*(v*O-g*V),x=b*(v*V+g*O)}else y=b*v,x=b*g;this._offsetVector[0]=y,this._offsetVector[1]=x,this._offsetVector[2]=0,r.mat4.translate(this._viewProjMat,this._viewProjMat,this._offsetVector),_=this._viewProjMat}var T=s.getPaintValue("line-pattern",i),A=void 0!==T,P=1/d,z=s.getPaintValue("line-blur",i),C=s.hasDataDrivenColor?[1,1,1,1]:s.getPaintValue("line-color",i),M=s.hasDataDrivenOpacity?1:s.getPaintValue("line-opacity",i),I=s.hasDataDrivenWidth?1:s.getPaintValue("line-width",i),B=M*C[3]*h;this._color[0]=B*C[0],this._color[1]=B*C[1],this._color[2]=B*C[2],this._color[3]=B;var R,j=s.hasDataDrivenLine,k=3===n;k&&(R=u.int32To4Bytes(t.layerID));var S=this._getLineVAO(e,a,j);if(!S)return 0;e.bindVAO(S);var U=(k?1:0)<<2|(j?1:0)<<1|(A?1:0),F=this._programOptions;F.id=k,F.dd=j,F.pattern=A;var L=this._programCache.getProgram(3,U,F);if(e.bindProgram(L),L.setUniformMatrix4fv("u_transformMatrix",_),L.setUniformMatrix4fv("u_extrudeMatrix",c),L.setUniform2fv("u_normalized_origin",a.tileTransform.displayCoord),L.setUniform1f("u_depth",s.z),L.setUniform1f("u_blur",z),L.setUniform1f("u_antialiasing",P),L.setUniform4fv("u_color",this._color),L.setUniform1f("u_width",I),k&&L.setUniform4f("u_id",R[0],R[1],R[2],R[3]),A){var E=f.getMosaicItemPosition(T,!0);E&&(f.bind(e,9729,E.page,5),L.setUniform2f("u_pattern_tl",E.tl[0],E.br[1]),L.setUniform2f("u_pattern_br",E.br[0],E.tl[1]),L.setUniform2f("u_spriteSize",p*E.size[0],E.size[1]),L.setUniform1i("u_texture",5))}else{var W=s.getPaintValue("line-dasharray",i);W.length<2&&(W=[1,-1]);var N=p;this._dashArray[0]=N*W[0],this._dashArray[1]=N*W[1],L.setUniform2fv("u_dasharray",this._dashArray)}return e.drawElements(4,t.triangleElementCount,5125,12*t.triangleElementStart),e.bindVAO(),t.triangleCount()},e.prototype._initialize=function(e){return!!this._initialized||(this._vertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:12,normalized:!1,divisor:0},{name:"a_offsetAndNormal",count:4,type:5120,offset:4,stride:12,normalized:!1,divisor:0},{name:"a_accumulatedDistance",count:2,type:5123,offset:8,stride:12,normalized:!1,divisor:0}]},this._vertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:20,normalized:!1,divisor:0},{name:"a_offsetAndNormal",count:4,type:5120,offset:4,stride:20,normalized:!1,divisor:0},{name:"a_accumulatedDistance",count:2,type:5122,offset:8,stride:20,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:12,stride:20,normalized:!0,divisor:0},{name:"a_width",count:1,type:5126,offset:16,stride:20,normalized:!1,divisor:0}]},this._initialized=!0,!0)},e.prototype._getLineVAO=function(e,t,r){if(r){if(t.lineDDVertexArrayObject)return t.lineDDVertexArrayObject;var i=t.lineDDVertexBuffer,n=t.lineIndexBuffer;return i&&n?(t.lineDDVertexArrayObject=new s.VertexArrayObject(e,this._programCache.getProgramAttributes(3),this._vertexAttributesDD,{geometry:i},n),t.lineDDVertexArrayObject):null}if(t.lineVertexArrayObject)return t.lineVertexArrayObject;i=t.lineVertexBuffer,n=t.lineIndexBuffer;return i&&n?(t.lineVertexArrayObject=new s.VertexArrayObject(e,this._programCache.getProgramAttributes(3),this._vertexAttributes,{geometry:i},n),t.lineVertexArrayObject):null},e}()}.apply(null,i))||(e.exports=n)},2538:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(2539),r(2540)],void 0===(n=function(e,t,r,i){return function(){function e(e){this._iconRenderer=new r(e),this._sdfRenderer=new i(e)}return e.prototype.dispose=function(){this._iconRenderer&&(this._iconRenderer.dispose(),this._iconRenderer=null),this._sdfRenderer&&(this._sdfRenderer.dispose(),this._sdfRenderer=null)},e.prototype.render=function(e,t,r,i,n,o,a,s,l,u,f,c,d,h){return t.hasData()?(t.markerPerPageElementsMap.size>0&&this._iconRenderer.render(e,t,r,i,n,o,a,s,l,f,c,h),t.glyphPerPageElementsMap.size>0&&this._sdfRenderer.render(e,t,r,i,n,o,a,s,u,f,c,d,h),t.triangleCount()):0},e}()}.apply(null,i))||(e.exports=n)},2539:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(24),r(474),r(285),r(354),r(356),r(472),r(807),r(2206)],void 0===(n=function(e,t,r,i,n,o,a,s,l,u){return s.enums.DataType,s.enums.PrimitiveType,s.enums.TextureSamplingMode,function(){function e(e){this._viewProjMat=i.mat4f32.create(),this._offsetVector=o.vec3f32.create(),this._spritesTextureSize=n.vec2f32.create(),this._color=a.vec4f32.create(),this._initialized=!1,this._programOptions={id:!1,dd:!1,sdf:!1},this._programCache=e}return e.prototype.dispose=function(){},e.prototype.render=function(e,t,i,n,o,a,s,f,c,d,h,_){var p=this;this._initialized||this._initialize(e);var m=f.hasDataDrivenIconSize?1:f.getLayoutValue("icon-size",i),v=f.hasDataDrivenIconColor?[1,1,1,1]:f.getPaintValue("icon-color",i),g=f.hasDataDrivenIconOpacity?1:f.getPaintValue("icon-opacity",i),y=v[3]*g*_;this._color[0]=y*v[0],this._color[1]=y*v[1],this._color[2]=y*v[2],this._color[3]=y;var x=f.getLayoutValue("icon-rotation-alignment",i);2===x&&(x=1===f.getLayoutValue("symbol-placement",i)?0:1);var b=0===x,D=t.isSDF,w=f.hasDataDrivenIcon,V=3===n,O=l.degToByte(o),T=s.tileTransform.transform,A=f.getPaintValue("icon-translate",i);if(0!==A[0]||0!==A[1]){r.mat4.copy(this._viewProjMat,s.tileTransform.transform);var P=A[0],z=A[1],C=0,M=0,I=s.coordRange/512,B=(1<<s.key.level)/Math.pow(2,i)*I;if(1===f.getPaintValue("icon-translate-anchor",i)){var R=-l.C_DEG_TO_RAD*o,j=Math.sin(R),k=Math.cos(R);C=B*(P*k-z*j),M=B*(P*j+z*k)}else C=B*P,M=B*z;this._offsetVector[0]=C,this._offsetVector[1]=M,this._offsetVector[2]=0,r.mat4.translate(this._viewProjMat,this._viewProjMat,this._offsetVector),T=this._viewProjMat}var S=b?d:h,U=this._getIconVAO(e,s,w);if(U){e.bindVAO(U);var F=(V?1:0)<<2|(w?1:0)<<1|(D?1:0),L=this._programOptions;L.id=V,L.dd=w,L.sdf=D;var E=this._programCache.getProgram(4,F,L);if(e.bindProgram(E),D){var W=f.getPaintValue("icon-halo-color",i),N=f.getPaintValue("icon-halo-width",i);E.setUniform4f("u_outlineColor",W[0],W[1],W[2],W[3]),E.setUniform1f("u_outlineSize",N)}if(E.setUniformMatrix4fv("u_transformMatrix",T),E.setUniformMatrix4fv("u_extrudeMatrix",S),E.setUniform2fv("u_normalized_origin",s.tileTransform.displayCoord),E.setUniform1f("u_depth",f.z),E.setUniform1f("u_mapRotation",O),E.setUniform1f("u_keepUpright",0),E.setUniform1f("u_level",10*i),E.setUniform1f("u_fadeSpeed",10*a.fadeSpeed),E.setUniform1f("u_minfadeLevel",10*a.minfadeLevel),E.setUniform1f("u_maxfadeLevel",10*a.maxfadeLevel),E.setUniform1f("u_fadeChange",10*(i+a.fadeChange)),E.setUniform1i("u_texture",5),E.setUniform1f("u_size",m),E.setUniform4fv("u_color",this._color),V){var H=u.int32To4Bytes(t.layerID);E.setUniform4f("u_id",H[0],H[1],H[2],H[3])}t.markerPerPageElementsMap.forEach(function(t,r){p._spritesTextureSize[0]=c.getWidth(r)/4,p._spritesTextureSize[1]=c.getHeight(r)/4,E.setUniform2fv("u_mosaicSize",p._spritesTextureSize),c.bind(e,9729,r,5),e.drawElements(4,t[1],5125,12*t[0])}),e.bindVAO()}},e.prototype._initialize=function(e){return!!this._initialized||(this._vertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:16,normalized:!1,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:4,stride:16,normalized:!1,divisor:0},{name:"a_tex",count:4,type:5121,offset:8,stride:16,normalized:!1,divisor:0},{name:"a_levelInfo",count:4,type:5121,offset:12,stride:16,normalized:!1,divisor:0}]},this._vertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:24,normalized:!1,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:4,stride:24,normalized:!1,divisor:0},{name:"a_tex",count:4,type:5121,offset:8,stride:24,normalized:!1,divisor:0},{name:"a_levelInfo",count:4,type:5121,offset:12,stride:24,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:16,stride:24,normalized:!0,divisor:0},{name:"a_size",count:1,type:5126,offset:20,stride:24,normalized:!1,divisor:0}]},this._initialized=!0,!0)},e.prototype._getIconVAO=function(e,t,r){if(r){if(t.iconDDVertexArrayObject)return t.iconDDVertexArrayObject;var i=t.iconDDVertexBuffer,n=t.iconIndexBuffer;return i&&n?(t.iconDDVertexArrayObject=new s.VertexArrayObject(e,this._programCache.getProgramAttributes(4),this._vertexAttributesDD,{geometry:i},n),t.iconDDVertexArrayObject):null}if(t.iconVertexArrayObject)return t.iconVertexArrayObject;i=t.iconVertexBuffer,n=t.iconIndexBuffer;return i&&n?(t.iconVertexArrayObject=new s.VertexArrayObject(e,this._programCache.getProgramAttributes(4),this._vertexAttributes,{geometry:i},n),t.iconVertexArrayObject):null},e}()}.apply(null,i))||(e.exports=n)},2540:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(26),r(24),r(474),r(285),r(354),r(356),r(472),r(807),r(2206)],void 0===(n=function(e,t,r,i,n,o,a,s,l,u,f){return l.enums.DataType,l.enums.PrimitiveType,l.enums.TextureSamplingMode,function(){function e(e){this._viewProjMat=n.mat4f32.create(),this._offsetVector=a.vec3f32.create(),this._extrudeMat=n.mat4f32.create(),this._scaleVec=a.vec3f32.create(),this._haloColor=s.vec4f32.create(),this._sdfColor=s.vec4f32.create(),this._initialized=!1,this._programOptions={id:!1,dd:!1},this._programCache=e}return e.prototype.dispose=function(){},e.prototype.render=function(e,t,n,a,s,l,c,d,h,_,p,m,v){var g=this;if(!r("esri-vector-tiles-avoid-text")){this._initialized||this._initialize(e);var y=u.degToByte(s),x=d.getLayoutValue("text-rotation-alignment",n);2===x&&(x=1===d.getLayoutValue("symbol-placement",n)?0:1);var b=0===x,D=d.getLayoutValue("text-keep-upright",n)&&b,w=3===a,V=.8*3/m,O=d.hasDataDrivenTextSize?1:d.getLayoutValue("text-size",n),T=d.hasDataDrivenTextColor?[1,1,1,1]:d.getPaintValue("text-color",n),A=d.hasDataDrivenTextOpacity?1:d.getPaintValue("text-opacity",n),P=T[3]*A*v;this._sdfColor[0]=P*T[0],this._sdfColor[1]=P*T[1],this._sdfColor[2]=P*T[2],this._sdfColor[3]=P,this._glyphTextureSize||(this._glyphTextureSize=o.vec2f32.fromValues(h.width/4,h.height/4));var z=c.tileTransform.transform,C=d.getPaintValue("text-translate",n);if(0!==C[0]||0!==C[1]){i.mat4.copy(this._viewProjMat,c.tileTransform.transform);var M=C[0],I=C[1],B=0,R=0,j=c.coordRange/512,k=(1<<c.key.level)/Math.pow(2,n)*j;if(1===d.getPaintValue("text-translate-anchor",n)){var S=-u.C_DEG_TO_RAD*s,U=Math.sin(S),F=Math.cos(S);B=k*(M*F-I*U),R=k*(M*U+I*F)}else B=k*M,R=k*I;this._offsetVector[0]=B,this._offsetVector[1]=R,this._offsetVector[2]=0,i.mat4.translate(this._viewProjMat,this._viewProjMat,this._offsetVector),z=this._viewProjMat}b?i.mat4.copy(this._extrudeMat,_):i.mat4.copy(this._extrudeMat,p),this._scaleVec[0]=1/24,this._scaleVec[1]=1/24,this._scaleVec[2]=1,i.mat4.scale(this._extrudeMat,this._extrudeMat,this._scaleVec);var L=d.hasDataDrivenText,E=this._getSDFVAO(e,c,L);if(E){e.bindVAO(E);var W=(w?1:0)<<1|(L?1:0),N=this._programOptions;N.id=w,N.dd=L;var H=this._programCache.getProgram(6,W,N);if(e.bindProgram(H),H.setUniformMatrix4fv("u_transformMatrix",z),H.setUniformMatrix4fv("u_extrudeMatrix",this._extrudeMat),H.setUniform2fv("u_normalized_origin",c.tileTransform.displayCoord),H.setUniform1f("u_depth",d.z+1/65536),H.setUniform2fv("u_mosaicSize",this._glyphTextureSize),H.setUniform1f("u_mapRotation",y),H.setUniform1f("u_keepUpright",D?1:0),H.setUniform1f("u_level",10*n),H.setUniform1f("u_fadeSpeed",10*l.fadeSpeed),H.setUniform1f("u_minfadeLevel",10*l.minfadeLevel),H.setUniform1f("u_maxfadeLevel",10*l.maxfadeLevel),H.setUniform1f("u_fadeChange",10*(n+l.fadeChange)),H.setUniform1i("u_texture",6),H.setUniform1f("u_size",O),H.setUniform1f("u_antialiasingWidth",V),w){var q=f.int32To4Bytes(t.layerID);H.setUniform4f("u_id",q[0],q[1],q[2],q[3])}t.glyphPerPageElementsMap.forEach(function(t,r){g._renderGlyphRange(e,t,r,d,h,H,n,A*v,3)}),e.bindVAO()}}},e.prototype._renderGlyphRange=function(e,t,r,i,n,o,a,s,l){n.bind(e,9729,r,6);var u=i.getPaintValue("text-halo-color",a),f=i.getPaintValue("text-halo-width",a);if(u[3]>0&&f>0){var c=u[3]*s;this._haloColor[0]=c*u[0],this._haloColor[1]=c*u[1],this._haloColor[2]=c*u[2],this._haloColor[3]=c;var d=i.getPaintValue("text-halo-blur",a)*l,h=f*l;o.setUniform4fv("u_color",this._haloColor),o.setUniform1f("u_halo",1),o.setUniform1f("u_edgeDistance",h),o.setUniform1f("u_edgeBlur",d),e.drawElements(4,t[1],5125,12*t[0])}this._sdfColor[3]>0&&(o.setUniform4fv("u_color",this._sdfColor),o.setUniform1f("u_halo",0),o.setUniform1f("u_edgeDistance",0),o.setUniform1f("u_edgeBlur",0),e.drawElements(4,t[1],5125,12*t[0]))},e.prototype._initialize=function(e){return!!this._initialized||(this._vertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:16,normalized:!1,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:4,stride:16,normalized:!1,divisor:0},{name:"a_tex",count:4,type:5121,offset:8,stride:16,normalized:!1,divisor:0},{name:"a_levelInfo",count:4,type:5121,offset:12,stride:16,normalized:!1,divisor:0}]},this._vertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:24,normalized:!1,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:4,stride:24,normalized:!1,divisor:0},{name:"a_tex",count:4,type:5121,offset:8,stride:24,normalized:!1,divisor:0},{name:"a_levelInfo",count:4,type:5121,offset:12,stride:24,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:16,stride:24,normalized:!0,divisor:0},{name:"a_size",count:1,type:5126,offset:20,stride:24,normalized:!1,divisor:0}]},this._initialized=!0,!0)},e.prototype._getSDFVAO=function(e,t,r){if(r){if(t.textDDVertexArrayObject)return t.textDDVertexArrayObject;var i=t.textDDVertexBuffer,n=t.textIndexBuffer;return i&&n?(t.textDDVertexArrayObject=new l.VertexArrayObject(e,this._programCache.getProgramAttributes(6),this._vertexAttributesDD,{geometry:i},n),t.textDDVertexArrayObject):null}if(t.textVertexArrayObject)return t.textVertexArrayObject;i=t.textVertexBuffer,n=t.textIndexBuffer;return i&&n?(t.textVertexArrayObject=new l.VertexArrayObject(e,this._programCache.getProgramAttributes(6),this._vertexAttributes,{geometry:i},n),t.textVertexArrayObject):null},e}()}.apply(null,i))||(e.exports=n)},2541:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(356),r(472),r(807)],void 0===(n=function(e,t,r,i,n){return i.enums.CompareFunction,i.enums.DataType,i.enums.PixelFormat,i.enums.PixelType,i.enums.PrimitiveType,i.enums.TextureSamplingMode,i.enums.TextureType,i.enums.Usage,function(){function e(e){this._initialized=!1,this._color=r.vec4f32.fromValues(1,0,0,1),this._maxWidth=0,this._programOptions={id:!1,pattern:!1},this._programCache=e}return e.prototype.dispose=function(){this._outlineVertexArrayObject&&(this._outlineVertexArrayObject.dispose(),this._outlineVertexArrayObject=null),this._tileInfoVertexArrayObject&&(this._tileInfoVertexArrayObject.dispose(),this._tileInfoVertexArrayObject=null)},e.prototype.render=function(e,t){this._initialized||this._initialize(e);var r=this._programCache.getProgram(0,0,this._programOptions);if(r){e.bindVAO(this._outlineVertexArrayObject),e.bindProgram(r),r.setUniformMatrix4fv("u_transformMatrix",t.tileTransform.transform),r.setUniform2fv("u_normalized_origin",t.tileTransform.displayCoord),r.setUniform1f("u_coord_range",t.coordRange),r.setUniform1f("u_depth",0),r.setUniform4fv("u_color",this._color),e.drawArrays(3,0,4),e.bindVAO(),t.triangleCount>1e5&&(e.setStencilFunction(514,t.stencilData.reference,t.stencilData.mask),e.setStencilTestEnabled(!0),e.bindVAO(this._quadVertexArrayObject),r.setUniform4f("u_color",.9,0,0,.35),e.drawArrays(5,0,4),e.bindVAO(),e.setStencilTestEnabled(!1));var i=this._getTexture(e,t);if(i){var n=this._programCache.getProgram(7,0,null);n&&(e.bindVAO(this._tileInfoVertexArrayObject),e.bindProgram(n),e.bindTexture(i,0),n.setUniformMatrix4fv("u_transformMatrix",t.tileTransform.transform),n.setUniform2fv("u_normalized_origin",t.tileTransform.displayCoord),n.setUniform1f("u_depth",0),n.setUniform1f("u_coord_ratio",t.coordRange/512),n.setUniform2f("u_delta",8,8),n.setUniform2f("u_dimensions",i.descriptor.width,i.descriptor.height),e.drawArrays(5,0,4),e.bindVAO())}}},e.prototype._initialize=function(e){if(this._initialized)return!0;var t={geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:2,normalized:!1,divisor:0}]},r=new Int8Array([0,0,1,0,1,1,0,1]),n=i.BufferObject.createVertex(e,35044,r),o=new i.VertexArrayObject(e,this._programCache.getProgramAttributes(0),t,{geometry:n}),a=new Int8Array([0,0,0,1,1,0,1,1]),s=i.BufferObject.createVertex(e,35044,a),l=new i.VertexArrayObject(e,this._programCache.getProgramAttributes(0),t,{geometry:s}),u=new Int8Array([0,0,1,0,0,1,1,1]),f=i.BufferObject.createVertex(e,35044,u),c=new i.VertexArrayObject(e,this._programCache.getProgramAttributes(7),t,{geometry:f});return this._outlineVertexArrayObject=o,this._quadVertexArrayObject=l,this._tileInfoVertexArrayObject=c,this._initialized=!0,!0},e.prototype._getTexture=function(e,t){if(t.texture)return t.texture;this._canvas||(this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","canvas2d"),this._canvas.setAttribute("width","512"),this._canvas.setAttribute("height","32"),this._canvas.setAttribute("style","display:none"));var r=t.key.id+", "+t.triangleCount,o=this._canvas.getContext("2d");o.font="24px sans-serif",o.textAlign="left",o.textBaseline="middle";var a=o.measureText(r),s=Math.pow(2,Math.ceil(n.log2(a.width+2)));s>this._maxWidth&&(this._maxWidth=s),o.clearRect(0,0,this._maxWidth,32),o.fillStyle="blue";var l,u=0,f=0;if(t.refKeys)for(var c=0,d=Object.keys(t.refKeys);c<d.length;c++){var h=d[c],_=t.refKeys[h].match(/\d+/);l=parseInt(_[0],10),isNaN(l)||(f++,t.key.level>l&&u++)}return u===f?o.fillStyle="red":u>0&&(o.fillStyle="purple"),o.fillText(r,0,16),t.texture=new i.Texture(e,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728},this._canvas),t.texture},e}()}.apply(null,i))||(e.exports=n)},2542:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(472),r(2543)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this._cache=new Array(8);for(var e=0;e<8;e++)this._cache[e]={}}return e.prototype.dispose=function(){this._programRepo&&(this._programRepo.dispose(),this._programRepo=null)},e.prototype.getProgram=function(e,t,r){var i=this._cache[e];if(!i[t]){var n=this._programRepo.getProgram(this._getProgramTemplate(e),r);i[t]=n}return i[t]},e.prototype.getProgramAttributes=function(e){switch(e){case 0:return i.background.attributes;case 5:return i.circle.attributes;case 1:return i.fill.attributes;case 4:return i.icon.attributes;case 3:return i.line.attributes;case 2:return i.outline.attributes;case 6:return i.text.attributes;case 7:return i.tileInfo.attributes}},e.prototype.initialize=function(e){this._programRepo||(this._programRepo=new r.ProgramCache(e))},e.prototype._getProgramTemplate=function(e){switch(e){case 0:return i.background;case 5:return i.circle;case 1:return i.fill;case 4:return i.icon;case 3:return i.line;case 2:return i.outline;case 6:return i.text;case 7:return i.tileInfo}},e}();t.default=n}.apply(null,i))||(e.exports=n)},2543:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(472),r(2544)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});var n=function(e){return r.glslifyDefineMap({ID:e.id,PATTERN:e.pattern})};t.background={name:"background",shaders:function(e){return{vertexShader:n(e)+i.resolveIncludes("background/background.vert"),fragmentShader:n(e)+i.resolveIncludes("background/background.frag")}},attributes:{a_pos:0}};var o=function(e){return r.glslifyDefineMap({ID:e.id})};t.circle={name:"circle",shaders:function(e){return{vertexShader:o(e)+i.resolveIncludes("circle/circle.vert"),fragmentShader:o(e)+i.resolveIncludes("circle/circle.frag")}},attributes:{a_pos:0,a_color:1,a_stroke_color:2,a_data:3}};var a=function(e){return r.glslifyDefineMap({ID:e.id,DD:e.dd,PATTERN:e.pattern})};t.fill={name:"fill",shaders:function(e){return{vertexShader:a(e)+i.resolveIncludes("fill/fill.vert"),fragmentShader:a(e)+i.resolveIncludes("fill/fill.frag")}},attributes:{a_pos:0,a_color:1}};var s=function(e){return r.glslifyDefineMap({ID:e.id,DD:e.dd})};t.outline={name:"outline",shaders:function(e){return{vertexShader:s(e)+i.resolveIncludes("outline/outline.vert"),fragmentShader:s(e)+i.resolveIncludes("outline/outline.frag")}},attributes:{a_pos:0,a_offset:1,a_xnormal:2,a_color:3}};var l=function(e){return r.glslifyDefineMap({ID:e.id,DD:e.dd,SDF:e.sdf})};t.icon={name:"icon",shaders:function(e){return{vertexShader:l(e)+i.resolveIncludes("icon/icon.vert"),fragmentShader:l(e)+i.resolveIncludes("icon/icon.frag")}},attributes:{a_pos:0,a_vertexOffset:1,a_tex:2,a_levelInfo:3,a_color:4,a_size:5}};var u=function(e){return r.glslifyDefineMap({ID:e.id,DD:e.dd,PATTERN:e.pattern})};t.line={name:"line",shaders:function(e){return{vertexShader:u(e)+i.resolveIncludes("line/line.vert"),fragmentShader:u(e)+i.resolveIncludes("line/line.frag")}},attributes:{a_pos:0,a_offsetAndNormal:1,a_accumulatedDistance:2,a_color:3,a_width:4}};var f=function(e){return r.glslifyDefineMap({ID:e.id,DD:e.dd})};t.text={name:"text",shaders:function(e){return{vertexShader:f(e)+i.resolveIncludes("text/text.vert"),fragmentShader:f(e)+i.resolveIncludes("text/text.frag")}},attributes:{a_pos:0,a_vertexOffset:1,a_tex:2,a_levelInfo:3,a_color:4,a_size:5}},t.tileInfo={name:"tileInfo",shaders:{vertexShader:i.resolveIncludes("tileInfo/tileInfo.vert"),fragmentShader:i.resolveIncludes("tileInfo/tileInfo.frag")},attributes:{a_pos:0}}}.apply(null,i))||(e.exports=n)},2544:function(e,t,r){var i,n;i=[r.dj.c(e.i),t,r(472),r(2545)],void 0===(n=function(e,t,r,i){Object.defineProperty(t,"__esModule",{value:!0});var n=new r.ShaderCompiler(function(e){var t=i;return e.split("/").forEach(function(e){t&&(t=t[e])}),t});t.resolveIncludes=function(e){return n.resolveIncludes(e)}}.apply(null,i))||(e.exports=n)},2545:function(e,t,r){var i,n;i=[r.dj.c(e.i),t],void 0===(n=function(e,t){return{background:{"background.frag":"#ifdef PATTERN\nuniform lowp float u_opacity;\nuniform mediump vec2 u_pattern_tl;\nuniform mediump vec2 u_pattern_br;\nuniform sampler2D u_texture;\nvarying mediump vec2 v_tileTextureCoord;\n#else\nuniform lowp vec4 u_color;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main() {\n#ifdef PATTERN\n  mediump vec2 normalizedTextureCoord = mod(v_tileTextureCoord, 1.0);\n  mediump vec2 samplePos = mix(u_pattern_tl, u_pattern_br, normalizedTextureCoord);\n  lowp vec4 color = texture2D(u_texture, samplePos);\n  gl_FragColor = u_opacity * color;\n#else\n  gl_FragColor = u_color;\n#endif\n#ifdef ID\n  if (gl_FragColor.a < 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor = v_id;\n#endif\n}","background.vert":"precision mediump float;\nattribute vec2 a_pos;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat4 u_transformMatrix;\nuniform mediump vec2 u_normalized_origin;\nuniform mediump float u_coord_range;\nuniform mediump float u_depth;\n#ifdef PATTERN\nuniform mediump mat3 u_pattern_matrix;\nvarying mediump vec2 v_tileTextureCoord;\n#endif\nvoid main() {\n  gl_Position = vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(u_coord_range * a_pos, 0.0, 1.0);\n#ifdef PATTERN\n  v_tileTextureCoord = (u_pattern_matrix * vec3(a_pos, 1.0)).xy;\n#endif\n#ifdef ID\n  v_id = u_id / 255.0;\n#endif\n}"},circle:{"circle.frag":"precision lowp float;\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\n  mediump float dist = length(v_offset);\n  mediump float alpha = smoothstep(0.0, -v_blur, dist - 1.0);\n  lowp float color_mix_ratio = v_stroke_width < 0.01 ? 0.0 : smoothstep(-v_blur, 0.0, dist - v_radius / (v_radius + v_stroke_width));\n  gl_FragColor = alpha * mix(v_color, v_stroke_color, color_mix_ratio);\n#ifdef ID\n  if (gl_FragColor.a < 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor = v_id;\n#endif\n}","circle.vert":"precision mediump float;\nattribute vec2 a_pos;\nattribute vec4 a_color;\nattribute vec4 a_stroke_color;\nattribute vec4 a_data;\nconst float sizePrecision = 0.25;\nconst float blurPrecision = 0.03125;\nvarying lowp vec4 v_color;\nvarying lowp vec4 v_stroke_color;\nvarying mediump float v_blur;\nvarying mediump float v_stroke_width;\nvarying mediump float v_radius;\nvarying mediump vec2 v_offset;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat4 u_transformMatrix;\nuniform highp mat4 u_extrudeMatrix;\nuniform highp vec2 u_normalized_origin;\nuniform mediump float u_depth;\nuniform mediump float u_radius;\nuniform lowp vec4 u_color;\nuniform mediump float u_blur;\nuniform mediump float u_stroke_width;\nuniform lowp vec4 u_stroke_color;\nuniform mediump float u_antialiasingWidth;\nvoid main()\n{\n  v_color = a_color * u_color;\n  v_stroke_color = a_stroke_color * u_stroke_color;\n  v_stroke_width = a_data[1] * sizePrecision * u_stroke_width;\n  v_radius = a_data[2] * u_radius;\n  v_blur = max(a_data[0] * blurPrecision + u_blur, u_antialiasingWidth / (v_radius + v_stroke_width));\n  mediump vec2 offset = vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\n  v_offset = offset;\n#ifdef ID\n  v_id = u_id / 255.0;\n#endif\n  gl_Position = vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(a_pos * 0.5, 0.0, 1.0) + u_extrudeMatrix * (v_radius + v_stroke_width) * vec4(offset, 0.0, 0.0);\n}"},fill:{"fill.frag":"precision lowp float;\n#ifdef PATTERN\nuniform mediump vec2 u_pattern_tl;\nuniform mediump vec2 u_pattern_br;\nuniform lowp sampler2D u_texture;\nvarying mediump vec2 v_tileTextureCoord;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvec4 mixColors(vec4 color1, vec4 color2) {\n  float compositeAlpha = color2.a + color1.a * (1.0 - color2.a);\n  vec3 compositeColor = color2.rgb + color1.rgb * (1.0 - color2.a);\n  return vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef PATTERN\n  mediump vec2 normalizedTextureCoord = mod(v_tileTextureCoord, 1.0);\n  mediump vec2 samplePos = mix(u_pattern_tl, u_pattern_br, normalizedTextureCoord);\n  lowp vec4 color = texture2D(u_texture, samplePos);\n  gl_FragColor = v_color[3] * color;\n#else\n  gl_FragColor = v_color;\n#endif\n#ifdef ID\n  if (gl_FragColor.a < 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor = v_id;\n#endif\n}","fill.vert":"precision mediump float;\nattribute vec2 a_pos;\nuniform highp mat4 u_transformMatrix;\nuniform highp vec2 u_normalized_origin;\nuniform mediump float u_depth;\n#ifdef PATTERN\nuniform mediump mat3 u_pattern_matrix;\nvarying mediump vec2 v_tileTextureCoord;\n#endif\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\n#ifdef DD\nattribute vec4 a_color;\n#endif\nuniform lowp vec4 u_color;\nvarying lowp vec4 v_color;\nvoid main()\n{\n#ifdef DD\n  v_color = a_color * u_color;\n#else\n  v_color = u_color;\n#endif\n#ifdef ID\n  v_id = u_id / 255.0;\n#endif\n#ifdef PATTERN\n  v_tileTextureCoord = (u_pattern_matrix * vec3(a_pos, 1.0)).xy;\n#endif\n  gl_Position = vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(a_pos, 0, 1.0);\n}"},icon:{"icon.frag":"precision mediump float;\nuniform lowp sampler2D u_texture;\n#ifdef SDF\nuniform lowp vec4 u_color;\nuniform lowp vec4 u_outlineColor;\nuniform mediump float u_outlineSize;\n#endif\nvarying mediump vec2 v_tex;\nvarying lowp float v_transparency;\nvarying mediump vec2 v_size;\nvarying lowp vec4 v_color;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\n#include <util/encoding.glsl>\nvec4 mixColors(vec4 color1, vec4 color2) {\n  float compositeAlpha = color2.a + color1.a * (1.0 - color2.a);\n  vec3 compositeColor = color2.rgb + color1.rgb * (1.0 - color2.a);\n  return vec4(compositeColor, compositeAlpha);\n}\nvoid main()\n{\n#ifdef SDF\n  lowp vec4 fillPixelColor = v_color;\n  float d = rgba2float(texture2D(u_texture, v_tex)) - 0.5;\n  const float sofetEdgeRatio = 0.248062016;\n  float size = max(v_size.x, v_size.y);\n  float dist = d * sofetEdgeRatio * size;\n  fillPixelColor *= clamp(0.5 - dist, 0.0, 1.0);\n  if (u_outlineSize > 0.25) {\n    lowp vec4 outlinePixelColor = u_outlineColor;\n    const float outlineLimitRatio = (16.0 / 86.0);\n    float clampedOutlineSize = sofetEdgeRatio * min(u_outlineSize, outlineLimitRatio * max(v_size.x, v_size.y));\n    outlinePixelColor *= clamp(0.5 - (abs(dist) - clampedOutlineSize), 0.0, 1.0);\n    gl_FragColor = v_transparency * mixColors(fillPixelColor, outlinePixelColor);\n  }\n  else {\n    gl_FragColor = v_transparency * fillPixelColor;\n  }\n#else\n  lowp vec4 texColor = texture2D(u_texture, v_tex);\n  gl_FragColor = v_transparency * texColor;\n#endif\n#ifdef ID\n  if (gl_FragColor.a < 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor = v_id;\n#endif\n}","icon.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_tex;\nattribute vec4 a_levelInfo;\n#ifdef DD\nattribute vec4 a_color;\nattribute mediump float a_size;\n#endif\nuniform lowp vec4 u_color;\nuniform mediump float u_size;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nuniform highp mat4 u_transformMatrix;\nuniform highp mat4 u_extrudeMatrix;\nuniform highp vec2 u_normalized_origin;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeSpeed;\nuniform mediump float u_minfadeLevel;\nuniform mediump float u_maxfadeLevel;\nuniform mediump float u_fadeChange;\nuniform mediump float u_opacity;\nvarying mediump vec2 v_tex;\nvarying lowp float v_transparency;\nvarying mediump vec2 v_size;\nconst float C_OFFSET_PRECISION = 1.0 / 8.0;\nconst float C_256_TO_RAD = 3.14159265359 / 128.0;\nconst float C_DEG_TO_RAD = 3.14159265359 / 180.0;\nconst float tileCoordRatio = 1.0 / 8.0;\nvoid main()\n{\n  mediump float a_labelMinLevel = a_levelInfo[0];\n  mediump float a_angle         = a_levelInfo[1];\n  mediump float a_minLevel      = a_levelInfo[2];\n  mediump float a_maxLevel      = a_levelInfo[3];\n  mediump float delta_z = 0.0;\n  mediump float rotated = mod(a_angle + u_mapRotation, 256.0);\n  delta_z += (1.0 - step(u_keepUpright, 0.0)) * step(64.0, rotated) * (1.0 - step(192.0, rotated));\n  delta_z += 1.0 - step(a_minLevel, u_level);\n  delta_z += step(a_maxLevel, u_level);\n  lowp float alpha = clamp((u_fadeChange - a_labelMinLevel) / u_fadeSpeed, 0.0, 1.0);\n  v_transparency = (u_fadeSpeed >= 0.0 ? alpha : 1.0 - alpha);\n  if (u_maxfadeLevel < a_labelMinLevel)\n  {\n    v_transparency = 0.0;\n  }\n  if (u_minfadeLevel >= a_labelMinLevel)\n  {\n    v_transparency = 1.0;\n  }\n  delta_z += step(v_transparency, 0.0);\n  vec2 offset = C_OFFSET_PRECISION * a_vertexOffset;\n  v_size = abs(offset);\n#ifdef SDF\n  offset = (120.0 / 86.0) * offset;\n#endif\n#ifdef DD\n  mediump float icon_size = a_size * u_size;\n#else\n  mediump float icon_size = u_size;\n#endif\n  gl_Position = vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(a_pos, 0.0, 1.0) + u_extrudeMatrix * icon_size * vec4(offset, delta_z, 0.0);\n#ifdef DD\n  v_color = a_color * u_color;\n#else\n  v_color = u_color;\n#endif\n#ifdef ID\n  v_id = u_id / 255.0;\n#endif\n  v_tex = a_tex.xy / u_mosaicSize;\n  v_transparency *= v_color.w;\n}"},line:{"line.frag":"varying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nvarying mediump float v_lineHalfWidth;\nvarying lowp vec4 v_color;\nvarying mediump float v_blur;\n#ifdef PATTERN\nuniform mediump vec2 u_pattern_tl;\nuniform mediump vec2 u_pattern_br;\nuniform mediump vec2 u_spriteSize;\nuniform sampler2D u_texture;\nconst mediump float tileCoordRatio = 8.0;\n#else\nvarying mediump vec2 v_dasharray;\n#endif\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\n  mediump float fragDist = length(v_normal) * v_lineHalfWidth;\n  lowp float alpha = clamp((v_lineHalfWidth - fragDist) / v_blur, 0.0, 1.0);\n#ifdef PATTERN\n  mediump float relativeTexX = mod((v_accumulatedDistance + v_normal.x * v_lineHalfWidth * tileCoordRatio) / u_spriteSize.x, 1.0);\n  mediump float relativeTexY = 0.5 + (v_normal.y * v_lineHalfWidth / u_spriteSize.y);\n  mediump vec2 texCoord = mix(u_pattern_tl, u_pattern_br, vec2(relativeTexX, relativeTexY));\n  lowp vec4 color = texture2D(u_texture, texCoord);\n  gl_FragColor = alpha * v_color[3] * color;\n#else\n  lowp float dashPos =  mod(v_accumulatedDistance, v_dasharray.x + v_dasharray.y);\n  lowp float dashAlpha = clamp(min(dashPos, v_dasharray.x - dashPos) + 0.5, 0.0, 1.0);\n  dashAlpha = max(sign(-v_dasharray.y), dashAlpha);\n  alpha *= dashAlpha;\n  gl_FragColor = alpha * v_color;\n#endif\n#ifdef ID\n  if (gl_FragColor.a < 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor = v_id;\n#endif\n}","line.vert":"attribute vec2 a_pos;\nattribute vec4 a_offsetAndNormal;\nattribute vec2 a_accumulatedDistance;\nuniform highp mat4 u_transformMatrix;\nuniform highp mat4 u_extrudeMatrix;\nuniform highp vec2 u_normalized_origin;\nuniform mediump float u_blur;\nuniform mediump float u_antialiasing;\nuniform mediump float u_depth;\nvarying mediump vec2 v_normal;\nvarying highp float v_accumulatedDistance;\nconst float scale = 1.0 / 31.0;\n#ifdef DD\nattribute vec4 a_color;\nattribute mediump float a_width;\n#endif\nuniform lowp vec4 u_color;\nuniform mediump float u_width;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nvarying lowp vec4 v_color;\nvarying mediump float v_lineHalfWidth;\nvarying mediump float v_blur;\n#ifndef PATTERN\nuniform mediump vec2 u_dasharray;\nvarying mediump vec2 v_dasharray;\n#endif\nvoid main()\n{\n  v_normal = a_offsetAndNormal.zw * scale;\n#ifdef DD\n  v_lineHalfWidth = a_width * u_width;\n#else\n  v_lineHalfWidth = u_width;\n#endif\n  v_lineHalfWidth += u_antialiasing;\n  v_lineHalfWidth *= 0.5;\n#ifndef PATTERN\n#ifdef DD\n  v_dasharray = u_dasharray * a_width;\n#else\n  v_dasharray = u_dasharray * u_width;\n#endif\n#endif\n  mediump vec2 dist = v_lineHalfWidth * a_offsetAndNormal.xy * scale;\n  gl_Position = vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(a_pos, 0.0, 1.0) + u_extrudeMatrix * vec4(dist, 0.0, 0.0);\n  v_accumulatedDistance = a_accumulatedDistance.x;\n  v_blur = u_blur + u_antialiasing;\n  #ifdef DD\n    v_color = a_color * u_color;\n  #else\n    v_color = u_color;\n  #endif\n  #ifdef ID\n    v_id = u_id / 255.0;\n  #endif\n}"},outline:{"outline.frag":"varying lowp vec4 v_color;\nvarying mediump vec2 v_normal;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\n  lowp float dist = abs(v_normal.y);\n  lowp float alpha = smoothstep(1.0, 0.0, dist);\n  gl_FragColor = alpha * v_color;\n#ifdef ID\n  if (gl_FragColor.a < 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor = v_id;\n#endif\n}","outline.vert":"attribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_xnormal;\n#ifdef DD\nattribute vec4 a_color;\n#endif\nuniform lowp vec4 u_color;\nvarying lowp vec4 v_color;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat4 u_transformMatrix;\nuniform highp mat4 u_extrudeMatrix;\nuniform highp vec2 u_normalized_origin;\nuniform mediump float u_depth;\nuniform mediump float u_outline_width;\nvarying lowp vec2 v_normal;\nconst float scale = 1.0 / 15.0;\nvoid main()\n{\n#ifdef DD\n  v_color = a_color * u_color;\n#else\n  v_color = u_color;\n#endif\n#ifdef ID\n  v_id = u_id / 255.0;\n#endif\n  v_normal = a_xnormal;\n  mediump vec4 dist = vec4(u_outline_width * a_offset * scale, 0.0, 0.0);\n  gl_Position = vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(a_pos, 0.0, 1.0) + u_extrudeMatrix * dist;\n}"},text:{"text.frag":"uniform lowp sampler2D u_texture;\nuniform mediump float u_edgeDistance;\nvarying lowp vec2 v_tex;\nvarying lowp float v_transparency;\nvarying lowp vec4 v_color;\nvarying mediump float v_edgeWidth;\nvarying mediump float v_edgeDistance;\n#ifdef ID\nvarying mediump vec4 v_id;\n#endif\nvoid main()\n{\n  lowp float dist = texture2D(u_texture, v_tex).a;\n  mediump float alpha = smoothstep(v_edgeDistance - v_edgeWidth, v_edgeDistance + v_edgeWidth, dist) * v_transparency;\n  gl_FragColor = alpha * v_color;\n#ifdef ID\n  if (gl_FragColor.a < 1.0 / 255.0) {\n    discard;\n  }\n  gl_FragColor = v_id;\n#endif\n}","text.vert":"attribute vec2 a_pos;\nattribute vec2 a_vertexOffset;\nattribute vec4 a_tex;\nattribute vec4 a_levelInfo;\nuniform lowp vec4 u_color;\n#ifdef DD\nattribute vec4 a_color;\n#endif\nvarying lowp vec4 v_color;\nuniform mediump float u_size;\n#ifdef DD\nattribute mediump float a_size;\n#endif\nvarying mediump float v_size;\n#ifdef ID\nuniform mediump vec4 u_id;\nvarying mediump vec4 v_id;\n#endif\nuniform highp mat4 u_transformMatrix;\nuniform highp mat4 u_extrudeMatrix;\nuniform highp vec2 u_normalized_origin;\nuniform vec2 u_mosaicSize;\nuniform mediump float u_depth;\nuniform mediump float u_mapRotation;\nuniform mediump float u_level;\nuniform lowp float u_keepUpright;\nuniform mediump float u_fadeSpeed;\nuniform mediump float u_minfadeLevel;\nuniform mediump float u_maxfadeLevel;\nuniform mediump float u_fadeChange;\nuniform mediump float u_opacity;\nvarying lowp vec2 v_tex;\nvarying lowp float v_transparency;\nconst float offsetPrecision = 1.0 / 8.0;\nconst mediump float edgePos = 0.75;\nuniform mediump float u_edgeDistance;\nuniform mediump float u_edgeBlur;\nuniform mediump float u_antialiasingWidth;\nvarying mediump float v_edgeDistance;\nvarying mediump float v_edgeWidth;\nuniform lowp float u_halo;\nvoid main()\n{\n  mediump float a_labelMinLevel = a_levelInfo[0];\n  mediump float a_angle        = a_levelInfo[1];\n  mediump float a_minLevel    = a_levelInfo[2];\n  mediump float a_maxLevel    = a_levelInfo[3];\n  mediump float delta_z = 0.0;\n  mediump float rotated = mod(a_angle + u_mapRotation, 256.0);\n  delta_z += (1.0 - step(u_keepUpright, 0.0)) * step(64.0, rotated) * (1.0 - step(192.0, rotated));\n  delta_z += 1.0 - step(a_minLevel, u_level);\n  delta_z += step(a_maxLevel, u_level);\n  lowp float alpha = clamp((u_fadeChange - a_labelMinLevel) / u_fadeSpeed, 0.0, 1.0);\n  v_transparency = (u_fadeSpeed >= 0.0 ? alpha : 1.0 - alpha);\n  if (u_maxfadeLevel < a_labelMinLevel)\n  {\n    v_transparency = 0.0;\n  }\n  if (u_minfadeLevel >= a_labelMinLevel)\n  {\n    v_transparency = 1.0;\n  }\n  delta_z += step(v_transparency, 0.0);\n  v_tex = a_tex.xy / u_mosaicSize;\n#ifdef DD\n  if (u_halo > 0.5)\n  {\n    v_color = u_color;\n  }\n  else\n  {\n    v_color = a_color * u_color;\n  }\n#else\n  v_color = u_color;\n#endif\n#ifdef DD\n  v_size = a_size * u_size;\n#else\n  v_size = u_size;\n#endif\n#ifdef ID\n  v_id = u_id / 255.0;\n#endif\n  v_edgeDistance = edgePos - u_edgeDistance / v_size;\n  v_edgeWidth = (u_antialiasingWidth + u_edgeBlur) / v_size;\n  gl_Position = vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(a_pos, 0.0, 1.0) + u_extrudeMatrix * v_size * vec4(offsetPrecision * a_vertexOffset, delta_z, 0.0);\n}"},tileInfo:{"tileInfo.frag":"uniform mediump sampler2D u_texture;\nvarying mediump vec2 v_tex;\nvoid main(void) {\n  lowp vec4 color = texture2D(u_texture, v_tex);\n  gl_FragColor = 0.75 * color;\n}","tileInfo.vert":"attribute vec2 a_pos;\nuniform highp mat4 u_transformMatrix;\nuniform mediump vec2 u_normalized_origin;\nuniform mediump float u_depth;\nuniform mediump float u_coord_ratio;\nuniform mediump vec2 u_delta;\nuniform mediump vec2 u_dimensions;\nvarying mediump vec2 v_tex;\nvoid main() {\n  mediump vec2 offests = u_coord_ratio * vec2(u_delta + a_pos * u_dimensions);\n  gl_Position = vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(offests, 0.0, 1.0);\n  v_tex = a_pos;\n}"},util:{"encoding.glsl":"const vec4 rgba2float_factors = vec4(\n    255.0 / (256.0),\n    255.0 / (256.0 * 256.0),\n    255.0 / (256.0 * 256.0 * 256.0),\n    255.0 / (256.0 * 256.0 * 256.0 * 256.0)\n  );\nfloat rgba2float(vec4 rgba) {\n  return dot(rgba, rgba2float_factors);\n}"}}}.apply(null,i))||(e.exports=n)}}]);