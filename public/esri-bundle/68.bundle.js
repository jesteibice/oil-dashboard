(function(){(this||window).webpackJsonp.registerAbsMids({"esri/views/layers/support/popupUtils":2188,"esri/views/3d/layers/support/DefinitionExpressionSceneLayerView":2222,"esri/views/3d/layers/support/fieldProperties":2223,"esri/views/3d/layers/BuildingSublayerView3D":2346,"esri/views/3d/layers/BuildingSceneLayerView3D":2664,"esri/views/3d/layers/BuildingComponentSublayerView3D":2665,"esri/views/3d/layers/BuildingGroupSublayerView3D":2666})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[68],{2188:function(e,r,i){var t,n;t=[i.dj.c(e.i),r,i(9),i(11),i(135),i(14),i(87)],void 0===(n=function(e,r,i,t,n,o,s){Object.defineProperty(r,"__esModule",{value:!0}),r.getRequiredFields=function(e,r){return void 0===r&&(r=e.popupTemplate),t(this,void 0,void 0,function(){var t,l,p,a,u,d,c,y,f,h,g;return i(this,function(i){switch(i.label){case 0:return o.isSome(r)?[4,r.getRequiredFields(e.fields)]:[2,[]];case 1:return t=i.sent(),l=r.lastEditInfoEnabled,p=e.objectIdField,a=e.typeIdField,n.includes(t,"*")?[2,["*"]]:(d=s.fixFields,c=[e.fields],f=(y=t).concat,h=[[a]],(g=l)?[4,s.getFeatureEditFields(e)]:[3,3]);case 2:g=i.sent(),i.label=3;case 3:return(u=d.apply(void 0,c.concat([f.apply(y,h.concat([g||null]))])))&&p&&s.hasField(e.fields,p)&&-1===u.indexOf(p)&&u.push(p),[2,u]}})})},r.getFetchPopupTemplate=function(e,r){return e.popupTemplate?e.popupTemplate:o.isSome(r)&&r.defaultPopupTemplateEnabled&&o.isSome(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}}.apply(null,t))||(e.exports=n)},2222:function(e,r,i){var t,n;t=[i.dj.c(e.i),r,i(1),i(0),i(8),i(13),i(2),i(355),i(2182)],void 0===(n=function(e,r,i,t,n,o,s,l,p){Object.defineProperty(r,"__esModule",{value:!0});var a=o.getLogger("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView"),u=function(e){function r(){var r=null!==e&&e.apply(this,arguments)||this;return r._definitionExpressionErrors=0,r._maxDefinitionExpressionErrors=20,r.logError=function(e){r._definitionExpressionErrors<r._maxDefinitionExpressionErrors&&a.error("Error while evaluating definitionExpression: "+e),++r._definitionExpressionErrors===r._maxDefinitionExpressionErrors&&a.error("Further errors are ignored")},r}return i(r,e),Object.defineProperty(r.prototype,"parsedDefinitionExpression",{get:function(){if(this.layer.definitionExpression)try{var e=l.WhereClause.create(this.layer.definitionExpression,this.layer.fieldsIndex);if(!e.isStandardized)return a.error("definitionExpression is using non standard function"),null;var r=[],i=e.fieldNames;return p.findFieldsCaseInsensitive(i,this.layer.fields,{missingFields:r}),r.length>0?(a.error("definitionExpression references unknown fields: "+r.join(", ")),null):(this._definitionExpressionErrors=0,e)}catch(e){return a.error("Failed to parse definitionExpression: "+e),null}return null},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"definitionExpressionFields",{get:function(){return this.parsedDefinitionExpression?this.parsedDefinitionExpression.fieldNames:null},enumerable:!0,configurable:!0}),r.prototype._evaluateClause=function(e,r){try{return e.testFeature(r)}catch(e){return this.logError(e),!1}},r.prototype._addDefinitionExpressionToQuery=function(e){if(!this.parsedDefinitionExpression)return e;var r=this.layer.definitionExpression,i=e.clone();return i.where?i.where="("+r+") AND ("+i.where+")":i.where=r,i},t([s.property()],r.prototype,"layer",void 0),t([s.property({readOnly:!0,dependsOn:["layer.definitionExpression","layer.fieldsIndex"]})],r.prototype,"parsedDefinitionExpression",null),t([s.property({readOnly:!0,dependsOn:["parsedDefinitionExpression"]})],r.prototype,"definitionExpressionFields",null),t([s.subclass("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView")],r)}(s.declared(n));r.DefinitionExpressionSceneLayerView=u,r.default=u}.apply(null,t))||(e.exports=n)},2223:function(e,r,i){var t,n;t=[i.dj.c(e.i),r,i(87)],void 0===(n=function(e,r,i){Object.defineProperty(r,"__esModule",{value:!0}),r.defineFieldProperties=function(){return{requiredFields:{type:[String],readOnly:!0},availableFields:{type:[String],readOnly:!0,dependsOn:["layer.fields","layer.outFields","requiredFields"],get:function(){var e=this,r=e.layer,t=e.layer.fields,n=e.requiredFields;return r.outFields?i.fixFields(t,i.unpackFieldNames(t,r.outFields).concat(n)):i.fixFields(t,n)}}}}}.apply(null,t))||(e.exports=n)},2346:function(e,r,i){var t,n;t=[i.dj.c(e.i),r,i(4),i(1),i(0),i(50),i(353),i(284),i(283),i(2)],void 0===(n=function(e,r,i,t,n,o,s,l,p,a){return function(e){function r(r){var i=e.call(this,r)||this;return i.layer=null,i.parent=null,i.view=null,i}return t(r,e),r.prototype.initialize=function(){},r.prototype.destroy=function(){this.layer=this.view=this.parent=null},Object.defineProperty(r.prototype,"suspended",{get:function(){return!this.canResume()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"updating",{get:function(){return!this.suspended&&this.isUpdating()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"visible",{get:function(){return!0===this.get("layer.visible")},set:function(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"fullOpacity",{get:function(){var e=function(e){return null!=e?e:1};return e(this.get("layer.opacity"))*e(this.get("parent.fullOpacity"))},enumerable:!0,configurable:!0}),r.prototype.canResume=function(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.visible||!1},r.prototype.isUpdating=function(){return!1},n([a.property()],r.prototype,"layer",void 0),n([a.property()],r.prototype,"parent",void 0),n([a.property({readOnly:!0,dependsOn:["view","visible","parent.suspended"]})],r.prototype,"suspended",null),n([a.property({type:Boolean,dependsOn:["suspended"],readOnly:!0})],r.prototype,"updating",null),n([a.property()],r.prototype,"view",void 0),n([a.property({dependsOn:["layer.visible"]})],r.prototype,"visible",null),n([a.property({dependsOn:["layer.opacity","parent.fullOpacity"]})],r.prototype,"fullOpacity",null),n([a.subclass("esri.views.3d.layers.BuildingSublayerView3D")],r)}(a.declared(s,o,l.Identifiable,p))}.apply(null,t))||(e.exports=n)},2664:function(e,r,i){var t,n;t=[i.dj.c(e.i),r,i(4),i(1),i(0),i(9),i(11),i(62),i(31),i(14),i(7),i(29),i(2),i(2665),i(2666),i(2176),i(2182),i(2180)],void 0===(n=function(e,r,i,t,n,o,s,l,p,a,u,d,c,y,f,h,g,v){return function(e){function r(){var r=null!==e&&e.apply(this,arguments)||this;return r.componentLayerViews=new p,r.groupLayerViews=new p,r._abortController=u.createAbortController(),r._loadingComponents=0,r}return t(r,e),Object.defineProperty(r.prototype,"filterExpression",{get:function(){var e=this.layer.activeFilterId,r=null!=e?this.layer.filters.find(function(r){return r.id===e}):null,i=null!=r?r.filterBlocks.find(function(e){return"solid"===e.filterMode.type}):null;return i?i.filterExpression:null},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"updatingPercentageValue",{get:function(){var e=this.componentLayerViews,r=this._loadingComponents,i=r+e.length;return e.reduce(function(e,r){return e+r.updatingPercentage},100*r)/i},enumerable:!0,configurable:!0}),r.prototype.isUpdating=function(){return this._loadingComponents>0||this.componentLayerViews.some(function(e){return e.updating})},r.prototype.initialize=function(){g.checkSpatialReference(this.layer.spatialReference,this.view.spatialReference,this.view.viewingMode),this.initializeSubLayerViews(this.layer.sublayers,this)},r.prototype.destroy=function(){this.groupLayerViews&&(this.groupLayerViews.forEach(function(e){return e.destroy()}),this.groupLayerViews=null),this.componentLayerViews&&(this.componentLayerViews.forEach(function(e){return e.destroy()}),this.componentLayerViews=null),this._abortController.abort(),this._abortController=null},r.prototype.initializeSubLayerViews=function(e,r){var i=this,t=this,n=this.view;e.forEach(function(e){if("building-group"===e.type){var o=new f({layer:e,view:n,parent:r});i.groupLayerViews.push(o),i.initializeSubLayerViews(e.sublayers,o)}else i._loadingComponents++,e.load({signal:i._abortController.signal}).then(function(){i._loadingComponents--;var o=new y({layer:e,layerView:t,view:n,parent:r});i.componentLayerViews.push(o),i.handles.add([d.init(o,"updating",function(){return i.notifyChange("updating")}),d.init(o,"updatingPercentage",function(){return i.notifyChange("updatingPercentageValue")})])})})},r.prototype.getGraphicFromStageObject=function(e,r){var i=this.componentLayerViews.find(function(r){return r.hasStageObject(e)});return i?i.getGraphicFromStageObject(e,r):null},r.prototype.fetchPopupFeatures=function(e,r){return s(this,void 0,void 0,function(){var i;return o(this,function(t){return a.isSome(r)&&r.clientGraphics&&0!==r.clientGraphics.length?(i=this._findComponent(r.clientGraphics[0].sourceLayer),a.isNone(i)?[2]:[2,i.fetchPopupFeatures(e,r)]):[2]})})},r.prototype.whenGraphicBounds=function(e){var r=this._findComponent(e.sourceLayer);return a.isNone(r)?u.reject():r.whenGraphicBounds(e)},r.prototype._findComponent=function(e){return this.componentLayerViews.find(function(r){return e===r.layer})},r.prototype.highlight=function(e,r){void 0===r&&(r={}),e instanceof l?e=[e]:e instanceof p&&(e=e.toArray());var i=[];if(Array.isArray(e)&&e.length>0&&e[0]instanceof l){for(var t=e,n=new Map,o=0,s=t;o<s.length;o++){var a=s[o],u=n.get(a.sourceLayer);null==u&&(u=[],n.set(a.sourceLayer,u)),u.push(a)}this.componentLayerViews.forEach(function(e){var r=n.get(e.layer);r&&i.push(e.highlight(r))})}return{remove:function(){return i.forEach(function(e){return e.remove()})},pause:function(){return i.forEach(function(e){return e.pause()})},resume:function(){return i.forEach(function(e){return e.resume()})}}},r.prototype.getUsedMemory=function(){return this.componentLayerViews.reduce(function(e,r){return e+r.getUsedMemory()},0)},r.prototype.getUnloadedMemory=function(){return this.componentLayerViews.reduce(function(e,r){return e+r.getUnloadedMemory()},0)},r.prototype.ignoresMemoryFactor=function(){return!1},n([c.property()],r.prototype,"layer",void 0),n([c.property()],r.prototype,"componentLayerViews",void 0),n([c.property()],r.prototype,"groupLayerViews",void 0),n([c.property({readOnly:!0,dependsOn:["layer.filters","layer.activeFilterId"]})],r.prototype,"filterExpression",null),n([c.property(v.updatingPercentage)],r.prototype,"updatingPercentage",void 0),n([c.property({readOnly:!0})],r.prototype,"updatingPercentageValue",null),n([c.subclass("esri.views.3d.layers.BuildingSceneLayerView3D")],r)}(c.declared(h))}.apply(null,t))||(e.exports=n)},2665:function(e,r,i){var t,n;t=[i.dj.c(e.i),r,i(4),i(1),i(0),i(9),i(11),i(62),i(15),i(13),i(14),i(7),i(29),i(2),i(355),i(87),i(2346),i(2272),i(2182),i(2222),i(2223),i(2188)],void 0===(n=function(e,r,i,t,n,o,s,l,p,a,u,d,c,y,f,h,g,v,w,b,F,E){var m=a.getLogger("esri.views.3d.layers.BuildingComponentSublayerView3D"),x=F.defineFieldProperties();return function(e){function r(){var r=null!==e&&e.apply(this,arguments)||this;return r.layerView=null,r._elevationContext="scene",r._isIntegratedMesh=!1,r.lodFactor=1,r.progressiveLoadFactor=1,r}return t(r,e),r.prototype.initialize=function(){var e=this;this._layerUid=this.layer.layer.uid,this.handles.add([c.init(this,["layer.renderer","definitionExpressionFields","filterExpressionFields"],function(){return e._updateRequiredFields()}),c.init(this.layer,"renderer",function(r){return e._rendererChange(r)}),this.watch(["parsedDefinitionExpression","parsedFilterExpression"],function(){return e._filterChange()})])},Object.defineProperty(r.prototype,"parsedFilterExpression",{get:function(){if("Overview"===this.layer.modelName)return null;if(u.isNone(this.layerView.filterExpression))return null;var e;try{e=f.WhereClause.create(this.layerView.filterExpression,this.layer.fieldsIndex)}catch(e){return m.error("Failed to parse filterExpression: "+e),null}if(!e.isStandardized)return m.error("filterExpression is using non standard function"),null;var r=[],i=e.fieldNames;return w.findFieldsCaseInsensitive(i,this.layer.fields,{missingFields:r}),r.length>0?(m.error("filterExpression references unknown fields: "+r.join(", ")),null):e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"filterExpressionFields",{get:function(){if(this.parsedFilterExpression){var e=this.parsedFilterExpression.fieldNames;return w.findFieldsCaseInsensitive(e,this.layer.fields)}return null},enumerable:!0,configurable:!0}),r.prototype._createLayerGraphic=function(e){var r=new l(null,null,e);return r.layer=this.layer.layer,r.sourceLayer=this.layer,r},r.prototype.canResume=function(){return this.inherited(arguments)&&(!this._controller||this._controller.rootNodeVisible)},r.prototype.isUpdating=function(){return!(!this._controller||!this._controller.updating)},r.prototype.fetchPopupFeatures=function(e,r){return s(this,void 0,void 0,function(){var e,i,t,n,s,l,p,a,c;return o(this,function(o){switch(o.label){case 0:return(e=this._validateFetchPopupFeatures(r))?[2,d.reject(e)]:u.isSome(r)&&r.clientGraphics&&0!==r.clientGraphics.length?(i=[],t=[],s=h.unpackFieldNames,l=[this.layer.fields],[4,E.getRequiredFields(this.layer,E.getFetchPopupTemplate(this.layer,r))]):[2,[]];case 1:for(n=s.apply(void 0,l.concat([o.sent()])),p=0,a=r.clientGraphics;p<a.length;p++)c=a[p],h.featureHasFields(n,c)?i.push(c):t.push(c);return 0===t.length?[2,d.resolve(i)]:[2,this.whenGraphicAttributes(t,n).catch(function(){return t}).then(function(e){return i.concat(e)})]}})})},r.prototype._updateRequiredFields=function(){return s(this,void 0,void 0,function(){var e,r,i,t;return o(this,function(n){switch(n.label){case 0:return r=h.fixFields,i=[this.layer.fields],this.layer.renderer?[4,this.layer.renderer.getRequiredFields(this.layer.fields)]:[3,2];case 1:return t=n.sent(),[3,3];case 2:t=[],n.label=3;case 3:return e=r.apply(void 0,i.concat([t.concat(this.definitionExpressionFields||[],this.filterExpressionFields||[])])),this._set("requiredFields",e),[2]}})})},r.prototype._validateFetchPopupFeatures=function(e){var r=this.layer;return r.popupEnabled?E.getFetchPopupTemplate(r,e)?void 0:new p("buildingscenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:r}):new p("buildingscenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:r})},r.prototype.getFilters=function(){var e=this.inherited(arguments);return this.addSqlFilter(e,this.parsedFilterExpression,this.filterExpressionFields,this.logError),this.addSqlFilter(e,this.parsedDefinitionExpression,this.definitionExpressionFields,this.logError),e},n([y.property()],r.prototype,"layer",void 0),n([y.property()],r.prototype,"layerView",void 0),n([y.property({dependsOn:["_controller.updating"]})],r.prototype,"updating",void 0),n([y.property({dependsOn:["_controller.rootNodeVisible"]})],r.prototype,"suspended",void 0),n([y.property({readOnly:!0,aliasOf:"view.qualitySettings.sceneService.3dObject.lodFactor"})],r.prototype,"lodFactor",void 0),n([y.property({readOnly:!0,dependsOn:["layerView.filterExpression","layer.fieldsIndex"]})],r.prototype,"parsedFilterExpression",null),n([y.property({type:[String],readOnly:!0,dependsOn:["parsedFilterExpression"]})],r.prototype,"filterExpressionFields",null),n([y.property(x.requiredFields)],r.prototype,"requiredFields",void 0),n([y.property(x.availableFields)],r.prototype,"availableFields",void 0),n([y.subclass("esri.views.3d.layers.BuildingComponentSublayerView3D")],r)}(y.declared(g,v.I3SMeshView3D,b.DefinitionExpressionSceneLayerView))}.apply(null,t))||(e.exports=n)},2666:function(e,r,i){var t,n;t=[i.dj.c(e.i),r,i(4),i(1),i(0),i(2),i(2346)],void 0===(n=function(e,r,i,t,n,o,s){return function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return t(r,e),n([o.subclass("esri.views.3d.layers.BuildingGroupSublayerView3D")],r)}(o.declared(s))}.apply(null,t))||(e.exports=n)}}]);