(function(){(this||window).webpackJsonp.registerAbsMids({"esri/layers/graphics/data/FeatureFilter":2347})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[69],{2347:function(t,e,i){var r,s;r=[i.dj.c(t.i),e,i(11),i(4),i(9),i(116),i(15),i(13),i(14),i(7),i(44),i(493),i(371),i(838),i(543),i(542),i(361),i(163)],void 0===(s=function(t,e,i,r,s,o,n,a,l,h,u,d,p,c,y,f,_,m){Object.defineProperty(e,"__esModule",{value:!0});var v=a.getLogger("esri.views.2d.layers.features.controllers.FeatureFilter"),b=1,w=2,g=function(){function t(t){var e=this;this._geometryBounds=u.create(),this._idToVisibility=new Map,this.check=function(t){var i=t.objectId,r=e._idToVisibility,s=e._applyFilter(t);return r.set(i,s?b|w:w),!!(r.get(i)&b)},this._serviceInfo=t}return Object.defineProperty(t.prototype,"hash",{get:function(){return this._hash},enumerable:!0,configurable:!0}),t.prototype.clear=function(){var t=this._resetAllHiddenIds();return this.update(),{show:t,hide:[]}},t.prototype.invalidate=function(){var t=this;this._idToVisibility.forEach(function(e,i){t._idToVisibility.set(i,0)})},t.prototype.setKnownIds=function(t){for(var e=0,i=t;e<i.length;e++){var r=i[e];this._idToVisibility.set(r,b)}},t.prototype.setTrue=function(t){var e=this,i=[],r=[],s=new o.default(t);return this._idToVisibility.forEach(function(t,o){var n=!!(e._idToVisibility.get(o)&b),a=s.has(o);!n&&a?i.push(o):n&&!a&&r.push(o),e._idToVisibility.set(o,a?b|w:0)}),{show:i,hide:r}},t.prototype.createQuery=function(){var t=this,e=t.geometry,i=t.spatialRel,r=t.where,s=t.timeExtent,o=t.objectIds;return m.fromJSON({geometry:e,spatialRel:i,where:r,timeExtent:s,objectIds:o})},t.prototype.update=function(t,e,r){return i(this,void 0,void 0,function(){var i;return s(this,function(s){switch(s.label){case 0:return this._hash=JSON.stringify(t),[4,_.normalizeQueryLike(t,e,r)];case 1:return i=s.sent(),[4,h.all([this._setGeometryFilter(i),this._setIdFilter(i),this._setAttributeFilter(i),this._setTimeFilter(i)])];case 2:return s.sent(),[2]}})})},t.prototype._setAttributeFilter=function(t){if(!t||!t.where)return this._clause=null,void(this.where=null);var e=p.getWhereClause(t.where,this._serviceInfo.fieldsIndex);if(e.isStandardized)this._clause=e;else{var i=new n("mapview - bad input","Unable to apply filter's definition expression, as expression is not standardized.",e);v.error(i)}this.where=t.where},t.prototype._setIdFilter=function(t){this._idsToShow=t&&t.objectIds&&new o.default(t.objectIds),this._idsToHide=t&&t.hiddenIds&&new o.default(t.hiddenIds),this.objectIds=t&&t.objectIds},t.prototype._setGeometryFilter=function(t){return i(this,void 0,void 0,function(){var e,i,r;return s(this,function(s){switch(s.label){case 0:return t&&t.geometry?(e=t.geometry,i=t.spatialRel||"esriSpatialRelIntersects",[4,y.getSpatialQueryOperator(i,e,this._serviceInfo)]):(this._spatialQueryOperator=null,this.geometry=null,this.spatialRel=null,[2]);case 1:return r=s.sent(),d.getBoundsXY(this._geometryBounds,e),this._spatialQueryOperator=r,this.geometry=e,this.spatialRel=i,[2]}})})},t.prototype._setTimeFilter=function(t){if(this.timeExtent=this._timeOperator=null,t&&t.timeExtent){if(!this._serviceInfo.timeInfo){var e=new n("feature-layer-view:time-filter-not-available","Unable to apply time filter, as layer doesn't have time metadata.",t.timeExtent);return void v.error(e)}this.timeExtent=t.timeExtent,this._timeOperator=f.getTimeOperator(this._serviceInfo.timeInfo,t.timeExtent,c.optimizedFeatureQueryEngineAdapter)}},t.prototype._applyFilter=function(t){return this._filterByGeometry(t)&&this._filterById(t)&&this._filterByTime(t)&&this._filterByExpression(t)},t.prototype._filterByExpression=function(t){return!this.where||this._clause.testFeature(t)},t.prototype._filterById=function(t){return(!this._idsToHide||!this._idsToHide.has(t.objectId))&&(!this._idsToShow||this._idsToShow.has(t.objectId))},t.prototype._filterByGeometry=function(t){return!this.geometry||!!this._earlyGeometryReject(t)&&this._spatialQueryOperator(t.geometry)},t.prototype._filterByTime=function(t){return!l.isSome(this._timeOperator)||this._timeOperator(t)},t.prototype._earlyGeometryReject=function(t){return!(!t.geometry||!t.geometry.coords.length)&&(!t.centroid||"esriSpatialRelContains"!==this.spatialRel||u.containsPoint(this._geometryBounds,t.centroid.coords))},t.prototype._resetAllHiddenIds=function(){var t=this,e=[];return this._idToVisibility.forEach(function(i,r){i&b||(t._idToVisibility.set(r,b),e.push(r))}),e},t}();e.default=g}.apply(null,r))||(t.exports=s)}}]);